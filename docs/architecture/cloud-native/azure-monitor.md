---
title: Azure Monitor
description: Azure Monitor を使用すると、システムの稼働状況を可視化できます。
ms.date: 01/19/2021
ms.openlocfilehash: a93b71db642e05a830b20b80d8387c24d35ea8c1
ms.sourcegitcommit: f2ab02d9a780819ca2e5310bbcf5cfe5b7993041
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 02/03/2021
ms.locfileid: "99506176"
---
# <a name="azure-monitor"></a><span data-ttu-id="20d4c-103">Azure Monitor</span><span class="sxs-lookup"><span data-stu-id="20d4c-103">Azure Monitor</span></span>

<span data-ttu-id="20d4c-104">Azure ほど成熟したクラウド アプリケーション監視ソリューションを提供しているクラウド プロバイダーは他にありません。</span><span class="sxs-lookup"><span data-stu-id="20d4c-104">No other cloud provider has as mature of a cloud application monitoring solution than that found in Azure.</span></span> <span data-ttu-id="20d4c-105">Azure Monitor は、システムの状態の可視性を提供するように設計されたツールのコレクションを示す包括的な名称です。</span><span class="sxs-lookup"><span data-stu-id="20d4c-105">Azure Monitor is an umbrella name for a collection of tools designed to provide visibility into the state of your system.</span></span> <span data-ttu-id="20d4c-106">クラウドネイティブ サービスがどのように実行されているかを理解するのに役立ち、それらに影響する問題を事前に特定することができます。</span><span class="sxs-lookup"><span data-stu-id="20d4c-106">It helps you understand how your cloud-native services are performing and proactively identifies issues affecting them.</span></span> <span data-ttu-id="20d4c-107">図 7-12 は、Azure Monitor の概要図です。</span><span class="sxs-lookup"><span data-stu-id="20d4c-107">Figure 7-12 presents a high level of view of Azure Monitor.</span></span>

<span data-ttu-id="20d4c-108">![Azure Monitor の概要。](./media/azure-monitor.png)
**図 7-12**.</span><span class="sxs-lookup"><span data-stu-id="20d4c-108">![High-level view of Azure Monitor.](./media/azure-monitor.png)
**Figure 7-12**.</span></span> <span data-ttu-id="20d4c-109">Azure Monitor の概要。</span><span class="sxs-lookup"><span data-stu-id="20d4c-109">High-level view of Azure Monitor.</span></span>

## <a name="gathering-logs-and-metrics"></a><span data-ttu-id="20d4c-110">ログとメトリックの収集</span><span class="sxs-lookup"><span data-stu-id="20d4c-110">Gathering logs and metrics</span></span>

<span data-ttu-id="20d4c-111">監視ソリューションの最初の手順は、できるだけ多くのデータを収集することです。</span><span class="sxs-lookup"><span data-stu-id="20d4c-111">The first step in any monitoring solution is to gather as much data as possible.</span></span> <span data-ttu-id="20d4c-112">収集されるデータが多いほど、より深い分析情報を得られます。</span><span class="sxs-lookup"><span data-stu-id="20d4c-112">The more data gathered, the deeper the insights.</span></span> <span data-ttu-id="20d4c-113">従来、システムのインストルメント化は困難でした。</span><span class="sxs-lookup"><span data-stu-id="20d4c-113">Instrumenting systems has traditionally been difficult.</span></span> <span data-ttu-id="20d4c-114">簡易ネットワーク管理プロトコル (SNMP) は、マシン レベルの情報を収集するための代表的なプロトコルでしたが、多くの知識と構成が必要でした。</span><span class="sxs-lookup"><span data-stu-id="20d4c-114">Simple Network Management Protocol (SNMP) was the gold standard protocol for collecting machine level information, but it required a great deal of knowledge and configuration.</span></span> <span data-ttu-id="20d4c-115">幸い、最も一般的なメトリックは Azure Monitor によって自動的に収集されるため、このような苦労の多くが解消されました。</span><span class="sxs-lookup"><span data-stu-id="20d4c-115">Fortunately, much of this hard work has been eliminated as the most common metrics are gathered automatically by Azure Monitor.</span></span>

<span data-ttu-id="20d4c-116">アプリケーション レベルのメトリックとイベントは、デプロイされるアプリケーションに固有であるため、自動的に計測することはできません。</span><span class="sxs-lookup"><span data-stu-id="20d4c-116">Application level metrics and events aren't possible to instrument automatically because they're specific to the application being deployed.</span></span> <span data-ttu-id="20d4c-117">このようなメトリックを収集するために、お客様がサインアップしたときや注文を完了したときなどに、そのような情報を直接報告するための [SDK と API が用意されています](/azure/azure-monitor/app/api-custom-events-metrics)。</span><span class="sxs-lookup"><span data-stu-id="20d4c-117">In order to gather these metrics, there are [SDKs and APIs available](/azure/azure-monitor/app/api-custom-events-metrics) to directly report such information, such as when a customer signs up or completes an order.</span></span> <span data-ttu-id="20d4c-118">例外をキャプチャし、Application Insights を介して Azure Monitor に報告することもできます。</span><span class="sxs-lookup"><span data-stu-id="20d4c-118">Exceptions can also be captured and reported back into Azure Monitor via Application Insights.</span></span> <span data-ttu-id="20d4c-119">SDK は、Go、Python、JavaScript、.NET 言語など、クラウド ネイティブ アプリケーションにあるほとんどすべての言語をサポートしています。</span><span class="sxs-lookup"><span data-stu-id="20d4c-119">The SDKs support most every language found in Cloud Native Applications including Go, Python, JavaScript, and the .NET languages.</span></span>

<span data-ttu-id="20d4c-120">アプリケーションの状態に関する情報を収集する最終的な目標は、エンド ユーザーに優れたエクスペリエンスを提供することです。</span><span class="sxs-lookup"><span data-stu-id="20d4c-120">The ultimate goal of gathering information about the state of your application is to ensure that your end users have a good experience.</span></span> <span data-ttu-id="20d4c-121">ユーザーに問題が発生しているかどうかを判断するには、[アウトサイドイン Web テスト](/azure/azure-monitor/app/monitor-web-app-availability)を実行するのが一番です。</span><span class="sxs-lookup"><span data-stu-id="20d4c-121">What better way to tell if users are experiencing issues than doing [outside-in web tests](/azure/azure-monitor/app/monitor-web-app-availability)?</span></span> <span data-ttu-id="20d4c-122">これらのテストは、世界各国の場所から Web サイトに ping を送信するような単純なものから、エージェントがサイトにログインしてユーザーの行動をシミュレートするような複雑なものまであります。</span><span class="sxs-lookup"><span data-stu-id="20d4c-122">These tests can be as simple as pinging your website from locations around the world or as involved as having agents log into the site and simulate user actions.</span></span>

## <a name="reporting-data"></a><span data-ttu-id="20d4c-123">データの報告</span><span class="sxs-lookup"><span data-stu-id="20d4c-123">Reporting data</span></span>

<span data-ttu-id="20d4c-124">データを収集した後は、それを操作し、要約し、グラフにプロットすることができます。これで、ユーザーは問題が発生したときにすぐに確認できるようになります。</span><span class="sxs-lookup"><span data-stu-id="20d4c-124">Once the data is gathered, it can be manipulated, summarized, and plotted into charts, which allow users to instantly see when there are problems.</span></span> <span data-ttu-id="20d4c-125">このようなグラフは、ダッシュボードまたはブック (システムのある側面についてのストーリーを伝えるように設計された複数ページのレポート) にまとめることができます。</span><span class="sxs-lookup"><span data-stu-id="20d4c-125">These charts can be gathered into dashboards or into Workbooks, a multi-page report designed to tell a story about some aspect of the system.</span></span>

<span data-ttu-id="20d4c-126">現代のアプリケーションは、人工知能や機械学習を抜きにしては成り立ちません。</span><span class="sxs-lookup"><span data-stu-id="20d4c-126">No modern application would be complete without some artificial intelligence or machine learning.</span></span> <span data-ttu-id="20d4c-127">そのためにデータを Azure のさまざまな機械学習ツールに[渡す](https://www.youtube.com/watch?v=Cuza-I1g9tw)ことで、他の方法では隠れてしまうような傾向や情報を抽出することができます。</span><span class="sxs-lookup"><span data-stu-id="20d4c-127">To this end, data [can be passed](https://www.youtube.com/watch?v=Cuza-I1g9tw) to the various machine learning tools in Azure to allow you to extract trends and information that would otherwise be hidden.</span></span>

<span data-ttu-id="20d4c-128">Application Insights には *Kusto* という強力な (SQL に似た) クエリ言語が用意されており、レコードのクエリを実行し、要約し、グラフをプロットすることができます。</span><span class="sxs-lookup"><span data-stu-id="20d4c-128">Application Insights provides a powerful (SQL-like) query language called *Kusto* that can query records, summarize them, and even plot charts.</span></span> <span data-ttu-id="20d4c-129">たとえば、次のクエリを実行すると、2007 年 11 月のすべてのレコードが検索され、それらが州ごとにグループ化され、上位 10 件が円グラフとしてプロットされます。</span><span class="sxs-lookup"><span data-stu-id="20d4c-129">For example, the following query will locate all records for the month of November 2007, group them by state, and plot the top 10 as a pie chart.</span></span>

```kusto
StormEvents
| where StartTime >= datetime(2007-11-01) and StartTime < datetime(2007-12-01)
| summarize count() by State
| top 10 by count_
| render piechart
```

<span data-ttu-id="20d4c-130">図 7-13 は、この Application Insights クエリの結果を示しています。</span><span class="sxs-lookup"><span data-stu-id="20d4c-130">Figure 7-13 shows the results of this Application Insights Query.</span></span>

<span data-ttu-id="20d4c-131">![Application Insights のクエリ結果](./media/application_insights_example.png)
**図 7-13**.</span><span class="sxs-lookup"><span data-stu-id="20d4c-131">![Application Insights query results](./media/application_insights_example.png)
**Figure 7-13**.</span></span> <span data-ttu-id="20d4c-132">Application Insights のクエリ結果。</span><span class="sxs-lookup"><span data-stu-id="20d4c-132">Application Insights query results.</span></span>

<span data-ttu-id="20d4c-133">[Kusto クエリを試すためのプレイグラウンド](https://dataexplorer.azure.com/clusters/help/databases/Samples)があります。</span><span class="sxs-lookup"><span data-stu-id="20d4c-133">There is a [playground for experimenting with Kusto](https://dataexplorer.azure.com/clusters/help/databases/Samples) queries.</span></span> <span data-ttu-id="20d4c-134">[サンプル クエリ](/azure/kusto/query/samples)を参照することもお勧めします。</span><span class="sxs-lookup"><span data-stu-id="20d4c-134">Reading [sample queries](/azure/kusto/query/samples) can also be instructive.</span></span>

## <a name="dashboards"></a><span data-ttu-id="20d4c-135">ダッシュボード</span><span class="sxs-lookup"><span data-stu-id="20d4c-135">Dashboards</span></span>

<span data-ttu-id="20d4c-136">Azure Monitor からの情報を表示するために使用できるダッシュボード テクノロジがいくつかあります。</span><span class="sxs-lookup"><span data-stu-id="20d4c-136">There are several different dashboard technologies that may be used to surface the information from Azure Monitor.</span></span> <span data-ttu-id="20d4c-137">おそらく、最も簡単なのは、Application Insights でクエリを実行し、[データをグラフにプロットする](/azure/azure-monitor/learn/tutorial-app-dashboards)ことです。</span><span class="sxs-lookup"><span data-stu-id="20d4c-137">Perhaps the simplest is to just run queries in Application Insights and [plot the data into a chart](/azure/azure-monitor/learn/tutorial-app-dashboards).</span></span>

<span data-ttu-id="20d4c-138">![メインの Azure ダッシュボードに埋め込まれた Application Insights グラフの例](./media/azure_dashboard.png)
**図 7-14**.</span><span class="sxs-lookup"><span data-stu-id="20d4c-138">![An example of Application Insights charts embedded in the main Azure Dashboard](./media/azure_dashboard.png)
**Figure 7-14**.</span></span> <span data-ttu-id="20d4c-139">メインの Azure ダッシュボードに埋め込まれた Application Insights グラフの例。</span><span class="sxs-lookup"><span data-stu-id="20d4c-139">An example of Application Insights charts embedded in the main Azure Dashboard.</span></span>

<span data-ttu-id="20d4c-140">このようなグラフは、Azure portal でダッシュボード機能を使用して適切に埋め込むことができます。</span><span class="sxs-lookup"><span data-stu-id="20d4c-140">These charts can then be embedded in the Azure portal proper through use of the dashboard feature.</span></span> <span data-ttu-id="20d4c-141">複数の層のデータにドリルダウンできることなど、より厳しい要件を持つユーザーの場合は、Azure Monitor データを [Power BI](https://powerbi.microsoft.com/) から使用できます。</span><span class="sxs-lookup"><span data-stu-id="20d4c-141">For users with more exacting requirements, such as being able to drill down into several tiers of data, Azure Monitor data is available to [Power BI](https://powerbi.microsoft.com/).</span></span> <span data-ttu-id="20d4c-142">Power BI は、業界をリードするエンタープライズ クラスのビジネス インテリジェンス ツールであり、さまざまなデータソースからデータを集計することができます。</span><span class="sxs-lookup"><span data-stu-id="20d4c-142">Power BI is an industry-leading, enterprise class, business intelligence tool that can aggregate data from many different data sources.</span></span>

![Power BI ダッシュボードの例](./media/powerbidashboard.png)

<span data-ttu-id="20d4c-144">**図 7-15**。</span><span class="sxs-lookup"><span data-stu-id="20d4c-144">**Figure 7-15**.</span></span> <span data-ttu-id="20d4c-145">Power BI ダッシュボードの例</span><span class="sxs-lookup"><span data-stu-id="20d4c-145">An example Power BI dashboard.</span></span>

## <a name="alerts"></a><span data-ttu-id="20d4c-146">警告</span><span class="sxs-lookup"><span data-stu-id="20d4c-146">Alerts</span></span>

<span data-ttu-id="20d4c-147">データ ダッシュボードがあるだけでは不十分な場合があります。</span><span class="sxs-lookup"><span data-stu-id="20d4c-147">Sometimes, having data dashboards is insufficient.</span></span> <span data-ttu-id="20d4c-148">ダッシュボードを見るために起きている人がいなければ、問題が解決されるまで、または検出されるまでに何時間もかかる可能性があります。</span><span class="sxs-lookup"><span data-stu-id="20d4c-148">If nobody is awake to watch the dashboards, then it can still be many hours before a problem is addressed, or even detected.</span></span> <span data-ttu-id="20d4c-149">このため、Azure Monitor には、最上級の[アラート ソリューション](/azure/azure-monitor/platform/alerts-overview)も用意されています。</span><span class="sxs-lookup"><span data-stu-id="20d4c-149">To this end, Azure Monitor also provides a top notch [alerting solution](/azure/azure-monitor/platform/alerts-overview).</span></span> <span data-ttu-id="20d4c-150">アラートは、次のようにさまざまな条件でトリガーされる可能性があります。</span><span class="sxs-lookup"><span data-stu-id="20d4c-150">Alerts can be triggered by a wide range of conditions including:</span></span>

- <span data-ttu-id="20d4c-151">メトリックの値</span><span class="sxs-lookup"><span data-stu-id="20d4c-151">Metric values</span></span>
- <span data-ttu-id="20d4c-152">ログの検索クエリ</span><span class="sxs-lookup"><span data-stu-id="20d4c-152">Log search queries</span></span>
- <span data-ttu-id="20d4c-153">アクティビティ ログのイベント</span><span class="sxs-lookup"><span data-stu-id="20d4c-153">Activity Log events</span></span>
- <span data-ttu-id="20d4c-154">基になっている Azure プラットフォームの正常性</span><span class="sxs-lookup"><span data-stu-id="20d4c-154">Health of the underlying Azure platform</span></span>
- <span data-ttu-id="20d4c-155">Web サイトの可用性のテスト</span><span class="sxs-lookup"><span data-stu-id="20d4c-155">Tests for web site availability</span></span>

<span data-ttu-id="20d4c-156">トリガーされると、アラートによってさまざまなタスクを実行できます。</span><span class="sxs-lookup"><span data-stu-id="20d4c-156">When triggered, the alerts can perform a wide variety of tasks.</span></span> <span data-ttu-id="20d4c-157">簡単な例を挙げると、アラートによって、単にメーリング リストにメールの通知を送信したり、個人にテキスト メッセージを送ったりすることができます。</span><span class="sxs-lookup"><span data-stu-id="20d4c-157">On the simple side, the alerts may just send an e-mail notification to a mailing list or a text message to an individual.</span></span> <span data-ttu-id="20d4c-158">より複雑なアラートの場合は、特定のアプリケーションについて待機者を認識する機能がある PagerDuty のようなツールで、ワークフローをトリガーすることができます。</span><span class="sxs-lookup"><span data-stu-id="20d4c-158">More involved alerts might trigger a workflow in a tool such as PagerDuty, which is aware of who is on call for a particular application.</span></span> <span data-ttu-id="20d4c-159">アラートを使用して [Microsoft Flow](https://flow.microsoft.com/) のアクションをトリガーすると、ワークフローの可能性をほぼ無限に広げることができます。</span><span class="sxs-lookup"><span data-stu-id="20d4c-159">Alerts can trigger actions in [Microsoft Flow](https://flow.microsoft.com/) unlocking near limitless possibilities for workflows.</span></span>

<span data-ttu-id="20d4c-160">アラートの一般的な原因が特定されたら、アラートの一般的な原因とそれを解決するための手順に関する詳細情報を使って、アラートを強化することができます。</span><span class="sxs-lookup"><span data-stu-id="20d4c-160">As common causes of alerts are identified, the alerts can be enhanced with details about the common causes of the alerts and the steps to take to resolve them.</span></span> <span data-ttu-id="20d4c-161">高度に成熟したクラウドネイティブ アプリケーションのデプロイの場合、自己修復タスクを開始し、スケール セットから障害ノードを削除したり、自動スケーリング アクティビティをトリガーしたりするなどのアクションを実行することができます。</span><span class="sxs-lookup"><span data-stu-id="20d4c-161">Highly mature cloud-native application deployments may opt to kick off self-healing tasks, which perform actions such as removing failing nodes from a scale set or triggering an autoscaling activity.</span></span> <span data-ttu-id="20d4c-162">最終的には、ライブ サイトの問題を解決するために午前 2 時に待機担当者を起こす必要はなくなる可能性があります。安定するように自動的に調整されるか、少なくとも翌朝に誰かが出社するまでは持ちこたえることができるようになるからです。</span><span class="sxs-lookup"><span data-stu-id="20d4c-162">Eventually it may no longer be necessary to wake up on-call personnel at 2AM to resolve a live-site issue as the system will be able to adjust itself to compensate or at least limp along until somebody arrives at work the next morning.</span></span>

<span data-ttu-id="20d4c-163">Azure Monitor には、デプロイされたアプリケーションの正常な動作パラメーターを把握するために機械学習が自動的に利用されています。</span><span class="sxs-lookup"><span data-stu-id="20d4c-163">Azure Monitor automatically leverages machine learning to understand the normal operating parameters of deployed applications.</span></span> <span data-ttu-id="20d4c-164">このアプローチにより、通常のパラメーターから外れて動作しているサービスを検出することができます。</span><span class="sxs-lookup"><span data-stu-id="20d4c-164">This approach enables it to detect services that are operating outside of their normal parameters.</span></span> <span data-ttu-id="20d4c-165">たとえば、平日の一般的なサイトのトラフィックが 1 分あたり 10,000 要求だとします。</span><span class="sxs-lookup"><span data-stu-id="20d4c-165">For instance, the typical weekday traffic on the site might be 10,000 requests per minute.</span></span> <span data-ttu-id="20d4c-166">そして、ある週に、突然、要求数が 1 分あたり 20,000 要求という通常とはかけ離れた数字になったとします。</span><span class="sxs-lookup"><span data-stu-id="20d4c-166">And then, on a given week, suddenly the number of requests hits a highly unusual 20,000 requests per minute.</span></span> <span data-ttu-id="20d4c-167">[スマート検出](/azure/azure-monitor/app/proactive-diagnostics)により、このような標準値からの逸脱が検出され、アラートがトリガーされます。</span><span class="sxs-lookup"><span data-stu-id="20d4c-167">[Smart Detection](/azure/azure-monitor/app/proactive-diagnostics) will notice this deviation from the norm and trigger an alert.</span></span> <span data-ttu-id="20d4c-168">同時に、高度な傾向分析により、トラフィックの負荷が予想される場合には、誤検知の生成が回避されます。</span><span class="sxs-lookup"><span data-stu-id="20d4c-168">At the same time, the trend analysis is smart enough to avoid firing false positives when the traffic load is expected.</span></span>

## <a name="references"></a><span data-ttu-id="20d4c-169">リファレンス</span><span class="sxs-lookup"><span data-stu-id="20d4c-169">References</span></span>

- [<span data-ttu-id="20d4c-170">Azure Monitor</span><span class="sxs-lookup"><span data-stu-id="20d4c-170">Azure Monitor</span></span>](/azure/azure-monitor/overview)

>[!div class="step-by-step"]
><span data-ttu-id="20d4c-171">[前へ](monitoring-azure-kubernetes.md)
>[次へ](identity.md)</span><span class="sxs-lookup"><span data-stu-id="20d4c-171">[Previous](monitoring-azure-kubernetes.md)
[Next](identity.md)</span></span>
