---
title: 集中管理構成
description: Azure App Configuration と AzureKey Vault を使用したクラウドネイティブ アプリの構成の一元化。
ms.date: 01/19/2021
ms.openlocfilehash: 770c0c19a6de01250c59a586badb6a4afa2e9ae5
ms.sourcegitcommit: f2ab02d9a780819ca2e5310bbcf5cfe5b7993041
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 02/03/2021
ms.locfileid: "99505714"
---
# <a name="centralized-configuration"></a><span data-ttu-id="26d5f-103">集中管理構成</span><span class="sxs-lookup"><span data-stu-id="26d5f-103">Centralized configuration</span></span>

<span data-ttu-id="26d5f-104">すべてが 1 つのインスタンス内で動作するモノリシック アプリとは異なり、クラウドネイティブ アプリは、仮想マシン、コンテナー、地域に分散された、独立したサービスで構成されています。</span><span class="sxs-lookup"><span data-stu-id="26d5f-104">Unlike a monolithic app in which everything runs within a single instance, a cloud-native application consists of independent services distributed across virtual machines, containers, and geographic regions.</span></span> <span data-ttu-id="26d5f-105">相互に依存する何十個ものサービスの構成設定を管理することは困難です。</span><span class="sxs-lookup"><span data-stu-id="26d5f-105">Managing configuration settings for dozens of interdependent services can be challenging.</span></span> <span data-ttu-id="26d5f-106">さまざまな場所に構成設定の重複するコピーがあると、エラーが発生しやすく、管理も困難になります。</span><span class="sxs-lookup"><span data-stu-id="26d5f-106">Duplicate copies of configuration settings across different locations are error prone and difficult to manage.</span></span> <span data-ttu-id="26d5f-107">一元化された構成は、分散型クラウドネイティブ アプリケーションにとって重要な要件です。</span><span class="sxs-lookup"><span data-stu-id="26d5f-107">Centralized configuration is a critical requirement for distributed cloud-native applications.</span></span>

<span data-ttu-id="26d5f-108">[第 1 章](introduction.md)で説明したように、Twelve-Factor App (12 要素アプリ) の推奨事項では、コードと構成を厳密に分離する必要があります。</span><span class="sxs-lookup"><span data-stu-id="26d5f-108">As discussed in [Chapter 1](introduction.md), the Twelve-Factor App recommendations require strict separation between code and configuration.</span></span> <span data-ttu-id="26d5f-109">構成はアプリケーションの外部に格納し、必要に応じて読み込む必要があります。</span><span class="sxs-lookup"><span data-stu-id="26d5f-109">Configuration must be stored externally from the application and read-in as needed.</span></span> <span data-ttu-id="26d5f-110">構成値を定数やリテラル値としてコードに格納することは違反になります。</span><span class="sxs-lookup"><span data-stu-id="26d5f-110">Storing configuration values as constants or literal values in code is a violation.</span></span> <span data-ttu-id="26d5f-111">同じアプリケーション内の多くのサービスで、同じ構成値が使用されることはよくあります。</span><span class="sxs-lookup"><span data-stu-id="26d5f-111">The same configuration values are often be used by many services in the same application.</span></span> <span data-ttu-id="26d5f-112">さらに、開発、テスト、運用など、複数の環境で同じ値をサポートする必要があります。</span><span class="sxs-lookup"><span data-stu-id="26d5f-112">Additionally, we must support the same values across multiple environments, such as dev, testing, and production.</span></span> <span data-ttu-id="26d5f-113">ベスト プラクティスは、それらを一元化された構成ストアに格納することです。</span><span class="sxs-lookup"><span data-stu-id="26d5f-113">The best practice is store them in a centralized configuration store.</span></span>

<span data-ttu-id="26d5f-114">Azure クラウドにはいくつかの素晴らしい選択肢があります。</span><span class="sxs-lookup"><span data-stu-id="26d5f-114">The Azure cloud presents several great options.</span></span>

## <a name="azure-app-configuration"></a><span data-ttu-id="26d5f-115">Azure App Configuration</span><span class="sxs-lookup"><span data-stu-id="26d5f-115">Azure App Configuration</span></span>

<span data-ttu-id="26d5f-116">[Azure App Configuration](/azure/azure-app-configuration/overview) は、フル マネージド Azure サービスであり、シークレットではない構成設定が安全な一元化された場所に格納されます。</span><span class="sxs-lookup"><span data-stu-id="26d5f-116">[Azure App Configuration](/azure/azure-app-configuration/overview) is a fully managed Azure service that stores non-secret configuration settings in a secure, centralized location.</span></span> <span data-ttu-id="26d5f-117">格納された値は、複数のサービスやアプリケーション間で共有できます。</span><span class="sxs-lookup"><span data-stu-id="26d5f-117">Stored values can be shared among multiple services and applications.</span></span>

<span data-ttu-id="26d5f-118">このサービスは使いやすく、いくつかの利点があります。</span><span class="sxs-lookup"><span data-stu-id="26d5f-118">The service is simple to use and provides several benefits:</span></span>

- <span data-ttu-id="26d5f-119">柔軟性に優れたキーと値による表現とマッピング</span><span class="sxs-lookup"><span data-stu-id="26d5f-119">Flexible key/value representations and mappings</span></span>
- <span data-ttu-id="26d5f-120">Azure ラベルによるタグ付け</span><span class="sxs-lookup"><span data-stu-id="26d5f-120">Tagging with Azure labels</span></span>
- <span data-ttu-id="26d5f-121">管理専用の UI</span><span class="sxs-lookup"><span data-stu-id="26d5f-121">Dedicated UI for management</span></span>
- <span data-ttu-id="26d5f-122">機密情報の暗号化</span><span class="sxs-lookup"><span data-stu-id="26d5f-122">Encryption of sensitive information</span></span>
- <span data-ttu-id="26d5f-123">クエリとバッチ取得</span><span class="sxs-lookup"><span data-stu-id="26d5f-123">Querying and batch retrieval</span></span>

<span data-ttu-id="26d5f-124">Azure App Configuration により、キー値設定に加えられた変更が 7 日間維持されます。</span><span class="sxs-lookup"><span data-stu-id="26d5f-124">Azure App Configuration maintains changes made to key-value settings for seven days.</span></span> <span data-ttu-id="26d5f-125">ポイントインタイム スナップショット機能を使用すると、設定の履歴を再構築し、失敗したデプロイをロールバックすることもできます。</span><span class="sxs-lookup"><span data-stu-id="26d5f-125">The point-in-time snapshot feature enables you to reconstruct the history of a setting and even rollback for a failed deployment.</span></span>

<span data-ttu-id="26d5f-126">App Configuration では、構成ストアへの呼び出しが多くなりすぎないようにするため、個々の設定が自動的にキャッシュされます。</span><span class="sxs-lookup"><span data-stu-id="26d5f-126">App Configuration automatically caches each setting to avoid excessive calls to the configuration store.</span></span> <span data-ttu-id="26d5f-127">キャッシュされた設定の値は、構成ストアで変更されたとしても、その有効期限が切れるまで、設定の更新操作は先延ばしされます。</span><span class="sxs-lookup"><span data-stu-id="26d5f-127">The refresh operation waits until the cached value of a setting expires to update that setting, even when its value changes in the configuration store.</span></span> <span data-ttu-id="26d5f-128">キャッシュの既定の有効期間は 30 秒です。</span><span class="sxs-lookup"><span data-stu-id="26d5f-128">The default cache expiration time is 30 seconds.</span></span> <span data-ttu-id="26d5f-129">有効期間はオーバーライドすることができます。</span><span class="sxs-lookup"><span data-stu-id="26d5f-129">You can override the expiration time.</span></span>

<span data-ttu-id="26d5f-130">App Configuration により、転送中と保存中のすべての構成値が暗号化されます。</span><span class="sxs-lookup"><span data-stu-id="26d5f-130">App Configuration encrypts all configuration values in transit and at rest.</span></span> <span data-ttu-id="26d5f-131">キー名とラベルは、構成データを取得するためのインデックスとして使用され、暗号化されません。</span><span class="sxs-lookup"><span data-stu-id="26d5f-131">Key names and labels are used as indexes for retrieving configuration data and aren't encrypted.</span></span>

<span data-ttu-id="26d5f-132">App Configuration は強固なセキュリティを備えていますが、それでもアプリケーション シークレットの保管場所としては Azure Key Vault が最も優れています。</span><span class="sxs-lookup"><span data-stu-id="26d5f-132">Although App Configuration provides hardened security, Azure Key Vault is still the best place for storing application secrets.</span></span> <span data-ttu-id="26d5f-133">Key Vault では、ハードウェアレベルの暗号化、粒度の細かいアクセス ポリシー、管理操作 (証明書のローテーションなど) が利用できます。</span><span class="sxs-lookup"><span data-stu-id="26d5f-133">Key Vault provides hardware-level encryption, granular access policies, and management operations such as certificate rotation.</span></span> <span data-ttu-id="26d5f-134">キー コンテナーに格納されているシークレットを参照する App Configuration 値を作成できます。</span><span class="sxs-lookup"><span data-stu-id="26d5f-134">You can create App Configuration values that reference secrets stored in a Key Vault.</span></span>

## <a name="azure-key-vault"></a><span data-ttu-id="26d5f-135">Azure Key Vault</span><span class="sxs-lookup"><span data-stu-id="26d5f-135">Azure Key Vault</span></span>

<span data-ttu-id="26d5f-136">Key Vault は、シークレットを安全に保管し、それにアクセスするためのマネージド サービスです。</span><span class="sxs-lookup"><span data-stu-id="26d5f-136">Key Vault is a managed service for securely storing and accessing secrets.</span></span> <span data-ttu-id="26d5f-137">シークレットは、API キー、パスワード、証明書など、アクセスを厳密に制御する必要がある任意のものです。</span><span class="sxs-lookup"><span data-stu-id="26d5f-137">A secret is anything that you want to tightly control access to, such as API keys, passwords, or certificates.</span></span> <span data-ttu-id="26d5f-138">コンテナーはシークレットの論理グループです。</span><span class="sxs-lookup"><span data-stu-id="26d5f-138">A vault is a logical group of secrets.</span></span>

<span data-ttu-id="26d5f-139">Key Vault によって、シークレットが誤って漏洩する可能性が大幅に小さくなります。</span><span class="sxs-lookup"><span data-stu-id="26d5f-139">Key Vault greatly reduces the chances that secrets may be accidentally leaked.</span></span> <span data-ttu-id="26d5f-140">Key Vault を使用すると、アプリケーション開発者は、アプリケーションにセキュリティ情報を格納する必要がなくなります。</span><span class="sxs-lookup"><span data-stu-id="26d5f-140">When using Key Vault, application developers no longer need to store security information in their application.</span></span> <span data-ttu-id="26d5f-141">この手法を使用すると、コード内にこの情報を格納する必要がなくなります。</span><span class="sxs-lookup"><span data-stu-id="26d5f-141">This practice eliminates the need to store this information inside your code.</span></span> <span data-ttu-id="26d5f-142">たとえば、必要に応じてデータベースに接続するアプリケーションがあるとします。</span><span class="sxs-lookup"><span data-stu-id="26d5f-142">For example, an application may need to connect to a database.</span></span> <span data-ttu-id="26d5f-143">この場合、接続文字列をアプリのコードに格納する代わりに、Key Vault に安全に格納できます。</span><span class="sxs-lookup"><span data-stu-id="26d5f-143">Instead of storing the connection string in the app's code, you can store it securely in Key Vault.</span></span>

<span data-ttu-id="26d5f-144">アプリケーションでは、URI を使用して、必要な情報に安全にアクセスできます。</span><span class="sxs-lookup"><span data-stu-id="26d5f-144">Your applications can securely access the information they need by using URIs.</span></span> <span data-ttu-id="26d5f-145">アプリケーションでは、これらの URI を使用して特定のバージョンのシークレットを取得できます。</span><span class="sxs-lookup"><span data-stu-id="26d5f-145">These URIs allow the applications to retrieve specific versions of a secret.</span></span> <span data-ttu-id="26d5f-146">Key Vault に格納されているシークレット情報のいずれかを保護するためにカスタム コードを記述する必要はありません。</span><span class="sxs-lookup"><span data-stu-id="26d5f-146">There's no need to write custom code to protect any of the secret information stored in Key Vault.</span></span>

<span data-ttu-id="26d5f-147">Key Vault にアクセスするには、適切な呼び出し元の認証と承認が必要です。</span><span class="sxs-lookup"><span data-stu-id="26d5f-147">Access to Key Vault requires proper caller authentication and authorization.</span></span> <span data-ttu-id="26d5f-148">通常、クラウドネイティブ マイクロサービスには、ClientId と ClientSecret の組み合わせが使用されます。</span><span class="sxs-lookup"><span data-stu-id="26d5f-148">Typically, each cloud-native microservice uses a ClientId/ClientSecret combination.</span></span> <span data-ttu-id="26d5f-149">このような資格情報は、ソース管理の外部に保持することが重要です。</span><span class="sxs-lookup"><span data-stu-id="26d5f-149">It's important to keep these credentials outside source control.</span></span> <span data-ttu-id="26d5f-150">ベスト プラクティスは、アプリケーションの環境でそれらを設定することです。</span><span class="sxs-lookup"><span data-stu-id="26d5f-150">A best practice is to set them in  the application's environment.</span></span> <span data-ttu-id="26d5f-151">AKS から Key Vault に直接アクセスするには、[Key Vault FlexVolume](https://github.com/Azure/kubernetes-keyvault-flexvol) を使用します。</span><span class="sxs-lookup"><span data-stu-id="26d5f-151">Direct access to Key Vault from AKS can be achieved using [Key Vault FlexVolume](https://github.com/Azure/kubernetes-keyvault-flexvol).</span></span>

## <a name="configuration-in-eshop"></a><span data-ttu-id="26d5f-152">eShop での構成</span><span class="sxs-lookup"><span data-stu-id="26d5f-152">Configuration in eShop</span></span>

<span data-ttu-id="26d5f-153">eShopOnContainers アプリケーションには、各マイクロサービスにローカル アプリケーション設定ファイルが含まれています。</span><span class="sxs-lookup"><span data-stu-id="26d5f-153">The eShopOnContainers application includes local application settings files with each microservice.</span></span> <span data-ttu-id="26d5f-154">これらのファイルはソース管理にチェックインされていますが、接続文字列や API キーなどの運用シークレットは含まれていません。</span><span class="sxs-lookup"><span data-stu-id="26d5f-154">These files are checked into source control, but don't include production secrets such as connection strings or API keys.</span></span> <span data-ttu-id="26d5f-155">運用環境では、個々の設定が、サービスごとの環境変数で上書きされる可能性があります。</span><span class="sxs-lookup"><span data-stu-id="26d5f-155">In production, individual settings may be overwritten with per-service environment variables.</span></span> <span data-ttu-id="26d5f-156">環境変数にシークレットを挿入することは、ホステッド アプリケーションに一般的な手法ですが、中央の構成ストアは提供されません。</span><span class="sxs-lookup"><span data-stu-id="26d5f-156">Injecting secrets in environment variables is a common practice for hosted applications, but doesn't provide a central configuration store.</span></span> <span data-ttu-id="26d5f-157">構成設定の一元管理をサポートするために、各マイクロサービスには、ローカル設定と Azure Key Vault 設定の使用を切り替える設定が含まれています。</span><span class="sxs-lookup"><span data-stu-id="26d5f-157">To support centralized management of configuration settings, each microservice includes a setting to toggle between its use of local settings or Azure Key Vault settings.</span></span>

## <a name="references"></a><span data-ttu-id="26d5f-158">リファレンス</span><span class="sxs-lookup"><span data-stu-id="26d5f-158">References</span></span>

- [<span data-ttu-id="26d5f-159">eShopOnContainers アーキテクチャ</span><span class="sxs-lookup"><span data-stu-id="26d5f-159">The eShopOnContainers Architecture</span></span>](https://github.com/dotnet-architecture/eShopOnContainers/wiki/Architecture)
- [<span data-ttu-id="26d5f-160">高いスケーラビリティと可用性のためにマイクロサービスと複数のコンテナー アプリケーションを調整する</span><span class="sxs-lookup"><span data-stu-id="26d5f-160">Orchestrating microservices and multi-container applications for high scalability and availability</span></span>](../microservices/architect-microservice-container-applications/scalable-available-multi-container-microservice-applications.md)
- [<span data-ttu-id="26d5f-161">Azure API Management</span><span class="sxs-lookup"><span data-stu-id="26d5f-161">Azure API Management</span></span>](/azure/api-management/api-management-key-concepts)
- [<span data-ttu-id="26d5f-162">Azure SQL Database の概要</span><span class="sxs-lookup"><span data-stu-id="26d5f-162">Azure SQL Database Overview</span></span>](/azure/sql-database/sql-database-technical-overview)
- [<span data-ttu-id="26d5f-163">Azure Cache for Redis</span><span class="sxs-lookup"><span data-stu-id="26d5f-163">Azure Cache for Redis</span></span>](https://azure.microsoft.com/services/cache/)
- [<span data-ttu-id="26d5f-164">Azure Cosmos DB の MongoDB 用 API</span><span class="sxs-lookup"><span data-stu-id="26d5f-164">Azure Cosmos DB's API for MongoDB</span></span>](/azure/cosmos-db/mongodb-introduction)
- [<span data-ttu-id="26d5f-165">Azure Service Bus</span><span class="sxs-lookup"><span data-stu-id="26d5f-165">Azure Service Bus</span></span>](/azure/service-bus-messaging/service-bus-messaging-overview)
- [<span data-ttu-id="26d5f-166">Azure Monitor の概要</span><span class="sxs-lookup"><span data-stu-id="26d5f-166">Azure Monitor overview</span></span>](/azure/azure-monitor/overview)
- <span data-ttu-id="26d5f-167">[eShopOnContainers: AKS での Kubernetes クラスターの作成](https://github.com/dotnet-architecture/eShopOnContainers/wiki/Deploy-to-Azure-Kubernetes-Service-(AKS)#create-kubernetes-cluster-in-aks)</span><span class="sxs-lookup"><span data-stu-id="26d5f-167">[eShopOnContainers: Create Kubernetes cluster in AKS](https://github.com/dotnet-architecture/eShopOnContainers/wiki/Deploy-to-Azure-Kubernetes-Service-(AKS)#create-kubernetes-cluster-in-aks)</span></span>
- [<span data-ttu-id="26d5f-168">eShopOnContainers: Azure Dev Spaces</span><span class="sxs-lookup"><span data-stu-id="26d5f-168">eShopOnContainers: Azure Dev Spaces</span></span>](https://github.com/dotnet-architecture/eShopOnContainers/wiki/Azure-Dev-Spaces)
- [<span data-ttu-id="26d5f-169">Azure Dev Spaces</span><span class="sxs-lookup"><span data-stu-id="26d5f-169">Azure Dev Spaces</span></span>](/azure/dev-spaces/about)

>[!div class="step-by-step"]
><span data-ttu-id="26d5f-170">[前へ](deploy-eshoponcontainers-azure.md)
>[次へ](scale-applications.md)</span><span class="sxs-lookup"><span data-stu-id="26d5f-170">[Previous](deploy-eshoponcontainers-azure.md)
[Next](scale-applications.md)</span></span>
