---
title: eShopOnContainers を Azure にデプロイする
description: Azure Kubernetes Service、Helm、Dev Spaces を使用した eShopOnContainers アプリケーションのデプロイ。
ms.date: 01/19/2021
ms.openlocfilehash: da68fa1510841b6cef9117b6d84e7ed30c565698
ms.sourcegitcommit: 46cfed35d79d70e08c313b9c664c7e76babab39e
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/10/2021
ms.locfileid: "102604568"
---
# <a name="deploying-eshoponcontainers-to-azure"></a><span data-ttu-id="e86e8-103">eShopOnContainers を Azure にデプロイする</span><span class="sxs-lookup"><span data-stu-id="e86e8-103">Deploying eShopOnContainers to Azure</span></span>

<span data-ttu-id="e86e8-104">eShopOnContainers アプリケーションは、さまざまな Azure プラットフォームにデプロイできます。</span><span class="sxs-lookup"><span data-stu-id="e86e8-104">The eShopOnContainers application can be deployed to various Azure platforms.</span></span> <span data-ttu-id="e86e8-105">Azure Kubernetes Services (AKS) にアプリケーションをデプロイする方法をお勧めします。</span><span class="sxs-lookup"><span data-stu-id="e86e8-105">The recommended approach is to deploy the application to Azure Kubernetes Services (AKS).</span></span> <span data-ttu-id="e86e8-106">Kubernetes デプロイ ツールである Helm は、デプロイの複雑さを軽減するために使用できます。</span><span class="sxs-lookup"><span data-stu-id="e86e8-106">Helm, a Kubernetes deployment tool, is available to reduce deployment complexity.</span></span> <span data-ttu-id="e86e8-107">開発者は必要に応じて Kubernetes 用の Azure Dev Spaces を実装し、開発プロセスを効率化できます。</span><span class="sxs-lookup"><span data-stu-id="e86e8-107">Optionally, developers may implement Azure Dev Spaces for Kubernetes to streamline their development process.</span></span>

## <a name="azure-kubernetes-service"></a><span data-ttu-id="e86e8-108">Azure Kubernetes Service</span><span class="sxs-lookup"><span data-stu-id="e86e8-108">Azure Kubernetes Service</span></span>

<span data-ttu-id="e86e8-109">AKS で eShop をホストするには、最初に AKS クラスターを作成します。</span><span class="sxs-lookup"><span data-stu-id="e86e8-109">To host eShop in AKS, the first step is to create an AKS cluster.</span></span> <span data-ttu-id="e86e8-110">Azure portal を使用すると、作成に必要な手順を実行できます。</span><span class="sxs-lookup"><span data-stu-id="e86e8-110">To do so, you might use the Azure portal, which will walk you through the required steps.</span></span> <span data-ttu-id="e86e8-111">また、Azure CLI からクラスターを作成して、ロールベースのアクセス制御 (RBAC) とアプリケーション ルーティングを有効にすることもできます。</span><span class="sxs-lookup"><span data-stu-id="e86e8-111">You could also create a cluster from the Azure CLI, taking care to enable Role-Based Access Control (RBAC) and application routing.</span></span> <span data-ttu-id="e86e8-112">eShopOnContainers のドキュメントでは、独自の AKS クラスターを作成する手順について詳しく説明しています。</span><span class="sxs-lookup"><span data-stu-id="e86e8-112">The eShopOnContainers' documentation details the steps for creating your own AKS cluster.</span></span> <span data-ttu-id="e86e8-113">作成が完了したら、Kubernetes ダッシュボードからクラスターにアクセスして管理できます。</span><span class="sxs-lookup"><span data-stu-id="e86e8-113">Once created, you can access and manage the cluster from the Kubernetes dashboard.</span></span>

<span data-ttu-id="e86e8-114">これで、Helm を使用して eShop アプリケーションをクラスターにデプロイできるようになりました。</span><span class="sxs-lookup"><span data-stu-id="e86e8-114">You can now deploy the eShop application to the cluster using Helm.</span></span>

## <a name="deploying-to-azure-kubernetes-service-using-helm"></a><span data-ttu-id="e86e8-115">Helm を使用した Azure Kubernetes Service へのデプロイ</span><span class="sxs-lookup"><span data-stu-id="e86e8-115">Deploying to Azure Kubernetes Service using Helm</span></span>

<span data-ttu-id="e86e8-116">Helm は、Kubernetes と直接連携するアプリケーション パッケージ マネージャー ツールです。</span><span class="sxs-lookup"><span data-stu-id="e86e8-116">Helm is an application package manager tool that works directly with Kubernetes.</span></span> <span data-ttu-id="e86e8-117">Kubernetes アプリケーションの定義、インストール、アップグレードに役立ちます。</span><span class="sxs-lookup"><span data-stu-id="e86e8-117">It helps you define, install, and upgrade Kubernetes applications.</span></span> <span data-ttu-id="e86e8-118">シンプルなアプリはカスタム CLI スクリプトやシンプルなデプロイ ファイルを使用して AKS にデプロイできますが、複雑なアプリには多数の Kubernetes オブジェクトを含めることができます。また、Helm によるメリットも得られます。</span><span class="sxs-lookup"><span data-stu-id="e86e8-118">While simple apps can be deployed to AKS with custom CLI scripts or simple deployment files, complex apps can contain many Kubernetes objects and benefit from Helm.</span></span>

<span data-ttu-id="e86e8-119">Helm を使用するアプリケーションには、Helm チャートと呼ばれるテキスト ベースの構成ファイルが含まれています。このファイルでは、Helm パッケージ内のアプリケーションと構成が宣言によって記述されます。</span><span class="sxs-lookup"><span data-stu-id="e86e8-119">Using Helm, applications include text-based configuration files, called Helm charts, which declaratively describe the application and configuration in Helm packages.</span></span> <span data-ttu-id="e86e8-120">チャートでは、標準の YAML 形式のファイルを使用して、関連する Kubernetes リソースのセットを記述します。</span><span class="sxs-lookup"><span data-stu-id="e86e8-120">Charts use standard YAML-formatted files to describe a related set of Kubernetes resources.</span></span> <span data-ttu-id="e86e8-121">これらは、記述されているアプリケーション コードと共にバージョン管理されます。</span><span class="sxs-lookup"><span data-stu-id="e86e8-121">They're versioned alongside the application code they describe.</span></span> <span data-ttu-id="e86e8-122">Helm チャートは、記述されているインストールの要件に応じて、シンプルなものから複雑なものまで多岐にわたります。</span><span class="sxs-lookup"><span data-stu-id="e86e8-122">Helm Charts range from simple to complex depending on the requirements of the installation they describe.</span></span>

<span data-ttu-id="e86e8-123">Helm はコマンド ライン クライアント ツールで構成されます。このツールは、Helm チャートを使用して、Tiller という名前のサーバー コンポーネントに対するコマンドを起動します。</span><span class="sxs-lookup"><span data-stu-id="e86e8-123">Helm is composed of a command-line client tool, which consumes helm charts and launches commands to a server component named, Tiller.</span></span> <span data-ttu-id="e86e8-124">Tiller は Kubernetes API と通信して、コンテナー化されたワークロードを適切にプロビジョニングします。</span><span class="sxs-lookup"><span data-stu-id="e86e8-124">Tiller communicates with the Kubernetes API to ensure the correct provisioning of your containerized workloads.</span></span> <span data-ttu-id="e86e8-125">Helm は、Cloud Native Computing Foundation で管理されています。</span><span class="sxs-lookup"><span data-stu-id="e86e8-125">Helm is maintained by the Cloud-native Computing Foundation.</span></span>

<span data-ttu-id="e86e8-126">次の yaml ファイルは、Helm テンプレートを示しています。</span><span class="sxs-lookup"><span data-stu-id="e86e8-126">The following yaml file presents a Helm template:</span></span>

```yaml
apiVersion: v1
kind: Service
metadata:
  name: {{ .Values.app.svc.marketing }}
  labels:
    app: {{ template "marketing-api.name" . }}
    chart: {{ template "marketing-api.chart" . }}
    release: {{ .Release.Name }}
    heritage: {{ .Release.Service }}
spec:
  type: {{ .Values.service.type }}
  ports:
    - port: {{ .Values.service.port }}
      targetPort: http
      protocol: TCP
      name: http
  selector:
    app: {{ template "marketing-api.name" . }}
    release: {{ .Release.Name }}
```

<span data-ttu-id="e86e8-127">このテンプレートで、キーと値のペアの動的なセットがどのように記述されているかに注目してください。</span><span class="sxs-lookup"><span data-stu-id="e86e8-127">Note how the template describes a dynamic set of key/value pairs.</span></span> <span data-ttu-id="e86e8-128">テンプレートが呼び出されると、中かっこで囲まれた値が、他の yaml ベースの構成ファイルから取り込まれます。</span><span class="sxs-lookup"><span data-stu-id="e86e8-128">When the template is invoked, values that enclosed in curly braces are pulled in from other yaml-based configuration files.</span></span>

<span data-ttu-id="e86e8-129">eShopOnContainers の Helm チャートは、/k8s/helm フォルダーにあります。</span><span class="sxs-lookup"><span data-stu-id="e86e8-129">You'll find the eShopOnContainers helm charts in the /k8s/helm folder.</span></span> <span data-ttu-id="e86e8-130">図 2-6 は、アプリケーションのさまざまなコンポーネントを、デプロイの定義と管理のために Helm で使用されるフォルダー構造に編成する方法を示しています。</span><span class="sxs-lookup"><span data-stu-id="e86e8-130">Figure 2-6 shows how the different components of the application are organized into a folder structure used by helm to define and managed deployments.</span></span>

<span data-ttu-id="e86e8-131">![eShopOnContainers の helm フォルダー](./media/eshoponcontainers-helm-folder.png)
**図 2-6**</span><span class="sxs-lookup"><span data-stu-id="e86e8-131">![The eShopOnContainers helm folder](./media/eshoponcontainers-helm-folder.png)
**Figure 2-6**.</span></span> <span data-ttu-id="e86e8-132">eShopOnContainers の helm フォルダー。</span><span class="sxs-lookup"><span data-stu-id="e86e8-132">The eShopOnContainers helm folder.</span></span>

<span data-ttu-id="e86e8-133">個々のコンポーネントは、`helm install` コマンドを使用してインストールされます。</span><span class="sxs-lookup"><span data-stu-id="e86e8-133">Each individual component is installed using a `helm install` command.</span></span> <span data-ttu-id="e86e8-134">eShop には、それぞれの Helm チャートを使用してコンポーネントをループまたはインストールする "すべてをデプロイ" スクリプトが含まれています。</span><span class="sxs-lookup"><span data-stu-id="e86e8-134">eShop includes a "deploy all" script that loops through and installs the components using their respective helm charts.</span></span> <span data-ttu-id="e86e8-135">結果として、反復可能なプロセスが生成されます。バージョン管理はソース管理でアプリケーションと共に行われます。これにより、チームのすべてのメンバーが 1 行のスクリプト コマンドを使用して AKS クラスターへのデプロイを行えるようになります。</span><span class="sxs-lookup"><span data-stu-id="e86e8-135">The result is a repeatable process, versioned with the application in source control, that anyone on the team can deploy to an AKS cluster with a one-line script command.</span></span>

> <span data-ttu-id="e86e8-136">Helm のバージョン 3 では Tiller サーバー コンポーネントが正式に不要になったことに注意してください。</span><span class="sxs-lookup"><span data-stu-id="e86e8-136">Note that version 3 of Helm officially removes the need for the Tiller server component.</span></span> <span data-ttu-id="e86e8-137">この機能拡張の詳細については、[ここ](https://medium.com/better-programming/why-is-tiller-missing-in-helm-3-2347c446714)を参照してください。</span><span class="sxs-lookup"><span data-stu-id="e86e8-137">More information on this enhancement can be found [here](https://medium.com/better-programming/why-is-tiller-missing-in-helm-3-2347c446714).</span></span>

## <a name="azure-dev-spaces"></a><span data-ttu-id="e86e8-138">Azure Dev Spaces</span><span class="sxs-lookup"><span data-stu-id="e86e8-138">Azure Dev Spaces</span></span>

<span data-ttu-id="e86e8-139">クラウドネイティブ アプリケーションの規模と複雑さが急速に拡大し、実行のために大量のコンピューティング リソースが必要になる可能性があります。</span><span class="sxs-lookup"><span data-stu-id="e86e8-139">Cloud-native applications can quickly grow large and complex, requiring significant compute resources to run.</span></span> <span data-ttu-id="e86e8-140">このようなシナリオでは、アプリケーション全体を開発用コンピューター (特にノート PC) でホストすることはできません。</span><span class="sxs-lookup"><span data-stu-id="e86e8-140">In these scenarios, the entire application can't be hosted on a development machine (especially a laptop).</span></span> <span data-ttu-id="e86e8-141">Azure Dev Spaces は、AKS を使用してこの問題に対処するように設計されています。</span><span class="sxs-lookup"><span data-stu-id="e86e8-141">Azure Dev Spaces is designed to address this problem using AKS.</span></span> <span data-ttu-id="e86e8-142">開発者は、サービスのローカル バージョンで作業を行いながら、AKS 開発クラスターでアプリケーションの残りの部分をホストできます。</span><span class="sxs-lookup"><span data-stu-id="e86e8-142">It enables developers to work with a local version of their services while hosting the rest of the application in an AKS development cluster.</span></span>

<span data-ttu-id="e86e8-143">開発者は、コンテナー化されたアプリケーション全体が格納されている AKS クラスターで実行中の (開発) インスタンスを共有します。</span><span class="sxs-lookup"><span data-stu-id="e86e8-143">Developers share a running (development) instance in an AKS cluster that contains the entire containerized application.</span></span> <span data-ttu-id="e86e8-144">ただし、サービスのローカル開発には、自分のコンピューターに設定されている個人用のスペースを使用します。</span><span class="sxs-lookup"><span data-stu-id="e86e8-144">But they use personal spaces set up on their machine to locally develop their services.</span></span> <span data-ttu-id="e86e8-145">準備ができたら、依存関係をレプリケートすることなく、AKS クラスターでエンドツーエンドのテストを行います。</span><span class="sxs-lookup"><span data-stu-id="e86e8-145">When ready, they test from end-to-end in the AKS cluster - without replicating dependencies.</span></span> <span data-ttu-id="e86e8-146">Azure Dev Spaces により、ローカル コンピューターのコードと AKS 内のサービスがマージされます。</span><span class="sxs-lookup"><span data-stu-id="e86e8-146">Azure Dev Spaces merges code from the local machine with services in AKS.</span></span> <span data-ttu-id="e86e8-147">チーム メンバーは、実際の AKS 環境で変更内容がどのように動作するかを確認できます。</span><span class="sxs-lookup"><span data-stu-id="e86e8-147">Team members can see how their changes will behave in a real AKS environment.</span></span> <span data-ttu-id="e86e8-148">開発者は、Visual Studio 2017 または Visual Studio Code を使用して、Kubernetes 内で直接コードの迅速な反復処理とデバッグを実行できます。</span><span class="sxs-lookup"><span data-stu-id="e86e8-148">Developers can rapidly iterate and debug code directly in Kubernetes using Visual Studio 2017 or Visual Studio Code.</span></span>

<span data-ttu-id="e86e8-149">図 2-7 では、Susie という開発者が自身の開発スペースに Bikes マイクロサービスの更新バージョンをデプロイしたことがわかります。</span><span class="sxs-lookup"><span data-stu-id="e86e8-149">In Figure 2-7, you can see that Developer Susie has deployed an updated version of the Bikes microservice into her dev space.</span></span> <span data-ttu-id="e86e8-150">次に彼女は、自分のスペースの名前 (susie.s.dev.myapp.eus.azds.io) で始まるカスタム URL を使用して変更内容をテストできます。</span><span class="sxs-lookup"><span data-stu-id="e86e8-150">She's then able to test her changes using a custom URL starting with the name of her space (susie.s.dev.myapp.eus.azds.io).</span></span>

<span data-ttu-id="e86e8-151">![Bikes マイクロサービスを示す eShopOnContainers アーキテクチャ](./media/azure-devspaces-one.png)
**図 2-7**</span><span class="sxs-lookup"><span data-stu-id="e86e8-151">![eShopOnContainers Architecture showing Bikes microservice](./media/azure-devspaces-one.png)
**Figure 2-7**.</span></span> <span data-ttu-id="e86e8-152">開発者 Susie が独自のバージョンの Bikes マイクロサービスをデプロイしてテストする。</span><span class="sxs-lookup"><span data-stu-id="e86e8-152">Developer Susie deploys her own version of the Bikes microservice and tests it.</span></span>

<span data-ttu-id="e86e8-153">同時に、開発者 John は Reservations マイクロサービスをカスタマイズして、変更内容をテストする必要があります。</span><span class="sxs-lookup"><span data-stu-id="e86e8-153">At the same time, developer John is customizing the Reservations microservice and needs to test his changes.</span></span> <span data-ttu-id="e86e8-154">図 2-8 に示すように、彼は Susie の変更内容と競合することなく、自分の開発スペースに変更内容をデプロイします。</span><span class="sxs-lookup"><span data-stu-id="e86e8-154">He deploys his changes to his own dev space without conflicting with Susie's changes as shown in Figure 2-8.</span></span> <span data-ttu-id="e86e8-155">次に John は、自分のスペースの名前 (john.s.dev.myapp.eus.azds.io) を先頭に付加した独自の URL を使用して変更内容をテストします。</span><span class="sxs-lookup"><span data-stu-id="e86e8-155">John then tests his changes using his own URL that is prefixed with the name of his space (john.s.dev.myapp.eus.azds.io).</span></span>

<span data-ttu-id="e86e8-156">![John の Reservations マイクロサービスのバージョンを示す eShopOnContainers アーキテクチャ](./media/azure-devspaces-two.png)
**図 2-8**</span><span class="sxs-lookup"><span data-stu-id="e86e8-156">![eShopOnContainers Architecture showing John's version of Reservations microservice](./media/azure-devspaces-two.png)
**Figure 2-8**.</span></span> <span data-ttu-id="e86e8-157">開発者 John が独自のバージョンの Reservations マイクロサービスをデプロイし、他の開発者と競合することなくテストする。</span><span class="sxs-lookup"><span data-stu-id="e86e8-157">Developer John deploys his own version of the Reservations microservice and tests it without conflicting with other developers.</span></span>

<span data-ttu-id="e86e8-158">Azure Dev Spaces を使用すると、チームは AKS を直接操作し、変更内容の修正、デプロイ、テストを独立して行うことができます。</span><span class="sxs-lookup"><span data-stu-id="e86e8-158">Using Azure Dev Spaces, teams can work directly with AKS while independently changing, deploying, and testing their changes.</span></span> <span data-ttu-id="e86e8-159">この方法では、開発者が独自の AKS 環境を効果的に使用できるため、個別の専用ホスト環境の必要性が軽減されます。</span><span class="sxs-lookup"><span data-stu-id="e86e8-159">This approach reduces the need for separate dedicated hosted environments since every developer effectively has their own AKS environment.</span></span> <span data-ttu-id="e86e8-160">開発者は CLI を使用して Azure Dev Spaces を操作したり、Visual Studio から直接 Azure Dev Spaces に対してアプリケーションを起動したりできます。</span><span class="sxs-lookup"><span data-stu-id="e86e8-160">Developers can work with Azure Dev Spaces using its CLI or launch their application to Azure Dev Spaces directly from Visual Studio.</span></span> <span data-ttu-id="e86e8-161">Azure Dev Spaces のしくみと構成方法の詳細については、[ここ](/azure/dev-spaces/how-dev-spaces-works)を参照してください。</span><span class="sxs-lookup"><span data-stu-id="e86e8-161">[Learn more about how Azure Dev Spaces works and is configured.](/azure/dev-spaces/how-dev-spaces-works)</span></span>

## <a name="azure-functions-and-logic-apps-serverless"></a><span data-ttu-id="e86e8-162">Azure Functions と Logic Apps (サーバーレス)</span><span class="sxs-lookup"><span data-stu-id="e86e8-162">Azure Functions and Logic Apps (Serverless)</span></span>

<span data-ttu-id="e86e8-163">eShopOnContainers サンプルには、オンライン マーケティング キャンペーンの追跡のサポートが含まれています。</span><span class="sxs-lookup"><span data-stu-id="e86e8-163">The eShopOnContainers sample includes support for tracking online marketing campaigns.</span></span> <span data-ttu-id="e86e8-164">特定のキャンペーン ID のマーケティング キャンペーンの詳細を追跡するには、Azure 関数を使用します。</span><span class="sxs-lookup"><span data-stu-id="e86e8-164">An Azure Function is used to track marketing campaign details for a given campaign ID.</span></span> <span data-ttu-id="e86e8-165">完全なマイクロサービスを作成する代わりに、Azure 関数を 1 つ使用すればシンプルかつ十分です。</span><span class="sxs-lookup"><span data-stu-id="e86e8-165">Rather than creating a full microservice, a single Azure Function is simpler and sufficient.</span></span> <span data-ttu-id="e86e8-166">Azure Functions には、Kubernetes で実行するように構成されている場合などに適した、シンプルなビルドおよびデプロイ モデルが用意されています。</span><span class="sxs-lookup"><span data-stu-id="e86e8-166">Azure Functions have a simple build and deployment model, especially when configured to run in Kubernetes.</span></span> <span data-ttu-id="e86e8-167">関数のデプロイは、Azure Resource Manager (ARM) テンプレートと Azure CLI を使用してスクリプト化されます。</span><span class="sxs-lookup"><span data-stu-id="e86e8-167">Deploying the function is scripted using Azure Resource Manager (ARM) templates and the Azure CLI.</span></span> <span data-ttu-id="e86e8-168">このキャンペーン サービスは顧客向けではなく、1 つの操作を呼び出します。この操作は Azure Functions に最適な候補になります。</span><span class="sxs-lookup"><span data-stu-id="e86e8-168">This campaign service isn't customer-facing and invokes a single operation, making it a great candidate for Azure Functions.</span></span> <span data-ttu-id="e86e8-169">この関数には、データベース接続文字列データやイメージ ベースの URI 設定などの最小限の構成が必要です。</span><span class="sxs-lookup"><span data-stu-id="e86e8-169">The function requires minimal configuration, including a database connection string data and image base URI settings.</span></span> <span data-ttu-id="e86e8-170">Azure Functions は Azure portal で構成します。</span><span class="sxs-lookup"><span data-stu-id="e86e8-170">You configure Azure Functions in the Azure portal.</span></span>

>[!div class="step-by-step"]
><span data-ttu-id="e86e8-171">[前へ](map-eshoponcontainers-azure-services.md)
>[次へ](centralized-configuration.md)</span><span class="sxs-lookup"><span data-stu-id="e86e8-171">[Previous](map-eshoponcontainers-azure-services.md)
[Next](centralized-configuration.md)</span></span>
