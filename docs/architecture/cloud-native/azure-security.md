---
title: クラウドネイティブ アプリ向けの Azure のセキュリティ
description: Azure 向けのクラウド ネイティブ .NET アプリを設計する | クラウド ネイティブ アプリ向けの Azure のセキュリティ
ms.date: 01/19/2021
ms.openlocfilehash: 1e2dce97a43479d49aecf220893efcc19bb00a8c
ms.sourcegitcommit: f2ab02d9a780819ca2e5310bbcf5cfe5b7993041
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 02/03/2021
ms.locfileid: "99505883"
---
# <a name="azure-security-for-cloud-native-apps"></a><span data-ttu-id="0a31c-103">クラウドネイティブ アプリ向けの Azure のセキュリティ</span><span class="sxs-lookup"><span data-stu-id="0a31c-103">Azure security for cloud-native apps</span></span>

<span data-ttu-id="0a31c-104">クラウドネイティブ アプリケーションは、従来のアプリケーションに比べてセキュリティで保護するのが簡単でもあり、難しくもあります。</span><span class="sxs-lookup"><span data-stu-id="0a31c-104">Cloud-native applications can be both easier and more difficult to secure than traditional applications.</span></span> <span data-ttu-id="0a31c-105">欠点としては、より小規模なアプリケーションをセキュリティで保護する必要があり、セキュリティ インフラストラクチャの構築により多くのエネルギーを費やす必要があります。</span><span class="sxs-lookup"><span data-stu-id="0a31c-105">On the downside, you need to secure more smaller applications and dedicate more energy to build out the security infrastructure.</span></span> <span data-ttu-id="0a31c-106">また、ほとんどのサービスのデプロイでは、プログラミング言語とスタイルが異種混合であるため、さまざまなプロバイダーからのセキュリティ情報にさらに注意を払う必要があります。</span><span class="sxs-lookup"><span data-stu-id="0a31c-106">The heterogeneous nature of programming languages and styles in most service deployments also means you need to pay more attention to security bulletins from many different providers.</span></span>

<span data-ttu-id="0a31c-107">一方で、小規模なサービスの場合、それぞれが独自のデータ ストアを持っているため、攻撃のスコープが限定されます。</span><span class="sxs-lookup"><span data-stu-id="0a31c-107">On the flip side, smaller services, each with their own data store, limit the scope of an attack.</span></span> <span data-ttu-id="0a31c-108">攻撃者が 1 つのシステムを侵害した場合、その攻撃者が別のシステムも侵害することは、おそらくモノリシック アプリケーションの場合よりも難しくなるでしょう。</span><span class="sxs-lookup"><span data-stu-id="0a31c-108">If an attacker compromises one system, it's probably more difficult for the attacker to make the jump to another system than it is in a monolithic application.</span></span> <span data-ttu-id="0a31c-109">プロセスの境界は強力な境界です。</span><span class="sxs-lookup"><span data-stu-id="0a31c-109">Process boundaries are strong boundaries.</span></span> <span data-ttu-id="0a31c-110">また、データベースのバックアップが漏えいしたとしても、そのデータベースにはデータのサブセットしか含まれておらず、個人情報が含まれている可能性は低いため、被害はより限定的です。</span><span class="sxs-lookup"><span data-stu-id="0a31c-110">Also, if a database backup gets exposed, then the damage is more limited, as that database contains only a subset of data and is unlikely to contain personal data.</span></span>

## <a name="threat-modeling"></a><span data-ttu-id="0a31c-111">脅威モデリング</span><span class="sxs-lookup"><span data-stu-id="0a31c-111">Threat modeling</span></span>

<span data-ttu-id="0a31c-112">クラウドネイティブ アプリケーションの利点が欠点を上回っていても、同じように全体的なセキュリティの考え方に従う必要があります。</span><span class="sxs-lookup"><span data-stu-id="0a31c-112">No matter if the advantages outweigh the disadvantages of cloud-native applications, the same holistic security mindset must be followed.</span></span> <span data-ttu-id="0a31c-113">セキュリティと安全な考え方は、開発と運用のストーリーのすべての手順に含める必要があります。</span><span class="sxs-lookup"><span data-stu-id="0a31c-113">Security and secure thinking must be part of every step of the development and operations story.</span></span> <span data-ttu-id="0a31c-114">アプリケーションを計画するときは、次のような項目を自問してください。</span><span class="sxs-lookup"><span data-stu-id="0a31c-114">When planning an application ask questions like:</span></span>

- <span data-ttu-id="0a31c-115">このデータが失われた場合、どのような影響がありますか?</span><span class="sxs-lookup"><span data-stu-id="0a31c-115">What would be the impact of this data being lost?</span></span>
- <span data-ttu-id="0a31c-116">不正なデータがこのサービスに挿入された場合の損害を抑えるにはどうすればよいですか?</span><span class="sxs-lookup"><span data-stu-id="0a31c-116">How can we limit the damage from bad data being injected into this service?</span></span>
- <span data-ttu-id="0a31c-117">誰がこのデータにアクセスできる必要がありますか?</span><span class="sxs-lookup"><span data-stu-id="0a31c-117">Who should have access to this data?</span></span>
- <span data-ttu-id="0a31c-118">開発とリリースのプロセスに関する監査ポリシーはありますか?</span><span class="sxs-lookup"><span data-stu-id="0a31c-118">Are there auditing policies in place around the development and release process?</span></span>

<span data-ttu-id="0a31c-119">このような質問はすべて、[脅威モデリング](/azure/security/azure-security-threat-modeling-tool)と呼ばれるプロセスの一部です。</span><span class="sxs-lookup"><span data-stu-id="0a31c-119">All these questions are part of a process called [threat modeling](/azure/security/azure-security-threat-modeling-tool).</span></span> <span data-ttu-id="0a31c-120">これは、システムにどのような脅威があるのか、脅威の可能性はどの程度か、脅威による潜在的な損害はどの程度か、という質問に答えを出そうと試みるプロセスです。</span><span class="sxs-lookup"><span data-stu-id="0a31c-120">This process tries to answer the question of what threats there are to the system, how likely the threats are, and the potential damage from them.</span></span>

<span data-ttu-id="0a31c-121">脅威の一覧を作成したら、それらを軽減する価値があるかどうかを判断する必要があります。</span><span class="sxs-lookup"><span data-stu-id="0a31c-121">Once the list of threats has been established, you need to decide whether they're worth mitigating.</span></span> <span data-ttu-id="0a31c-122">場合によっては、脅威の可能性が低く、それに対する計画にコストがかかるため、エネルギーを費やす価値がないこともあります。</span><span class="sxs-lookup"><span data-stu-id="0a31c-122">Sometimes a threat is so unlikely and expensive to plan for that it isn't worth spending energy on it.</span></span> <span data-ttu-id="0a31c-123">たとえば、一部の国家レベルのアクターは、何百万台ものデバイスに使用されるプロセスの設計に変更を加える可能性があります。</span><span class="sxs-lookup"><span data-stu-id="0a31c-123">For instance, some state level actor could inject changes into the design of a process that is used by millions of devices.</span></span> <span data-ttu-id="0a31c-124">このような状況で、あるコードが[リング 3](https://en.wikipedia.org/wiki/Protection_ring) で実行されるのではなく、そのコードがリング 0 で実行されるようになります。</span><span class="sxs-lookup"><span data-stu-id="0a31c-124">Now, instead of running a certain piece of code in [Ring 3](https://en.wikipedia.org/wiki/Protection_ring), that code is run in Ring 0.</span></span> <span data-ttu-id="0a31c-125">このプロセスにより、ハイパーバイザーをバイパスして攻撃コードをベアメタル マシン上で実行する悪用が可能になり、そのハードウェア上で動作するすべての仮想マシンへの攻撃が可能になります。</span><span class="sxs-lookup"><span data-stu-id="0a31c-125">This process allows an exploit that can bypass the hypervisor and run the attack code on the bare metal machines, allowing attacks on all the virtual machines that are running on that hardware.</span></span>

<span data-ttu-id="0a31c-126">変更されたプロセッサを検出するには、顕微鏡とそのプロセッサのシリコン上の設計に関する高度な知識が必要です。</span><span class="sxs-lookup"><span data-stu-id="0a31c-126">The altered processors are difficult to detect without a microscope and advanced knowledge of the on silicon design of that processor.</span></span> <span data-ttu-id="0a31c-127">このシナリオは発生する可能性が低く、軽減にもコストがかかるため、そのための悪用対策の構築を推奨する脅威モデルはないでしょう。</span><span class="sxs-lookup"><span data-stu-id="0a31c-127">This scenario is unlikely to happen and expensive to mitigate, so probably no threat model would recommend building exploit protection for it.</span></span>

<span data-ttu-id="0a31c-128">より可能性の高い脅威としては、`Id` の増分攻撃 (URL の `Id=2` を `Id=3` に置き換える) や SQL インジェクションを可能にするアクセス制御の破損などがあり、その防御策を構築する方が魅力的です。</span><span class="sxs-lookup"><span data-stu-id="0a31c-128">More likely threats, such as broken access controls permitting `Id` incrementing attacks (replacing `Id=2` with `Id=3` in the URL) or SQL injection, are more attractive to build protections against.</span></span> <span data-ttu-id="0a31c-129">このような脅威に対する軽減策を講じて、企業の評判を落とすような恥ずかしいセキュリティ ホールを防ぐことは非常に合理的です。</span><span class="sxs-lookup"><span data-stu-id="0a31c-129">The mitigations for these threats are quite reasonable to build and prevent embarrassing security holes that smear the company's reputation.</span></span>

## <a name="principle-of-least-privilege"></a><span data-ttu-id="0a31c-130">最小限の特権の原則</span><span class="sxs-lookup"><span data-stu-id="0a31c-130">Principle of least privilege</span></span>

<span data-ttu-id="0a31c-131">コンピューター セキュリティの基礎となる考え方の 1 つに、最小限の特権の原則 (POLP) があります。</span><span class="sxs-lookup"><span data-stu-id="0a31c-131">One of the founding ideas in computer security is the Principle of Least Privilege (POLP).</span></span> <span data-ttu-id="0a31c-132">これは、デジタル、物理を問わず、あらゆる形式のセキュリティにおいて基礎となる考え方です。</span><span class="sxs-lookup"><span data-stu-id="0a31c-132">It's actually a foundational idea in most any form of security be it digital or physical.</span></span> <span data-ttu-id="0a31c-133">簡単に言うと、ユーザーまたはプロセスには、そのタスクを実行するために必要な最小限の数の権限を持たせるべきであるという原則です。</span><span class="sxs-lookup"><span data-stu-id="0a31c-133">In short, the principle is that any user or process should have the smallest number of rights possible to execute its task.</span></span>

<span data-ttu-id="0a31c-134">たとえば、銀行の窓口係を考えてみましょう。金庫を利用することは珍しい行動です。</span><span class="sxs-lookup"><span data-stu-id="0a31c-134">As an example, think of the tellers at a bank: accessing the safe is an uncommon activity.</span></span> <span data-ttu-id="0a31c-135">そのため、平均的な窓口係が自分で金庫を開けることはできません。</span><span class="sxs-lookup"><span data-stu-id="0a31c-135">So, the average teller can't open the safe themselves.</span></span> <span data-ttu-id="0a31c-136">アクセス権を得るには、追加のセキュリティ チェックを行う銀行のマネージャーを介して要求をエスカレートする必要があります。</span><span class="sxs-lookup"><span data-stu-id="0a31c-136">To gain access, they need to escalate their request through a bank manager, who performs additional security checks.</span></span>

<span data-ttu-id="0a31c-137">コンピューター システムの場合、データベースに接続するユーザーの権限がその好例です。</span><span class="sxs-lookup"><span data-stu-id="0a31c-137">In a computer system, a fantastic example is the rights of a user connecting to a database.</span></span> <span data-ttu-id="0a31c-138">多くの場合、データベース構造の構築とアプリケーションの実行の両方に 1 つのユーザー アカウントが使用されます。</span><span class="sxs-lookup"><span data-stu-id="0a31c-138">In many cases, there's a single user account used to both build the database structure and run the application.</span></span> <span data-ttu-id="0a31c-139">極端な場合を除いて、アプリケーションを実行するアカウントは、スキーマ情報を更新できる必要がありません。</span><span class="sxs-lookup"><span data-stu-id="0a31c-139">Except in extreme cases, the account running the application doesn't need the ability to update schema information.</span></span> <span data-ttu-id="0a31c-140">さまざまなレベルの特権を付与する複数のアカウントを用意するようにします。</span><span class="sxs-lookup"><span data-stu-id="0a31c-140">There should be several accounts that provide different levels of privilege.</span></span> <span data-ttu-id="0a31c-141">アプリケーションからは、テーブル内のデータの読み取りと書き込みのアクセス権を付与するアクセス許可レベルのみを使用するようにします。</span><span class="sxs-lookup"><span data-stu-id="0a31c-141">The application should only use the permission level that grants read and writes access to the data in the tables.</span></span> <span data-ttu-id="0a31c-142">このような保護機能があれば、データベースのテーブルをドロップしたり、悪意のあるトリガーを導入したりすることを目的とした攻撃を排除できます。</span><span class="sxs-lookup"><span data-stu-id="0a31c-142">This kind of protection would eliminate attacks that aimed to drop database tables or introduce malicious triggers.</span></span>

<span data-ttu-id="0a31c-143">クラウドネイティブ アプリケーションを構築する際には、ほとんどの部分で最小限の特権の原則を覚えておくと便利です。</span><span class="sxs-lookup"><span data-stu-id="0a31c-143">Almost every part of building a cloud-native application can benefit from remembering the principle of least privilege.</span></span> <span data-ttu-id="0a31c-144">ファイアウォール、ネットワーク セキュリティ グループ、ロール、ロールベースのアクセス制御 (RBAC) のスコープなどを設定する際にも役立ちます。</span><span class="sxs-lookup"><span data-stu-id="0a31c-144">You can find it at play when setting up firewalls, network security groups, roles, and scopes in Role-based access control (RBAC).</span></span>

## <a name="penetration-testing"></a><span data-ttu-id="0a31c-145">侵入テスト</span><span class="sxs-lookup"><span data-stu-id="0a31c-145">Penetration testing</span></span>

<span data-ttu-id="0a31c-146">アプリケーションが複雑になるにつれて、攻撃ベクトルの数は驚くべき速さで増加します。</span><span class="sxs-lookup"><span data-stu-id="0a31c-146">As applications become more complicated the number of attack vectors increases at an alarming rate.</span></span> <span data-ttu-id="0a31c-147">脅威のモデル化は、システムの構築者と同一人物が行う傾向があるという欠点があります。</span><span class="sxs-lookup"><span data-stu-id="0a31c-147">Threat modeling is flawed in that it tends to be executed by the same people building the system.</span></span> <span data-ttu-id="0a31c-148">多くの開発者が、ユーザーとの対話を想定することに苦労し、使い勝手の悪いユーザー インターフェイスを作ってしまうのと同じように、ほとんどの開発者は、あらゆる攻撃ベクトルを把握することができません。</span><span class="sxs-lookup"><span data-stu-id="0a31c-148">In the same way that many developers have trouble envisioning user interactions and then build unusable user interfaces, most developers have difficulty seeing every attack vector.</span></span> <span data-ttu-id="0a31c-149">また、システムを構築している開発者が攻撃手法に精通しておらず、重要な何かを見逃している可能性もあります。</span><span class="sxs-lookup"><span data-stu-id="0a31c-149">It's also possible that the developers building the system aren't well versed in attack methodologies and miss something crucial.</span></span>

<span data-ttu-id="0a31c-150">侵入テスト ("ペン テスト" とも呼ばれます) を行うには、外部のアクターを招き、システムへの攻撃を試みてもらいます。</span><span class="sxs-lookup"><span data-stu-id="0a31c-150">Penetration testing or "pen testing" involves bringing in external actors to attempt to attack the system.</span></span> <span data-ttu-id="0a31c-151">こうした攻撃者は、外部のコンサルティング会社の場合や、優れたセキュリティ知識を持ち、別の業務を受け持つ他の開発者の場合があります。</span><span class="sxs-lookup"><span data-stu-id="0a31c-151">These attackers may be an external consulting company or other developers with good security knowledge from another part of the business.</span></span> <span data-ttu-id="0a31c-152">その担当者には、システムの破壊を試みることができる自由裁量が与えられます。</span><span class="sxs-lookup"><span data-stu-id="0a31c-152">They're given carte blanche to attempt to subvert the system.</span></span> <span data-ttu-id="0a31c-153">多くの場合、パッチを適用する必要がある広範なセキュリティ ホールが見つけられます。</span><span class="sxs-lookup"><span data-stu-id="0a31c-153">Frequently, they'll find extensive security holes that need to be patched.</span></span> <span data-ttu-id="0a31c-154">CEO に対してフィッシング攻撃を悪用するなど、まったく予期しないものが攻撃ベクトルとなることがあります。</span><span class="sxs-lookup"><span data-stu-id="0a31c-154">Sometimes the attack vector will be something totally unexpected like exploiting a phishing attack against the CEO.</span></span>

<span data-ttu-id="0a31c-155">Azure 自体も、[Microsoft 内部のハッカー チーム](https://azure.microsoft.com/resources/videos/red-vs-blue-internal-security-penetration-testing-of-microsoft-azure/)から常に攻撃を受けています。</span><span class="sxs-lookup"><span data-stu-id="0a31c-155">Azure itself is constantly undergoing attacks from a [team of hackers inside Microsoft](https://azure.microsoft.com/resources/videos/red-vs-blue-internal-security-penetration-testing-of-microsoft-azure/).</span></span> <span data-ttu-id="0a31c-156">長年にわたり、壊滅的な被害をもたらす可能性のある何十件もの攻撃ベクトルを彼らが最初に発見し、外部から悪用される前にそれらを閉じてきました。</span><span class="sxs-lookup"><span data-stu-id="0a31c-156">Over the years, they've been the first to find dozens of potentially catastrophic attack vectors, closing them before they can be exploited externally.</span></span> <span data-ttu-id="0a31c-157">ターゲットが魅力的であればあるほど、悪用しようとするアクターが絶えない可能性が高くなりますが、Azure よりも魅力的なターゲットは世界でも少数です。</span><span class="sxs-lookup"><span data-stu-id="0a31c-157">The more tempting a target, the more likely that eternal actors will attempt to exploit it and there are a few targets in the world more tempting than Azure.</span></span>

## <a name="monitoring"></a><span data-ttu-id="0a31c-158">監視</span><span class="sxs-lookup"><span data-stu-id="0a31c-158">Monitoring</span></span>

<span data-ttu-id="0a31c-159">攻撃者がアプリケーションへの侵入を試みた場合、何らかの警告があるはずです。</span><span class="sxs-lookup"><span data-stu-id="0a31c-159">Should an attacker attempt to penetrate an application, there should be some warning of it.</span></span> <span data-ttu-id="0a31c-160">多くの場合、サービスからのログを調べることで攻撃を発見できます。</span><span class="sxs-lookup"><span data-stu-id="0a31c-160">Frequently, attacks can be spotted by examining the logs from services.</span></span> <span data-ttu-id="0a31c-161">攻撃には、その成功前に発見できる明らかな兆候があります。</span><span class="sxs-lookup"><span data-stu-id="0a31c-161">Attacks leave telltale signs that can be spotted before they succeed.</span></span> <span data-ttu-id="0a31c-162">たとえば、パスワードを推測しようとする攻撃者は、ログイン システムに対して多くの要求を行います。</span><span class="sxs-lookup"><span data-stu-id="0a31c-162">For instance, an attacker attempting to guess a password will make many requests to a login system.</span></span> <span data-ttu-id="0a31c-163">ログイン システムの周辺を監視すると、通常のアクセス パターンとは異なる奇妙なパターンを検出することができます。</span><span class="sxs-lookup"><span data-stu-id="0a31c-163">Monitoring around the login system can detect weird patterns that are out of line with the typical access pattern.</span></span> <span data-ttu-id="0a31c-164">この監視をアラートにして、運用担当者に何らかの対策を講じるように警告することができます。</span><span class="sxs-lookup"><span data-stu-id="0a31c-164">This monitoring can be turned into an alert that can, in turn, alert an operations person to activate some sort of countermeasure.</span></span> <span data-ttu-id="0a31c-165">高度に成熟した監視システムの場合、要求をブロックしたり、応答を抑えたりする規則を事前に追加して、このような逸脱に基づいてアクションを実行することもできます。</span><span class="sxs-lookup"><span data-stu-id="0a31c-165">A highly mature monitoring system might even take action based on these deviations proactively adding rules to block requests or throttle responses.</span></span>

## <a name="securing-the-build"></a><span data-ttu-id="0a31c-166">ビルドをセキュリティで保護する</span><span class="sxs-lookup"><span data-stu-id="0a31c-166">Securing the build</span></span>

<span data-ttu-id="0a31c-167">セキュリティが見落とされがちな場所の 1 つは、ビルド プロセスの周辺です。</span><span class="sxs-lookup"><span data-stu-id="0a31c-167">One place where security is often overlooked is around the build process.</span></span> <span data-ttu-id="0a31c-168">ビルド時に、安全でないコードやチェックインの資格情報のスキャンなどのセキュリティ チェックを行うだけでなく、ビルド自体もセキュリティで保護する必要があります。</span><span class="sxs-lookup"><span data-stu-id="0a31c-168">Not only should the build run security checks, such as scanning for insecure code or checked-in credentials, but the build itself should be secure.</span></span> <span data-ttu-id="0a31c-169">ビルド サーバーが侵害された場合、任意のコードを製品に取り込む絶好のベクトルとなります。</span><span class="sxs-lookup"><span data-stu-id="0a31c-169">If the build server is compromised, then it provides a fantastic vector for introducing arbitrary code into the product.</span></span>

<span data-ttu-id="0a31c-170">攻撃者が Web アプリケーションにサインインするユーザーのパスワードを盗もうとしているとします。</span><span class="sxs-lookup"><span data-stu-id="0a31c-170">Imagine that an attacker is looking to steal the passwords of people signing into a web application.</span></span> <span data-ttu-id="0a31c-171">この場合、チェックアウトされたコードを修正し、任意のログイン要求を別のサーバーへミラーリングするビルド手順を組み込む可能性があります。</span><span class="sxs-lookup"><span data-stu-id="0a31c-171">They could introduce a build step that modifies the checked-out code to mirror any login request to another server.</span></span> <span data-ttu-id="0a31c-172">次にコードがビルドされると、自動的に更新されます。</span><span class="sxs-lookup"><span data-stu-id="0a31c-172">The next time code goes through the build, it's silently updated.</span></span> <span data-ttu-id="0a31c-173">ビルド前に実行されるため、ソース コードの脆弱性スキャンではこの脆弱性を検出できません。</span><span class="sxs-lookup"><span data-stu-id="0a31c-173">The source code vulnerability scanning won't catch this vulnerability as it runs before the build.</span></span> <span data-ttu-id="0a31c-174">同様に、ビルド手順はビルド サーバー上で実行されるため、コード レビューでは誰もこの脆弱性を発見できません。</span><span class="sxs-lookup"><span data-stu-id="0a31c-174">Equally, nobody will catch it in a code review because the build steps live on the build server.</span></span> <span data-ttu-id="0a31c-175">悪用されたコードは運用環境に配置され、そこでパスワードが採取される可能性があります。</span><span class="sxs-lookup"><span data-stu-id="0a31c-175">The exploited code will go to production where it can harvest passwords.</span></span> <span data-ttu-id="0a31c-176">おそらく、ビルド プロセスの変更の監査ログがないか、少なくとも監査を監視している人は誰もいません。</span><span class="sxs-lookup"><span data-stu-id="0a31c-176">Probably there's no audit log of the build process changes, or at least nobody monitoring the audit.</span></span>

<span data-ttu-id="0a31c-177">このシナリオは、一見すると価値の低いターゲットを使用してシステムに侵入される可能性があるという完璧な例です。</span><span class="sxs-lookup"><span data-stu-id="0a31c-177">This scenario is a perfect example of a seemingly low-value target that can be used to break into the system.</span></span> <span data-ttu-id="0a31c-178">攻撃者がシステムの境界を突破すると、任意の場所で実害を与えることができるレベルまでアクセス許可を昇格させる方法を見つける作業に取りかかれるようになります。</span><span class="sxs-lookup"><span data-stu-id="0a31c-178">Once an attacker breaches the perimeter of the system, they can start working on finding ways to elevate their permissions to the point that they can cause real harm anywhere they like.</span></span>

## <a name="building-secure-code"></a><span data-ttu-id="0a31c-179">安全なコードの構築</span><span class="sxs-lookup"><span data-stu-id="0a31c-179">Building secure code</span></span>

<span data-ttu-id="0a31c-180">.NET Framework は、既に非常に安全なフレームワークです。</span><span class="sxs-lookup"><span data-stu-id="0a31c-180">.NET Framework is already a quite secure framework.</span></span> <span data-ttu-id="0a31c-181">配列の範囲から外れるなど、アンマネージド コードの落とし穴の一部を回避できます。</span><span class="sxs-lookup"><span data-stu-id="0a31c-181">It avoids some of the pitfalls of unmanaged code, such as walking off the ends of arrays.</span></span> <span data-ttu-id="0a31c-182">セキュリティ ホールが発見されると、それを修正する作業が積極的に行われます。</span><span class="sxs-lookup"><span data-stu-id="0a31c-182">Work is actively done to fix security holes as they're discovered.</span></span> <span data-ttu-id="0a31c-183">フレームワーク内の問題を見つけて、悪用するのではなく報告した研究者に対して対価を支払う[バグ報奨金プログラム](https://www.microsoft.com/msrc/bounty)もあります。</span><span class="sxs-lookup"><span data-stu-id="0a31c-183">There's even a [bug bounty program](https://www.microsoft.com/msrc/bounty) that pays researchers to find issues in the framework and report them instead of exploiting them.</span></span>

<span data-ttu-id="0a31c-184">.NET コードをより安全にする方法はたくさんあります。</span><span class="sxs-lookup"><span data-stu-id="0a31c-184">There are many ways to make .NET code more secure.</span></span> <span data-ttu-id="0a31c-185">[.NET の「安全なコーディングのガイドライン」](../../standard/security/secure-coding-guidelines.md)の記事のようなガイドラインに従うことは、最初から確実に安全なコードにするために合理的な手順です。</span><span class="sxs-lookup"><span data-stu-id="0a31c-185">Following guidelines such as the [Secure coding guidelines for .NET](../../standard/security/secure-coding-guidelines.md) article is a reasonable step to take to ensure that the code is secure from the ground up.</span></span> <span data-ttu-id="0a31c-186">「[OWASP Top Ten (OWASP トップ テン)](https://owasp.org/www-project-top-ten/)」も安全なコードを構築するために貴重なガイドです。</span><span class="sxs-lookup"><span data-stu-id="0a31c-186">The [OWASP top 10](https://owasp.org/www-project-top-ten/) is another invaluable guide to build secure code.</span></span>

<span data-ttu-id="0a31c-187">ビルド プロセスは、運用環境に移行する前にソース コードの問題点を検出するスキャン ツールを配置するために適した場所です。</span><span class="sxs-lookup"><span data-stu-id="0a31c-187">The build process is a good place to put scanning tools to detect problems in source code before they make it into production.</span></span> <span data-ttu-id="0a31c-188">ほとんどのプロジェクトは、他のパッケージに依存しています。</span><span class="sxs-lookup"><span data-stu-id="0a31c-188">Most every project has dependencies on some other packages.</span></span> <span data-ttu-id="0a31c-189">古くなったパッケージをスキャンできるツールがあれば、ナイトリー ビルドでも問題を検出できます。</span><span class="sxs-lookup"><span data-stu-id="0a31c-189">A tool that can scan for outdated packages will catch problems in a nightly build.</span></span> <span data-ttu-id="0a31c-190">また、Docker イメージをビルドする場合でも、ベース イメージに既知の脆弱性がないことを確認しておくと便利です。</span><span class="sxs-lookup"><span data-stu-id="0a31c-190">Even when building Docker images, it's useful to check and make sure that the base image doesn't have known vulnerabilities.</span></span> <span data-ttu-id="0a31c-191">また、誰も誤って資格情報をチェックインしていないことも確認すべき点です。</span><span class="sxs-lookup"><span data-stu-id="0a31c-191">Another thing to check is that nobody has accidentally checked in credentials.</span></span>

## <a name="built-in-security"></a><span data-ttu-id="0a31c-192">組み込みのセキュリティ</span><span class="sxs-lookup"><span data-stu-id="0a31c-192">Built-in security</span></span>

<span data-ttu-id="0a31c-193">Azure は、ほとんどのユーザーにとって使いやすさとセキュリティのバランスが取れるように設計されています。</span><span class="sxs-lookup"><span data-stu-id="0a31c-193">Azure is designed to balance usability and security for most users.</span></span> <span data-ttu-id="0a31c-194">ユーザーによってセキュリティ要件は異なるため、クラウド セキュリティへのアプローチを細かく調整する必要があります。</span><span class="sxs-lookup"><span data-stu-id="0a31c-194">Different users are going to have different security requirements, so they need to fine-tune their approach to cloud security.</span></span> <span data-ttu-id="0a31c-195">Microsoft は、[トラスト センター](https://azure.microsoft.com/support/trust-center/)で多くのセキュリティ情報を公開しています。</span><span class="sxs-lookup"><span data-stu-id="0a31c-195">Microsoft publishes a great deal of security information in the [Trust Center](https://azure.microsoft.com/support/trust-center/).</span></span> <span data-ttu-id="0a31c-196">このリソースは、組み込まれている攻撃リスク軽減テクノロジのしくみを理解したいと考える担当者にとって、最初に参照すべき場所です。</span><span class="sxs-lookup"><span data-stu-id="0a31c-196">This resource should be the first stop for those professionals interested in understanding how the built-in attack mitigation technologies work.</span></span>

<span data-ttu-id="0a31c-197">Azure portal 内にある [Azure Advisor](https://azure.microsoft.com/services/advisor/) は、環境を常にスキャンして推奨事項を提示するシステムです。</span><span class="sxs-lookup"><span data-stu-id="0a31c-197">Within the Azure portal, the [Azure Advisor](https://azure.microsoft.com/services/advisor/) is a system that is constantly scanning an environment and making recommendations.</span></span> <span data-ttu-id="0a31c-198">このような推奨事項には、ユーザーのコスト削減を目的としたものもあれば、仮想ネットワークによって保護されていないストレージ コンテナーが世界に向けて公開されているなど、潜在的に安全でない構成を特定するためのものもあります。</span><span class="sxs-lookup"><span data-stu-id="0a31c-198">Some of these recommendations are designed to save users money, but others are designed to identify potentially insecure configurations, such as having a storage container open to the world and not protected by a Virtual Network.</span></span>

## <a name="azure-network-infrastructure"></a><span data-ttu-id="0a31c-199">Azure ネットワーク インフラストラクチャ</span><span class="sxs-lookup"><span data-stu-id="0a31c-199">Azure network infrastructure</span></span>

<span data-ttu-id="0a31c-200">オンプレミスのデプロイ環境では、ネットワークの設定に多大なエネルギーが費やされます。</span><span class="sxs-lookup"><span data-stu-id="0a31c-200">In an on-premises deployment environment, a great deal of energy is dedicated to setting up networking.</span></span> <span data-ttu-id="0a31c-201">ルーターやスイッチなどの設定は複雑な作業です。</span><span class="sxs-lookup"><span data-stu-id="0a31c-201">Setting up routers, switches, and the such is complicated work.</span></span> <span data-ttu-id="0a31c-202">ネットワークにより、特定のリソースと他のリソースとの通信が可能になりますが、場合によってはアクセスが阻止されます。</span><span class="sxs-lookup"><span data-stu-id="0a31c-202">Networks allow certain resources to talk to other resources and prevent access in some cases.</span></span> <span data-ttu-id="0a31c-203">よくあるネットワーク規則として、開発途中のコードが暴走して大量のデータが削除されるという万が一の状況に備えて、開発環境から運用環境へのアクセスを制限するというものがあります。</span><span class="sxs-lookup"><span data-stu-id="0a31c-203">A frequent network rule is to restrict access to the production environment from the development environment on the off chance that a half-developed piece of code runs awry and deletes a swath of data.</span></span>

<span data-ttu-id="0a31c-204">既定では、ほとんどの PaaS Azure リソースには、最も基本的で許容度の高いネットワーク設定しかありません。</span><span class="sxs-lookup"><span data-stu-id="0a31c-204">Out of the box, most PaaS Azure resources have only the most basic and permissive networking setup.</span></span> <span data-ttu-id="0a31c-205">たとえば、インターネット上の誰でもアプリ サービスにアクセスできます。</span><span class="sxs-lookup"><span data-stu-id="0a31c-205">For instance, anybody on the Internet can access an app service.</span></span> <span data-ttu-id="0a31c-206">新しい SQL Server インスタンスは、通常、外部からアクセスできないように制限されていますが、Azure 自体に使用される IP アドレスの範囲は許可されています。</span><span class="sxs-lookup"><span data-stu-id="0a31c-206">New SQL Server instances typically come restricted, so that external parties can't access them, but the IP address ranges used by Azure itself are permitted through.</span></span> <span data-ttu-id="0a31c-207">つまり、SQL サーバーは外部の脅威から保護されていますが、攻撃者は Azure のブリッジ ヘッドを設定するだけで、そこから Azure 上のすべての SQL インスタンスに対して攻撃を仕掛けることができます。</span><span class="sxs-lookup"><span data-stu-id="0a31c-207">So, while the SQL server is protected from external threats, an attacker only needs to set up an Azure bridgehead from where they can launch attacks against all SQL instances on Azure.</span></span>

<span data-ttu-id="0a31c-208">幸いなことに、ほとんどの Azure リソースは、きめ細かなアクセス制御が可能な Azure 仮想ネットワークに配置することができます。</span><span class="sxs-lookup"><span data-stu-id="0a31c-208">Fortunately, most Azure resources can be placed into an Azure Virtual Network that allows fine-grained access control.</span></span> <span data-ttu-id="0a31c-209">オンプレミス ネットワークを使用して広い世界から保護されたプライベート ネットワークを構築する方法と同様に、仮想ネットワークは、Azure ネットワーク内に配置されたプライベート IP アドレスの島です。</span><span class="sxs-lookup"><span data-stu-id="0a31c-209">Similar to the way that on-premises networks establish private networks that are protected from the wider world, virtual networks are islands of private IP addresses that are located within the Azure network.</span></span>

![図 9-1 Azure 内の仮想ネットワーク](./media/virtual-network.png)

<span data-ttu-id="0a31c-211">**図 9-1**</span><span class="sxs-lookup"><span data-stu-id="0a31c-211">**Figure 9-1**.</span></span> <span data-ttu-id="0a31c-212">Azure 内の仮想ネットワーク</span><span class="sxs-lookup"><span data-stu-id="0a31c-212">A virtual network in Azure.</span></span>

<span data-ttu-id="0a31c-213">オンプレミス ネットワークに、ネットワークへのアクセスを管理するファイアウォールがあるように、仮想ネットワークの境界にも同様のファイアウォールを設置することができます。</span><span class="sxs-lookup"><span data-stu-id="0a31c-213">In the same way that on-premises networks have a firewall governing access to the network, you can establish a similar firewall at the boundary of the virtual network.</span></span> <span data-ttu-id="0a31c-214">既定では、仮想ネットワーク上のすべてのリソースは、インターネットとの通信が可能です。</span><span class="sxs-lookup"><span data-stu-id="0a31c-214">By default, all the resources on a virtual network can still talk to the Internet.</span></span> <span data-ttu-id="0a31c-215">何らかの形式の明示的なファイアウォール例外が必要なのは、受信接続のみです。</span><span class="sxs-lookup"><span data-stu-id="0a31c-215">It's only incoming connections that require some form of explicit firewall exception.</span></span>

<span data-ttu-id="0a31c-216">ネットワークを構築したら、ストレージ アカウントなどの内部リソースを、仮想ネットワーク上にあるリソースからのアクセスのみを許可するように設定することができます。</span><span class="sxs-lookup"><span data-stu-id="0a31c-216">With the network established, internal resources like storage accounts can be set up to only allow for access by resources that are also on the Virtual Network.</span></span> <span data-ttu-id="0a31c-217">このファイアウォールにより、万が一、ストレージ アカウントのキーが漏えいしたとしても、攻撃者はそこに接続して漏えいしたキーを悪用することができないため、セキュリティ レベルが向上します。</span><span class="sxs-lookup"><span data-stu-id="0a31c-217">This firewall provides an extra level of security, should the keys for that storage account be leaked, attackers wouldn't be able to connect to it to exploit the leaked keys.</span></span> <span data-ttu-id="0a31c-218">このシナリオは、最小限の特権の原則の一例でもあります。</span><span class="sxs-lookup"><span data-stu-id="0a31c-218">This scenario is another example of the principle of least privilege.</span></span>

<span data-ttu-id="0a31c-219">Azure Kubernetes クラスターのノードは、Azure にネイティブな他のリソースと同様に、仮想ネットワークに参加することができます。</span><span class="sxs-lookup"><span data-stu-id="0a31c-219">The nodes in an Azure Kubernetes cluster can participate in a virtual network just like other resources that are more native to Azure.</span></span> <span data-ttu-id="0a31c-220">この機能は、[Azure Container Networking Interface](https://github.com/Azure/azure-container-networking/blob/master/docs/cni.md) と呼ばれます。</span><span class="sxs-lookup"><span data-stu-id="0a31c-220">This functionality is called [Azure Container Networking Interface](https://github.com/Azure/azure-container-networking/blob/master/docs/cni.md).</span></span> <span data-ttu-id="0a31c-221">実際には、仮想ネットワーク内にサブネットが割り当てられ、そこに仮想マシンやコンテナー イメージが割り当てられます。</span><span class="sxs-lookup"><span data-stu-id="0a31c-221">In effect, it allocates a subnet within the virtual network on which virtual machines and container images are allocated.</span></span>

<span data-ttu-id="0a31c-222">最小限の特権の原則についてさらに説明すると、仮想ネットワーク内のすべてのリソースと、他のすべてのリソースとを通信できるようにする必要はありません。</span><span class="sxs-lookup"><span data-stu-id="0a31c-222">Continuing down the path of illustrating the principle of least privilege, not every resource within a Virtual Network needs to talk to every other resource.</span></span> <span data-ttu-id="0a31c-223">たとえば、ストレージ アカウントと SQL データベースに Web API を提供するアプリケーションの場合、データベースとストレージ アカウントが相互に通信する必要はありません。</span><span class="sxs-lookup"><span data-stu-id="0a31c-223">For instance, in an application that provides a web API over a storage account and a SQL database, it's unlikely that the database and the storage account need to talk to one another.</span></span> <span data-ttu-id="0a31c-224">これらの間でデータを共有する場合は、Web アプリケーションを介して行われます。</span><span class="sxs-lookup"><span data-stu-id="0a31c-224">Any data sharing between them would go through the web application.</span></span> <span data-ttu-id="0a31c-225">そのため、[ネットワーク セキュリティ グループ (NSG)](/azure/virtual-network/security-overview) を使用して、2 つのサービス間のトラフィックを拒否することができます。</span><span class="sxs-lookup"><span data-stu-id="0a31c-225">So, a [network security group (NSG)](/azure/virtual-network/security-overview) could be used to deny traffic between the two services.</span></span>

<span data-ttu-id="0a31c-226">リソース間の通信を拒否するポリシーは、特にトラフィック制限なしに Azure を使用していた背景からすると、実装するのが面倒です。</span><span class="sxs-lookup"><span data-stu-id="0a31c-226">A policy of denying communication between resources can be annoying to implement, especially coming from a background of using Azure without traffic restrictions.</span></span> <span data-ttu-id="0a31c-227">他の一部のクラウドでは、ネットワーク セキュリティ グループの概念がはるかに普及しています。</span><span class="sxs-lookup"><span data-stu-id="0a31c-227">On some other clouds, the concept of network security groups is much more prevalent.</span></span> <span data-ttu-id="0a31c-228">たとえば、AWS の既定のポリシーでは、NSG の規則によって有効になるまで、リソース間で通信できません。</span><span class="sxs-lookup"><span data-stu-id="0a31c-228">For instance, the default policy on AWS is that resources can't communicate among themselves until enabled by rules in an NSG.</span></span> <span data-ttu-id="0a31c-229">この開発には時間がかかりますが、制限の厳しい環境では、より安全な既定値となります。</span><span class="sxs-lookup"><span data-stu-id="0a31c-229">While slower to develop this, a more restrictive environment provides a more secure default.</span></span> <span data-ttu-id="0a31c-230">適切な DevOps 手法を利用すること、特に [Azure Resource Manager や Terraform](infrastructure-as-code.md) を使用してアクセス許可を管理することで、規則の制御が容易になります。</span><span class="sxs-lookup"><span data-stu-id="0a31c-230">Making use of proper DevOps practices, especially using [Azure Resource Manager or Terraform](infrastructure-as-code.md) to manage permissions can make controlling the rules easier.</span></span>

<span data-ttu-id="0a31c-231">仮想ネットワークは、オンプレミスとクラウドのリソース間の通信を設定する場合にも役立ちます。</span><span class="sxs-lookup"><span data-stu-id="0a31c-231">Virtual Networks can also be useful when setting up communication between on-premises and cloud resources.</span></span> <span data-ttu-id="0a31c-232">仮想プライベート ネットワークを使用することで、2 つのネットワークをシームレスに接続することができます。</span><span class="sxs-lookup"><span data-stu-id="0a31c-232">A virtual private network can be used to seamlessly attach the two networks together.</span></span> <span data-ttu-id="0a31c-233">このアプローチにより、すべてのユーザーがオンサイトにいるシナリオでは、ゲートウェイなしで仮想ネットワークを実行できます。</span><span class="sxs-lookup"><span data-stu-id="0a31c-233">This approach allows running a virtual network without any sort of gateway for scenarios where all the users are on-site.</span></span> <span data-ttu-id="0a31c-234">このネットワークを構築するために使用できるテクノロジはいくつかあります。</span><span class="sxs-lookup"><span data-stu-id="0a31c-234">There are a number of technologies that can be used to establish this network.</span></span> <span data-ttu-id="0a31c-235">最も簡単な方法は、多くのルーターと Azure の間に設定できる[サイト間 VPN](/azure/vpn-gateway/vpn-gateway-about-vpngateways?toc=%252fazure%252fvirtual-network%252ftoc.json#s2smulti) を使用することです。</span><span class="sxs-lookup"><span data-stu-id="0a31c-235">The simplest is to use a [site-to-site VPN](/azure/vpn-gateway/vpn-gateway-about-vpngateways?toc=%252fazure%252fvirtual-network%252ftoc.json#s2smulti) that can be established between many routers and Azure.</span></span> <span data-ttu-id="0a31c-236">トラフィックは暗号化され、他のトラフィックと同じバイトあたりのコストでインターネット経由でトンネリングされます。</span><span class="sxs-lookup"><span data-stu-id="0a31c-236">Traffic is encrypted and tunneled over the Internet at the same cost per byte as any other traffic.</span></span> <span data-ttu-id="0a31c-237">より多くの帯域幅やより高いセキュリティが必要なシナリオの場合、Azure には、オンプレミス ネットワークと Azure の間にプライベート回線を使用する [Express Route](/azure/vpn-gateway/vpn-gateway-about-vpngateways?toc=%252fazure%252fvirtual-network%252ftoc.json#ExpressRoute) というサービスが用意されています。</span><span class="sxs-lookup"><span data-stu-id="0a31c-237">For scenarios where more bandwidth or more security is desirable, Azure offers a service called [Express Route](/azure/vpn-gateway/vpn-gateway-about-vpngateways?toc=%252fazure%252fvirtual-network%252ftoc.json#ExpressRoute) that uses a private circuit between an on-premises network and Azure.</span></span> <span data-ttu-id="0a31c-238">構築のコストは高く、困難ですが、より安全でもあります。</span><span class="sxs-lookup"><span data-stu-id="0a31c-238">It's more costly and difficult to establish but also more secure.</span></span>

## <a name="role-based-access-control-for-restricting-access-to-azure-resources"></a><span data-ttu-id="0a31c-239">Azure リソースへのアクセスを制限するためのロールベースのアクセス制御</span><span class="sxs-lookup"><span data-stu-id="0a31c-239">Role-based access control for restricting access to Azure resources</span></span>

<span data-ttu-id="0a31c-240">RBAC は、Azure で実行されているアプリケーションに ID を提供するシステムです。</span><span class="sxs-lookup"><span data-stu-id="0a31c-240">RBAC is a system that provides an identity to applications running in Azure.</span></span> <span data-ttu-id="0a31c-241">アプリケーションからは、キーやパスワードを使う代わりに、またはそれに加えて、この ID を使用してリソースにアクセスすることができます。</span><span class="sxs-lookup"><span data-stu-id="0a31c-241">Applications can access resources using this identity instead of or in addition to using keys or passwords.</span></span>

## <a name="security-principals"></a><span data-ttu-id="0a31c-242">セキュリティ プリンシパル</span><span class="sxs-lookup"><span data-stu-id="0a31c-242">Security Principals</span></span>

<span data-ttu-id="0a31c-243">RBAC の 1 つ目のコンポーネントは、セキュリティ プリンシパルです。</span><span class="sxs-lookup"><span data-stu-id="0a31c-243">The first component in RBAC is a security principal.</span></span> <span data-ttu-id="0a31c-244">セキュリティ プリンシパルは、ユーザー、グループ、サービス プリンシパル、またはマネージド ID の場合があります。</span><span class="sxs-lookup"><span data-stu-id="0a31c-244">A security principal can be a user, group, service principal, or managed identity.</span></span>

![図 9-2 さまざまな種類のセキュリティ プリンシパル](./media/rbac-security-principal.png)

<span data-ttu-id="0a31c-246">**図 9-2**</span><span class="sxs-lookup"><span data-stu-id="0a31c-246">**Figure 9-2**.</span></span> <span data-ttu-id="0a31c-247">さまざまな種類のセキュリティ プリンシパル。</span><span class="sxs-lookup"><span data-stu-id="0a31c-247">Different types of security principals.</span></span>

- <span data-ttu-id="0a31c-248">ユーザー - Azure Active Directory にアカウントを持っているすべてのユーザーはユーザーです。</span><span class="sxs-lookup"><span data-stu-id="0a31c-248">User - Any user who has an account in Azure Active Directory is a user.</span></span>
- <span data-ttu-id="0a31c-249">グループ - Azure Active Directory のユーザーのコレクション。</span><span class="sxs-lookup"><span data-stu-id="0a31c-249">Group - A collection of users from Azure Active Directory.</span></span> <span data-ttu-id="0a31c-250">グループのメンバーであるユーザーは、自分のロールに加えて、そのグループのロールも引き受けることになります。</span><span class="sxs-lookup"><span data-stu-id="0a31c-250">As a member of a group, a user takes on the roles of that group in addition to their own.</span></span>
- <span data-ttu-id="0a31c-251">サービス プリンシパル - サービスまたはアプリケーションの実行に使用するセキュリティ ID。</span><span class="sxs-lookup"><span data-stu-id="0a31c-251">Service principal - A security identity under which services or applications run.</span></span>
- <span data-ttu-id="0a31c-252">マネージド ID - Azure によって管理される Azure Active Directory ID。</span><span class="sxs-lookup"><span data-stu-id="0a31c-252">Managed identity - An Azure Active Directory identity managed by Azure.</span></span> <span data-ttu-id="0a31c-253">通常、マネージド ID は、Azure サービスに対する認証を受けるための資格情報を管理するクラウド アプリケーションを開発するときに使用されます。</span><span class="sxs-lookup"><span data-stu-id="0a31c-253">Managed identities are typically used when developing cloud applications that manage the credentials for authenticating to Azure services.</span></span>

<span data-ttu-id="0a31c-254">このセキュリティ プリンシパルは、ほとんどすべてのリソースに適用できます。</span><span class="sxs-lookup"><span data-stu-id="0a31c-254">The security principal can be applied to most any resource.</span></span> <span data-ttu-id="0a31c-255">この側面は、Azure Kubernetes 内で動作するコンテナーにセキュリティ プリンシパルを割り当てることで、Key Vault に格納されているシークレットにアクセスできるようになることを意味します。</span><span class="sxs-lookup"><span data-stu-id="0a31c-255">This aspect means that it's possible to assign a security principal to a container running within Azure Kubernetes, allowing it to access secrets stored in Key Vault.</span></span> <span data-ttu-id="0a31c-256">Azure 関数には、Active Directory インスタンスと通信し、呼び出し元のユーザーの JWT を検証することを許可するアクセス許可を付与することができます。</span><span class="sxs-lookup"><span data-stu-id="0a31c-256">An Azure Function could take on a permission allowing it to talk to an Active Directory instance to validate a JWT for a calling user.</span></span> <span data-ttu-id="0a31c-257">サービス プリンシパルでサービスを有効にすると、そのアクセス許可は、ロールとスコープを使用して細かく管理できます。</span><span class="sxs-lookup"><span data-stu-id="0a31c-257">Once services are enabled with a service principal, their permissions can be managed granularly using roles and scopes.</span></span>

## <a name="roles"></a><span data-ttu-id="0a31c-258">ロール</span><span class="sxs-lookup"><span data-stu-id="0a31c-258">Roles</span></span>

<span data-ttu-id="0a31c-259">セキュリティ プリンシパルは、多数のロールを担うことができます。これを洋服に例えると、多くの帽子をかぶることができます。</span><span class="sxs-lookup"><span data-stu-id="0a31c-259">A security principal can take on many roles or, using a more sartorial analogy, wear many hats.</span></span> <span data-ttu-id="0a31c-260">各ロールには、"Azure Service Bus エンドポイントからメッセージを読み取る" のような一連のアクセス許可が定義されています。</span><span class="sxs-lookup"><span data-stu-id="0a31c-260">Each role defines a series of permissions such as "Read messages from Azure Service Bus endpoint".</span></span> <span data-ttu-id="0a31c-261">セキュリティ プリンシパルの有効なアクセス許可セットは、セキュリティ プリンシパルが持つすべてのロールに割り当てられたすべてのアクセス許可の組み合わせです。</span><span class="sxs-lookup"><span data-stu-id="0a31c-261">The effective permission set of a security principal is the combination of all the permissions assigned to all the roles that a security principal has.</span></span> <span data-ttu-id="0a31c-262">Azure には組み込みのロールが多数あります。また、ユーザーは自分でロールを定義することもできます。</span><span class="sxs-lookup"><span data-stu-id="0a31c-262">Azure has a large number of built-in roles and users can define their own roles.</span></span>

![図 9-3 RBAC ロールの定義](./media/rbac-role-definition.png)

<span data-ttu-id="0a31c-264">**図 9-3**</span><span class="sxs-lookup"><span data-stu-id="0a31c-264">**Figure 9-3**.</span></span> <span data-ttu-id="0a31c-265">RBAC ロールの定義。</span><span class="sxs-lookup"><span data-stu-id="0a31c-265">RBAC role definitions.</span></span>

<span data-ttu-id="0a31c-266">Azure には、所有者、共同作成者、閲覧者、ユーザー アカウント管理者などの多数の高レベルのロールも組み込まれています。</span><span class="sxs-lookup"><span data-stu-id="0a31c-266">Built into Azure are also a number of high-level roles such as Owner, Contributor, Reader, and User Account Administrator.</span></span> <span data-ttu-id="0a31c-267">所有者ロールを持つセキュリティ プリンシパルの場合、すべてのリソースにアクセスし、他のユーザーにアクセス許可を割り当てることができます。</span><span class="sxs-lookup"><span data-stu-id="0a31c-267">With the Owner role, a security principal can access all resources and assign permissions to others.</span></span> <span data-ttu-id="0a31c-268">共同作成者は、すべてのリソースに同じレベルでアクセスできますが、アクセス許可を割り当てることはできません。</span><span class="sxs-lookup"><span data-stu-id="0a31c-268">A contributor has the same level of access to all resources but they can't assign permissions.</span></span> <span data-ttu-id="0a31c-269">閲覧者は、既存の Azure リソースの表示のみを実行できます。ユーザー アカウント管理者は、Azure リソースへのアクセスを管理できます。</span><span class="sxs-lookup"><span data-stu-id="0a31c-269">A Reader can only view existing Azure resources and a User Account Administrator can manage access to Azure resources.</span></span>

<span data-ttu-id="0a31c-270">[DNS ゾーンの共同作成者](/azure/role-based-access-control/built-in-roles#dns-zone-contributor)などのより詳細な組み込みロールは、1 つのサービスに限定された権限を持ちます。</span><span class="sxs-lookup"><span data-stu-id="0a31c-270">More granular built-in roles such as [DNS Zone Contributor](/azure/role-based-access-control/built-in-roles#dns-zone-contributor) have rights limited to a single service.</span></span> <span data-ttu-id="0a31c-271">セキュリティ プリンシパルは、任意の数のロールを担うことができます。</span><span class="sxs-lookup"><span data-stu-id="0a31c-271">Security principals can take on any number of roles.</span></span>

## <a name="scopes"></a><span data-ttu-id="0a31c-272">スコープ</span><span class="sxs-lookup"><span data-stu-id="0a31c-272">Scopes</span></span>

<span data-ttu-id="0a31c-273">ロールは、Azure 内の限定されたリソース セットに適用できます。</span><span class="sxs-lookup"><span data-stu-id="0a31c-273">Roles can be applied to a restricted set of resources within Azure.</span></span> <span data-ttu-id="0a31c-274">たとえば、先ほどの Service Bus キューから読み取る例にスコープを適用すると、"Azure Service Bus エンドポイント `blah.servicebus.windows.net/queue1` からメッセージを読み取る" という 1 つのキューにアクセス許可を絞り込むことができます。</span><span class="sxs-lookup"><span data-stu-id="0a31c-274">For instance, applying scope to the previous example of reading from a Service Bus queue, you can narrow the permission to a single queue: "Read messages from Azure Service Bus endpoint `blah.servicebus.windows.net/queue1`"</span></span>

<span data-ttu-id="0a31c-275">スコープは、1 つのリソースのように狭くすることも、リソース グループ、サブスクリプション、または管理グループ全体に適用することもできます。</span><span class="sxs-lookup"><span data-stu-id="0a31c-275">The scope can be as narrow as a single resource or it can be applied to an entire resource group, subscription, or even management group.</span></span>

<span data-ttu-id="0a31c-276">セキュリティ プリンシパルが特定のアクセス許可を持っているかどうかをテストする場合には、ロールとスコープの組み合わせが考慮されます。</span><span class="sxs-lookup"><span data-stu-id="0a31c-276">When testing if a security principal has certain permission, the combination of role and scope are taken into account.</span></span> <span data-ttu-id="0a31c-277">この組み合わせにより、強力な承認メカニズムが実現します。</span><span class="sxs-lookup"><span data-stu-id="0a31c-277">This combination provides a powerful authorization mechanism.</span></span>

## <a name="deny"></a><span data-ttu-id="0a31c-278">拒否</span><span class="sxs-lookup"><span data-stu-id="0a31c-278">Deny</span></span>

<span data-ttu-id="0a31c-279">以前の RBAC には、"許可" 規則しか認められていませんでした。</span><span class="sxs-lookup"><span data-stu-id="0a31c-279">Previously, only "allow" rules were permitted for RBAC.</span></span> <span data-ttu-id="0a31c-280">この動作により、一部のスコープの構築が複雑になっていました。</span><span class="sxs-lookup"><span data-stu-id="0a31c-280">This behavior made some scopes complicated to build.</span></span> <span data-ttu-id="0a31c-281">たとえば、あるセキュリティ プリンシパルに 1 つを除くすべてのストレージ アカウントへのアクセスを許可するには、無限の可能性があるストレージ アカウントの一覧に明示的なアクセス許可を付与する必要がありました。</span><span class="sxs-lookup"><span data-stu-id="0a31c-281">For instance, allowing a security principal access to all storage accounts except one required granting explicit permission to a potentially endless list of storage accounts.</span></span> <span data-ttu-id="0a31c-282">新しいストレージ アカウントを作成するたびに、このアカウント一覧に追加する必要がありました。</span><span class="sxs-lookup"><span data-stu-id="0a31c-282">Every time a new storage account was created, it would have to be added to this list of accounts.</span></span> <span data-ttu-id="0a31c-283">これにより、望ましくない管理のオーバーヘッドが増えることになりました。</span><span class="sxs-lookup"><span data-stu-id="0a31c-283">This added management overhead that certainly wasn't desirable.</span></span>

<span data-ttu-id="0a31c-284">拒否規則は許可規則よりも優先されます。</span><span class="sxs-lookup"><span data-stu-id="0a31c-284">Deny rules take precedence over allow rules.</span></span> <span data-ttu-id="0a31c-285">これで、同じ "1 つを除いてすべてを許可する" というスコープを、"すべてを許可する" と "この特定の 1 つを拒否する" という 2 つの規則で表現できるようになりました。</span><span class="sxs-lookup"><span data-stu-id="0a31c-285">Now representing the same "allow all but one" scope could be represented as two rules "allow all" and "deny this one specific one".</span></span> <span data-ttu-id="0a31c-286">拒否規則によって、管理が容易になるだけでなく、全員へのアクセスを拒否することで、より安全にリソースを使用できるようになります。</span><span class="sxs-lookup"><span data-stu-id="0a31c-286">Deny rules not only ease management but allow for resources that are extra secure by denying access to everybody.</span></span>

## <a name="checking-access"></a><span data-ttu-id="0a31c-287">アクセスのチェック</span><span class="sxs-lookup"><span data-stu-id="0a31c-287">Checking access</span></span>

<span data-ttu-id="0a31c-288">ご想像のとおり、多数のロールやスコープがあると、サービス プリンシパルの有効なアクセス許可を把握することが非常に困難になります。</span><span class="sxs-lookup"><span data-stu-id="0a31c-288">As you can imagine, having a large number of roles and scopes can make figuring out the effective permission of a service principal quite difficult.</span></span> <span data-ttu-id="0a31c-289">その上に拒否規則を重ねると、複雑さが増すだけです。</span><span class="sxs-lookup"><span data-stu-id="0a31c-289">Piling deny rules on top of that, only serves to increase the complexity.</span></span> <span data-ttu-id="0a31c-290">幸いなことに、任意のサービス プリンシパルの有効なアクセス許可を表示する機能を持つ[アクセス許可計算ツール](/azure/role-based-access-control/check-access)があります。</span><span class="sxs-lookup"><span data-stu-id="0a31c-290">Fortunately, there's a [permissions calculator](/azure/role-based-access-control/check-access) that can show the effective permissions for any service principal.</span></span> <span data-ttu-id="0a31c-291">通常、図 9-3 に示すように、これはポータルの [IAM] タブにあります。</span><span class="sxs-lookup"><span data-stu-id="0a31c-291">It's typically found under the IAM tab in the portal, as shown in Figure 9-3.</span></span>

![図 9-4 アプリ サービスのアクセス許可計算ツール](./media/check-rbac.png)

<span data-ttu-id="0a31c-293">**図 9-4**</span><span class="sxs-lookup"><span data-stu-id="0a31c-293">**Figure 9-4**.</span></span> <span data-ttu-id="0a31c-294">アプリ サービスのアクセス許可計算ツール。</span><span class="sxs-lookup"><span data-stu-id="0a31c-294">Permission calculator for an app service.</span></span>

## <a name="securing-secrets"></a><span data-ttu-id="0a31c-295">シークレットのセキュリティ保護</span><span class="sxs-lookup"><span data-stu-id="0a31c-295">Securing secrets</span></span>

<span data-ttu-id="0a31c-296">パスワードと証明書は、攻撃者にとって一般的な攻撃ベクトルです。</span><span class="sxs-lookup"><span data-stu-id="0a31c-296">Passwords and certificates are a common attack vector for attackers.</span></span> <span data-ttu-id="0a31c-297">パスワードクラッキング ハードウェアによりブルートフォース攻撃が実行され、1 秒間に何十億個ものパスワードの推測が試行される可能性があります。</span><span class="sxs-lookup"><span data-stu-id="0a31c-297">Password-cracking hardware can do a  brute-force attack and try to guess billions of passwords per second.</span></span> <span data-ttu-id="0a31c-298">そのため、リソースへのアクセスに使用されるパスワードは、さまざまな文字を使用した強力なものにすることが重要です。</span><span class="sxs-lookup"><span data-stu-id="0a31c-298">So it's important that the passwords that are used to access resources are strong, with a large variety of characters.</span></span> <span data-ttu-id="0a31c-299">このようなパスワードは、覚えることが不可能に近い種類のパスワードです。</span><span class="sxs-lookup"><span data-stu-id="0a31c-299">These passwords are exactly the kind of passwords that are near impossible to remember.</span></span> <span data-ttu-id="0a31c-300">幸いなことに、Azure 内のパスワードを実際に人間が把握する必要がありません。</span><span class="sxs-lookup"><span data-stu-id="0a31c-300">Fortunately, the passwords in Azure don't actually need to be known by any human.</span></span>

<span data-ttu-id="0a31c-301">パスワード マネージャーを使用して自分のパスワードを管理することが多くのセキュリティ[専門家によって提案](https://www.troyhunt.com/password-managers-dont-have-to-be-perfect-they-just-have-to-be-better-than-not-having-one/)されています。</span><span class="sxs-lookup"><span data-stu-id="0a31c-301">Many security [experts suggest](https://www.troyhunt.com/password-managers-dont-have-to-be-perfect-they-just-have-to-be-better-than-not-having-one/) that using a password manager to keep your own passwords is the best approach.</span></span> <span data-ttu-id="0a31c-302">これにより、パスワードを 1 か所に一元化できるだけでなく、パスワードを非常に複雑なものにすることや、アカウントごとに確実に一意にすることもできます。</span><span class="sxs-lookup"><span data-stu-id="0a31c-302">While it centralizes your passwords in one location, it also allows using highly complex passwords and ensuring they're unique for each account.</span></span> <span data-ttu-id="0a31c-303">同じシステムが Azure 内にもあります。シークレット用のセントラル ストアです。</span><span class="sxs-lookup"><span data-stu-id="0a31c-303">The same system exists within Azure: a central store for secrets.</span></span>

## <a name="azure-key-vault"></a><span data-ttu-id="0a31c-304">Azure Key Vault</span><span class="sxs-lookup"><span data-stu-id="0a31c-304">Azure Key Vault</span></span>

<span data-ttu-id="0a31c-305">Azure Key Vault には、データベース、API キー、証明書などのパスワードを一元的に格納する場所が用意されています。</span><span class="sxs-lookup"><span data-stu-id="0a31c-305">Azure Key Vault provides a centralized location to store passwords for things such as databases, API keys, and certificates.</span></span> <span data-ttu-id="0a31c-306">シークレットがコンテナーに格納された後は二度と表示されず、それを抽出して表示するコマンドは意図的に複雑に作られています。</span><span class="sxs-lookup"><span data-stu-id="0a31c-306">Once a secret is entered into the Vault, it's never shown again and the commands to extract and view it are purposefully complicated.</span></span> <span data-ttu-id="0a31c-307">この金庫内の情報は、ソフトウェアによる暗号化または FIPS 140-2 レベル 2 で検証されたハードウェア セキュリティ モジュールを使用して保護されます。</span><span class="sxs-lookup"><span data-stu-id="0a31c-307">The information in the safe is protected using either software encryption or FIPS 140-2 Level 2 validated Hardware Security Modules.</span></span>

<span data-ttu-id="0a31c-308">キー コンテナーへのアクセス権は、RBAC を介して付与されます。つまり、すべてのユーザーがコンテナー内の情報にアクセスできるわけではありません。</span><span class="sxs-lookup"><span data-stu-id="0a31c-308">Access to the key vault is provided through RBACs, meaning that not just any user can access the information in the vault.</span></span> <span data-ttu-id="0a31c-309">たとえば、ある Web アプリケーションから、Azure Key Vault に格納されているデータベース接続文字列にアクセスしたい場合があるとします。</span><span class="sxs-lookup"><span data-stu-id="0a31c-309">Say a web application wishes to access the database connection string stored in Azure Key Vault.</span></span> <span data-ttu-id="0a31c-310">アクセスするには、アプリケーションにより、サービス プリンシパルを使用して実行する必要があります。</span><span class="sxs-lookup"><span data-stu-id="0a31c-310">To gain access, applications need to run using a service principal.</span></span> <span data-ttu-id="0a31c-311">この想定されるロールの場合、金庫内のシークレットを読み取ることができます。</span><span class="sxs-lookup"><span data-stu-id="0a31c-311">Under this assumed role, they can read the secrets from the safe.</span></span> <span data-ttu-id="0a31c-312">アプリケーションがコンテナーに対して持つアクセス権をさらに制限できるさまざまなセキュリティ設定があるので、シークレットを更新することはできず、読み取ることしかできません。</span><span class="sxs-lookup"><span data-stu-id="0a31c-312">There are a number of different security settings that can further limit the access that an application has to the vault, so that it can't update secrets but only read them.</span></span>

<span data-ttu-id="0a31c-313">キーのコンテナーへのアクセスを監視することで、想定したアプリケーションのみがコンテナーにアクセスしていることを確認できます。</span><span class="sxs-lookup"><span data-stu-id="0a31c-313">Access to the key vault can be monitored to ensure that only the expected applications are accessing the vault.</span></span> <span data-ttu-id="0a31c-314">ログを Azure Monitor に統合することで、予期せぬ状況が発生したときにアラートを設定する機能を利用できるようになります。</span><span class="sxs-lookup"><span data-stu-id="0a31c-314">The logs can be integrated back into Azure Monitor, unlocking the ability to set up alerts when unexpected conditions are encountered.</span></span>

## <a name="kubernetes"></a><span data-ttu-id="0a31c-315">Kubernetes</span><span class="sxs-lookup"><span data-stu-id="0a31c-315">Kubernetes</span></span>

<span data-ttu-id="0a31c-316">Kubernetes 内にも、シークレット情報の小さな断片を保守するための同様のサービスがあります。</span><span class="sxs-lookup"><span data-stu-id="0a31c-316">Within Kubernetes, there's a similar service for maintaining small pieces of secret information.</span></span> <span data-ttu-id="0a31c-317">Kubernetes Secrets は、一般的な `kubectl` 実行可能ファイルを使用して設定できます。</span><span class="sxs-lookup"><span data-stu-id="0a31c-317">Kubernetes Secrets can be set via the typical `kubectl` executable.</span></span>

<span data-ttu-id="0a31c-318">シークレットの作成は、格納する値の base64 バージョンを見つけるのと同じくらい簡単です。</span><span class="sxs-lookup"><span data-stu-id="0a31c-318">Creating a secret is as simple as finding the base64 version of the values to be stored:</span></span>

```console
echo -n 'admin' | base64
YWRtaW4=
echo -n '1f2d1e2e67df' | base64
MWYyZDFlMmU2N2Rm
```

<span data-ttu-id="0a31c-319">次に、たとえばそれを次の例のような `secret.yml` という名前のシークレット ファイルに追加します。</span><span class="sxs-lookup"><span data-stu-id="0a31c-319">Then adding it to a secrets file named `secret.yml` for example that looks similar to the following example:</span></span>

```yml
apiVersion: v1
kind: Secret
metadata:
  name: mysecret
type: Opaque
data:
  username: YWRtaW4=
  password: MWYyZDFlMmU2N2Rm
```

<span data-ttu-id="0a31c-320">最後に、次のコマンドを実行して、このファイルを Kubernetes に読み込むことができます。</span><span class="sxs-lookup"><span data-stu-id="0a31c-320">Finally, this file can be loaded into Kubernetes by running the following command:</span></span>

```console
kubectl apply -f ./secret.yaml
```

<span data-ttu-id="0a31c-321">このようなシークレットは、ボリュームにマウントしたり、環境変数を介してコンテナー プロセスに公開したりすることができます。</span><span class="sxs-lookup"><span data-stu-id="0a31c-321">These secrets can then be mounted into volumes or exposed to container processes through environment variables.</span></span> <span data-ttu-id="0a31c-322">[Twelve-factor app (12 要素アプリ)](https://12factor.net/) というアプリケーション構築のアプローチでは、アプリケーションに設定を伝達する際に、最小公分母を使用することが推奨されています。</span><span class="sxs-lookup"><span data-stu-id="0a31c-322">The [Twelve-factor app](https://12factor.net/) approach to building applications suggests using the lowest common denominator to transmit settings to an application.</span></span> <span data-ttu-id="0a31c-323">環境変数は、OS やアプリケーションに関係なくサポートされているため、最小公分母です。</span><span class="sxs-lookup"><span data-stu-id="0a31c-323">Environment variables are the lowest common denominator, because they're supported no matter the operating system or application.</span></span>

<span data-ttu-id="0a31c-324">Kubernetes の組み込みのシークレットを使用するのではなく、Kubernetes 内から Azure Key Vault のシークレットにアクセスする方法があります。</span><span class="sxs-lookup"><span data-stu-id="0a31c-324">An alternative to use the built-in Kubernetes secrets is to access the secrets in Azure Key Vault from within Kubernetes.</span></span> <span data-ttu-id="0a31c-325">これを行う最も簡単な方法は、シークレットを読み込もうとしているコンテナーに RBAC ロールを割り当てることです。</span><span class="sxs-lookup"><span data-stu-id="0a31c-325">The simplest way to do this is to assign an RBAC role to the container looking to load secrets.</span></span> <span data-ttu-id="0a31c-326">これで、Azure Key Vault API を使用して、アプリケーションからシークレットにアクセスできるようになります。</span><span class="sxs-lookup"><span data-stu-id="0a31c-326">The application can then use the Azure Key Vault APIs to access the secrets.</span></span> <span data-ttu-id="0a31c-327">ただし、このアプローチではコードを修正する必要があり、環境変数を使用するパターンには従っていません。</span><span class="sxs-lookup"><span data-stu-id="0a31c-327">However, this approach requires modifications to the code and doesn't follow the pattern of using environment variables.</span></span> <span data-ttu-id="0a31c-328">代わりに、コンテナーに値を挿入することができます。</span><span class="sxs-lookup"><span data-stu-id="0a31c-328">Instead, it's possible to inject values into a container.</span></span> <span data-ttu-id="0a31c-329">このアプローチは、クラスター上のユーザーからアクセスできるため、実際には Kubernetes のシークレットを直接使用するよりも安全です。</span><span class="sxs-lookup"><span data-stu-id="0a31c-329">This approach is actually more secure than using the Kubernetes secrets directly, as they can be accessed by users on the cluster.</span></span>

## <a name="encryption-in-transit-and-at-rest"></a><span data-ttu-id="0a31c-330">転送中と保存中の暗号化</span><span class="sxs-lookup"><span data-stu-id="0a31c-330">Encryption in transit and at rest</span></span>

<span data-ttu-id="0a31c-331">データを安全に保つことは、それがディスク上にある場合でも、さまざまなサービス間で転送されている場合でも重要です。</span><span class="sxs-lookup"><span data-stu-id="0a31c-331">Keeping data safe is important whether it's on disk or transiting between various different services.</span></span> <span data-ttu-id="0a31c-332">データの漏えいを防ぐ最も効果的な方法は、他のユーザーが簡単に読み取れない形式に暗号化することです。</span><span class="sxs-lookup"><span data-stu-id="0a31c-332">The most effective way to keep data from leaking is to encrypt it into a format that can't be easily read by others.</span></span> <span data-ttu-id="0a31c-333">Azure はさまざまな暗号化オプションをサポートしています。</span><span class="sxs-lookup"><span data-stu-id="0a31c-333">Azure supports a wide range of encryption options.</span></span>

### <a name="in-transit"></a><span data-ttu-id="0a31c-334">転送中のデータ</span><span class="sxs-lookup"><span data-stu-id="0a31c-334">In transit</span></span>

<span data-ttu-id="0a31c-335">Azure でネットワーク上のトラフィックを暗号化する方法はいくつかあります。</span><span class="sxs-lookup"><span data-stu-id="0a31c-335">There are several ways to encrypt traffic on the network in Azure.</span></span> <span data-ttu-id="0a31c-336">Azure サービスへのアクセスは、通常、トランスポート層セキュリティ (TLS) を使用する接続を介して行われます。</span><span class="sxs-lookup"><span data-stu-id="0a31c-336">The access to Azure services is typically done over connections that use Transport Layer Security (TLS).</span></span> <span data-ttu-id="0a31c-337">たとえば、Azure API へのすべての接続には、TLS 接続が必要です。</span><span class="sxs-lookup"><span data-stu-id="0a31c-337">For instance, all the connections to the Azure APIs require TLS connections.</span></span> <span data-ttu-id="0a31c-338">同様に、Azure Storage 内のエンドポイントへの接続は、TLS で暗号化された接続でのみ機能するように制限することができます。</span><span class="sxs-lookup"><span data-stu-id="0a31c-338">Equally, connections to endpoints in Azure storage can be restricted to work only over TLS encrypted connections.</span></span>

<span data-ttu-id="0a31c-339">TLS は複雑なプロトコルであり、接続に TLS が使われていることを知っているだけでは、十分にセキュリティを確保できません。</span><span class="sxs-lookup"><span data-stu-id="0a31c-339">TLS is a complicated protocol and simply knowing that the connection is using TLS isn't sufficient to ensure security.</span></span> <span data-ttu-id="0a31c-340">たとえば、TLS 1.0 は長いこと安全ではなく、TLS 1.1 もそれほど優れていません。</span><span class="sxs-lookup"><span data-stu-id="0a31c-340">For instance, TLS 1.0 is chronically insecure, and TLS 1.1 isn't much better.</span></span> <span data-ttu-id="0a31c-341">TLS のバージョンの中でも、接続の復号化を容易にするさまざまな設定があります。</span><span class="sxs-lookup"><span data-stu-id="0a31c-341">Even within the versions of TLS, there are various settings that can make the connections easier to decrypt.</span></span> <span data-ttu-id="0a31c-342">最善の措置は、サーバーの接続に、最新の適切に構成されたプロトコルが使用されているかどうか確認することです。</span><span class="sxs-lookup"><span data-stu-id="0a31c-342">The best course of action is to check and see if the server connection is using up-to-date and well configured protocols.</span></span>

<span data-ttu-id="0a31c-343">この確認は、SSL ラボの SSL Server Test のような外部サービスで行うことができます。</span><span class="sxs-lookup"><span data-stu-id="0a31c-343">This check can be done by an external service such as SSL labs' SSL Server Test.</span></span> <span data-ttu-id="0a31c-344">一般的な Azure のエンドポイント (この場合はサービス バス エンドポイント) に対してテストを実行すると、ほぼ満点の A という結果が得られます。</span><span class="sxs-lookup"><span data-stu-id="0a31c-344">A test run against a typical Azure endpoint, in this case a service bus endpoint, yields a near perfect score of A.</span></span>

<span data-ttu-id="0a31c-345">Azure SQL データベースのようなサービスでも、データを隠すために TLS 暗号化が使用されています。</span><span class="sxs-lookup"><span data-stu-id="0a31c-345">Even services like Azure SQL databases use TLS encryption to keep data hidden.</span></span> <span data-ttu-id="0a31c-346">TLS を使用して転送中のデータを暗号化することの興味深い点は、Microsoft であっても、TLS を実行しているコンピューター間の接続をリッスンできないことです。</span><span class="sxs-lookup"><span data-stu-id="0a31c-346">The interesting part about encrypting the data in transit using TLS is that it isn't possible, even for Microsoft, to listen in on the connection between computers running TLS.</span></span> <span data-ttu-id="0a31c-347">そのため、Microsoft 社員や、通常の攻撃者よりも多くのリソースを持つ国家機関のアクターによるリスクに、自社のデータがさらされているのではないかと懸念する企業も安心できます。</span><span class="sxs-lookup"><span data-stu-id="0a31c-347">This should provide comfort for companies concerned that their data may be at risk from Microsoft proper or even a state actor with more resources than the standard attacker.</span></span>

![図 9-5 Service Bus エンドポイントのスコアを示す SSL ラボのレポート](./media/ssl-report.png)

<span data-ttu-id="0a31c-349">**図 9-5**</span><span class="sxs-lookup"><span data-stu-id="0a31c-349">**Figure 9-5**.</span></span> <span data-ttu-id="0a31c-350">Service Bus エンドポイントのスコアを示す SSL ラボのレポート。</span><span class="sxs-lookup"><span data-stu-id="0a31c-350">SSL labs report showing a score of A for a Service Bus endpoint.</span></span>

<span data-ttu-id="0a31c-351">このレベルの暗号化は今後も常に十分であるとは言えませんが、Azure の TLS 接続は非常に安全であると確信できるはずです。</span><span class="sxs-lookup"><span data-stu-id="0a31c-351">While this level of encryption isn't going to be sufficient for all time, it should inspire confidence that Azure TLS connections are quite secure.</span></span> <span data-ttu-id="0a31c-352">暗号化の向上に合わせて、Azure のセキュリティ標準を進化させ続ける予定です。</span><span class="sxs-lookup"><span data-stu-id="0a31c-352">Azure will continue to evolve its security standards as encryption improves.</span></span> <span data-ttu-id="0a31c-353">セキュリティ標準を監視し、その向上に合わせて誰かが Azure を更新するとわかっていることは便利です。</span><span class="sxs-lookup"><span data-stu-id="0a31c-353">It's nice to know that there's somebody watching the security standards and updating Azure as they improve.</span></span>

### <a name="at-rest"></a><span data-ttu-id="0a31c-354">保存中</span><span class="sxs-lookup"><span data-stu-id="0a31c-354">At rest</span></span>

<span data-ttu-id="0a31c-355">どのようなアプリケーションでも、データがディスク上に置かれる場所はいくつかあります。</span><span class="sxs-lookup"><span data-stu-id="0a31c-355">In any application, there are a number of places where data rests on the disk.</span></span> <span data-ttu-id="0a31c-356">アプリケーション コード自体は、何らかのストレージ メカニズムから読み込まれます。</span><span class="sxs-lookup"><span data-stu-id="0a31c-356">The application code itself is loaded from some storage mechanism.</span></span> <span data-ttu-id="0a31c-357">また、ほとんどのアプリケーションには、SQL Server、Cosmos DB、さらには驚くほど低価格の Table Storage など、何らかのデータベースが使用されています。</span><span class="sxs-lookup"><span data-stu-id="0a31c-357">Most applications also use some kind of a database such as SQL Server, Cosmos DB, or even the amazingly price-efficient Table Storage.</span></span> <span data-ttu-id="0a31c-358">このようなデータベースには、高度に暗号化されたストレージが使用され、適切なアクセス許可を持つアプリケーション以外はデータを読み取れないようになっています。</span><span class="sxs-lookup"><span data-stu-id="0a31c-358">These databases all use heavily encrypted storage to ensure that nobody other than the applications with proper permissions can read your data.</span></span> <span data-ttu-id="0a31c-359">暗号化されたデータは、システム運用者でさえも読み取ることができません。</span><span class="sxs-lookup"><span data-stu-id="0a31c-359">Even the system operators can't read data that has been encrypted.</span></span> <span data-ttu-id="0a31c-360">そのため、お客様は、シークレット情報の秘密が守られることに安心できます。</span><span class="sxs-lookup"><span data-stu-id="0a31c-360">So customers can remain confident their secret information remains secret.</span></span>

### <a name="storage"></a><span data-ttu-id="0a31c-361">ストレージ</span><span class="sxs-lookup"><span data-stu-id="0a31c-361">Storage</span></span>

<span data-ttu-id="0a31c-362">Azure の多くの部分を支えているのは、Azure Storage エンジンです。</span><span class="sxs-lookup"><span data-stu-id="0a31c-362">The underpinning of much of Azure is the Azure Storage engine.</span></span> <span data-ttu-id="0a31c-363">仮想マシン ディスクは、Azure Storage 上にマウントされます。</span><span class="sxs-lookup"><span data-stu-id="0a31c-363">Virtual machine disks are mounted on top of Azure Storage.</span></span> <span data-ttu-id="0a31c-364">Azure Kubernetes Service は、それ自体が Azure Storage 上でホストされている仮想マシン上で実行されます。</span><span class="sxs-lookup"><span data-stu-id="0a31c-364">Azure Kubernetes Service runs on virtual machines that, themselves, are hosted on Azure Storage.</span></span> <span data-ttu-id="0a31c-365">Azure Functions アプリや Azure Container Instances などのサーバーレス テクノロジであっても、Azure Storage の一部であるディスクから実行されます。</span><span class="sxs-lookup"><span data-stu-id="0a31c-365">Even serverless technologies, such as Azure Functions Apps and Azure Container Instances, run out of disk that is part of Azure Storage.</span></span>

<span data-ttu-id="0a31c-366">Azure Storage が適切に暗号化されていれば、他のほとんどすべてを暗号化するための基盤となります。</span><span class="sxs-lookup"><span data-stu-id="0a31c-366">If Azure Storage is well encrypted, then it provides for a foundation for most everything else to also be encrypted.</span></span> <span data-ttu-id="0a31c-367">Azure Storage は、[FIPS 140-2](https://en.wikipedia.org/wiki/FIPS_140) に準拠した [256 ビット AES](https://en.wikipedia.org/wiki/Advanced_Encryption_Standard) で[暗号化](/azure/storage/common/storage-service-encryption)されています。</span><span class="sxs-lookup"><span data-stu-id="0a31c-367">Azure Storage [is encrypted](/azure/storage/common/storage-service-encryption) with [FIPS 140-2](https://en.wikipedia.org/wiki/FIPS_140) compliant [256-bit AES](https://en.wikipedia.org/wiki/Advanced_Encryption_Standard).</span></span> <span data-ttu-id="0a31c-368">これは、過去 20 年ほどにわたって学術的な審査の対象となってきた、評価の高い暗号化テクノロジです。</span><span class="sxs-lookup"><span data-stu-id="0a31c-368">This is a well-regarded encryption technology having been the subject of extensive academic scrutiny over the last 20 or so years.</span></span> <span data-ttu-id="0a31c-369">現在のところ、キーを知らない誰かが AES で暗号化されたデータを読み取ることを可能にする既知の実用的な攻撃方法はありません。</span><span class="sxs-lookup"><span data-stu-id="0a31c-369">At present, there's no known practical attack that would allow someone without knowledge of the key to read data encrypted by AES.</span></span>

<span data-ttu-id="0a31c-370">既定では、Azure Storage の暗号化に使用されるキーは、Microsoft が管理しています。</span><span class="sxs-lookup"><span data-stu-id="0a31c-370">By default, the keys used for encrypting Azure Storage are managed by Microsoft.</span></span> <span data-ttu-id="0a31c-371">このようなキーへの悪意のあるアクセスを確実に防ぐために、広範な保護が実施されています。</span><span class="sxs-lookup"><span data-stu-id="0a31c-371">There are extensive protections in place to ensure to prevent malicious access to these keys.</span></span> <span data-ttu-id="0a31c-372">ただし、特定の暗号化要件を持つユーザーは、Azure Key Vault で管理される[独自のストレージ キーを用意する](/azure/storage/common/storage-encryption-keys-powershell)こともできます。</span><span class="sxs-lookup"><span data-stu-id="0a31c-372">However, users with particular encryption requirements can also [provide their own storage keys](/azure/storage/common/storage-encryption-keys-powershell) that are managed in Azure Key Vault.</span></span> <span data-ttu-id="0a31c-373">このようなキーはいつでも取り消し、それらを使用しているストレージ アカウントのコンテンツを実質的に表示できなくすることができます。</span><span class="sxs-lookup"><span data-stu-id="0a31c-373">These keys can be revoked at any time, which would effectively render the contents of the Storage account using them inaccessible.</span></span>

<span data-ttu-id="0a31c-374">仮想マシンには暗号化されたストレージが使用されますが、Windows 上の BitLocker や Linux 上の DM-Crypt などのテクノロジを使用することで、暗号化のレイヤーをさらに追加することができます。</span><span class="sxs-lookup"><span data-stu-id="0a31c-374">Virtual machines use encrypted storage, but it's possible to provide another layer of encryption by using technologies like BitLocker on Windows or DM-Crypt on Linux.</span></span> <span data-ttu-id="0a31c-375">このようなテクノロジは、たとえディスク イメージがストレージからリークされたとしても、それを読み取ることはほぼ不可能であることを意味します。</span><span class="sxs-lookup"><span data-stu-id="0a31c-375">These technologies mean that even if the disk image was leaked off of storage, it would remain near impossible to read it.</span></span>

### <a name="azure-sql"></a><span data-ttu-id="0a31c-376">Azure SQL</span><span class="sxs-lookup"><span data-stu-id="0a31c-376">Azure SQL</span></span>

<span data-ttu-id="0a31c-377">Azure SQL 上のデータベースでは、[Transparent Data Encryption (TDE)](/sql/relational-databases/security/encryption/transparent-data-encryption) と呼ばれるテクノロジを使用して、データが確実に暗号化されています。</span><span class="sxs-lookup"><span data-stu-id="0a31c-377">Databases hosted on Azure SQL use a technology called [Transparent Data Encryption (TDE)](/sql/relational-databases/security/encryption/transparent-data-encryption) to ensure data remains encrypted.</span></span> <span data-ttu-id="0a31c-378">これは新しく作成されたすべての SQL データベースでは既定で有効になっていますが、レガシ データベースについては手動で有効にする必要があります。</span><span class="sxs-lookup"><span data-stu-id="0a31c-378">It's enabled by default on all newly created SQL databases, but must be enabled manually for legacy databases.</span></span> <span data-ttu-id="0a31c-379">TDE を使用すると、データベースだけでなく、バックアップやトランザクション ログも含めて、リアルタイムの暗号化および復号化を実行できます。</span><span class="sxs-lookup"><span data-stu-id="0a31c-379">TDE executes real-time encryption and decryption of not just the database, but also the backups and transaction logs.</span></span>

<span data-ttu-id="0a31c-380">暗号化パラメーターは `master` データベースに格納され、残りの操作のために、スタートアップ時にメモリに読み込まれてます。</span><span class="sxs-lookup"><span data-stu-id="0a31c-380">The encryption parameters are stored in the `master` database and, on startup, are read into memory for the remaining operations.</span></span> <span data-ttu-id="0a31c-381">つまり、`master` データベースは暗号化されていない状態にしておく必要があります。</span><span class="sxs-lookup"><span data-stu-id="0a31c-381">This means that the `master` database must remain unencrypted.</span></span> <span data-ttu-id="0a31c-382">実際のキーは Microsoft が管理しています。</span><span class="sxs-lookup"><span data-stu-id="0a31c-382">The actual key is managed by Microsoft.</span></span> <span data-ttu-id="0a31c-383">ただし、厳格なセキュリティ要件を持つユーザーは、Azure Storage の場合と同様に、Key Vault に独自のキーを用意することができます。</span><span class="sxs-lookup"><span data-stu-id="0a31c-383">However, users with exacting security requirements may provide their own key in Key Vault in much the same way as is done for Azure Storage.</span></span> <span data-ttu-id="0a31c-384">このキー コンテナーには、キーのローテーションや失効などのサービスがあります。</span><span class="sxs-lookup"><span data-stu-id="0a31c-384">The Key Vault provides for such services as key rotation and revocation.</span></span>

<span data-ttu-id="0a31c-385">TDS の "透過的" という部分は、暗号化されたデータベースを使用するためにクライアントを変更する必要がないという事実に由来しています。</span><span class="sxs-lookup"><span data-stu-id="0a31c-385">The "Transparent" part of TDS comes from the fact that there aren't client changes needed to use an encrypted database.</span></span> <span data-ttu-id="0a31c-386">このアプローチによって優れたセキュリティを実現できますが、データベースのパスワードが漏えいするだけで、ユーザーはデータを復号化できます。</span><span class="sxs-lookup"><span data-stu-id="0a31c-386">While this approach provides for good security, leaking the database password is enough for users to be able to decrypt the data.</span></span> <span data-ttu-id="0a31c-387">データベース内の個々の列やテーブルを暗号化するアプローチもあります。</span><span class="sxs-lookup"><span data-stu-id="0a31c-387">There's another approach that encrypts individual columns or tables in a database.</span></span> <span data-ttu-id="0a31c-388">[Always Encrypted](/azure/sql-database/sql-database-always-encrypted-azure-key-vault) を使用すると、データベース内の暗号化されたデータが平文で表示されることがないようにすることができます。</span><span class="sxs-lookup"><span data-stu-id="0a31c-388">[Always Encrypted](/azure/sql-database/sql-database-always-encrypted-azure-key-vault) ensures that at no point the encrypted data appears in plain text inside the database.</span></span>

<span data-ttu-id="0a31c-389">この暗号化レベルを設定するには、SQL Server Management Studio のウィザードを実行して、暗号化の種類と Key Vault のどこに関連するキーを格納するかを選択する必要があります。</span><span class="sxs-lookup"><span data-stu-id="0a31c-389">Setting up this tier of encryption requires running through a wizard in SQL Server Management Studio to select the sort of encryption and where in Key Vault to store the associated keys.</span></span>

![図 9-6 Always Encrypted を使用して暗号化するテーブル内の列の選択](./media/always-encrypted.png)

<span data-ttu-id="0a31c-391">**図 9-6**.</span><span class="sxs-lookup"><span data-stu-id="0a31c-391">**Figure 9-6**.</span></span> <span data-ttu-id="0a31c-392">Always Encrypted を使用して暗号化するテーブル内の列の選択。</span><span class="sxs-lookup"><span data-stu-id="0a31c-392">Selecting columns in a table to be encrypted using Always Encrypted.</span></span>

<span data-ttu-id="0a31c-393">このような暗号化された列から情報を読み取るクライアント アプリケーションの場合、暗号化されたデータを読み取るために特別な配慮をする必要があります。</span><span class="sxs-lookup"><span data-stu-id="0a31c-393">Client applications that read information from these encrypted columns need to make special allowances to read encrypted data.</span></span> <span data-ttu-id="0a31c-394">接続文字列を `Column Encryption Setting=Enabled` を使用して更新し、クライアントの資格情報をキー コンテナーから取得する必要があります。</span><span class="sxs-lookup"><span data-stu-id="0a31c-394">Connection strings need to be updated with `Column Encryption Setting=Enabled` and client credentials must be retrieved from the Key Vault.</span></span> <span data-ttu-id="0a31c-395">次に、SQL Server クライアントを列暗号化キーで準備する必要があります。</span><span class="sxs-lookup"><span data-stu-id="0a31c-395">The SQL Server client must then be primed with the column encryption keys.</span></span> <span data-ttu-id="0a31c-396">それが完了したら、残りのアクションには SQL クライアントへの標準的なインターフェイスを使用します。</span><span class="sxs-lookup"><span data-stu-id="0a31c-396">Once that is done, the remaining actions use the standard interfaces to SQL Client.</span></span> <span data-ttu-id="0a31c-397">つまり、Dapper や Entity Framework など、SQL クライアント上に構築されているツールを、変更せずにそのまま使用できます。</span><span class="sxs-lookup"><span data-stu-id="0a31c-397">That is, tools like Dapper and Entity Framework, which are built on top of SQL Client, will continue to work without changes.</span></span> <span data-ttu-id="0a31c-398">Always Encrypted は、まだすべての言語のすべての SQL Server ドライバーで使用できるわけではありません。</span><span class="sxs-lookup"><span data-stu-id="0a31c-398">Always Encrypted may not yet be available for every SQL Server driver on every language.</span></span>

<span data-ttu-id="0a31c-399">TDE と Always Encrypted の組み合わせは、どちらもクライアント固有のキーと共に使用できるため、最も厳格な暗号化要件でもサポートできます。</span><span class="sxs-lookup"><span data-stu-id="0a31c-399">The combination of TDE and Always Encrypted, both of which can be used with client-specific keys, ensures that even the most exacting encryption requirements are supported.</span></span>

### <a name="cosmos-db"></a><span data-ttu-id="0a31c-400">Cosmos DB</span><span class="sxs-lookup"><span data-stu-id="0a31c-400">Cosmos DB</span></span>

<span data-ttu-id="0a31c-401">Cosmos DB は、Microsoft が Azure で提供する最新のデータベースです。</span><span class="sxs-lookup"><span data-stu-id="0a31c-401">Cosmos DB is the newest database provided by Microsoft in Azure.</span></span> <span data-ttu-id="0a31c-402">これは、セキュリティと暗号化を念頭に置いてゼロから構築されています。</span><span class="sxs-lookup"><span data-stu-id="0a31c-402">It has been built from the ground up with security and cryptography in mind.</span></span> <span data-ttu-id="0a31c-403">AES-256bit 暗号化は、すべての Cosmos DB データベースの標準であり、無効にすることはできません。</span><span class="sxs-lookup"><span data-stu-id="0a31c-403">AES-256bit encryption is standard for all Cosmos DB databases and can't be disabled.</span></span> <span data-ttu-id="0a31c-404">通信の TLS 1.2 要件と組み合わされることで、ストレージ ソリューション全体が暗号化されます。</span><span class="sxs-lookup"><span data-stu-id="0a31c-404">Coupled with the TLS 1.2 requirement for communication, the entire storage solution is encrypted.</span></span>

![図 9-7 Cosmos DB 内のデータ暗号化のフロー](./media/cosmos-encryption.png)

<span data-ttu-id="0a31c-406">**図 9-7**.</span><span class="sxs-lookup"><span data-stu-id="0a31c-406">**Figure 9-7**.</span></span> <span data-ttu-id="0a31c-407">Cosmos DB 内のデータ暗号化のフロー。</span><span class="sxs-lookup"><span data-stu-id="0a31c-407">The flow of data encryption within Cosmos DB.</span></span>

<span data-ttu-id="0a31c-408">Cosmos DB には、カスタマー暗号化キーを提供する機能がありませんが、それがなくても PCI-DSS に確実に準拠するように、チームは重要な作業に取り組んでいます。</span><span class="sxs-lookup"><span data-stu-id="0a31c-408">While Cosmos DB doesn't provide for supplying customer encryption keys, there has been significant work done by the team to ensure it remains PCI-DSS compliant without that.</span></span> <span data-ttu-id="0a31c-409">また、Cosmos DB は、Azure SQL の Always Encrypted のような単一列の暗号化をサポートしていません。</span><span class="sxs-lookup"><span data-stu-id="0a31c-409">Cosmos DB also doesn't support any sort of single column encryption similar to Azure SQL's Always Encrypted yet.</span></span>

## <a name="keeping-secure"></a><span data-ttu-id="0a31c-410">セキュリティの維持</span><span class="sxs-lookup"><span data-stu-id="0a31c-410">Keeping secure</span></span>

<span data-ttu-id="0a31c-411">Azure には、高度なセキュリティで保護された製品をリリースするために必要なツールがすべてそろっています。</span><span class="sxs-lookup"><span data-stu-id="0a31c-411">Azure has all the tools necessary to release a highly secure product.</span></span> <span data-ttu-id="0a31c-412">ただし、チェーンの強度は、その中で最も弱いリンクと同程度にしかなりません。</span><span class="sxs-lookup"><span data-stu-id="0a31c-412">However, a chain is only as strong as its weakest link.</span></span> <span data-ttu-id="0a31c-413">Azure 上にデプロイされたアプリケーションが、適切なセキュリティの考え方と適切なセキュリティ監査を使用して開発されていなければ、それはチェーンの中の弱いリンクになります。</span><span class="sxs-lookup"><span data-stu-id="0a31c-413">If the applications deployed on top of Azure aren't developed with a proper security mindset and good security audits, then they become the weak link in the chain.</span></span> <span data-ttu-id="0a31c-414">Azure 上にインストールされたソフトウェアを、確実に Azure 自体と同じくらい安全にするには、多くの優れた静的解析ツール、暗号化ライブラリ、およびセキュリティ手法を使用できます。</span><span class="sxs-lookup"><span data-stu-id="0a31c-414">There are many great static analysis tools, encryption libraries, and security practices that can be used to ensure that the software installed on Azure is as secure as Azure itself.</span></span> <span data-ttu-id="0a31c-415">例については、[静的解析ツール](https://www.whitesourcesoftware.com/)、[暗号化ライブラリ](https://www.libressl.org/)、[セキュリティ手法](https://azure.microsoft.com/resources/videos/red-vs-blue-internal-security-penetration-testing-of-microsoft-azure/)のページを参照してください。</span><span class="sxs-lookup"><span data-stu-id="0a31c-415">Examples include [static analysis tools](https://www.whitesourcesoftware.com/), [encryption libraries](https://www.libressl.org/), and [security practices](https://azure.microsoft.com/resources/videos/red-vs-blue-internal-security-penetration-testing-of-microsoft-azure/).</span></span>

>[!div class="step-by-step"]
><span data-ttu-id="0a31c-416">[前へ](security.md)
>[次へ](devops.md)</span><span class="sxs-lookup"><span data-stu-id="0a31c-416">[Previous](security.md)
[Next](devops.md)</span></span>
