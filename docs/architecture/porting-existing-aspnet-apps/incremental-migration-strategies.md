---
title: 段階的に移行するための戦略
description: チームがどのような戦略を採用していても、ASP.NET MVC から .NET Core に大規模なアプリを段階的に移行することができますか。
author: ardalis
ms.date: 11/13/2020
ms.openlocfilehash: dc500fa71188c472f78ef4df95d79434208552c3
ms.sourcegitcommit: bdbf6472de867a0a11aaa5b9384a2506c24f27d2
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/05/2021
ms.locfileid: "102401462"
---
# <a name="strategies-for-migrating-incrementally"></a><span data-ttu-id="8c622-103">段階的に移行するための戦略</span><span class="sxs-lookup"><span data-stu-id="8c622-103">Strategies for migrating incrementally</span></span>

<span data-ttu-id="8c622-104">大規模なアプリの移行における最大の課題は、プロセスを小さなタスクに分割する方法を決定することです。</span><span class="sxs-lookup"><span data-stu-id="8c622-104">The biggest challenge with migrating any large app is determining how to break the process into smaller tasks.</span></span> <span data-ttu-id="8c622-105">この目的に適用できるいくつかの方法があります。たとえば、UI、データアクセス、ビジネスロジックなどの水平方向の層にアプリを分割したり、アプリを別の小さなアプリに分割したりすることができます。</span><span class="sxs-lookup"><span data-stu-id="8c622-105">There are several strategies that can be applied for this purpose, including breaking the app into horizontal layers such as UI, data access, business logic, or breaking up the app into separate, smaller apps.</span></span> <span data-ttu-id="8c622-106">もう1つの方法は、最新の .NET Core リリースに対して、アプリの一部またはすべてを別のフレームワークバージョンにアップグレードすることです。</span><span class="sxs-lookup"><span data-stu-id="8c622-106">Another strategy is to upgrade some or all of the app to different framework versions on the way to a recent .NET Core release.</span></span> <span data-ttu-id="8c622-107">使用できる1つの方法は、一度に1つの水平方向のレイヤーを移行するのではなく、アプリの [垂直スライス](https://deviq.com/practices/vertical-slices) を移行することです。</span><span class="sxs-lookup"><span data-stu-id="8c622-107">One approach you could use, is to migrate [vertical slices](https://deviq.com/practices/vertical-slices) of the app, rather than attempting to migrate one horizontal layer at a time.</span></span> <span data-ttu-id="8c622-108">これらのさまざまなアプローチについて考えてみましょう。</span><span class="sxs-lookup"><span data-stu-id="8c622-108">Let's consider each of these different approaches.</span></span>

<span data-ttu-id="8c622-109">Large ASP.NET 4.5 アプリの移行の課題を考慮してください。</span><span class="sxs-lookup"><span data-stu-id="8c622-109">Consider the challenge of migrating a large ASP.NET 4.5 app.</span></span> <span data-ttu-id="8c622-110">1つの方法は、アプリ全体を .NET Framework 4.5 から .NET Core 3.1 に直接移行することです。</span><span class="sxs-lookup"><span data-stu-id="8c622-110">One approach is to migrate the entire app directly from .NET Framework 4.5 to .NET Core 3.1.</span></span> <span data-ttu-id="8c622-111">ただし、この方法では、2つのフレームワークとバージョン間のすべての重大な変更を考慮する必要があります。</span><span class="sxs-lookup"><span data-stu-id="8c622-111">However, this approach needs to account for every breaking change between the two frameworks and versions, which are substantial.</span></span>

## <a name="migrating-layer-by-layer"></a><span data-ttu-id="8c622-112">レイヤーによるレイヤーの移行</span><span class="sxs-lookup"><span data-stu-id="8c622-112">Migrating layer by layer</span></span>

<span data-ttu-id="8c622-113">.NET エコシステムに加えて、さまざまな .NET framework 間の相互運用性を向上させるために、 [.NET Standard](https://dotnet.microsoft.com/platform/dotnet-standard)ます。</span><span class="sxs-lookup"><span data-stu-id="8c622-113">One recent addition to the .NET ecosystem that helps with interoperability between different .NET frameworks is [.NET Standard](https://dotnet.microsoft.com/platform/dotnet-standard).</span></span> <span data-ttu-id="8c622-114">.NET Standard では、承認された一連の共通 Api に対してライブラリを構築できるため、どの .NET アプリでも使用できます。</span><span class="sxs-lookup"><span data-stu-id="8c622-114">.NET Standard allows libraries to build against the agreed upon set of common APIs, ensuring they can be used in any .NET app.</span></span> <span data-ttu-id="8c622-115">.NET Standard 2.0 は、ほとんどの .NET Framework および .NET Core アプリで使用されるほとんどの基本クラスライブラリ機能に対応しているため、注目してください。</span><span class="sxs-lookup"><span data-stu-id="8c622-115">.NET Standard 2.0 is notable because it covers most base class library functionality used by most .NET Framework and .NET Core apps.</span></span> <span data-ttu-id="8c622-116">残念ながら、.NET Standard 2.0 がサポートされている .NET の最も古いバージョンは .NET Framework 4.6.1 であり、.NET Framework 4.8 には、初期アップグレードのための魅力的な選択肢となっている多くの更新プログラムがあります。</span><span class="sxs-lookup"><span data-stu-id="8c622-116">Unfortunately, the earliest version of .NET with support for .NET Standard 2.0 is .NET Framework 4.6.1, and there are a number of updates in .NET Framework 4.8 that make it a compelling choice for initial upgrades.</span></span>

<span data-ttu-id="8c622-117">.NET Framework 4.5 システムレイヤーを段階的にアップグレードする方法の1つは、最初にクラスライブラリの依存関係を .NET Framework 4.8 に更新することです。</span><span class="sxs-lookup"><span data-stu-id="8c622-117">One approach to incrementally upgrade a .NET Framework 4.5 system layer-by-layer is to first update its class library dependencies to .NET Framework 4.8.</span></span> <span data-ttu-id="8c622-118">次に、これらのライブラリを .NET Standard クラスライブラリに変更します。</span><span class="sxs-lookup"><span data-stu-id="8c622-118">Then, modify these libraries to be .NET Standard class libraries.</span></span> <span data-ttu-id="8c622-119">必要に応じて、マルチターゲットと条件付きコンパイルを使用します。</span><span class="sxs-lookup"><span data-stu-id="8c622-119">Use multi-targeting and conditional compilation, if necessary.</span></span> <span data-ttu-id="8c622-120">この手順は、アプリの依存関係が .NET Framework を必要とし、.NET Standard や .NET Core を使用するために直接移植できないシナリオで役に立ちます。</span><span class="sxs-lookup"><span data-stu-id="8c622-120">This step can be helpful in scenarios where app dependencies require .NET Framework and cannot easily be ported directly to use .NET Standard and .NET Core.</span></span> <span data-ttu-id="8c622-121">.NET Framework ライブラリは ASP.NET Core 2.1 アプリで使用できるため、次の手順は、アプリの一部またはすべての web 機能を ASP.NET Core 2.1 に移行することです ( [前の章](choose-net-core-version.md)を参照)。</span><span class="sxs-lookup"><span data-stu-id="8c622-121">Since .NET Framework libraries can be consumed by ASP.NET Core 2.1 apps, the next step is to migrate some or all of the web functionality of the app to ASP.NET Core 2.1 (as described in the [previous chapter](choose-net-core-version.md)).</span></span> <span data-ttu-id="8c622-122">これは、下位レベルのクラスライブラリの依存関係と web アプリのエントリポイントまでの作業を開始する "ボトムアップ" アプローチです。</span><span class="sxs-lookup"><span data-stu-id="8c622-122">This is a "bottom up" approach, starting with low level class library dependencies and working up to the web app entry point.</span></span>

<span data-ttu-id="8c622-123">アプリが ASP.NET Core 2.1 で実行されている場合、分離された ASP.NET Core 3.1 に移行するのは比較的簡単です。</span><span class="sxs-lookup"><span data-stu-id="8c622-123">Once the app is running on ASP.NET Core 2.1, migrating it to ASP.NET Core 3.1 in isolation is relatively straightforward.</span></span> <span data-ttu-id="8c622-124">この手順で最も可能性の高い課題は、互換性のない依存関係を更新して、.NET Core をサポートし、場合によっては最新バージョンの .NET Standard をサポートすることです。</span><span class="sxs-lookup"><span data-stu-id="8c622-124">The most likely challenge during this step is updating incompatible dependencies to support .NET Core and possibly higher versions of .NET Standard.</span></span> <span data-ttu-id="8c622-125">.NET Framework のみのライブラリに問題のある依存関係がないアプリの場合、ASP.NET Core 2.1 にアップグレードする理由はほとんどありません。</span><span class="sxs-lookup"><span data-stu-id="8c622-125">For apps that don't have problematic dependencies on .NET Framework-only libraries, there's little reason to upgrade to ASP.NET Core 2.1.</span></span> <span data-ttu-id="8c622-126">ASP.NET Core 3.1 に直接移植すると、よりわかりやすくなり、手間がかかります。</span><span class="sxs-lookup"><span data-stu-id="8c622-126">Porting directly to ASP.NET Core 3.1 makes more sense and requires less effort.</span></span>

<span data-ttu-id="8c622-127">アプリが .NET Core 3.1 で実行されている間、現在の .NET 5 リリースへの移行は比較的簡単です。</span><span class="sxs-lookup"><span data-stu-id="8c622-127">By the time the app is running on .NET Core 3.1, migrating to the current .NET 5 release is relatively painless.</span></span> <span data-ttu-id="8c622-128">このプロセスでは、主にプロジェクトファイルのターゲットフレームワークとそれに関連付けられている NuGet パッケージの依存関係を更新する必要があります。</span><span class="sxs-lookup"><span data-stu-id="8c622-128">The process primarily involves updating the target framework of your project files and their associated NuGet package dependencies.</span></span> <span data-ttu-id="8c622-129">[考慮すべき](../../core/compatibility/5.0.md)重大な変更がいくつかありますが、ほとんどのアプリでは .net Core 3.1 から .net 5 に移行するために大幅な変更は必要ありません。</span><span class="sxs-lookup"><span data-stu-id="8c622-129">While there are several [breaking changes to consider](../../core/compatibility/5.0.md), most apps don't require significant modifications to move from .NET Core 3.1 to .NET 5.</span></span> <span data-ttu-id="8c622-130">[.Net Core 3.1 と .net 5 を選択する際の主な決定要因は、サポートされている可能性が](choose-net-core-version.md)あります。</span><span class="sxs-lookup"><span data-stu-id="8c622-130">The primary deciding factor in [choosing between .NET Core 3.1 and .NET 5 is likely to be support](choose-net-core-version.md).</span></span>

<span data-ttu-id="8c622-131">別の方法としては、"ボトムアップ" アプローチの代わりに、web アプリ (またはソリューション全体) から開始し、自動ツールを使用してアップグレードを支援することもできます。</span><span class="sxs-lookup"><span data-stu-id="8c622-131">Instead of a "bottom up" approach, another alternative is to start with the web app (or even the entire solution) and use an automated tool to assist with the upgrade.</span></span> <span data-ttu-id="8c622-132">[.Net Upgrade Assistant ツール](https://aka.ms/dotnet-upgrade-assistant)を使用すると、.NET Framework アプリを .net Core/.net 5 にアップグレードできます。</span><span class="sxs-lookup"><span data-stu-id="8c622-132">The [.NET Upgrade Assistant tool](https://aka.ms/dotnet-upgrade-assistant) can be used to help upgrade .NET Framework apps to .NET Core / .NET 5.</span></span> <span data-ttu-id="8c622-133">これにより、プロジェクトファイル形式の変更、適切なターゲットフレームワークの設定、NuGet 依存関係の更新など、アプリのアップグレードに関連する一般的なタスクの多くが自動化されます。</span><span class="sxs-lookup"><span data-stu-id="8c622-133">It automates many of the common tasks related to upgrading apps, such as modifying project file format, setting appropriate target frameworks, updating NuGet dependencies, and more.</span></span>

<span data-ttu-id="8c622-134">別の方法としては、"ボトムアップ" アプローチの代わりに、web アプリ (またはソリューション全体) から開始し、自動ツールを使用してアップグレードを支援することもできます。</span><span class="sxs-lookup"><span data-stu-id="8c622-134">Instead of a "bottom up" approach, another alternative is to start with the web app (or even the entire solution) and use an automated tool to assist with the upgrade.</span></span> <span data-ttu-id="8c622-135">[.Net Upgrade Assistant ツール](https://aka.ms/dotnet-upgrade-assistant)を使用すると、.NET Framework アプリを .net Core/.net 5 にアップグレードできます。</span><span class="sxs-lookup"><span data-stu-id="8c622-135">The [.NET Upgrade Assistant tool](https://aka.ms/dotnet-upgrade-assistant) can be used to help upgrade .NET Framework apps to .NET Core / .NET 5.</span></span> <span data-ttu-id="8c622-136">これにより、プロジェクトファイル形式の変更、適切なターゲットフレームワークの設定、NuGet 依存関係の更新など、アプリのアップグレードに関連する一般的なタスクの多くが自動化されます。</span><span class="sxs-lookup"><span data-stu-id="8c622-136">It automates many of the common tasks related to upgrading apps, such as modifying project file format, setting appropriate target frameworks, updating NuGet dependencies, and more.</span></span>

## <a name="migrating-slice-by-slice"></a><span data-ttu-id="8c622-137">スライスによるスライスの移行</span><span class="sxs-lookup"><span data-stu-id="8c622-137">Migrating slice by slice</span></span>

<span data-ttu-id="8c622-138">移行の別の方法として、機能の垂直スライスを識別し、ターゲットプラットフォームに1つずつ移行します。</span><span class="sxs-lookup"><span data-stu-id="8c622-138">Another approach to the migration would be to identify vertical slices of functionality, and migrate them to the target platform one by one.</span></span> <span data-ttu-id="8c622-139">最初の手順として、新しい ASP.NET Core 3.1 または5のアプリを作成します。</span><span class="sxs-lookup"><span data-stu-id="8c622-139">The first step would be to create a new ASP.NET Core 3.1 or 5 app.</span></span> <span data-ttu-id="8c622-140">次に、最初に移行される個々のページまたは API エンドポイントを特定します。</span><span class="sxs-lookup"><span data-stu-id="8c622-140">Next, identify the individual page or API endpoint that will be migrated first.</span></span> <span data-ttu-id="8c622-141">ASP.NET Core アプリでこの1つのルートをサポートするために必要な機能だけを構築します。</span><span class="sxs-lookup"><span data-stu-id="8c622-141">Build out just the necessary functionality to support this one route in the ASP.NET Core app.</span></span> <span data-ttu-id="8c622-142">次に、HTTP リライトまたはリバースプロキシを使用して、これらのページまたはエンドポイントに対する要求を、ASP.NET アプリではなく新しいアプリに送信します。</span><span class="sxs-lookup"><span data-stu-id="8c622-142">Then use HTTP rewriting and/or a reverse proxy to start sending requests for these pages or endpoints to the new app rather than the ASP.NET app.</span></span>

<span data-ttu-id="8c622-143">IIS を使用してこの戦略を実行する方法についての特定のガイダンスについては [、「5つの展開シナリオ](deployment-scenarios.md)」で説明されています。</span><span class="sxs-lookup"><span data-stu-id="8c622-143">Some specific guidance on how to follow this strategy using IIS is covered in [Chapter 5, Deployment Scenarios](deployment-scenarios.md).</span></span>

## <a name="references"></a><span data-ttu-id="8c622-144">関連項目</span><span class="sxs-lookup"><span data-stu-id="8c622-144">References</span></span>

- [<span data-ttu-id="8c622-145">.NET Standard とは何でしょうか。</span><span class="sxs-lookup"><span data-stu-id="8c622-145">What is .NET Standard?</span></span>](https://dotnet.microsoft.com/platform/dotnet-standard)
- [<span data-ttu-id="8c622-146">.NET 5 の概要</span><span class="sxs-lookup"><span data-stu-id="8c622-146">Introducing .NET 5</span></span>](https://devblogs.microsoft.com/dotnet/introducing-net-5/)
- [<span data-ttu-id="8c622-147">ASP.NET Core 3.1 から5.0 への移行</span><span class="sxs-lookup"><span data-stu-id="8c622-147">Migrate from ASP.NET Core 3.1 to 5.0</span></span>](/aspnet/core/migration/31-to-50)
- [<span data-ttu-id="8c622-148">.NET Upgrade Assistant ツール</span><span class="sxs-lookup"><span data-stu-id="8c622-148">.NET Upgrade Assistant tool</span></span>](https://aka.ms/dotnet-upgrade-assistant)

>[!div class="step-by-step"]
><span data-ttu-id="8c622-149">[前へ](choose-net-core-version.md)
>[次へ](migrate-web-forms.md)</span><span class="sxs-lookup"><span data-stu-id="8c622-149">[Previous](choose-net-core-version.md)
[Next](migrate-web-forms.md)</span></span>
