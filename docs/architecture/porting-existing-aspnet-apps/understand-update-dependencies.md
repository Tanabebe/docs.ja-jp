---
title: 依存関係の把握と更新
description: .NET Framework プロジェクトを .NET Core に移行するには、.NET Core で動作するようにその依存関係を更新する必要があります。 このセクションでは、大規模なアプリの移行を計画するために使用できるツールと方法について説明します。
author: ardalis
ms.date: 11/13/2020
ms.openlocfilehash: afad77860099e4737b5270dc32fc20c2025e63dd
ms.sourcegitcommit: 42d436ebc2a7ee02fc1848c7742bc7d80e13fc2f
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/04/2021
ms.locfileid: "102401345"
---
# <a name="understand-and-update-dependencies"></a><span data-ttu-id="0f6d2-104">依存関係の把握と更新</span><span class="sxs-lookup"><span data-stu-id="0f6d2-104">Understand and update dependencies</span></span>

<span data-ttu-id="0f6d2-105">アプリの個々のプロジェクトを移行する順序を特定したら、次の手順として、各プロジェクトの依存関係を理解し、必要に応じて更新します。</span><span class="sxs-lookup"><span data-stu-id="0f6d2-105">After identifying the sequence in which the app's individual projects must be migrated, the next step is to understand each project's dependencies and update them if necessary.</span></span> <span data-ttu-id="0f6d2-106">プラットフォームの依存関係については、まず、対象のアセンブリで [.Net 移植性アナライザー](../../standard/analyzers/portability-analyzer.md) を実行し、生成された詳細な結果を確認することをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="0f6d2-106">For platform dependencies, the best way to start is to run the [.NET Portability Analyzer](../../standard/analyzers/portability-analyzer.md) on the assembly in question, and then look at the detailed results that are generated.</span></span> <span data-ttu-id="0f6d2-107">このツールを構成して、.NET Core 3.1 や .NET Standard 2.0 などの1つ以上のターゲットプラットフォームを指定します。</span><span class="sxs-lookup"><span data-stu-id="0f6d2-107">You configure the tool to specify one or more target platforms, such as .NET Core 3.1 or .NET Standard 2.0.</span></span> <span data-ttu-id="0f6d2-108">結果には、対象となる各プラットフォームの詳細が表示されます。</span><span class="sxs-lookup"><span data-stu-id="0f6d2-108">Results are provided with details for each platform targeted.</span></span> <span data-ttu-id="0f6d2-109">図3-4 は、ツールの出力の例を示しています。</span><span class="sxs-lookup"><span data-stu-id="0f6d2-109">Figure 3-4 shows an example of the tool's output.</span></span>

![.NET 移植性アナライザーレポートの詳細](./media/Figure3-4.png)

<span data-ttu-id="0f6d2-111">**図 3-4.**</span><span class="sxs-lookup"><span data-stu-id="0f6d2-111">**Figure 3-4.**</span></span> <span data-ttu-id="0f6d2-112">.NET 移植性アナライザーレポートの詳細。</span><span class="sxs-lookup"><span data-stu-id="0f6d2-112">.NET Portability Analyzer report details.</span></span>

## <a name="update-class-library-dependencies"></a><span data-ttu-id="0f6d2-113">クラスライブラリの依存関係の更新</span><span class="sxs-lookup"><span data-stu-id="0f6d2-113">Update class library dependencies</span></span>

<span data-ttu-id="0f6d2-114">通常、大規模なアプリには複数のプロジェクトが含まれており、ASP.NET MVC web プロジェクト以外のほとんどのプロジェクトはクラスライブラリである可能性があります。</span><span class="sxs-lookup"><span data-stu-id="0f6d2-114">Large apps typically involve multiple projects, and most projects other than the ASP.NET MVC web project are likely to be class libraries.</span></span> <span data-ttu-id="0f6d2-115">クラスライブラリは、.NET プラットフォーム間で最も簡単に移植できる傾向があります。特に、ASP.NET プロジェクトの場合は、最も困難なもの (通常は再作成が必要) です。</span><span class="sxs-lookup"><span data-stu-id="0f6d2-115">Class libraries tend to be the easiest to port between .NET platforms, especially compared to ASP.NET projects, which are among the most difficult (and typically need to be re-created).</span></span>

<span data-ttu-id="0f6d2-116">チームでは、クラスライブラリを .NET Core に移行するための [変換ツール](https://github.com/dotnet/try-convert) または [.net Upgrade Assistant ツール](https://aka.ms/dotnet-upgrade-assistant) を検討できます。</span><span class="sxs-lookup"><span data-stu-id="0f6d2-116">Teams can consider the [try-convert tool](https://github.com/dotnet/try-convert) or the [.NET Upgrade Assistant tool](https://aka.ms/dotnet-upgrade-assistant) for migrating class libraries to .NET Core.</span></span> <span data-ttu-id="0f6d2-117">これらのツールは、.NET Framework プロジェクトファイルを分析し、.NET Core プロジェクトファイル形式への移行を試行して、プロセスで安全に実行できるように変更を行います。</span><span class="sxs-lookup"><span data-stu-id="0f6d2-117">These tools analyze a .NET Framework project file and attempt to migrate it to the .NET Core project file format, making any modifications it can safely perform in the process.</span></span> <span data-ttu-id="0f6d2-118">これらのツールでは、ASP.NET プロジェクトを操作するために手動の支援が必要になる場合がありますが、通常はクラスライブラリを移行するプロセスの速度を向上させることができます。</span><span class="sxs-lookup"><span data-stu-id="0f6d2-118">The tools may require some manual assistance to work with ASP.NET projects, but can usually help speed up the process of migrating class libraries.</span></span>

<span data-ttu-id="0f6d2-119">Convert および Upgrade Assistant ツールは、.NET Core コマンドラインツールとしてデプロイされています。</span><span class="sxs-lookup"><span data-stu-id="0f6d2-119">The try-convert and Upgrade Assistant tools are deployed as .NET Core command line tools.</span></span> <span data-ttu-id="0f6d2-120">これらは、.NET Framework アプリで動作するように設計されているため、Windows 上でのみ動作します。</span><span class="sxs-lookup"><span data-stu-id="0f6d2-120">They only run on Windows, since they're designed to work with .NET Framework apps.</span></span> <span data-ttu-id="0f6d2-121">コマンドプロンプトから次のコマンドを実行して、try 変換をインストールできます。</span><span class="sxs-lookup"><span data-stu-id="0f6d2-121">You can install try-convert by running the following command from a command prompt:</span></span>

```dotnetcli
dotnet tool install -g try-convert
```

<span data-ttu-id="0f6d2-122">ツールを正常にインストールしたら、 `try-convert` クラスライブラリのプロジェクトファイルが配置されているフォルダーでを実行できます。</span><span class="sxs-lookup"><span data-stu-id="0f6d2-122">Once you've successfully installed the tool, you can run `try-convert` in the folder where the class library's project file is located.</span></span>

<span data-ttu-id="0f6d2-123">次のコマンドを使用して .NET Upgrade Assistant をインストールします (試し変換をインストールした後)。</span><span class="sxs-lookup"><span data-stu-id="0f6d2-123">Install the .NET Upgrade Assistant with the following command (after installing try-convert):</span></span>

```dotnetcli
dotnet tool install -g upgrade-assistant
```

<span data-ttu-id="0f6d2-124">`upgrade-assistant <project>`プロジェクトファイルが配置されているフォルダー内のコマンドを使用して、ツールを実行します。</span><span class="sxs-lookup"><span data-stu-id="0f6d2-124">Run the tool with the command `upgrade-assistant <project>` in the folder where the project file is located.</span></span>

## <a name="update-nuget-package-dependencies"></a><span data-ttu-id="0f6d2-125">NuGet パッケージの依存関係の更新</span><span class="sxs-lookup"><span data-stu-id="0f6d2-125">Update NuGet package dependencies</span></span>

<span data-ttu-id="0f6d2-126">サードパーティの NuGet パッケージの使用を分析し、そのうちのいずれかがまだ .NET Standard をサポートしていないかどうかを判断します (または、新しいバージョンでのみサポートします)。</span><span class="sxs-lookup"><span data-stu-id="0f6d2-126">Analyze your use of third-party NuGet packages and determine if any of them don't yet support .NET Standard (or do support it but only with a new version).</span></span> <span data-ttu-id="0f6d2-127">最上位レベルの依存関係が表示されるように、 [ `<PackageReference>` Visual Studio のコンバーターツールを使用して構文を使用するように NuGet パッケージを更新](/nuget/consume-packages/migrate-packages-config-to-package-reference)すると便利な場合があります。</span><span class="sxs-lookup"><span data-stu-id="0f6d2-127">It can be helpful to [update NuGet packages to use `<PackageReference>` syntax using Visual Studio's converter tool](/nuget/consume-packages/migrate-packages-config-to-package-reference), so that top-level dependencies are visible.</span></span> <span data-ttu-id="0f6d2-128">次に、これらのパッケージの現在またはそれ以降のバージョンで .NET Core または .NET Standard がサポートされているかどうかを確認します。</span><span class="sxs-lookup"><span data-stu-id="0f6d2-128">Next, check whether the current or later versions of these packages support .NET Core or .NET Standard.</span></span> <span data-ttu-id="0f6d2-129">この情報は、パッケージごとに [nuget.org] または Visual Studio 内で確認できます。</span><span class="sxs-lookup"><span data-stu-id="0f6d2-129">This information can be found on [nuget.org] or within Visual Studio for each package.</span></span>

<span data-ttu-id="0f6d2-130">アプリが現在使用しているパッケージのバージョンを使用してサポートが存在する場合は、</span><span class="sxs-lookup"><span data-stu-id="0f6d2-130">If support exists using the version of the package the app currently uses, great!</span></span> <span data-ttu-id="0f6d2-131">そうでない場合は、より新しいバージョンのパッケージがサポートされているかどうかを確認し、アップグレードに関連する内容を調査します。</span><span class="sxs-lookup"><span data-stu-id="0f6d2-131">If not, see if a more recent version of the package has the support and research what would be involved in upgrading.</span></span> <span data-ttu-id="0f6d2-132">パッケージに重大な変更が加えられている可能性があります。特に、パッケージのメジャーバージョンが現在使用しているバージョンとアップグレードするバージョンの間で変更されている場合です。</span><span class="sxs-lookup"><span data-stu-id="0f6d2-132">There may be breaking changes in the package, especially if the major version of the package changes between your currently used version and the one to which you're upgrading.</span></span>

<span data-ttu-id="0f6d2-133">場合によっては、特定のパッケージのバージョンが .NET Core で動作しないことがあります。</span><span class="sxs-lookup"><span data-stu-id="0f6d2-133">In some cases, no version of a given package works with .NET Core.</span></span> <span data-ttu-id="0f6d2-134">その場合、チームにはいくつかのオプションがあります。</span><span class="sxs-lookup"><span data-stu-id="0f6d2-134">In that case, teams have a couple options.</span></span> <span data-ttu-id="0f6d2-135">.NET Framework のバージョンによっては継続できますが、これには制限があります。</span><span class="sxs-lookup"><span data-stu-id="0f6d2-135">They can continue depending on the .NET Framework version, but this has limitations.</span></span> <span data-ttu-id="0f6d2-136">アプリは Windows 上でのみ実行され、チームはパッケージのバイナリで移植性アナライザーを実行して、発生する可能性のある問題があるかどうかを確認することができます。</span><span class="sxs-lookup"><span data-stu-id="0f6d2-136">The app will only run on Windows, and the team may want to run Portability Analyzer on the package's binaries to see if there are any issues likely to be encountered.</span></span> <span data-ttu-id="0f6d2-137">もちろん、チームは十分にテストする必要があります。</span><span class="sxs-lookup"><span data-stu-id="0f6d2-137">Certainly the team will want to test thoroughly.</span></span> <span data-ttu-id="0f6d2-138">もう1つの方法は、別のパッケージを検索する方法です。必要なパッケージがオープンソースの場合は、それを .NET Standard または .NET Core にアップグレードします。</span><span class="sxs-lookup"><span data-stu-id="0f6d2-138">The other option is to find a different package or, if the required package is open source, upgrade it to .NET Standard or .NET Core themselves.</span></span>

## <a name="migrate-aspnet-mvc-projects"></a><span data-ttu-id="0f6d2-139">ASP.NET MVC プロジェクトの移行</span><span class="sxs-lookup"><span data-stu-id="0f6d2-139">Migrate ASP.NET MVC projects</span></span>

<span data-ttu-id="0f6d2-140">`System.Web`名前空間と型は、.Net Core には存在しません。</span><span class="sxs-lookup"><span data-stu-id="0f6d2-140">The `System.Web` namespace and types don't exist in .NET Core.</span></span> <span data-ttu-id="0f6d2-141">依存関係を分析したり、などのツールを使用したりする場合 `try-convert` 、ASP.NET MVC プロジェクトの自動移行に関する多くの提案と、を参照するコードが提供されていないことがわかり `System.Web` ます。</span><span class="sxs-lookup"><span data-stu-id="0f6d2-141">When you're analyzing dependencies and using tools like `try-convert`, you'll find they don't offer many suggestions for automatic migration of ASP.NET MVC projects and any code in them that references `System.Web`.</span></span> <span data-ttu-id="0f6d2-142">これらのプロジェクトでは、最初に新しい ASP.NET Core web プロジェクトを作成し、このプロジェクトにファイルを手動で移行する必要があります。</span><span class="sxs-lookup"><span data-stu-id="0f6d2-142">For these projects, you'll need to start with a new ASP.NET Core web project and manually migrate files to this project.</span></span>

<span data-ttu-id="0f6d2-143">一般に、アプリのビジネスロジックがユーザーインターフェイスレイヤーに存在する量を最小限に抑えることをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="0f6d2-143">In general, it's a good practice to minimize how much of an app's business logic lives in its user interface layer.</span></span> <span data-ttu-id="0f6d2-144">また、コントローラーとビューを小さくしておくことをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="0f6d2-144">It's also best to keep controllers and views small.</span></span> <span data-ttu-id="0f6d2-145">このガイダンスに従っているアプリは、ASP.NET web プロジェクトで大量のロジックを使用しているよりも簡単に移植できます。</span><span class="sxs-lookup"><span data-stu-id="0f6d2-145">Apps that have followed this guidance will be easier to port than those that have a significant amount of their logic in the ASP.NET web project.</span></span> <span data-ttu-id="0f6d2-146">移植を検討しているものの、まだプロセスを開始していないアプリがある場合は、維持するときにこの点に留意してください。</span><span class="sxs-lookup"><span data-stu-id="0f6d2-146">If you have an app you're considering porting, but haven't begun the process yet, keep this in mind as you maintain it.</span></span> <span data-ttu-id="0f6d2-147">ASP.NET MVC または Web API プロジェクト内のコードの量を最小限に抑えるために必要な作業は、アプリの移植に時間がかかる場合に、作業が少なくなる可能性があります。</span><span class="sxs-lookup"><span data-stu-id="0f6d2-147">Any effort you put toward minimizing how much code is in the ASP.NET MVC or Web API project will likely result in less work when the time comes to port the app.</span></span>

<span data-ttu-id="0f6d2-148">次の章では、調査プロジェクト ASP.NET Core に ASP.NET MVC プロジェクトと Web API プロジェクトを移行する方法の詳細について説明します。</span><span class="sxs-lookup"><span data-stu-id="0f6d2-148">The next chapter digs into details of how to migrate from ASP.NET MVC and Web API projects to ASP.NET Core projects.</span></span> <span data-ttu-id="0f6d2-149">前の章では、アプリ間の最大の違いを説明しました。</span><span class="sxs-lookup"><span data-stu-id="0f6d2-149">The previous chapter called out the biggest differences between the apps.</span></span> <span data-ttu-id="0f6d2-150">基本的なプロジェクトの構造が整ったら、通常、個々のコントローラーとビューを移行するのは簡単です。特に、主に web の役割を重視している場合は、</span><span class="sxs-lookup"><span data-stu-id="0f6d2-150">Once the basic project structure is in place, migrating individual controllers and views is usually straightforward, especially if they're mainly focused on web responsibilities.</span></span>

## <a name="references"></a><span data-ttu-id="0f6d2-151">関連項目</span><span class="sxs-lookup"><span data-stu-id="0f6d2-151">References</span></span>

- [<span data-ttu-id="0f6d2-152">.NET Upgrade Assistant ツール</span><span class="sxs-lookup"><span data-stu-id="0f6d2-152">.NET Upgrade Assistant tool</span></span>](https://aka.ms/dotnet-upgrade-assistant)
- [<span data-ttu-id="0f6d2-153">try 変換ツール</span><span class="sxs-lookup"><span data-stu-id="0f6d2-153">try-convert tool</span></span>](https://github.com/dotnet/try-convert)
- [<span data-ttu-id="0f6d2-154">apiport ツール</span><span class="sxs-lookup"><span data-stu-id="0f6d2-154">apiport tool</span></span>](https://github.com/microsoft/dotnet-apiport)

>[!div class="step-by-step"]
><span data-ttu-id="0f6d2-155">[前へ](identify-migration-sequence.md)
>[次へ](strategies-migrating-in-production.md)</span><span class="sxs-lookup"><span data-stu-id="0f6d2-155">[Previous](identify-migration-sequence.md)
[Next](strategies-migrating-in-production.md)</span></span>
