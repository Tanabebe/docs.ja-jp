---
title: プリンシパル オブジェクトと ID オブジェクト
description: .NET 内でユーザーを表す、ID オブジェクトについて説明します。 ID オブジェクトとロールの両方をカプセル化するプリンシパル オブジェクトについても説明します。
ms.date: 07/15/2020
helpviewer_keywords:
- WindowsIdentity objects
- GenericIdentity objects
- GenericPrincipal objects
- identity objects, about identity objects
- security [.NET], identity objects
- principal objects, about principal objects
- security [.NET], principals
- WindowsPrincipal objects
ms.assetid: aa5930ad-f3d7-40aa-b6f6-c6edcd5c64f7
ms.openlocfilehash: cfda506fc29e9a86e97b3c99faf2d4155c894f03
ms.sourcegitcommit: 965a5af7918acb0a3fd3baf342e15d511ef75188
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 11/18/2020
ms.locfileid: "94824240"
---
# <a name="principal-and-identity-objects"></a><span data-ttu-id="26e71-104">プリンシパル オブジェクトと ID オブジェクト</span><span class="sxs-lookup"><span data-stu-id="26e71-104">Principal and Identity Objects</span></span>

> [!NOTE]
> <span data-ttu-id="26e71-105">この記事は Windows に適用されます。</span><span class="sxs-lookup"><span data-stu-id="26e71-105">This article applies to Windows.</span></span>
>
> <span data-ttu-id="26e71-106">ASP.NET Core の詳細については、「[ASP.NET Core のセキュリティ](/aspnet/core/security/)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="26e71-106">For information about ASP.NET Core, see [ASP.NET Core Security](/aspnet/core/security/).</span></span>

<span data-ttu-id="26e71-107">マネージド コードは、<xref:System.Security.Principal.IIdentity> オブジェクトへの参照が含まれる <xref:System.Security.Principal.IPrincipal> オブジェクトを通じてプリンシパルの ID またはロールを検出できます。</span><span class="sxs-lookup"><span data-stu-id="26e71-107">Managed code can discover the identity or the role of a principal through a <xref:System.Security.Principal.IPrincipal> object, which contains a reference to an <xref:System.Security.Principal.IIdentity> object.</span></span> <span data-ttu-id="26e71-108">ID オブジェクトとプリンシパル オブジェクトは、ユーザーとグループ アカウントのようななじみのある概念と比較するとわかりやすいでしょう。</span><span class="sxs-lookup"><span data-stu-id="26e71-108">It might be helpful to compare identity and principal objects to familiar concepts like user and group accounts.</span></span> <span data-ttu-id="26e71-109">ほとんどのネットワーク環境で、ユーザー アカウントは人またはプログラムを表し、グループ アカウントは特定のカテゴリのユーザーやそのユーザーが所有する権限を表します。</span><span class="sxs-lookup"><span data-stu-id="26e71-109">In most network environments, user accounts represent people or programs, while group accounts represent certain categories of users and the rights they possess.</span></span> <span data-ttu-id="26e71-110">同様に、.NET の ID オブジェクトはユーザーを表し、ロールはメンバーシップやセキュリティ コンテキストを表します。</span><span class="sxs-lookup"><span data-stu-id="26e71-110">Similarly, .NET identity objects represent users, while roles represent memberships and security contexts.</span></span> <span data-ttu-id="26e71-111">.NET では、プリンシパル オブジェクトによって ID オブジェクトとロールの両方がカプセル化されます。</span><span class="sxs-lookup"><span data-stu-id="26e71-111">In .NET, the principal object encapsulates both an identity object and a role.</span></span> <span data-ttu-id="26e71-112">.NET アプリケーションは、その ID か、より一般的にはそのロール メンバーシップに基づいてプリンシパルに権限を付与します。</span><span class="sxs-lookup"><span data-stu-id="26e71-112">.NET applications grant rights to the principal based on its identity or, more commonly, its role membership.</span></span>  
  
## <a name="identity-objects"></a><span data-ttu-id="26e71-113">ID オブジェクト</span><span class="sxs-lookup"><span data-stu-id="26e71-113">Identity Objects</span></span>

<span data-ttu-id="26e71-114">ID オブジェクトは、検証対象のユーザーまたはエンティティに関する情報をカプセル化します。</span><span class="sxs-lookup"><span data-stu-id="26e71-114">The identity object encapsulates information about the user or entity being validated.</span></span> <span data-ttu-id="26e71-115">ID オブジェクトの最も基本的なレベルには名前と認証の種類が含まれます。</span><span class="sxs-lookup"><span data-stu-id="26e71-115">At their most basic level, identity objects contain a name and an authentication type.</span></span> <span data-ttu-id="26e71-116">名前はユーザー名または Windows アカウント名、認証の種類は、サポートされるログオン プロトコル (Kerberos V5 など) かカスタム値になります。</span><span class="sxs-lookup"><span data-stu-id="26e71-116">The name can either be a user's name or the name of a Windows account, while the authentication type can be either a supported logon protocol, such as Kerberos V5, or a custom value.</span></span> <span data-ttu-id="26e71-117">.NET では、ほとんどのカスタム ログオン シナリオで使用できる <xref:System.Security.Principal.GenericIdentity> オブジェクトと、アプリケーションを Windows 認証に依存させる場合に使用できるより特殊な <xref:System.Security.Principal.WindowsIdentity> オブジェクトが定義されています。</span><span class="sxs-lookup"><span data-stu-id="26e71-117">.NET defines a <xref:System.Security.Principal.GenericIdentity> object that can be used for most custom logon scenarios and a more specialized <xref:System.Security.Principal.WindowsIdentity> object that can be used when you want your application to rely on Windows authentication.</span></span> <span data-ttu-id="26e71-118">また、カスタム ユーザー情報をカプセル化する独自の ID クラスを定義することもできます。</span><span class="sxs-lookup"><span data-stu-id="26e71-118">Additionally, you can define your own identity class that encapsulates custom user information.</span></span>  
  
<span data-ttu-id="26e71-119"><xref:System.Security.Principal.IIdentity> インターフェイスでは、名前と認証の種類 (Kerberos V5 や NTLM など) にアクセスするためのプロパティが定義されています。</span><span class="sxs-lookup"><span data-stu-id="26e71-119">The <xref:System.Security.Principal.IIdentity> interface defines properties for accessing a name and an authentication type, such as Kerberos V5 or NTLM.</span></span> <span data-ttu-id="26e71-120">すべての **Identity** クラスでは **IIdentity** インターフェイスが実装されます。</span><span class="sxs-lookup"><span data-stu-id="26e71-120">All **Identity** classes implement the **IIdentity** interface.</span></span> <span data-ttu-id="26e71-121">**ID** オブジェクトと、スレッドが現在実行している Windows NT プロセス トークンの間に関係は必要ありません。</span><span class="sxs-lookup"><span data-stu-id="26e71-121">There is no required relationship between an **Identity** object and the Windows NT process token under which a thread is currently executing.</span></span> <span data-ttu-id="26e71-122">ただし、**ID** オブジェクトが **WindowsIdentity** オブジェクトである場合、ID は Windows NT セキュリティ トークンを表すと見なされます。</span><span class="sxs-lookup"><span data-stu-id="26e71-122">However, if the **Identity** object is a **WindowsIdentity** object, the identity is assumed to represent a Windows NT security token.</span></span>  
  
## <a name="principal-objects"></a><span data-ttu-id="26e71-123">プリンシパル オブジェクト</span><span class="sxs-lookup"><span data-stu-id="26e71-123">Principal Objects</span></span>

<span data-ttu-id="26e71-124">プリンシパル オブジェクトは、コードが実行されているセキュリティ コンテキストを表します。</span><span class="sxs-lookup"><span data-stu-id="26e71-124">The principal object represents the security context under which code is running.</span></span> <span data-ttu-id="26e71-125">ロールベースのセキュリティを実装するアプリケーションは、プリンシパル オブジェクトに関連付けられたロールに基づいて権限を付与します。</span><span class="sxs-lookup"><span data-stu-id="26e71-125">Applications that implement role-based security grant rights based on the role associated with a principal object.</span></span> <span data-ttu-id="26e71-126">ID オブジェクトと同様に、.NET では <xref:System.Security.Principal.GenericPrincipal> オブジェクトと <xref:System.Security.Principal.WindowsPrincipal> オブジェクトが提供されています。</span><span class="sxs-lookup"><span data-stu-id="26e71-126">Similar to identity objects, .NET provides a <xref:System.Security.Principal.GenericPrincipal> object and a <xref:System.Security.Principal.WindowsPrincipal> object.</span></span> <span data-ttu-id="26e71-127">独自のカスタム プリンシパル クラスを定義することもできます。</span><span class="sxs-lookup"><span data-stu-id="26e71-127">You can also define your own custom principal classes.</span></span>  
  
<span data-ttu-id="26e71-128"><xref:System.Security.Principal.IPrincipal> インターフェイスでは、関連付けられた **ID** オブジェクトにアクセスするためのプロパティと、**プリンシパル** オブジェクトによって識別されるユーザーが所定のロールのメンバーかどうかを判別するためのメソッドが定義されています。</span><span class="sxs-lookup"><span data-stu-id="26e71-128">The <xref:System.Security.Principal.IPrincipal> interface defines a property for accessing an associated **Identity** object as well as a method for determining whether the user identified by the **Principal** object is a member of a given role.</span></span> <span data-ttu-id="26e71-129">すべての **プリンシパル** クラスは、**IPrincipal** インターフェイスの他に、必要なその他のプロパティとメソッドを実装しています。</span><span class="sxs-lookup"><span data-stu-id="26e71-129">All **Principal** classes implement the **IPrincipal** interface as well as any additional properties and methods that are necessary.</span></span> <span data-ttu-id="26e71-130">たとえば、共通言語ランタイムでは **WindowsPrincipal** クラスが提供されますが、これは Windows NT または Windows 2000 グループ メンバーシップをロールにマッピングする追加機能を実装します。</span><span class="sxs-lookup"><span data-stu-id="26e71-130">For example, the common language runtime provides the **WindowsPrincipal** class, which implements additional functionality for mapping Windows NT or Windows 2000 group membership to roles.</span></span>  
  
<span data-ttu-id="26e71-131">**プリンシパル** オブジェクトは、アプリケーション ドメイン (<xref:System.AppDomain>) 内の呼び出しコンテキスト (<xref:System.Runtime.Remoting.Messaging.CallContext>) オブジェクトにバインドされます。</span><span class="sxs-lookup"><span data-stu-id="26e71-131">A **Principal** object is bound to a call context (<xref:System.Runtime.Remoting.Messaging.CallContext>) object within an application domain (<xref:System.AppDomain>).</span></span> <span data-ttu-id="26e71-132">常に既定の呼び出しコンテキストはそれぞれ新しい **AppDomain** を使用して作成されるため、**プリンシパル** オブジェクトを受け入れる呼び出しコンテキストが常に存在します。</span><span class="sxs-lookup"><span data-stu-id="26e71-132">A default call context is always created with each new **AppDomain**, so there is always a call context available to accept the **Principal** object.</span></span> <span data-ttu-id="26e71-133">新しいスレッドが作成されるとき、そのスレッドの **CallContext** オブジェクトも作成されます。</span><span class="sxs-lookup"><span data-stu-id="26e71-133">When a new thread is created, a **CallContext** object is also created for the thread.</span></span> <span data-ttu-id="26e71-134">**プリンシパル** オブジェクトの参照は、作成スレッドから新しいスレッドの **CallContext** に自動的にコピーされます。</span><span class="sxs-lookup"><span data-stu-id="26e71-134">The **Principal** object reference is automatically copied from the creating thread to the new thread's **CallContext**.</span></span> <span data-ttu-id="26e71-135">スレッドの作成者に所属する **プリンシパル** オブジェクトをランタイムが判別できない場合は、**プリンシパル** オブジェクトと **ID** オブジェクトの作成で既定のポリシーに従います。</span><span class="sxs-lookup"><span data-stu-id="26e71-135">If the runtime cannot determine which **Principal** object belongs to the creator of the thread, it follows the default policy for **Principal** and **Identity** object creation.</span></span>  
  
<span data-ttu-id="26e71-136">構成可能なアプリケーション ドメイン固有のポリシーによって、新しいアプリケーション ドメインに関連付ける **プリンシパル** オブジェクトの種類を決める規則が定義されます。</span><span class="sxs-lookup"><span data-stu-id="26e71-136">A configurable application domain-specific policy defines the rules for deciding what type of **Principal** object to associate with a new application domain.</span></span> <span data-ttu-id="26e71-137">セキュリティ ポリシーによって許可される場合、ランタイムは、現在の実行スレッドに関連するオペレーティング システム トークンを反映する **プリンシパル** オブジェクトと **ID** オブジェクトを作成できます。</span><span class="sxs-lookup"><span data-stu-id="26e71-137">Where security policy permits, the runtime can create **Principal** and **Identity** objects that reflect the operating system token associated with the current thread of execution.</span></span> <span data-ttu-id="26e71-138">ランタイムは既定では、認証されていないユーザーを表す **プリンシパル** オブジェクトと **ID** オブジェクトを使用します。</span><span class="sxs-lookup"><span data-stu-id="26e71-138">By default, the runtime uses **Principal** and **Identity** objects that represent unauthenticated users.</span></span> <span data-ttu-id="26e71-139">このような既定の **プリンシパル** オブジェクトと **ID** オブジェクトは、コードがアクセスを試行するまでランタイムによって作成されることはありません。</span><span class="sxs-lookup"><span data-stu-id="26e71-139">The runtime does not create these default **Principal** and **Identity** objects until the code attempts to access them.</span></span>  
  
<span data-ttu-id="26e71-140">信頼されるコードが、アプリケーション ドメインを作成して、アプリケーション ドメイン ポリシーを作成できます。このポリシーによって、既定の **プリンシパル** オブジェクトと **ID** オブジェクトのコンストラクトが制御されます。</span><span class="sxs-lookup"><span data-stu-id="26e71-140">Trusted code that creates an application domain can set the application domain policy that controls construction of the default **Principal** and **Identity** objects.</span></span> <span data-ttu-id="26e71-141">このアプリケーション ドメイン固有ポリシーは、そのアプリケーション ドメインのすべての実行スレッドに適用されます。</span><span class="sxs-lookup"><span data-stu-id="26e71-141">This application domain-specific policy applies to all execution threads in that application domain.</span></span> <span data-ttu-id="26e71-142">信頼されているアンマネージド ホストは本質的にこのポリシーを設定できますが、このポリシーを設定するマネージド コードはドメイン ポリシーを制御するために <xref:System.Security.Permissions.SecurityPermission?displayProperty=nameWithType> を持つ必要があります。</span><span class="sxs-lookup"><span data-stu-id="26e71-142">An unmanaged, trusted host inherently has the ability to set this policy, but managed code that sets this policy must have the <xref:System.Security.Permissions.SecurityPermission?displayProperty=nameWithType> for controlling domain policy.</span></span>  
  
<span data-ttu-id="26e71-143">**プリンシパル** オブジェクトを同じプロセス内 (つまり同じコンピューター上の) アプリケーション ドメイン間で送信するとき、リモート処理インフラストラクチャが、呼び出し元のコンテキストに関連する **プリンシパル** オブジェクトへの参照を呼び出し先のコンテキストにコピーします。</span><span class="sxs-lookup"><span data-stu-id="26e71-143">When transmitting a **Principal** object across application domains but within the same process (and therefore on the same computer), the remoting infrastructure copies a reference to the **Principal** object associated with the caller's context to the callee's context.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="26e71-144">関連項目</span><span class="sxs-lookup"><span data-stu-id="26e71-144">See also</span></span>

- [<span data-ttu-id="26e71-145">方法: WindowsPrincipal プロジェクトを作成する</span><span class="sxs-lookup"><span data-stu-id="26e71-145">How to: Create a WindowsPrincipal Object</span></span>](how-to-create-a-windowsprincipal-object.md)
- [<span data-ttu-id="26e71-146">方法: GenericPrincipal オブジェクトと GenericIdentity オブジェクトを作成する</span><span class="sxs-lookup"><span data-stu-id="26e71-146">How to: Create GenericPrincipal and GenericIdentity Objects</span></span>](how-to-create-genericprincipal-and-genericidentity-objects.md)
- [<span data-ttu-id="26e71-147">プリンシパル オブジェクトの置き換え</span><span class="sxs-lookup"><span data-stu-id="26e71-147">Replacing a Principal Object</span></span>](replacing-a-principal-object.md)
- [<span data-ttu-id="26e71-148">偽装と復帰</span><span class="sxs-lookup"><span data-stu-id="26e71-148">Impersonating and Reverting</span></span>](impersonating-and-reverting.md)
- [<span data-ttu-id="26e71-149">ロール ベースのセキュリティ</span><span class="sxs-lookup"><span data-stu-id="26e71-149">Role-Based Security</span></span>](role-based-security.md)
- [<span data-ttu-id="26e71-150">セキュリティの基本概念</span><span class="sxs-lookup"><span data-stu-id="26e71-150">Key Security Concepts</span></span>](key-security-concepts.md)
- [<span data-ttu-id="26e71-151">ASP.NET Core のセキュリティ</span><span class="sxs-lookup"><span data-stu-id="26e71-151">ASP.NET Core Security</span></span>](/aspnet/core/security/)
