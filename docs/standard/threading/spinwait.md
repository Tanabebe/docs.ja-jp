---
description: '詳細情報: SpinWait'
title: SpinWait
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
helpviewer_keywords:
- synchronization primitives, SpinWait
ms.assetid: 36012f42-34e5-4f86-adf4-973f433ed6c6
ms.openlocfilehash: 929db1b35d7d526585641ef1c1b213f4e000585b
ms.sourcegitcommit: ddf7edb67715a5b9a45e3dd44536dabc153c1de0
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 02/06/2021
ms.locfileid: "99797992"
---
# <a name="spinwait"></a><span data-ttu-id="48f12-103">SpinWait</span><span class="sxs-lookup"><span data-stu-id="48f12-103">SpinWait</span></span>

<span data-ttu-id="48f12-104"><xref:System.Threading.SpinWait?displayProperty=nameWithType> は軽量な同期型であり、負荷が高いコンテキスト スイッチとカーネル イベントに必要なカーネル遷移を避けるために低レベルのシナリオで使用できます。</span><span class="sxs-lookup"><span data-stu-id="48f12-104"><xref:System.Threading.SpinWait?displayProperty=nameWithType> is a lightweight synchronization type that you can use in low-level scenarios to avoid the expensive context switches and kernel transitions that are required for kernel events.</span></span> <span data-ttu-id="48f12-105">マルチコア コンピューターでは、リソースの保持期間が長くならないと予測される場合、待機中のスレッドを数十または数百サイクルの間ユーザー モードでスピンさせてから、リソースの取得を再試行した方が効率的です。</span><span class="sxs-lookup"><span data-stu-id="48f12-105">On multicore computers, when a resource is not expected to be held for long periods of time, it can be more efficient for a waiting thread to spin in user mode for a few dozen or a few hundred cycles, and then retry to acquire the resource.</span></span> <span data-ttu-id="48f12-106">スピン後にリソースを使用できる場合は、数千サイクルを節約したことになります。</span><span class="sxs-lookup"><span data-stu-id="48f12-106">If the resource is available after spinning, then you have saved several thousand cycles.</span></span> <span data-ttu-id="48f12-107">リソースをまだ使用できない場合でも、数サイクルを消費しただけであり、カーネル ベースの待機に移行できます。</span><span class="sxs-lookup"><span data-stu-id="48f12-107">If the resource is still not available, then you have spent only a few cycles and can still enter a kernel-based wait.</span></span> <span data-ttu-id="48f12-108">スピン後に待機というこの組み合わせは、*2 フェーズ待機操作* と呼ばれることがあります。</span><span class="sxs-lookup"><span data-stu-id="48f12-108">This spinning-then-waiting combination is sometimes referred to as a *two-phase wait operation*.</span></span>  
  
 <span data-ttu-id="48f12-109"><xref:System.Threading.SpinWait> は、<xref:System.Threading.ManualResetEvent> などのカーネル イベントをラップする .NET 型と共に使用するように設計されています。</span><span class="sxs-lookup"><span data-stu-id="48f12-109"><xref:System.Threading.SpinWait> is designed to be used in conjunction with the .NET types that wrap kernel events such as <xref:System.Threading.ManualResetEvent>.</span></span> <span data-ttu-id="48f12-110">また、<xref:System.Threading.SpinWait> は、1 つのプログラムのみで基本的なスピン機能のために単独で使用することもできます。</span><span class="sxs-lookup"><span data-stu-id="48f12-110"><xref:System.Threading.SpinWait> can also be used by itself for basic spinning functionality in just one program.</span></span>  
  
 <span data-ttu-id="48f12-111"><xref:System.Threading.SpinWait> は単なる空のループではありません。</span><span class="sxs-lookup"><span data-stu-id="48f12-111"><xref:System.Threading.SpinWait> is more than just an empty loop.</span></span> <span data-ttu-id="48f12-112">一般的に、適切なスピン動作を提供するためには慎重に実装する必要があり、長時間 (おおよそ、カーネル遷移に要する時間) スピンすると、コンテキスト スイッチが開始されます。</span><span class="sxs-lookup"><span data-stu-id="48f12-112">It is carefully implemented to provide correct spinning behavior for the general case, and will itself initiate context switches if it spins long enough (roughly the length of time required for a kernel transition).</span></span> <span data-ttu-id="48f12-113">たとえば、シングルコア コンピューターでは、スピンはすべてのスレッドの進行をブロックするため、<xref:System.Threading.SpinWait> によって、スレッドのタイム スライスがすぐに生成されます。</span><span class="sxs-lookup"><span data-stu-id="48f12-113">For example, on single-core computers, <xref:System.Threading.SpinWait> yields the time slice of the thread immediately because spinning blocks forward progress on all threads.</span></span> <span data-ttu-id="48f12-114">マルチコア コンピューターでも、待機中のスレッドがより優先順位の高いスレッドやガベージ コレクターをブロックしないように、<xref:System.Threading.SpinWait> によってタイム スライスが生成されます。</span><span class="sxs-lookup"><span data-stu-id="48f12-114"><xref:System.Threading.SpinWait> also yields even on multi-core machines to prevent the waiting thread from blocking higher-priority threads or the garbage collector.</span></span> <span data-ttu-id="48f12-115">したがって、<xref:System.Threading.SpinWait> を 2 フェーズ待機操作で使用する場合は、<xref:System.Threading.SpinWait> 自体がコンテキスト スイッチを開始する前にカーネル待機を呼び出すことをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="48f12-115">Therefore, if you are using a <xref:System.Threading.SpinWait> in a two-phase wait operation, we recommend that you invoke the kernel wait before the <xref:System.Threading.SpinWait> itself initiates a context switch.</span></span> <span data-ttu-id="48f12-116"><xref:System.Threading.SpinWait> では <xref:System.Threading.SpinWait.NextSpinWillYield%2A> プロパティが提供され、<xref:System.Threading.SpinWait.SpinOnce%2A> のすべての呼び出しの前に確認できます。</span><span class="sxs-lookup"><span data-stu-id="48f12-116"><xref:System.Threading.SpinWait> provides the <xref:System.Threading.SpinWait.NextSpinWillYield%2A> property, which you can check before every call to <xref:System.Threading.SpinWait.SpinOnce%2A>.</span></span> <span data-ttu-id="48f12-117">プロパティが `true` を返したときに、独自の待機操作を開始します。</span><span class="sxs-lookup"><span data-stu-id="48f12-117">When the property returns `true`, initiate your own Wait operation.</span></span> <span data-ttu-id="48f12-118">例については、「[方法: SpinWait を使用して 2 フェーズ待機操作を実装する](how-to-use-spinwait-to-implement-a-two-phase-wait-operation.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="48f12-118">For an example, see [How to: Use SpinWait to Implement a Two-Phase Wait Operation](how-to-use-spinwait-to-implement-a-two-phase-wait-operation.md).</span></span>  
  
 <span data-ttu-id="48f12-119">2 フェーズ待機操作は実行せずに、特定の条件が満たされるまでスピンを行うだけの場合は、Windows オペレーティング システム環境で問題を発生させることなく、<xref:System.Threading.SpinWait> を有効にしてコンテキスト スイッチを実行できます。</span><span class="sxs-lookup"><span data-stu-id="48f12-119">If you are not performing a two-phase wait operation but are just spinning until some condition is true, you can enable <xref:System.Threading.SpinWait> to perform its context switches so that it is a good citizen in the Windows operating system environment.</span></span> <span data-ttu-id="48f12-120">ロックされないスタックの <xref:System.Threading.SpinWait> を次の基本的な例に示します。</span><span class="sxs-lookup"><span data-stu-id="48f12-120">The following basic example shows a <xref:System.Threading.SpinWait> in a lock-free stack.</span></span> <span data-ttu-id="48f12-121">高パフォーマンスのスレッド セーフ スタックが必要な場合は、<xref:System.Collections.Concurrent.ConcurrentStack%601?displayProperty=nameWithType> の使用を検討してください。</span><span class="sxs-lookup"><span data-stu-id="48f12-121">If you require a high-performance, thread-safe stack, consider using <xref:System.Collections.Concurrent.ConcurrentStack%601?displayProperty=nameWithType>.</span></span>  
  
 [!code-csharp[CDS_SpinWait#05](../../../samples/snippets/csharp/VS_Snippets_Misc/cds_spinwait/cs/spinwait.cs#05)]
 [!code-vb[CDS_SpinWait#05](../../../samples/snippets/visualbasic/VS_Snippets_Misc/cds_spinwait/vb/cds_spinwait1.vb#05)]  
  
## <a name="see-also"></a><span data-ttu-id="48f12-122">参照</span><span class="sxs-lookup"><span data-stu-id="48f12-122">See also</span></span>

- <xref:System.Threading.Thread.SpinWait%2A>
- [<span data-ttu-id="48f12-123">スレッド処理オブジェクトと機能</span><span class="sxs-lookup"><span data-stu-id="48f12-123">Threading Objects and Features</span></span>](threading-objects-and-features.md)
