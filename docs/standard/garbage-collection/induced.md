---
description: '詳細情報: 発生したコレクション'
title: 発生したコレクション
ms.date: 03/30/2017
helpviewer_keywords:
- garbage collection, forced
ms.assetid: 019008fe-4708-4e65-bebf-04fd9941e149
ms.openlocfilehash: c9f1929b40ed7cdb38832afebd6d0c67910ccfb7
ms.sourcegitcommit: ddf7edb67715a5b9a45e3dd44536dabc153c1de0
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 02/06/2021
ms.locfileid: "99775852"
---
# <a name="induced-collections"></a><span data-ttu-id="0a6a3-103">発生したコレクション</span><span class="sxs-lookup"><span data-stu-id="0a6a3-103">Induced Collections</span></span>

<span data-ttu-id="0a6a3-104">ほとんどの場合、コレクションの実行に最適なタイミングはガベージ コレクターが判断できるので、ガベージ コレクターに任せるのが良い方法です。</span><span class="sxs-lookup"><span data-stu-id="0a6a3-104">In most cases, the garbage collector can determine the best time to perform a collection, and you should let it run independently.</span></span> <span data-ttu-id="0a6a3-105">ただし、ごくまれに、強制的にコレクションを実行するとアプリケーションのパフォーマンスが向上する場合があります。</span><span class="sxs-lookup"><span data-stu-id="0a6a3-105">There are rare situations when a forced collection might improve your application's performance.</span></span> <span data-ttu-id="0a6a3-106">このような場合は、<xref:System.GC.Collect%2A?displayProperty=nameWithType> メソッドを使用してガベージ コレクションを強制的に実行できます。</span><span class="sxs-lookup"><span data-stu-id="0a6a3-106">In these cases, you can induce garbage collection by using the <xref:System.GC.Collect%2A?displayProperty=nameWithType> method to force a garbage collection.</span></span>  
  
 <span data-ttu-id="0a6a3-107">アプリケーションのコードの特定の位置で、使用しているメモリ量が大きく減少する場合は、<xref:System.GC.Collect%2A?displayProperty=nameWithType> メソッドを使用します。</span><span class="sxs-lookup"><span data-stu-id="0a6a3-107">Use the <xref:System.GC.Collect%2A?displayProperty=nameWithType> method when there is a significant reduction in the amount of memory being used at a specific point in your application's code.</span></span> <span data-ttu-id="0a6a3-108">たとえば、複数のコントロールのある複雑なダイアログ ボックスを使用するアプリケーションでは、ダイアログ ボックスを閉じるときに <xref:System.GC.Collect%2A> を呼び出すと、ダイアログ ボックスの使用メモリが直ちに再利用されてパフォーマンスが向上する可能性があります。</span><span class="sxs-lookup"><span data-stu-id="0a6a3-108">For example, if your application uses a complex dialog box that has several controls, calling <xref:System.GC.Collect%2A> when the dialog box is closed could improve performance by immediately reclaiming the memory used by the dialog box.</span></span> <span data-ttu-id="0a6a3-109">適切でない回数でガベージ コレクターがオブジェクトの再利用を試みるとパフォーマンスが低下する場合があるので、アプリケーションではあまり頻繁にガベージ コレクションを強制しないでください。</span><span class="sxs-lookup"><span data-stu-id="0a6a3-109">Be sure that your application is not inducing garbage collection too frequently, because that can decrease performance if the garbage collector is trying to reclaim objects at non-optimal times.</span></span> <span data-ttu-id="0a6a3-110">次のセクションで説明するように、コレクションの効果がある場合にのみ、<xref:System.GCCollectionMode.Optimized?displayProperty=nameWithType> のメソッドに対して収集する <xref:System.GC.Collect%2A> の列挙値を指定できます。</span><span class="sxs-lookup"><span data-stu-id="0a6a3-110">You can supply a <xref:System.GCCollectionMode.Optimized?displayProperty=nameWithType> enumeration value to the <xref:System.GC.Collect%2A> method to collect only when collection would be productive, as discussed in the next section.</span></span>  
  
## <a name="gc-collection-mode"></a><span data-ttu-id="0a6a3-111">GC コレクション モード</span><span class="sxs-lookup"><span data-stu-id="0a6a3-111">GC collection mode</span></span>  

 <span data-ttu-id="0a6a3-112"><xref:System.GC.Collect%2A?displayProperty=nameWithType> 値を含む <xref:System.GCCollectionMode> メソッド オーバーロードの 1 つを使用して、強制的コレクションの動作を次のように指定できます。</span><span class="sxs-lookup"><span data-stu-id="0a6a3-112">You can use one of the <xref:System.GC.Collect%2A?displayProperty=nameWithType> method overloads that includes a <xref:System.GCCollectionMode> value to specify the behavior for a forced collection as follows.</span></span>  
  
|<span data-ttu-id="0a6a3-113">`GCCollectionMode` 値</span><span class="sxs-lookup"><span data-stu-id="0a6a3-113">`GCCollectionMode` value</span></span>|<span data-ttu-id="0a6a3-114">説明</span><span class="sxs-lookup"><span data-stu-id="0a6a3-114">Description</span></span>|  
|------------------------------|-----------------|  
|<xref:System.GCCollectionMode.Default>|<span data-ttu-id="0a6a3-115">実行中のバージョンの .NET の既定のガベージ コレクション設定を使用します。</span><span class="sxs-lookup"><span data-stu-id="0a6a3-115">Uses the default garbage collection setting for the running version of .NET.</span></span>|  
|<xref:System.GCCollectionMode.Forced>|<span data-ttu-id="0a6a3-116">直ちにガベージ コレクションを強制的に実行します。</span><span class="sxs-lookup"><span data-stu-id="0a6a3-116">Forces garbage collection to occur immediately.</span></span> <span data-ttu-id="0a6a3-117">これは、<xref:System.GC.Collect?displayProperty=nameWithType> オーバーロードを呼び出すのと同じです。</span><span class="sxs-lookup"><span data-stu-id="0a6a3-117">This is equivalent to calling the <xref:System.GC.Collect?displayProperty=nameWithType> overload.</span></span> <span data-ttu-id="0a6a3-118">結果として、すべてのジェネレーションのフル ブロッキング コレクションになります。</span><span class="sxs-lookup"><span data-stu-id="0a6a3-118">It results in a full blocking collection of all generations.</span></span><br /><br /> <span data-ttu-id="0a6a3-119">また、直ちにフル ブロッキング ガベージ コレクションを強制的に実行する前に、<xref:System.Runtime.GCSettings.LargeObjectHeapCompactionMode%2A?displayProperty=nameWithType> プロパティを <xref:System.Runtime.GCLargeObjectHeapCompactionMode.CompactOnce?displayProperty=nameWithType> に設定して、大きなオブジェクト ヒープを圧縮することもできます。</span><span class="sxs-lookup"><span data-stu-id="0a6a3-119">You can also compact the large object heap by setting the <xref:System.Runtime.GCSettings.LargeObjectHeapCompactionMode%2A?displayProperty=nameWithType> property to <xref:System.Runtime.GCLargeObjectHeapCompactionMode.CompactOnce?displayProperty=nameWithType> before forcing an immediate full blocking garbage collection.</span></span>|  
|<xref:System.GCCollectionMode.Optimized>|<span data-ttu-id="0a6a3-120">オブジェクトを再利用するのに現在が最適なときかどうかをガベージ コレクターが判断できるようにします。</span><span class="sxs-lookup"><span data-stu-id="0a6a3-120">Enables the garbage collector to determine whether the current time is optimal to reclaim objects.</span></span><br /><br /> <span data-ttu-id="0a6a3-121">ガベージ コレクターは、コレクションの実行を正当化できるほど効果がないと判断して、オブジェクトを再利用せずに戻る場合があります。</span><span class="sxs-lookup"><span data-stu-id="0a6a3-121">The garbage collector could determine that a collection would not be productive enough to be justified, in which case it will return without reclaiming objects.</span></span>|  
  
## <a name="background-or-blocking-collections"></a><span data-ttu-id="0a6a3-122">バックグラウンドまたはブロッキング コレクション</span><span class="sxs-lookup"><span data-stu-id="0a6a3-122">Background or blocking collections</span></span>  

 <span data-ttu-id="0a6a3-123"><xref:System.GC.Collect%28System.Int32%2CSystem.GCCollectionMode%2CSystem.Boolean%29?displayProperty=nameWithType> メソッド オーバーロードを呼び出して、発生するコレクションがブロッキング コレクションであるかどうかを指定できます。</span><span class="sxs-lookup"><span data-stu-id="0a6a3-123">You can call the <xref:System.GC.Collect%28System.Int32%2CSystem.GCCollectionMode%2CSystem.Boolean%29?displayProperty=nameWithType> method overload to specify whether an induced collection is blocking or not.</span></span> <span data-ttu-id="0a6a3-124">実行されるコレクションの型は、メソッドの `mode` と `blocking` のパラメーターの組み合わせによって異なります。</span><span class="sxs-lookup"><span data-stu-id="0a6a3-124">The type of collection performed depends on a combination of the method's `mode` and `blocking` parameters.</span></span> <span data-ttu-id="0a6a3-125">`mode` は <xref:System.GCCollectionMode> 列挙体のメンバーです。`blocking` は <xref:System.Boolean> 値です。</span><span class="sxs-lookup"><span data-stu-id="0a6a3-125">`mode` is a member of the <xref:System.GCCollectionMode> enumeration, and `blocking` is a <xref:System.Boolean> value.</span></span> <span data-ttu-id="0a6a3-126">`mode` と `blocking` 引数の相互作用を次の表にまとめます。</span><span class="sxs-lookup"><span data-stu-id="0a6a3-126">The following table summarizes the interaction of the `mode` and `blocking` arguments.</span></span>  
  
|`mode`|`blocking` = `true`|`blocking` = `false`|  
|------------|--------------------------|---------------------------|  
|<span data-ttu-id="0a6a3-127"><xref:System.GCCollectionMode.Forced> または <xref:System.GCCollectionMode.Default></span><span class="sxs-lookup"><span data-stu-id="0a6a3-127"><xref:System.GCCollectionMode.Forced> or <xref:System.GCCollectionMode.Default></span></span>|<span data-ttu-id="0a6a3-128">ブロッキング コレクションはできるだけ早く実行されます。</span><span class="sxs-lookup"><span data-stu-id="0a6a3-128">A blocking collection is performed as soon as possible.</span></span> <span data-ttu-id="0a6a3-129">バックグラウンド コレクションが実行中でジェネレーションが 0 または 1 の場合、<xref:System.GC.Collect%28System.Int32%2CSystem.GCCollectionMode%2CSystem.Boolean%29> メソッドは直ちにブロッキング コレクションをトリガーし、コレクションが終了すると制御を戻します。</span><span class="sxs-lookup"><span data-stu-id="0a6a3-129">If a background collection is in progress and generation is 0 or 1, the <xref:System.GC.Collect%28System.Int32%2CSystem.GCCollectionMode%2CSystem.Boolean%29> method immediately triggers a blocking collection and returns when the collection is finished.</span></span> <span data-ttu-id="0a6a3-130">バックグラウンド コレクションが実行中で `generation` パラメーターが 2 の場合、メソッドはバックグラウンド コレクションの終了を待機し、ジェネレーション 2 のブロッキング コレクションをトリガーして、制御を戻します。</span><span class="sxs-lookup"><span data-stu-id="0a6a3-130">If a background collection is in progress and the `generation` parameter is 2, the method waits until the background collection is finished, triggers a blocking generation 2 collection, and then returns.</span></span>|<span data-ttu-id="0a6a3-131">コレクションはできるだけ早く実行されます。</span><span class="sxs-lookup"><span data-stu-id="0a6a3-131">A collection is performed as soon as possible.</span></span> <span data-ttu-id="0a6a3-132"><xref:System.GC.Collect%28System.Int32%2CSystem.GCCollectionMode%2CSystem.Boolean%29> メソッドはバックグラウンド コレクションを要求しますが、それは保証されず、状況によってはブロッキング コレクションが実行される場合もあります。</span><span class="sxs-lookup"><span data-stu-id="0a6a3-132">The <xref:System.GC.Collect%28System.Int32%2CSystem.GCCollectionMode%2CSystem.Boolean%29> method requests a background collection, but this is not guaranteed; depending on the circumstances, a blocking collection may still be performed.</span></span> <span data-ttu-id="0a6a3-133">バックグラウンド コレクションが既に実行中の場合、メソッドはすぐに制御を返します。</span><span class="sxs-lookup"><span data-stu-id="0a6a3-133">If a background collection is already in progress, the method returns immediately.</span></span>|  
|<xref:System.GCCollectionMode.Optimized>|<span data-ttu-id="0a6a3-134">ガベージ コレクターおよび `generation` パラメーターの状態によっては、ブロッキング コレクションが実行される場合があります。</span><span class="sxs-lookup"><span data-stu-id="0a6a3-134">A blocking collection may be performed, depending on the state of the garbage collector and the `generation` parameter.</span></span> <span data-ttu-id="0a6a3-135">ガベージ コレクターは最適なパフォーマンスを提供しようとします。</span><span class="sxs-lookup"><span data-stu-id="0a6a3-135">The garbage collector tries to provide optimal performance.</span></span>|<span data-ttu-id="0a6a3-136">ガベージ コレクターの状態によっては、コレクションが実行される場合があります。</span><span class="sxs-lookup"><span data-stu-id="0a6a3-136">A collection may be performed, depending on the state of the garbage collector.</span></span> <span data-ttu-id="0a6a3-137"><xref:System.GC.Collect%28System.Int32%2CSystem.GCCollectionMode%2CSystem.Boolean%29> メソッドはバックグラウンド コレクションを要求しますが、それは保証されず、状況によってはブロッキング コレクションが実行される場合もあります。</span><span class="sxs-lookup"><span data-stu-id="0a6a3-137">The <xref:System.GC.Collect%28System.Int32%2CSystem.GCCollectionMode%2CSystem.Boolean%29> method requests a background collection, but this is not guaranteed; depending on the circumstances, a blocking collection may still be performed.</span></span> <span data-ttu-id="0a6a3-138">ガベージ コレクターは最適なパフォーマンスを提供しようとします。</span><span class="sxs-lookup"><span data-stu-id="0a6a3-138">The garbage collector tries to provide optimal performance.</span></span> <span data-ttu-id="0a6a3-139">バックグラウンド コレクションが既に実行中の場合、メソッドはすぐに制御を返します。</span><span class="sxs-lookup"><span data-stu-id="0a6a3-139">If a background collection is already in progress, the method returns immediately.</span></span>|  
  
## <a name="see-also"></a><span data-ttu-id="0a6a3-140">関連項目</span><span class="sxs-lookup"><span data-stu-id="0a6a3-140">See also</span></span>

- [<span data-ttu-id="0a6a3-141">待機モード</span><span class="sxs-lookup"><span data-stu-id="0a6a3-141">Latency Modes</span></span>](latency.md)
- [<span data-ttu-id="0a6a3-142">ガベージ コレクション</span><span class="sxs-lookup"><span data-stu-id="0a6a3-142">Garbage Collection</span></span>](index.md)
