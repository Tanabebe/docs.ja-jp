---
title: .NET での書式付きデータの表示と保持に関するベスト プラクティス
description: .NET アプリケーションで数値と日付のデータを効果的に表示および保持する方法について説明します。
ms.date: 05/01/2019
ms.topic: conceptual
dev_langs:
- csharp
- vb
ms.openlocfilehash: dd2e85ed695072da24b6b25b187810a109b89b25
ms.sourcegitcommit: 4313614f57690f9a5119a37314f0a1fd738ebda2
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 01/22/2021
ms.locfileid: "98693125"
---
# <a name="best-practices-for-displaying-and-persisting-formatted-data"></a><span data-ttu-id="4dfb7-103">書式付きデータの表示と保持に関するベスト プラクティス</span><span class="sxs-lookup"><span data-stu-id="4dfb7-103">Best practices for displaying and persisting formatted data</span></span>

<span data-ttu-id="4dfb7-104">この記事では、数値データや日時データなどの書式付きデータを、表示および格納のために処理する方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="4dfb7-104">This article examines how formatted data, such as numeric data and date-and-time data, is handled for display and for storage.</span></span>

<span data-ttu-id="4dfb7-105">.NET で開発するとき、数値、日付など、文字列以外のデータをユーザー インターフェイスに表示するには、カルチャに依存する書式設定を使用します。</span><span class="sxs-lookup"><span data-stu-id="4dfb7-105">When you develop with .NET, use culture-sensitive formatting to display non-string data, such as numbers and dates, in a user interface.</span></span> <span data-ttu-id="4dfb7-106">文字列以外のデータを文字列形式で保持するには、[インバリアント カルチャ](xref:System.Globalization.CultureInfo.InvariantCulture)を使用する書式設定を使用します。</span><span class="sxs-lookup"><span data-stu-id="4dfb7-106">Use formatting with the [invariant culture](xref:System.Globalization.CultureInfo.InvariantCulture) to persist non-string data in string form.</span></span> <span data-ttu-id="4dfb7-107">数値データや日時データを文字列形式で保持する場合は、カルチャに依存する書式設定を使用しないでください。</span><span class="sxs-lookup"><span data-stu-id="4dfb7-107">Do not use culture-sensitive formatting to persist numeric or date-and-time data in string form.</span></span>

## <a name="displaying-formatted-data"></a><span data-ttu-id="4dfb7-108">書式付きデータの表示</span><span class="sxs-lookup"><span data-stu-id="4dfb7-108">Displaying formatted data</span></span>

<span data-ttu-id="4dfb7-109">数値、日時など、文字列以外のデータをユーザーに表示するには、ユーザーのカルチャ設定を使用して書式設定します。</span><span class="sxs-lookup"><span data-stu-id="4dfb7-109">When you display non-string data such as numbers and dates and times to users, format them by using the user's cultural settings.</span></span> <span data-ttu-id="4dfb7-110">既定では、以下のすべてで、書式設定操作での現在のスレッド カルチャが使用されます。</span><span class="sxs-lookup"><span data-stu-id="4dfb7-110">By default, the following all use the current thread culture in formatting operations:</span></span>

- <span data-ttu-id="4dfb7-111">[C#](../../csharp/language-reference/tokens/interpolated.md) と [Visual Basic](../../visual-basic/programming-guide/language-features/strings/interpolated-strings.md) のコンパイラでサポートされている挿入文字列。</span><span class="sxs-lookup"><span data-stu-id="4dfb7-111">Interpolated strings supported by the [C#](../../csharp/language-reference/tokens/interpolated.md) and [Visual Basic](../../visual-basic/programming-guide/language-features/strings/interpolated-strings.md) compilers.</span></span>
- <span data-ttu-id="4dfb7-112">[C#](../../csharp/language-reference/operators/addition-operator.md#string-concatenation) または [Visual Basic](../../visual-basic/programming-guide/language-features/operators-and-expressions/concatenation-operators.md) の連結演算子を使用または <xref:System.String.Concat%2A?displayProperty=nameWithType> メソッドを直接呼び出す文字列連結操作。</span><span class="sxs-lookup"><span data-stu-id="4dfb7-112">String concatenation operations that use the [C#](../../csharp/language-reference/operators/addition-operator.md#string-concatenation) or [Visual Basic](../../visual-basic/programming-guide/language-features/operators-and-expressions/concatenation-operators.md) concatenation operators or that call the <xref:System.String.Concat%2A?displayProperty=nameWithType> method directly.</span></span>
- <span data-ttu-id="4dfb7-113"><xref:System.String.Format%2A?displayProperty=nameWithType> メソッド。</span><span class="sxs-lookup"><span data-stu-id="4dfb7-113">The <xref:System.String.Format%2A?displayProperty=nameWithType> method.</span></span>
- <span data-ttu-id="4dfb7-114">数値型と日時型の `ToString` メソッド。</span><span class="sxs-lookup"><span data-stu-id="4dfb7-114">The `ToString` methods of the numeric types and the date and time types.</span></span>

<span data-ttu-id="4dfb7-115">指定されたカルチャまたは[インバリアント カルチャ](xref:System.Globalization.CultureInfo.InvariantCulture)の規則を使用することで文字列を書式設定することを明示的に指定するには、次を行うことができます。</span><span class="sxs-lookup"><span data-stu-id="4dfb7-115">To explicitly specify that a string should be formatted by using the conventions of a designated culture or the [invariant culture](xref:System.Globalization.CultureInfo.InvariantCulture), you can do the following:</span></span>

- <span data-ttu-id="4dfb7-116"><xref:System.String.Format%2A?displayProperty=nameWithType> メソッドと `ToString` メソッドを使用している場合、`provider` パラメーター (<xref:System.String.Format%28System.IFormatProvider%2CSystem.String%2CSystem.Object%5B%5D%29?displayProperty=nameWithType> または <xref:System.DateTime.ToString%28System.IFormatProvider%29?displayProperty=nameWithType> など) を持つオーバー ロードを呼び出し、それに <xref:System.Globalization.CultureInfo.CurrentCulture%2A?displayProperty=nameWithType> プロパティ、目的のカルチャを表す <xref:System.Globalization.CultureInfo> インスタンス、または <xref:System.Globalization.CultureInfo.InvariantCulture?displayProperty=nameWithType> プロパティを渡します。</span><span class="sxs-lookup"><span data-stu-id="4dfb7-116">When using the <xref:System.String.Format%2A?displayProperty=nameWithType> and `ToString` methods, call an overload that has a `provider` parameter, such as <xref:System.String.Format%28System.IFormatProvider%2CSystem.String%2CSystem.Object%5B%5D%29?displayProperty=nameWithType> or <xref:System.DateTime.ToString%28System.IFormatProvider%29?displayProperty=nameWithType>, and pass it the <xref:System.Globalization.CultureInfo.CurrentCulture%2A?displayProperty=nameWithType> property, a <xref:System.Globalization.CultureInfo> instance that represents the desired culture, or the <xref:System.Globalization.CultureInfo.InvariantCulture?displayProperty=nameWithType> property.</span></span>

- <span data-ttu-id="4dfb7-117">文字列連結の場合、コンパイラに暗黙の変換の実行を許可しないでください。</span><span class="sxs-lookup"><span data-stu-id="4dfb7-117">For string concatenation, do not allow the compiler to perform any implicit conversions.</span></span> <span data-ttu-id="4dfb7-118">代わりに、`provider` パラメーターを持つ `ToString` オーバーロードを呼び出すことで、明示的な変換を実行します。</span><span class="sxs-lookup"><span data-stu-id="4dfb7-118">Instead, perform an explicit conversion by calling a `ToString` overload that has a `provider` parameter.</span></span> <span data-ttu-id="4dfb7-119">たとえば、次のコードでは、<xref:System.Double> 値を文字列に変換するときに、コンパイラでは現在のカルチャが暗黙的に使用されます。</span><span class="sxs-lookup"><span data-stu-id="4dfb7-119">For example, the compiler implicitly uses the current culture when converting a <xref:System.Double> value to a string in the following code:</span></span>

  [!code-csharp[Implicit String Conversion](./snippets/best-practices-strings/csharp/tostring/Program.cs#1)]
  [!code-vb[Implicit String Conversion](./snippets/best-practices-strings/vb/tostring/Program.vb#1)]

  <span data-ttu-id="4dfb7-120">代わりに、次のコードのように、<xref:System.Double.ToString(System.IFormatProvider)?displayProperty=nameWithType> メソッドを呼び出して、変換に使用する書式指定規則を持つカルチャを明示的に指定することができます。</span><span class="sxs-lookup"><span data-stu-id="4dfb7-120">Instead, you can explicitly specify the culture whose formatting conventions are used in the conversion by calling the <xref:System.Double.ToString(System.IFormatProvider)?displayProperty=nameWithType> method, as the following code does:</span></span>

  [!code-csharp[Explicit String Conversion](./snippets/best-practices-strings/csharp/tostring/Program.cs#2)]
  [!code-vb[Implicit String Conversion](./snippets/best-practices-strings/vb/tostring/Program.vb#2)]

- <span data-ttu-id="4dfb7-121">文字列補間の場合、挿入文字列を <xref:System.String> インスタンスに割り当てるのではなく、<xref:System.FormattableString> に割り当てます。</span><span class="sxs-lookup"><span data-stu-id="4dfb7-121">For string interpolation, rather than assigning an interpolated string to a <xref:System.String> instance, assign it to a <xref:System.FormattableString>.</span></span> <span data-ttu-id="4dfb7-122">その後、その <xref:System.FormattableString.ToString?displayProperty=nameWithType> メソッドを呼び出して、現在のカルチャの規則を反映する結果の文字列を生成することも、<xref:System.FormattableString.ToString(System.IFormatProvider)?displayProperty=nameWithType> メソッドを呼び出して、指定したカルチャの規則を反映する結果の文字列を生成することもできます。</span><span class="sxs-lookup"><span data-stu-id="4dfb7-122">You can then call its <xref:System.FormattableString.ToString?displayProperty=nameWithType> method produce a result string that reflects the conventions of the current culture, or you can call the <xref:System.FormattableString.ToString(System.IFormatProvider)?displayProperty=nameWithType> method to produce a result string that reflects the conventions of a specified culture.</span></span> <span data-ttu-id="4dfb7-123">また、書式設定可能な文字列を静的 <xref:System.FormattableString.Invariant%2A?displayProperty=nameWithType> メソッドに渡して、インバリアント カルチャの規則を反映する結果の文字列を生成することもできます。</span><span class="sxs-lookup"><span data-stu-id="4dfb7-123">You can also pass the formattable string to the static <xref:System.FormattableString.Invariant%2A?displayProperty=nameWithType> method to produce a result string that reflects the conventions of the invariant culture.</span></span> <span data-ttu-id="4dfb7-124">このアプローチの例を次に示します。</span><span class="sxs-lookup"><span data-stu-id="4dfb7-124">The following example illustrates this approach.</span></span> <span data-ttu-id="4dfb7-125">(この例の出力には en-US の現在のカルチャが反映されます)。</span><span class="sxs-lookup"><span data-stu-id="4dfb7-125">(The output from the example reflects a current culture of en-US.)</span></span>

  [!code-csharp[String interpolation](./snippets/best-practices-strings/csharp/formattable/Program.cs)]
  [!code-vb[String interpolation](./snippets/best-practices-strings/vb/formattable/Program.vb)]

## <a name="persisting-formatted-data"></a><span data-ttu-id="4dfb7-126">書式付きデータの保持</span><span class="sxs-lookup"><span data-stu-id="4dfb7-126">Persisting formatted data</span></span>

<span data-ttu-id="4dfb7-127">文字列以外のデータは、バイナリ データまたは書式付きデータとして保持できます。</span><span class="sxs-lookup"><span data-stu-id="4dfb7-127">You can persist non-string data either as binary data or as formatted data.</span></span> <span data-ttu-id="4dfb7-128">書式付きデータとして保存するには、`provider` パラメーターを含む書式指定メソッドのオーバーロードを呼び出し、そのパラメーターを <xref:System.Globalization.CultureInfo.InvariantCulture%2A?displayProperty=nameWithType> プロパティに渡す必要があります。</span><span class="sxs-lookup"><span data-stu-id="4dfb7-128">If you choose to save it as formatted data, you should call a formatting method overload that includes a `provider` parameter and pass it the <xref:System.Globalization.CultureInfo.InvariantCulture%2A?displayProperty=nameWithType> property.</span></span> <span data-ttu-id="4dfb7-129">インバリアント カルチャは、カルチャとコンピューターに依存しない書式付きデータに一貫した書式を提供します。</span><span class="sxs-lookup"><span data-stu-id="4dfb7-129">The invariant culture provides a consistent format for formatted data that is independent of culture and machine.</span></span> <span data-ttu-id="4dfb7-130">これに対し、インバリアント カルチャ以外のカルチャを使用して書式設定するデータの保持には、さまざまな制限があります。</span><span class="sxs-lookup"><span data-stu-id="4dfb7-130">In contrast, persisting data that is formatted by using cultures other than the invariant culture has a number of limitations:</span></span>

- <span data-ttu-id="4dfb7-131">カルチャが異なるシステムでデータを取得したり、現在のシステムのユーザーが現在のカルチャを変更してデータを取得しようとしたりすると、そのデータは使用できない可能性があります。</span><span class="sxs-lookup"><span data-stu-id="4dfb7-131">The data is likely to be unusable if it is retrieved on a system that has a different culture, or if the user of the current system changes the current culture and tries to retrieve the data.</span></span>
- <span data-ttu-id="4dfb7-132">特定のコンピューターのカルチャのプロパティは、その標準の値とは異なる場合があります。</span><span class="sxs-lookup"><span data-stu-id="4dfb7-132">The properties of a culture on a specific computer can differ from standard values.</span></span> <span data-ttu-id="4dfb7-133">常に、ユーザーはカルチャに依存した表示設定をカスタマイズする可能性があります。</span><span class="sxs-lookup"><span data-stu-id="4dfb7-133">At any time, a user can customize culture-sensitive display settings.</span></span> <span data-ttu-id="4dfb7-134">このため、ユーザーがカルチャの設定をカスタマイズすると、システムに保存されている書式付きデータを読み取ることができなくなる場合があります。</span><span class="sxs-lookup"><span data-stu-id="4dfb7-134">Because of this, formatted data that is saved on a system may not be readable after the user customizes cultural settings.</span></span> <span data-ttu-id="4dfb7-135">コンピューター間の書式付きデータの移植性がさらに制限される可能性があります。</span><span class="sxs-lookup"><span data-stu-id="4dfb7-135">The portability of formatted data across computers is likely to be even more limited.</span></span>
- <span data-ttu-id="4dfb7-136">数値や日時の書式設定を制御する国際的、地域的、または国内の標準は時間と共に変化するため、これらの変化は Windows オペレーティング システムの更新プログラムに組み込まれています。</span><span class="sxs-lookup"><span data-stu-id="4dfb7-136">International, regional, or national standards that govern the formatting of numbers or dates and times change over time, and these changes are incorporated into Windows operating system updates.</span></span> <span data-ttu-id="4dfb7-137">書式設定の規則が変わると、以前の規則に従って書式設定されたデータを読み取ることができなくなる場合があります。</span><span class="sxs-lookup"><span data-stu-id="4dfb7-137">When formatting conventions change, data that was formatted by using the previous conventions may become unreadable.</span></span>

<span data-ttu-id="4dfb7-138">次に、カルチャに依存する書式設定を使用してデータを保持すると移植性が制限される例を示します。</span><span class="sxs-lookup"><span data-stu-id="4dfb7-138">The following example illustrates the limited portability that results from using culture-sensitive formatting to persist data.</span></span> <span data-ttu-id="4dfb7-139">この例では、日時の値の配列をファイルに保存します。</span><span class="sxs-lookup"><span data-stu-id="4dfb7-139">The example saves an array of date and time values to a file.</span></span> <span data-ttu-id="4dfb7-140">これらは、英語 (米国) のカルチャの規則を使用して書式設定されています。</span><span class="sxs-lookup"><span data-stu-id="4dfb7-140">These are formatted by using the conventions of the English (United States) culture.</span></span> <span data-ttu-id="4dfb7-141">現在のスレッド カルチャがフランス語 (スイス) に変更されると、アプリケーションは現在のカルチャの書式設定規則を使用して保存された値を読み取ることを試みます。</span><span class="sxs-lookup"><span data-stu-id="4dfb7-141">After the application changes the current thread culture to French (Switzerland), it tries to read the saved values by using the formatting conventions of the current culture.</span></span> <span data-ttu-id="4dfb7-142">2 つのデータ項目の読み取りを試みると、<xref:System.FormatException> 例外がスローされます。日付の配列には、<xref:System.DateTime.MinValue> に等しい 2 つの間違った要素が含まれることになります。</span><span class="sxs-lookup"><span data-stu-id="4dfb7-142">The attempt to read two of the data items throws a <xref:System.FormatException> exception, and the array of dates now contains two incorrect elements that are equal to <xref:System.DateTime.MinValue>.</span></span>

[!code-csharp[Conceptual.Strings.BestPractices#21](~/samples/snippets/csharp/VS_Snippets_CLR/conceptual.strings.bestpractices/cs/persistence.cs#21)]
[!code-vb[Conceptual.Strings.BestPractices#21](~/samples/snippets/visualbasic/VS_Snippets_CLR/conceptual.strings.bestpractices/vb/persistence.vb#21)]

<span data-ttu-id="4dfb7-143">しかし、<xref:System.DateTime.ToString%28System.String%2CSystem.IFormatProvider%29?displayProperty=nameWithType> および <xref:System.DateTime.Parse%28System.String%2CSystem.IFormatProvider%29?displayProperty=nameWithType> の呼び出しで、<xref:System.Globalization.CultureInfo.CurrentCulture%2A?displayProperty=nameWithType> プロパティを <xref:System.Globalization.CultureInfo.InvariantCulture%2A?displayProperty=nameWithType> に置き換えると、保持されている日時データは正常に復元されます。次にその出力を示します。</span><span class="sxs-lookup"><span data-stu-id="4dfb7-143">However, if you replace the <xref:System.Globalization.CultureInfo.CurrentCulture%2A?displayProperty=nameWithType> property with <xref:System.Globalization.CultureInfo.InvariantCulture%2A?displayProperty=nameWithType> in the calls to <xref:System.DateTime.ToString%28System.String%2CSystem.IFormatProvider%29?displayProperty=nameWithType> and <xref:System.DateTime.Parse%28System.String%2CSystem.IFormatProvider%29?displayProperty=nameWithType>, the persisted date and time data is successfully restored, as the following output shows:</span></span>

```console
06.05.1758 21:26
05.05.1818 07:19
22.04.1870 23:54
08.09.1890 06:47
18.02.1905 15:12
```
