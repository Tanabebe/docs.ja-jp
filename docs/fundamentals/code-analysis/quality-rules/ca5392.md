---
title: 'CA5392: P/Invoke に対して DefaultDllImportSearchPaths 属性を使用します (コード分析)'
description: コード分析規則 CA5392 に関する情報を提供します。これには、原因、違反の修正方法、およびそれを抑制するタイミングなどが含まれます。
ms.date: 05/28/2020
ms.topic: reference
author: LLLXXXCCC
ms.author: linche
f1_keywords:
- CA5392
ms.openlocfilehash: e9b7588fc2e0805782aa923409e135ae0a774688
ms.sourcegitcommit: 05d0087dfca85aac9ca2960f86c5efd218bf833f
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/30/2021
ms.locfileid: "99769365"
---
# <a name="ca5392-use-defaultdllimportsearchpaths-attribute-for-pinvokes"></a><span data-ttu-id="86d49-103">CA5392: P/Invoke に対して DefaultDllImportSearchPaths 属性を使用します</span><span class="sxs-lookup"><span data-stu-id="86d49-103">CA5392: Use DefaultDllImportSearchPaths attribute for P/Invokes</span></span>

| | <span data-ttu-id="86d49-104">値</span><span class="sxs-lookup"><span data-stu-id="86d49-104">Value</span></span> |
|-|-|
| <span data-ttu-id="86d49-105">**ルール ID**</span><span class="sxs-lookup"><span data-stu-id="86d49-105">**Rule ID**</span></span> |<span data-ttu-id="86d49-106">CA5392</span><span class="sxs-lookup"><span data-stu-id="86d49-106">CA5392</span></span>|
| <span data-ttu-id="86d49-107">**カテゴリ**</span><span class="sxs-lookup"><span data-stu-id="86d49-107">**Category**</span></span> |[<span data-ttu-id="86d49-108">Security</span><span class="sxs-lookup"><span data-stu-id="86d49-108">Security</span></span>](security-warnings.md)|
| <span data-ttu-id="86d49-109">**修正が中断か中断なしであるか**</span><span class="sxs-lookup"><span data-stu-id="86d49-109">**Fix is breaking or non-breaking**</span></span> |<span data-ttu-id="86d49-110">なし</span><span class="sxs-lookup"><span data-stu-id="86d49-110">Non-breaking</span></span>|

## <a name="cause"></a><span data-ttu-id="86d49-111">原因</span><span class="sxs-lookup"><span data-stu-id="86d49-111">Cause</span></span>

<span data-ttu-id="86d49-112"><xref:System.Runtime.InteropServices.DefaultDllImportSearchPathsAttribute> が [プラットフォーム呼び出し (P/Invoke)](../../../standard/native-interop/pinvoke.md) 関数に対して指定されていません。</span><span class="sxs-lookup"><span data-stu-id="86d49-112">The <xref:System.Runtime.InteropServices.DefaultDllImportSearchPathsAttribute> is not specified for a [Platform Invoke (P/Invoke)](../../../standard/native-interop/pinvoke.md) function.</span></span>

## <a name="rule-description"></a><span data-ttu-id="86d49-113">規則の説明</span><span class="sxs-lookup"><span data-stu-id="86d49-113">Rule description</span></span>

<span data-ttu-id="86d49-114">既定では、<xref:System.Runtime.InteropServices.DllImportAttribute> を使用している P/Invoke 関数では、ライブラリが読み込むための現在の作業ディレクトリを含むいくつかのディレクトリを精査します。</span><span class="sxs-lookup"><span data-stu-id="86d49-114">By default, P/Invoke functions using <xref:System.Runtime.InteropServices.DllImportAttribute> probe a number of directories, including the current working directory for the library to load.</span></span> <span data-ttu-id="86d49-115">これは特定のアプリケーションでセキュリティ上の問題を引き起こし、DLL のハイジャックにつながる可能性があります。</span><span class="sxs-lookup"><span data-stu-id="86d49-115">This can be a security issue for certain applications, leading to DLL hijacking.</span></span>

<span data-ttu-id="86d49-116">たとえば、インポートされた DLL と同じ名前の悪意のある DLL が、既定で最初に検索される現在の作業ディレクトリの下に置かれている場合、悪意のある DLL が読み込まれる可能性があります。</span><span class="sxs-lookup"><span data-stu-id="86d49-116">For example, if a malicious DLL with the same name as the imported one is placed under the current working directory, which will be searched firstly by default, then the malicious DLL could be loaded.</span></span>

<span data-ttu-id="86d49-117">詳細については、[ライブラリの安全な読み込み](https://msrc-blog.microsoft.com/2014/05/13/load-library-safely/)に関するページを参照してください。</span><span class="sxs-lookup"><span data-stu-id="86d49-117">For more information, see [Load Library Safely](https://msrc-blog.microsoft.com/2014/05/13/load-library-safely/).</span></span>

## <a name="how-to-fix-violations"></a><span data-ttu-id="86d49-118">違反の修正方法</span><span class="sxs-lookup"><span data-stu-id="86d49-118">How to fix violations</span></span>

<span data-ttu-id="86d49-119"><xref:System.Runtime.InteropServices.DefaultDllImportSearchPathsAttribute> を使用して、アセンブリまたはメソッドに対して DLL 検索パスを明示的に指定します。</span><span class="sxs-lookup"><span data-stu-id="86d49-119">Use <xref:System.Runtime.InteropServices.DefaultDllImportSearchPathsAttribute> to specify the DLL search path explicitly for the assembly or the method.</span></span>

## <a name="when-to-suppress-warnings"></a><span data-ttu-id="86d49-120">どのようなときに警告を抑制するか</span><span class="sxs-lookup"><span data-stu-id="86d49-120">When to suppress warnings</span></span>

<span data-ttu-id="86d49-121">次の場合は、この規則を抑制できます。</span><span class="sxs-lookup"><span data-stu-id="86d49-121">It's safe to suppress this rule if:</span></span>

- <span data-ttu-id="86d49-122">読み込まれたアセンブリが必要なものだとわかっている。</span><span class="sxs-lookup"><span data-stu-id="86d49-122">You're sure the loaded assembly is what you want.</span></span> <span data-ttu-id="86d49-123">アプリケーションが信頼できるサーバーで実行され、ファイルを完全に信頼できる場合など。</span><span class="sxs-lookup"><span data-stu-id="86d49-123">For example, your application runs on a trusted server and you completely trust the files.</span></span>
- <span data-ttu-id="86d49-124">インポートされたアセンブリが、user32.dll のような一般的に使用されるシステム アセンブリであり、検索パス戦略が [Known DLLs メカニズム](/archive/blogs/larryosterman/what-are-known-dlls-anyway)に従っている。</span><span class="sxs-lookup"><span data-stu-id="86d49-124">The imported assembly is a commonly used system assembly, like user32.dll, and the search path strategy follows the [Known DLLs mechanism](/archive/blogs/larryosterman/what-are-known-dlls-anyway).</span></span>

## <a name="pseudo-code-examples"></a><span data-ttu-id="86d49-125">疑似コードの例</span><span class="sxs-lookup"><span data-stu-id="86d49-125">Pseudo-code examples</span></span>

```csharp
using System;
using System.Runtime.InteropServices;

class ExampleClass
{
    [DllImport("The3rdAssembly.dll")]
    public static extern int MessageBox(IntPtr hWnd, String text, String caption, uint type);

    public void ExampleMethod()
    {
        MessageBox(new IntPtr(0), "Hello World!", "Hello Dialog", 0);
    }
}
```

### <a name="solution"></a><span data-ttu-id="86d49-126">解決策</span><span class="sxs-lookup"><span data-stu-id="86d49-126">Solution</span></span>

```csharp
using System;
using System.Runtime.InteropServices;

class ExampleClass
{
    [DllImport("The3rdAssembly.dll")]
    [DefaultDllImportSearchPaths(DllImportSearchPath.UserDirectories)]
    public static extern int MessageBox(IntPtr hWnd, String text, String caption, uint type);

    public void ExampleMethod()
    {
        MessageBox(new IntPtr(0), "Hello World!", "Hello Dialog", 0);
    }
}
```

## <a name="related-rules"></a><span data-ttu-id="86d49-127">関連規則</span><span class="sxs-lookup"><span data-stu-id="86d49-127">Related rules</span></span>

[<span data-ttu-id="86d49-128">CA5393: 安全でない DllImportSearchPath 値を使用しないでください</span><span class="sxs-lookup"><span data-stu-id="86d49-128">CA5393: Do not use unsafe DllImportSearchPath value</span></span>](ca5393.md)
