---
title: 'CA2012: ValueTasks を正しく使用する (コード分析)'
description: 'コード分析規則「CA2012: ValueTasks を正しく使用する」について'
ms.date: 06/18/2020
ms.topic: reference
f1_keywords:
- UseValueTasksCorrectly
- CA2012
helpviewer_keywords:
- UseValueTasksCorrectly
- CA2012
author: stephentoub
ms.author: stoub
ms.openlocfilehash: e6bf3b099ce31e72027b9b749aefcd4a11b1f470
ms.sourcegitcommit: 05d0087dfca85aac9ca2960f86c5efd218bf833f
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/30/2021
ms.locfileid: "99754746"
---
# <a name="ca2012-use-valuetasks-correctly"></a><span data-ttu-id="1d5a0-103">CA2012: ValueTask を正しく使用する必要があります</span><span class="sxs-lookup"><span data-stu-id="1d5a0-103">CA2012: Use ValueTasks correctly</span></span>

| | <span data-ttu-id="1d5a0-104">値</span><span class="sxs-lookup"><span data-stu-id="1d5a0-104">Value</span></span> |
|-|-|
| <span data-ttu-id="1d5a0-105">**ルール ID**</span><span class="sxs-lookup"><span data-stu-id="1d5a0-105">**Rule ID**</span></span> |<span data-ttu-id="1d5a0-106">CA2012</span><span class="sxs-lookup"><span data-stu-id="1d5a0-106">CA2012</span></span>|
| <span data-ttu-id="1d5a0-107">**カテゴリ**</span><span class="sxs-lookup"><span data-stu-id="1d5a0-107">**Category**</span></span> |[<span data-ttu-id="1d5a0-108">信頼性</span><span class="sxs-lookup"><span data-stu-id="1d5a0-108">Reliability</span></span>](reliability-warnings.md)|
| <span data-ttu-id="1d5a0-109">**修正が中断か中断なしであるか**</span><span class="sxs-lookup"><span data-stu-id="1d5a0-109">**Fix is breaking or non-breaking**</span></span> |<span data-ttu-id="1d5a0-110">なし</span><span class="sxs-lookup"><span data-stu-id="1d5a0-110">Non-breaking</span></span>|

## <a name="cause"></a><span data-ttu-id="1d5a0-111">原因</span><span class="sxs-lookup"><span data-stu-id="1d5a0-111">Cause</span></span>

<span data-ttu-id="1d5a0-112">メンバーの呼び出しから返された <xref:System.Threading.Tasks.ValueTask> インスタンスが、例外、破損、またはパフォーマンスの低下を招く可能性のある方法で使用されています。</span><span class="sxs-lookup"><span data-stu-id="1d5a0-112">A <xref:System.Threading.Tasks.ValueTask> instance returned from a member invocation is used in a way that could lead to exceptions, corruption, or poor performance.</span></span>

## <a name="rule-description"></a><span data-ttu-id="1d5a0-113">規則の説明</span><span class="sxs-lookup"><span data-stu-id="1d5a0-113">Rule description</span></span>

<span data-ttu-id="1d5a0-114">メンバーの呼び出しから返される <xref:System.Threading.Tasks.ValueTask> インスタンスは、直接待機する必要があります。</span><span class="sxs-lookup"><span data-stu-id="1d5a0-114"><xref:System.Threading.Tasks.ValueTask> instances returned from member invocations are intended to be directly awaited.</span></span>  <span data-ttu-id="1d5a0-115">ValueTask を複数回使用しようとするか、完了が判明する前に結果に直接アクセスしようとすると、例外または破損が発生する可能性があります。</span><span class="sxs-lookup"><span data-stu-id="1d5a0-115">Attempts to consume a ValueTask multiple times or to directly access one's result before it's known to be completed may result in an exception or corruption.</span></span>  <span data-ttu-id="1d5a0-116">このような ValueTask を無視することは、機能的なバグを示していることが多く、パフォーマンスを低下させる可能性があります。</span><span class="sxs-lookup"><span data-stu-id="1d5a0-116">Ignoring such a ValueTask is likely an indication of a functional bug and may degrade performance.</span></span>

## <a name="how-to-fix-violations"></a><span data-ttu-id="1d5a0-117">違反の修正方法</span><span class="sxs-lookup"><span data-stu-id="1d5a0-117">How to fix violations</span></span>

<span data-ttu-id="1d5a0-118">通常、ValueTasks は、破棄したり、ローカル変数やフィールドなどの他の場所に格納したりせずに、直接待機する必要があります。</span><span class="sxs-lookup"><span data-stu-id="1d5a0-118">In general, ValueTasks should be directly awaited rather than discarded or stored into other locations like local variables or fields.</span></span>

## <a name="when-to-suppress-warnings"></a><span data-ttu-id="1d5a0-119">どのようなときに警告を抑制するか</span><span class="sxs-lookup"><span data-stu-id="1d5a0-119">When to suppress warnings</span></span>

<span data-ttu-id="1d5a0-120">任意のメンバー呼び出しから返される ValueTasks の場合、呼び出し元は、Valuetasks を 1 回しか使用できないことを想定している (つまり直接待機している) 必要があります。</span><span class="sxs-lookup"><span data-stu-id="1d5a0-120">For ValueTasks returned from arbitrary member calls, the caller needs to assume that the ValueTask must be consumed (e.g. awaited) once and only once.</span></span>  <span data-ttu-id="1d5a0-121">ただし、開発者が呼び出されているメンバーを制御し、その実装について完全な知識を有している場合、その開発者は、戻り値の ValueTask が常に <xref:System.Threading.Tasks.Task> オブジェクトをラップしている場合など、警告を抑制しても安全であると認識する場合があります。</span><span class="sxs-lookup"><span data-stu-id="1d5a0-121">However, if the developer also controls the member being invoked and has complete knowledge of its implementation, the developer may know it's safe to suppress the warning, for example, if the return ValueTask always wraps a <xref:System.Threading.Tasks.Task> object.</span></span>

## <a name="see-also"></a><span data-ttu-id="1d5a0-122">関連項目</span><span class="sxs-lookup"><span data-stu-id="1d5a0-122">See also</span></span>

- [<span data-ttu-id="1d5a0-123">信頼性の規則</span><span class="sxs-lookup"><span data-stu-id="1d5a0-123">Reliability rules</span></span>](reliability-warnings.md)
