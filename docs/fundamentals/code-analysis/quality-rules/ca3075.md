---
title: 'CA3075: 安全ではない DTD の処理 (コード分析)'
description: 'コード分析規則「CA3075: 安全ではない DTD の処理」について'
ms.date: 03/18/2019
ms.topic: reference
author: gewarren
ms.author: gewarren
ms.openlocfilehash: 9e48a4e7594b7f04c14510f509b46646786119db
ms.sourcegitcommit: 05d0087dfca85aac9ca2960f86c5efd218bf833f
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/30/2021
ms.locfileid: "99787631"
---
# <a name="ca3075-insecure-dtd-processing"></a><span data-ttu-id="f21b0-103">CA3075:安全ではない DTD の処理</span><span class="sxs-lookup"><span data-stu-id="f21b0-103">CA3075: Insecure DTD Processing</span></span>

| | <span data-ttu-id="f21b0-104">値</span><span class="sxs-lookup"><span data-stu-id="f21b0-104">Value</span></span> |
|-|-|
| <span data-ttu-id="f21b0-105">**ルール ID**</span><span class="sxs-lookup"><span data-stu-id="f21b0-105">**Rule ID**</span></span> |<span data-ttu-id="f21b0-106">CA3075</span><span class="sxs-lookup"><span data-stu-id="f21b0-106">CA3075</span></span>|
| <span data-ttu-id="f21b0-107">**カテゴリ**</span><span class="sxs-lookup"><span data-stu-id="f21b0-107">**Category**</span></span> |[<span data-ttu-id="f21b0-108">Security</span><span class="sxs-lookup"><span data-stu-id="f21b0-108">Security</span></span>](security-warnings.md)|
| <span data-ttu-id="f21b0-109">**修正が中断か中断なしであるか**</span><span class="sxs-lookup"><span data-stu-id="f21b0-109">**Fix is breaking or non-breaking**</span></span> |<span data-ttu-id="f21b0-110">なし</span><span class="sxs-lookup"><span data-stu-id="f21b0-110">Non-breaking</span></span>|

## <a name="cause"></a><span data-ttu-id="f21b0-111">原因</span><span class="sxs-lookup"><span data-stu-id="f21b0-111">Cause</span></span>

<span data-ttu-id="f21b0-112">安全ではない <xref:System.Xml.XmlReaderSettings.DtdProcessing%2A> インスタンスを使用する場合、または外部エンティティ ソースを参照する場合、パーサーは信頼されていない入力を受け入れ、攻撃者に機密情報を漏えいしてしまう可能性があります。</span><span class="sxs-lookup"><span data-stu-id="f21b0-112">If you use insecure <xref:System.Xml.XmlReaderSettings.DtdProcessing%2A> instances or reference external entity sources, the parser may accept untrusted input and disclose sensitive information to attackers.</span></span>

## <a name="rule-description"></a><span data-ttu-id="f21b0-113">規則の説明</span><span class="sxs-lookup"><span data-stu-id="f21b0-113">Rule description</span></span>

<span data-ttu-id="f21b0-114">*文書型定義 (DTD)* は、  [World Wide Web コンソーシアム (W3C) Extensible Markup Language (XML) 1.0](https://www.w3.org/TR/2008/REC-xml-20081126/)で定義されているように、XML パーサーが文書の妥当性を判別する 2 つの方法のうちの 1 つです。</span><span class="sxs-lookup"><span data-stu-id="f21b0-114">A *Document Type Definition (DTD)* is one of two ways an XML parser can determine the validity of a document, as defined by the  [World Wide Web Consortium (W3C) Extensible Markup Language (XML) 1.0](https://www.w3.org/TR/2008/REC-xml-20081126/).</span></span> <span data-ttu-id="f21b0-115">この規則は、信頼されていないデータを受け入れてしまうプロパティとインスタンスを検索し、潜在的な[情報漏えい](../../../framework/wcf/feature-details/information-disclosure.md)の脅威または[サービス拒否 (DoS)](../../../framework/wcf/feature-details/denial-of-service.md) 攻撃について開発者に警告します。</span><span class="sxs-lookup"><span data-stu-id="f21b0-115">This rule seeks properties and instances where untrusted data is accepted to warn developers about potential [Information Disclosure](../../../framework/wcf/feature-details/information-disclosure.md) threats or [Denial of Service (DoS)](../../../framework/wcf/feature-details/denial-of-service.md) attacks.</span></span> <span data-ttu-id="f21b0-116">このルールは、次の場合にトリガーされます。</span><span class="sxs-lookup"><span data-stu-id="f21b0-116">This rule triggers when:</span></span>

- <span data-ttu-id="f21b0-117"><xref:System.Xml.XmlReader> を使用して外部 XML エンティティを解決する <xref:System.Xml.XmlUrlResolver>インスタンスで、DtdProcessing が有効になっている。</span><span class="sxs-lookup"><span data-stu-id="f21b0-117">DtdProcessing is enabled on the <xref:System.Xml.XmlReader> instance, which resolves external XML entities using <xref:System.Xml.XmlUrlResolver>.</span></span>

- <span data-ttu-id="f21b0-118">XML で <xref:System.Xml.XmlNode.InnerXml%2A> プロパティが設定されている。</span><span class="sxs-lookup"><span data-stu-id="f21b0-118">The <xref:System.Xml.XmlNode.InnerXml%2A> property in the XML is set.</span></span>

- <span data-ttu-id="f21b0-119"><xref:System.Xml.XmlReaderSettings.DtdProcessing%2A> プロパティが Parse に設定されている。</span><span class="sxs-lookup"><span data-stu-id="f21b0-119"><xref:System.Xml.XmlReaderSettings.DtdProcessing%2A> property is set to Parse.</span></span>

- <span data-ttu-id="f21b0-120">信頼されていない入力が <xref:System.Xml.XmlSecureResolver> ではなく <xref:System.Xml.XmlResolver> を使用して処理される。</span><span class="sxs-lookup"><span data-stu-id="f21b0-120">Untrusted input is processed using <xref:System.Xml.XmlResolver> instead of <xref:System.Xml.XmlSecureResolver>.</span></span>

- <span data-ttu-id="f21b0-121"><xref:System.Xml.XmlReader.Create%2A?displayProperty=nameWithType> メソッドが安全ではない <xref:System.Xml.XmlReaderSettings> インスタンスで呼び出される。またはインスタンスがまったくない。</span><span class="sxs-lookup"><span data-stu-id="f21b0-121">The <xref:System.Xml.XmlReader.Create%2A?displayProperty=nameWithType> method is invoked with an insecure <xref:System.Xml.XmlReaderSettings> instance or no instance at all.</span></span>

- <span data-ttu-id="f21b0-122"><xref:System.Xml.XmlReader> が安全ではない既定の設定または値で作成されている。</span><span class="sxs-lookup"><span data-stu-id="f21b0-122"><xref:System.Xml.XmlReader> is created with insecure default settings or values.</span></span>

<span data-ttu-id="f21b0-123">これらのケースはいずれも、結果は同じになります。XML を処理するマシンが共有するファイル システム、またはネットワークからのコンテンツが攻撃者にさらされ、DTD 処理が DoS の媒介として使用される可能性があります。</span><span class="sxs-lookup"><span data-stu-id="f21b0-123">In each of these cases, the outcome is the same: the contents from either the file system or network shares from the machine where the XML is processed will be exposed to the attacker, or DTD processing can be used as a DoS vector.</span></span>

## <a name="how-to-fix-violations"></a><span data-ttu-id="f21b0-124">違反の修正方法</span><span class="sxs-lookup"><span data-stu-id="f21b0-124">How to fix violations</span></span>

- <span data-ttu-id="f21b0-125">パス情報の漏えいを防ぐために、XmlTextReader 例外をすべてキャッチし、適切に処理します。</span><span class="sxs-lookup"><span data-stu-id="f21b0-125">Catch and process all XmlTextReader exceptions properly to avoid path information disclosure.</span></span>

- <span data-ttu-id="f21b0-126"><xref:System.Xml.XmlSecureResolver> を使用して、XmlTextReader がアクセスできるリソースを制限します。</span><span class="sxs-lookup"><span data-stu-id="f21b0-126">Use the <xref:System.Xml.XmlSecureResolver> to restrict the resources that the XmlTextReader can access.</span></span>

- <span data-ttu-id="f21b0-127"><xref:System.Xml.XmlReader> プロパティを <xref:System.Xml.XmlResolver> null **に設定して、** がどの外部リソースも開けないようにします。</span><span class="sxs-lookup"><span data-stu-id="f21b0-127">Do not allow the <xref:System.Xml.XmlReader> to open any external resources by setting the <xref:System.Xml.XmlResolver> property to **null**.</span></span>

- <span data-ttu-id="f21b0-128"><xref:System.Data.DataViewManager.DataViewSettingCollectionString%2A?displayProperty=nameWithType> プロパティが信頼できるソースから割り当てられていることを確認します。</span><span class="sxs-lookup"><span data-stu-id="f21b0-128">Ensure that the <xref:System.Data.DataViewManager.DataViewSettingCollectionString%2A?displayProperty=nameWithType> property is assigned from a trusted source.</span></span>

### <a name="net-framework-35-and-earlier"></a><span data-ttu-id="f21b0-129">.NET Framework 3.5 以前</span><span class="sxs-lookup"><span data-stu-id="f21b0-129">.NET Framework 3.5 and earlier</span></span>

- <span data-ttu-id="f21b0-130">信頼されていないソースを扱う場合には、<xref:System.Xml.XmlReaderSettings.ProhibitDtd%2A> プロパティを **true** に設定して、DTD 処理を無効にします。</span><span class="sxs-lookup"><span data-stu-id="f21b0-130">Disable DTD processing if you are dealing with untrusted sources by setting the <xref:System.Xml.XmlReaderSettings.ProhibitDtd%2A> property to **true**.</span></span>

- <span data-ttu-id="f21b0-131">XmlTextReader クラスには、完全信頼の継承確認要求があります。</span><span class="sxs-lookup"><span data-stu-id="f21b0-131">XmlTextReader class has a full trust inheritance demand.</span></span>

### <a name="net-framework-4-and-later"></a><span data-ttu-id="f21b0-132">.NET Framework 4 以降</span><span class="sxs-lookup"><span data-stu-id="f21b0-132">.NET Framework 4 and later</span></span>

- <span data-ttu-id="f21b0-133">信頼されていないソースを扱う場合には、<xref:System.Xml.XmlReaderSettings.DtdProcessing%2A?displayProperty=nameWithType> プロパティを **Prohibit** または **Ignore** に設定して、DtdProcessing を有効にしないようにします。</span><span class="sxs-lookup"><span data-stu-id="f21b0-133">Avoid enabling DtdProcessing if you're dealing with untrusted sources by setting the <xref:System.Xml.XmlReaderSettings.DtdProcessing%2A?displayProperty=nameWithType> property to **Prohibit** or **Ignore**.</span></span>

- <span data-ttu-id="f21b0-134">すべての InnerXml ケースで、Load() メソッドが XmlReader インスタンスを取ることを確認します。</span><span class="sxs-lookup"><span data-stu-id="f21b0-134">Ensure that the Load() method takes an XmlReader instance in all InnerXml cases.</span></span>

> [!NOTE]
> <span data-ttu-id="f21b0-135">このルールは、有効な XmlSecureResolver インスタンスについて誤検知を報告することがあります。</span><span class="sxs-lookup"><span data-stu-id="f21b0-135">This rule might report false positives on some valid XmlSecureResolver instances.</span></span>

## <a name="when-to-suppress-warnings"></a><span data-ttu-id="f21b0-136">どのようなときに警告を抑制するか</span><span class="sxs-lookup"><span data-stu-id="f21b0-136">When to suppress warnings</span></span>

<span data-ttu-id="f21b0-137">入力が信頼できるソースからのものとわかっているのでない限り、この警告からのルールを抑制しないでください。</span><span class="sxs-lookup"><span data-stu-id="f21b0-137">Unless you're sure that the input is known to be from a trusted source, do not suppress a rule from this warning.</span></span>

## <a name="pseudo-code-examples"></a><span data-ttu-id="f21b0-138">疑似コードの例</span><span class="sxs-lookup"><span data-stu-id="f21b0-138">Pseudo-code examples</span></span>

### <a name="violation-1"></a><span data-ttu-id="f21b0-139">違反 1</span><span class="sxs-lookup"><span data-stu-id="f21b0-139">Violation 1</span></span>

```csharp
using System.IO;
using System.Xml.Schema;

class TestClass
{
    public XmlSchema Test
    {
        get
        {
            var src = "";
            TextReader tr = new StreamReader(src);
            XmlSchema schema = XmlSchema.Read(tr, null); // warn
            return schema;
        }
    }
}
```

### <a name="solution-1"></a><span data-ttu-id="f21b0-140">解決策 1</span><span class="sxs-lookup"><span data-stu-id="f21b0-140">Solution 1</span></span>

```csharp
using System.IO;
using System.Xml;
using System.Xml.Schema;

class TestClass
{
    public XmlSchema Test
    {
        get
        {
            var src = "";
            TextReader tr = new StreamReader(src);
            XmlReader reader = XmlReader.Create(tr, new XmlReaderSettings() { XmlResolver = null });
            XmlSchema schema = XmlSchema.Read(reader , null);
            return schema;
        }
    }
}
```

### <a name="violation-2"></a><span data-ttu-id="f21b0-141">違反 2</span><span class="sxs-lookup"><span data-stu-id="f21b0-141">Violation 2</span></span>

```csharp
using System.Xml;

namespace TestNamespace
{
    public class TestClass
    {
        public XmlReaderSettings settings = new XmlReaderSettings();
        public void TestMethod(string path)
        {
            var reader = XmlReader.Create(path, settings);  // warn
        }
    }
}
```

### <a name="solution-2"></a><span data-ttu-id="f21b0-142">解決策 2</span><span class="sxs-lookup"><span data-stu-id="f21b0-142">Solution 2</span></span>

```csharp
using System.Xml;

namespace TestNamespace
{
    public class TestClass
    {
        public XmlReaderSettings settings = new XmlReaderSettings()
        {
            DtdProcessing = DtdProcessing.Prohibit
        };

        public void TestMethod(string path)
        {
            var reader = XmlReader.Create(path, settings);
        }
    }
}
```

### <a name="violation-3"></a><span data-ttu-id="f21b0-143">違反 3</span><span class="sxs-lookup"><span data-stu-id="f21b0-143">Violation 3</span></span>

```csharp
using System.Xml;

namespace TestNamespace
{
    public class DoNotUseSetInnerXml
    {
        public void TestMethod(string xml)
        {
            XmlDocument doc = new XmlDocument() { XmlResolver = null };
            doc.InnerXml = xml; // warn
        }
    }
}
```

```csharp
using System.Xml;

namespace TestNamespace
{
    public class DoNotUseLoadXml
    {
        public void TestMethod(string xml)
        {
            XmlDocument doc = new XmlDocument(){ XmlResolver = null };
            doc.LoadXml(xml); // warn
        }
    }
}
```

### <a name="solution-3"></a><span data-ttu-id="f21b0-144">解決策 3</span><span class="sxs-lookup"><span data-stu-id="f21b0-144">Solution 3</span></span>

```csharp
using System.Xml;

public static void TestMethod(string xml)
{
    XmlDocument doc = new XmlDocument() { XmlResolver = null };
    System.IO.StringReader sreader = new System.IO.StringReader(xml);
    XmlReader reader = XmlReader.Create(sreader, new XmlReaderSettings() { XmlResolver = null });
    doc.Load(reader);
}
```

### <a name="violation-4"></a><span data-ttu-id="f21b0-145">違反 4</span><span class="sxs-lookup"><span data-stu-id="f21b0-145">Violation 4</span></span>

```csharp
using System.IO;
using System.Xml;
using System.Xml.Serialization;

namespace TestNamespace
{
    public class UseXmlReaderForDeserialize
    {
        public void TestMethod(Stream stream)
        {
            XmlSerializer serializer = new XmlSerializer(typeof(UseXmlReaderForDeserialize));
            serializer.Deserialize(stream); // warn
        }
    }
}
```

### <a name="solution-4"></a><span data-ttu-id="f21b0-146">解決策 4</span><span class="sxs-lookup"><span data-stu-id="f21b0-146">Solution 4</span></span>

```csharp
using System.IO;
using System.Xml;
using System.Xml.Serialization;

namespace TestNamespace
{
    public class UseXmlReaderForDeserialize
    {
        public void TestMethod(Stream stream)
        {
            XmlSerializer serializer = new XmlSerializer(typeof(UseXmlReaderForDeserialize));
            XmlReader reader = XmlReader.Create(stream, new XmlReaderSettings() { XmlResolver = null });
            serializer.Deserialize(reader );
        }
    }
}
```

### <a name="violation-5"></a><span data-ttu-id="f21b0-147">違反 5</span><span class="sxs-lookup"><span data-stu-id="f21b0-147">Violation 5</span></span>

```csharp
using System.Xml;
using System.Xml.XPath;

namespace TestNamespace
{
    public class UseXmlReaderForXPathDocument
    {
        public void TestMethod(string path)
        {
            XPathDocument doc = new XPathDocument(path); // warn
        }
    }
}
```

### <a name="solution-5"></a><span data-ttu-id="f21b0-148">解決策 5</span><span class="sxs-lookup"><span data-stu-id="f21b0-148">Solution 5</span></span>

```csharp
using System.Xml;
using System.Xml.XPath;

namespace TestNamespace
{
    public class UseXmlReaderForXPathDocument
    {
        public void TestMethod(string path)
        {
            XmlReader reader = XmlReader.Create(path, new XmlReaderSettings() { XmlResolver = null });
            XPathDocument doc = new XPathDocument(reader);
        }
    }
}
```

### <a name="violation-6"></a><span data-ttu-id="f21b0-149">違反 6</span><span class="sxs-lookup"><span data-stu-id="f21b0-149">Violation 6</span></span>

```csharp
using System.Xml;

namespace TestNamespace
{
    class TestClass
    {
        public XmlDocument doc = new XmlDocument() { XmlResolver = new XmlUrlResolver() };
    }
}
```

### <a name="solution-6"></a><span data-ttu-id="f21b0-150">解決策 6</span><span class="sxs-lookup"><span data-stu-id="f21b0-150">Solution 6</span></span>

```csharp
using System.Xml;

namespace TestNamespace
{
    class TestClass
    {
        public XmlDocument doc = new XmlDocument() { XmlResolver = null }; // or set to a XmlSecureResolver instance
    }
}
```

### <a name="violation-7"></a><span data-ttu-id="f21b0-151">違反 7</span><span class="sxs-lookup"><span data-stu-id="f21b0-151">Violation 7</span></span>

```csharp
using System.Xml;

namespace TestNamespace
{
    class TestClass
    {
        private static void TestMethod()
        {
            var reader = XmlTextReader.Create(""doc.xml""); //warn
        }
    }
}
```

```csharp
using System.Xml;

namespace TestNamespace
{
    public class TestClass
    {
        public void TestMethod(string path)
        {
            try {
                XmlTextReader reader = new XmlTextReader(path); // warn
            }
            catch { throw ; }
            finally {}
        }
    }
}
```

### <a name="solution-7"></a><span data-ttu-id="f21b0-152">解決策 7</span><span class="sxs-lookup"><span data-stu-id="f21b0-152">Solution 7</span></span>

```csharp
using System.Xml;

namespace TestNamespace
{
    public class TestClass
    {
        public void TestMethod(string path)
        {
            XmlReaderSettings settings = new XmlReaderSettings() { XmlResolver = null };
            XmlReader reader = XmlReader.Create(path, settings);
        }
    }
}
```

> [!NOTE]
> <span data-ttu-id="f21b0-153"><xref:System.Xml.XmlReader.Create%2A?displayProperty=nameWithType> は <xref:System.Xml.XmlReader> インスタンスを作成するために推奨される方法ですが、<xref:System.Xml.XmlTextReader> とは異なる動作をします。</span><span class="sxs-lookup"><span data-stu-id="f21b0-153">Although <xref:System.Xml.XmlReader.Create%2A?displayProperty=nameWithType> is the recommended way to create an <xref:System.Xml.XmlReader> instance, there are behavior differences from <xref:System.Xml.XmlTextReader>.</span></span> <span data-ttu-id="f21b0-154"><xref:System.Xml.XmlReader.Create%2A> からの<xref:System.Xml.XmlReader> は、XML 値内で `\r\n` を `\n` に正規化しますが、<xref:System.Xml.XmlTextReader> は `\r\n` シーケンスを保持します。</span><span class="sxs-lookup"><span data-stu-id="f21b0-154">An <xref:System.Xml.XmlReader> from <xref:System.Xml.XmlReader.Create%2A> normalizes `\r\n` to `\n` in XML values, while <xref:System.Xml.XmlTextReader> preserves the `\r\n` sequence.</span></span>
