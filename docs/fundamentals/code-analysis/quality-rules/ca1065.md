---
title: 'CA1065: 予期しない場所に例外を発生させません (コード分析)'
description: 'コード分析規則「CA1065: 予期しない場所に例外を発生させません」について説明します'
ms.date: 11/04/2016
ms.topic: reference
f1_keywords:
- CA1065
- DoNotRaiseExceptionsInUnexpectedLocations
helpviewer_keywords:
- DoNotRaiseExceptionsInUnexpectedLocations
- CA1065
author: gewarren
ms.author: gewarren
ms.openlocfilehash: 0990fc1c283e7961f1ece1a374a6a06960968faf
ms.sourcegitcommit: 05d0087dfca85aac9ca2960f86c5efd218bf833f
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/30/2021
ms.locfileid: "99548319"
---
# <a name="ca1065-do-not-raise-exceptions-in-unexpected-locations"></a><span data-ttu-id="59934-103">CA1065:予期しない場所に例外を発生させません</span><span class="sxs-lookup"><span data-stu-id="59934-103">CA1065: Do not raise exceptions in unexpected locations</span></span>

| | <span data-ttu-id="59934-104">値</span><span class="sxs-lookup"><span data-stu-id="59934-104">Value</span></span> |
|-|-|
| <span data-ttu-id="59934-105">**ルール ID**</span><span class="sxs-lookup"><span data-stu-id="59934-105">**Rule ID**</span></span> |<span data-ttu-id="59934-106">CA1065</span><span class="sxs-lookup"><span data-stu-id="59934-106">CA1065</span></span>|
| <span data-ttu-id="59934-107">**カテゴリ**</span><span class="sxs-lookup"><span data-stu-id="59934-107">**Category**</span></span> |[<span data-ttu-id="59934-108">Microsoft.Design</span><span class="sxs-lookup"><span data-stu-id="59934-108">Microsoft.Design</span></span>](design-warnings.md)|
| <span data-ttu-id="59934-109">**修正が中断ありか中断なしか**</span><span class="sxs-lookup"><span data-stu-id="59934-109">**Fix is breaking or non-breaking**</span></span> |<span data-ttu-id="59934-110">なし</span><span class="sxs-lookup"><span data-stu-id="59934-110">Non-breaking</span></span>|

## <a name="cause"></a><span data-ttu-id="59934-111">原因</span><span class="sxs-lookup"><span data-stu-id="59934-111">Cause</span></span>

<span data-ttu-id="59934-112">例外をスローしないはずのメソッドが例外をスローします。</span><span class="sxs-lookup"><span data-stu-id="59934-112">A method that is not expected to throw exceptions throws an exception.</span></span>

## <a name="rule-description"></a><span data-ttu-id="59934-113">規則の説明</span><span class="sxs-lookup"><span data-stu-id="59934-113">Rule description</span></span>

<span data-ttu-id="59934-114">例外をスローしないはずのメソッドは、次のように分類できます。</span><span class="sxs-lookup"><span data-stu-id="59934-114">Methods that are not expected to throw exceptions can be categorized as follows:</span></span>

- <span data-ttu-id="59934-115">プロパティの get メソッド</span><span class="sxs-lookup"><span data-stu-id="59934-115">Property Get Methods</span></span>

- <span data-ttu-id="59934-116">イベントのアクセサー メソッド</span><span class="sxs-lookup"><span data-stu-id="59934-116">Event Accessor Methods</span></span>

- <span data-ttu-id="59934-117">Equals メソッド</span><span class="sxs-lookup"><span data-stu-id="59934-117">Equals Methods</span></span>

- <span data-ttu-id="59934-118">GetHashCode メソッド</span><span class="sxs-lookup"><span data-stu-id="59934-118">GetHashCode Methods</span></span>

- <span data-ttu-id="59934-119">ToString メソッド</span><span class="sxs-lookup"><span data-stu-id="59934-119">ToString Methods</span></span>

- <span data-ttu-id="59934-120">静的コンストラクター</span><span class="sxs-lookup"><span data-stu-id="59934-120">Static Constructors</span></span>

- <span data-ttu-id="59934-121">ファイナライザー</span><span class="sxs-lookup"><span data-stu-id="59934-121">Finalizers</span></span>

- <span data-ttu-id="59934-122">Dispose メソッド</span><span class="sxs-lookup"><span data-stu-id="59934-122">Dispose Methods</span></span>

- <span data-ttu-id="59934-123">等値演算子</span><span class="sxs-lookup"><span data-stu-id="59934-123">Equality Operators</span></span>

- <span data-ttu-id="59934-124">暗黙的キャスト演算子</span><span class="sxs-lookup"><span data-stu-id="59934-124">Implicit Cast Operators</span></span>

<span data-ttu-id="59934-125">以下のセクションでは、これらのメソッドの種類について説明します。</span><span class="sxs-lookup"><span data-stu-id="59934-125">The following sections discuss these method types.</span></span>

### <a name="property-get-methods"></a><span data-ttu-id="59934-126">プロパティの get メソッド</span><span class="sxs-lookup"><span data-stu-id="59934-126">Property Get Methods</span></span>

<span data-ttu-id="59934-127">プロパティは基本的にスマート フィールドです。</span><span class="sxs-lookup"><span data-stu-id="59934-127">Properties are basically smart fields.</span></span> <span data-ttu-id="59934-128">そのため、それらは可能な限りフィールドのように動作する必要があります。</span><span class="sxs-lookup"><span data-stu-id="59934-128">Therefore, they should behave like a field as much as possible.</span></span> <span data-ttu-id="59934-129">フィールドから例外はスローされないので、プロパティでもスローされません。</span><span class="sxs-lookup"><span data-stu-id="59934-129">Fields don't throw exceptions and neither should properties.</span></span> <span data-ttu-id="59934-130">例外をスローするプロパティがある場合は、メソッドにすることを検討します。</span><span class="sxs-lookup"><span data-stu-id="59934-130">If you have a property that throws an exception, consider making it a method.</span></span>

<span data-ttu-id="59934-131">プロパティの get メソッドからは、次の例外がスローされる可能性があります。</span><span class="sxs-lookup"><span data-stu-id="59934-131">The following exceptions can be thrown from a property get method:</span></span>

- <span data-ttu-id="59934-132"><xref:System.InvalidOperationException?displayProperty=fullName> およびすべての派生物 (<xref:System.ObjectDisposedException?displayProperty=fullName> を含む)</span><span class="sxs-lookup"><span data-stu-id="59934-132"><xref:System.InvalidOperationException?displayProperty=fullName> and all derivatives (including <xref:System.ObjectDisposedException?displayProperty=fullName>)</span></span>

- <span data-ttu-id="59934-133"><xref:System.NotSupportedException?displayProperty=fullName> およびすべての派生物</span><span class="sxs-lookup"><span data-stu-id="59934-133"><xref:System.NotSupportedException?displayProperty=fullName> and all derivatives</span></span>

- <span data-ttu-id="59934-134"><xref:System.ArgumentException?displayProperty=fullName> (インデックス付きの get からのみ)</span><span class="sxs-lookup"><span data-stu-id="59934-134"><xref:System.ArgumentException?displayProperty=fullName> (only from indexed get)</span></span>

- <span data-ttu-id="59934-135"><xref:System.Collections.Generic.KeyNotFoundException> (インデックス付きの get からのみ)</span><span class="sxs-lookup"><span data-stu-id="59934-135"><xref:System.Collections.Generic.KeyNotFoundException> (only from indexed get)</span></span>

### <a name="event-accessor-methods"></a><span data-ttu-id="59934-136">イベントのアクセサー メソッド</span><span class="sxs-lookup"><span data-stu-id="59934-136">Event Accessor Methods</span></span>

<span data-ttu-id="59934-137">イベント アクセサーは、例外をスローしない単純な操作である必要があります。</span><span class="sxs-lookup"><span data-stu-id="59934-137">Event accessors should be simple operations that don't throw exceptions.</span></span> <span data-ttu-id="59934-138">イベント ハンドラーを追加または削除しようとしたときに、イベントで例外がスローされないようにする必要があります。</span><span class="sxs-lookup"><span data-stu-id="59934-138">An event should not throw an exception when you try to add or remove an event handler.</span></span>

<span data-ttu-id="59934-139">イベント アクセサーからは、次の例外がスローされる可能性があります。</span><span class="sxs-lookup"><span data-stu-id="59934-139">The following exceptions can be thrown from an event accessor:</span></span>

- <span data-ttu-id="59934-140"><xref:System.InvalidOperationException?displayProperty=fullName> およびすべての派生物 (<xref:System.ObjectDisposedException?displayProperty=fullName> を含む)</span><span class="sxs-lookup"><span data-stu-id="59934-140"><xref:System.InvalidOperationException?displayProperty=fullName> and all derivatives (including <xref:System.ObjectDisposedException?displayProperty=fullName>)</span></span>

- <span data-ttu-id="59934-141"><xref:System.NotSupportedException?displayProperty=fullName> およびすべての派生物</span><span class="sxs-lookup"><span data-stu-id="59934-141"><xref:System.NotSupportedException?displayProperty=fullName> and all derivatives</span></span>

- <span data-ttu-id="59934-142"><xref:System.ArgumentException> および派生物</span><span class="sxs-lookup"><span data-stu-id="59934-142"><xref:System.ArgumentException> and derivatives</span></span>

### <a name="equals-methods"></a><span data-ttu-id="59934-143">Equals メソッド</span><span class="sxs-lookup"><span data-stu-id="59934-143">Equals Methods</span></span>

<span data-ttu-id="59934-144">次の **Equals** メソッドから例外がスローされてはなりません。</span><span class="sxs-lookup"><span data-stu-id="59934-144">The following **Equals** methods should not throw exceptions:</span></span>

- <xref:System.Object.Equals%2A?displayProperty=fullName>

- <xref:System.IEquatable%601.Equals%2A>

<span data-ttu-id="59934-145">**Equals** メソッドからは、例外をスローする代わりに、`true` または `false` を返す必要があります。</span><span class="sxs-lookup"><span data-stu-id="59934-145">An **Equals** method should return `true` or `false` instead of throwing an exception.</span></span> <span data-ttu-id="59934-146">たとえば、Equals に 2 つの一致しない型が渡された場合、<xref:System.ArgumentException> をスローするのではなく、`false` を返すだけにする必要があります。</span><span class="sxs-lookup"><span data-stu-id="59934-146">For example, if Equals is passed two mismatched types it should just return `false` instead of throwing an <xref:System.ArgumentException>.</span></span>

### <a name="gethashcode-methods"></a><span data-ttu-id="59934-147">GetHashCode メソッド</span><span class="sxs-lookup"><span data-stu-id="59934-147">GetHashCode Methods</span></span>

<span data-ttu-id="59934-148">次の **GetHashCode** メソッドからは、通常、例外をスローしないようにする必要があります。</span><span class="sxs-lookup"><span data-stu-id="59934-148">The following **GetHashCode** methods should usually not throw exceptions:</span></span>

- <xref:System.Object.GetHashCode%2A>

- <xref:System.Collections.IEqualityComparer.GetHashCode%2A>

<span data-ttu-id="59934-149">**GetHashCode** からは、常に値を返す必要があります。</span><span class="sxs-lookup"><span data-stu-id="59934-149">**GetHashCode** should always return a value.</span></span> <span data-ttu-id="59934-150">そうしないと、ハッシュ テーブル内の項目が失われる可能性があります。</span><span class="sxs-lookup"><span data-stu-id="59934-150">Otherwise, you can lose items in the hash table.</span></span>

<span data-ttu-id="59934-151">引数を受け取るバージョンの **GetHashCode** からは、<xref:System.ArgumentException> をスローできます。</span><span class="sxs-lookup"><span data-stu-id="59934-151">The versions of **GetHashCode** that take an argument can throw an <xref:System.ArgumentException>.</span></span> <span data-ttu-id="59934-152">ただし、**Object.GetHashCode** から例外をスローすることはできません。</span><span class="sxs-lookup"><span data-stu-id="59934-152">However, **Object.GetHashCode** should never throw an exception.</span></span>

### <a name="tostring-methods"></a><span data-ttu-id="59934-153">ToString メソッド</span><span class="sxs-lookup"><span data-stu-id="59934-153">ToString Methods</span></span>

<span data-ttu-id="59934-154"><xref:System.Object.ToString%2A?displayProperty=fullName> は、オブジェクトに関する情報を文字列形式で表示するために、デバッガーによって使用されます。</span><span class="sxs-lookup"><span data-stu-id="59934-154">The debugger uses <xref:System.Object.ToString%2A?displayProperty=fullName> to help display information about objects in string format.</span></span> <span data-ttu-id="59934-155">したがって、**ToString** でオブジェクトの状態を変更してはならず、例外をスローすることはできません。</span><span class="sxs-lookup"><span data-stu-id="59934-155">Therefore, **ToString** should not change the state of an object, and it shouldn't throw exceptions.</span></span>

### <a name="static-constructors"></a><span data-ttu-id="59934-156">静的コンストラクター</span><span class="sxs-lookup"><span data-stu-id="59934-156">Static Constructors</span></span>

<span data-ttu-id="59934-157">静的コンストラクターから例外をスローすると、現在のアプリケーション ドメインでその型を使用できなくなります。</span><span class="sxs-lookup"><span data-stu-id="59934-157">Throwing exceptions from a static constructor causes the type to be unusable in the current application domain.</span></span> <span data-ttu-id="59934-158">静的コンストラクターから例外をスローするには、適切な理由 (セキュリティの問題など) が必要です。</span><span class="sxs-lookup"><span data-stu-id="59934-158">You should have a good reason (such as a security issue) for throwing an exception from a static constructor.</span></span>

### <a name="finalizers"></a><span data-ttu-id="59934-159">ファイナライザー</span><span class="sxs-lookup"><span data-stu-id="59934-159">Finalizers</span></span>

<span data-ttu-id="59934-160">ファイナライザーから例外をスローすると、CLR がフェイル ファストし、プロセスが破棄されます。</span><span class="sxs-lookup"><span data-stu-id="59934-160">Throwing an exception from a finalizer causes the CLR to fail fast, which tears down the process.</span></span> <span data-ttu-id="59934-161">したがって、ファイナライザーで例外をスローすることは常に避ける必要があります。</span><span class="sxs-lookup"><span data-stu-id="59934-161">Therefore, throwing exceptions in a finalizer should always be avoided.</span></span>

### <a name="dispose-methods"></a><span data-ttu-id="59934-162">Dispose メソッド</span><span class="sxs-lookup"><span data-stu-id="59934-162">Dispose Methods</span></span>

<span data-ttu-id="59934-163"><xref:System.IDisposable.Dispose%2A?displayProperty=fullName> メソッドで例外をスローしてはなりません。</span><span class="sxs-lookup"><span data-stu-id="59934-163">A <xref:System.IDisposable.Dispose%2A?displayProperty=fullName> method should not throw an exception.</span></span> <span data-ttu-id="59934-164">Dispose は、`finally` 句でのクリーンアップ ロジックの一部として呼び出されることがよくあります。</span><span class="sxs-lookup"><span data-stu-id="59934-164">Dispose is often called as part of the cleanup logic in a `finally` clause.</span></span> <span data-ttu-id="59934-165">したがって、Dispose から明示的に例外をスローすると、ユーザーは `finally` 句内に例外処理を追加するように強制されます。</span><span class="sxs-lookup"><span data-stu-id="59934-165">Therefore, explicitly throwing an exception from Dispose forces the user to add exception handling inside the `finally` clause.</span></span>

<span data-ttu-id="59934-166">ほとんどの場合、Dispose はファイナライザーから呼び出されるため、**Dispose(false)** コード パスで例外をスローしてはなりません。</span><span class="sxs-lookup"><span data-stu-id="59934-166">The **Dispose(false)** code path should never throw exceptions, because Dispose is almost always called from a finalizer.</span></span>

### <a name="equality-operators--"></a><span data-ttu-id="59934-167">等値演算子 (==、!=)</span><span class="sxs-lookup"><span data-stu-id="59934-167">Equality Operators (==, !=)</span></span>

<span data-ttu-id="59934-168">Equals メソッドと同様に、等値演算子からは `true` または `false` のいずれかを返す必要があり、例外をスローしてはなりません。</span><span class="sxs-lookup"><span data-stu-id="59934-168">Like Equals methods, equality operators should return either `true` or `false`, and should not throw exceptions.</span></span>

### <a name="implicit-cast-operators"></a><span data-ttu-id="59934-169">暗黙的キャスト演算子</span><span class="sxs-lookup"><span data-stu-id="59934-169">Implicit Cast Operators</span></span>

<span data-ttu-id="59934-170">ユーザーは、暗黙的キャスト演算子が呼び出されたことを認識しないことがよくあるため、暗黙的キャスト演算子によってスローされる例外は予期されていません。</span><span class="sxs-lookup"><span data-stu-id="59934-170">Because the user is often unaware that an implicit cast operator has been called, an exception thrown by the implicit cast operator is unexpected.</span></span> <span data-ttu-id="59934-171">したがって、暗黙的キャスト演算子から例外をスローしてはなりません。</span><span class="sxs-lookup"><span data-stu-id="59934-171">Therefore, no exceptions should be thrown from implicit cast operators.</span></span>

## <a name="how-to-fix-violations"></a><span data-ttu-id="59934-172">違反の修正方法</span><span class="sxs-lookup"><span data-stu-id="59934-172">How to fix violations</span></span>

<span data-ttu-id="59934-173">プロパティのゲッターの場合は、例外をスローする必要がないようにロジックを変更するか、プロパティをメソッドに変更します。</span><span class="sxs-lookup"><span data-stu-id="59934-173">For property getters, either change the logic so that it no longer has to throw an exception, or change the property into a method.</span></span>

<span data-ttu-id="59934-174">上で示した他のすべてのメソッドの種類については、例外をスローする必要がないようにロジックを変更します。</span><span class="sxs-lookup"><span data-stu-id="59934-174">For all other method types listed previously, change the logic so that it no longer must throw an exception.</span></span>

## <a name="when-to-suppress-warnings"></a><span data-ttu-id="59934-175">どのようなときに警告を抑制するか</span><span class="sxs-lookup"><span data-stu-id="59934-175">When to suppress warnings</span></span>

<span data-ttu-id="59934-176">スローされる例外ではなく例外の宣言によって違反が発生した場合は、この規則からの警告を抑制しても安全です。</span><span class="sxs-lookup"><span data-stu-id="59934-176">If the violation was caused by an exception declaration instead of a thrown exception, it is safe to suppress a warning from this rule.</span></span>

## <a name="related-rules"></a><span data-ttu-id="59934-177">関連規則</span><span class="sxs-lookup"><span data-stu-id="59934-177">Related rules</span></span>

- [<span data-ttu-id="59934-178">CA2219:exception 句に例外を発生させないでください</span><span class="sxs-lookup"><span data-stu-id="59934-178">CA2219: Do not raise exceptions in exception clauses</span></span>](ca2219.md)

## <a name="see-also"></a><span data-ttu-id="59934-179">関連項目</span><span class="sxs-lookup"><span data-stu-id="59934-179">See also</span></span>

- [<span data-ttu-id="59934-180">デザイン規則</span><span class="sxs-lookup"><span data-stu-id="59934-180">Design rules</span></span>](design-warnings.md)
