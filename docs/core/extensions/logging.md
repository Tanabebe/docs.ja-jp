---
title: .NET でのログの記録
author: IEvangelist
description: Microsoft.Extensions.Logging NuGet パッケージで提供されるログ記録フレームワークの使用方法について説明します。
ms.author: dapine
ms.date: 02/19/2021
ms.openlocfilehash: 834331b9e103138012bbe91586d0d5a7c08654ce
ms.sourcegitcommit: bdbf6472de867a0a11aaa5b9384a2506c24f27d2
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/05/2021
ms.locfileid: "102402167"
---
# <a name="logging-in-net"></a><span data-ttu-id="4bbe8-103">.NET でのログの記録</span><span class="sxs-lookup"><span data-stu-id="4bbe8-103">Logging in .NET</span></span>

<span data-ttu-id="4bbe8-104">.NET では、組み込みやサード パーティ製のさまざまなログ プロバイダーと連携するログ API がサポートされています。</span><span class="sxs-lookup"><span data-stu-id="4bbe8-104">.NET supports a logging API that works with a variety of built-in and third-party logging providers.</span></span> <span data-ttu-id="4bbe8-105">この記事では、組み込みプロバイダーと共にログ API を使用する方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="4bbe8-105">This article shows how to use the logging API with built-in providers.</span></span> <span data-ttu-id="4bbe8-106">この記事に示されているほとんどのコード例は、[汎用ホスト](generic-host.md)を使用する任意の .NET アプリに適用されます。</span><span class="sxs-lookup"><span data-stu-id="4bbe8-106">Most of the code examples shown in this article apply to any .NET app that uses the [Generic Host](generic-host.md).</span></span> <span data-ttu-id="4bbe8-107">汎用ホストを使用しないアプリについては、「[ホスト コンソール以外のアプリ](#non-host-console-app)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="4bbe8-107">For apps that don't use the Generic Host, see [Non-host console app](#non-host-console-app).</span></span>

## <a name="create-logs"></a><span data-ttu-id="4bbe8-108">ログを作成する</span><span class="sxs-lookup"><span data-stu-id="4bbe8-108">Create logs</span></span>

<span data-ttu-id="4bbe8-109">ログを作成するには、[依存関係の挿入 (DI)](dependency-injection.md) から <xref:Microsoft.Extensions.Logging.ILogger%601> オブジェクトを使用します。</span><span class="sxs-lookup"><span data-stu-id="4bbe8-109">To create logs, use an <xref:Microsoft.Extensions.Logging.ILogger%601> object from [dependency injection (DI)](dependency-injection.md).</span></span>

<span data-ttu-id="4bbe8-110">次のような例です。</span><span class="sxs-lookup"><span data-stu-id="4bbe8-110">The following example:</span></span>

- <span data-ttu-id="4bbe8-111">`Worker` 型の完全修飾名のログ "*カテゴリ*" を使用する、ロガー `ILogger<Worker>` を作成します。</span><span class="sxs-lookup"><span data-stu-id="4bbe8-111">Creates a logger, `ILogger<Worker>`, which uses a log *category* of the fully qualified name of the type `Worker`.</span></span> <span data-ttu-id="4bbe8-112">ログのカテゴリは、各ログに関連付けられている文字列です。</span><span class="sxs-lookup"><span data-stu-id="4bbe8-112">The log category is a string that is associated with each log.</span></span>
- <span data-ttu-id="4bbe8-113"><xref:Microsoft.Extensions.Logging.LoggerExtensions.LogInformation%2A> を呼び出して、`Information` レベルでログを記録します。</span><span class="sxs-lookup"><span data-stu-id="4bbe8-113">Calls <xref:Microsoft.Extensions.Logging.LoggerExtensions.LogInformation%2A> to log at the `Information` level.</span></span> <span data-ttu-id="4bbe8-114">ログの "*レベル*" は、ログに記録されるイベントの重大度を示します。</span><span class="sxs-lookup"><span data-stu-id="4bbe8-114">The Log *level* indicates the severity of the logged event.</span></span>

:::code language="csharp" source="snippets/configuration/worker-service/Worker.cs" range="9-24" highlight="12":::

<span data-ttu-id="4bbe8-115">[レベル](#log-level)と[カテゴリ](#log-category)の詳細については、この記事で後ほど説明します。</span><span class="sxs-lookup"><span data-stu-id="4bbe8-115">[Levels](#log-level) and [categories](#log-category) are explained in more detail later in this article.</span></span>

## <a name="configure-logging"></a><span data-ttu-id="4bbe8-116">ログの構成</span><span class="sxs-lookup"><span data-stu-id="4bbe8-116">Configure logging</span></span>

<span data-ttu-id="4bbe8-117">一般的に、ログの構成は *appsettings*.`{Environment}` *.json* ファイルの `Logging` セクションで指定されます。</span><span class="sxs-lookup"><span data-stu-id="4bbe8-117">Logging configuration is commonly provided by the `Logging` section of *appsettings*.`{Environment}`*.json* files.</span></span> <span data-ttu-id="4bbe8-118">次の *appsettings.Development.json* ファイルは、.NET Worker サービス テンプレートによって生成されます。</span><span class="sxs-lookup"><span data-stu-id="4bbe8-118">The following *appsettings.Development.json* file is generated by the .NET Worker service templates:</span></span>

:::code language="json" source="snippets/configuration/worker-service/appsettings.Development.json":::

<span data-ttu-id="4bbe8-119">上記の JSON では、次のように指定されています。</span><span class="sxs-lookup"><span data-stu-id="4bbe8-119">In the preceding JSON:</span></span>

- <span data-ttu-id="4bbe8-120">`"Default"`、`"Microsoft"`、および `"Microsoft.Hosting.Lifetime"` の各カテゴリが指定されています。</span><span class="sxs-lookup"><span data-stu-id="4bbe8-120">The `"Default"`, `"Microsoft"`, and `"Microsoft.Hosting.Lifetime"` categories are specified.</span></span>
- <span data-ttu-id="4bbe8-121">`"Microsoft"` カテゴリは、`"Microsoft"` で始まるすべてのカテゴリに適用されます。</span><span class="sxs-lookup"><span data-stu-id="4bbe8-121">The `"Microsoft"` category applies to all categories that start with `"Microsoft"`.</span></span>
- <span data-ttu-id="4bbe8-122">`"Microsoft"` カテゴリでは、ログ レベルが `Warning` 以上のログが記録されます。</span><span class="sxs-lookup"><span data-stu-id="4bbe8-122">The `"Microsoft"` category logs at log level `Warning` and higher.</span></span>
- <span data-ttu-id="4bbe8-123">`"Microsoft.Hosting.Lifetime"` カテゴリは `"Microsoft"` カテゴリよりも詳細なので、`"Microsoft.Hosting.Lifetime"` カテゴリではログ レベルが "情報" 以上のログが記録されます。</span><span class="sxs-lookup"><span data-stu-id="4bbe8-123">The `"Microsoft.Hosting.Lifetime"` category is more specific than the `"Microsoft"` category, so the `"Microsoft.Hosting.Lifetime"` category logs at log level "Information" and higher.</span></span>
- <span data-ttu-id="4bbe8-124">特定のログ プロバイダーが指定されていないため、`LogLevel` は、[Windows EventLog](logging-providers.md#windows-eventlog) を除くすべての有効なログ プロバイダーに適用されます。</span><span class="sxs-lookup"><span data-stu-id="4bbe8-124">A specific log provider is not specified, so `LogLevel` applies to all the enabled logging providers except for the [Windows EventLog](logging-providers.md#windows-eventlog).</span></span>

<span data-ttu-id="4bbe8-125">`Logging` プロパティには <xref:Microsoft.Extensions.Logging.LogLevel> およびログ プロバイダーのプロパティを含めることができます。</span><span class="sxs-lookup"><span data-stu-id="4bbe8-125">The `Logging` property can have <xref:Microsoft.Extensions.Logging.LogLevel> and log provider properties.</span></span> <span data-ttu-id="4bbe8-126">`LogLevel` により、選択したカテゴリに対するログの最小[レベル](#log-level)が指定されます。</span><span class="sxs-lookup"><span data-stu-id="4bbe8-126">The `LogLevel` specifies the minimum [level](#log-level) to log for selected categories.</span></span> <span data-ttu-id="4bbe8-127">上記の JSON では、`Information` と `Warning` のログ レベルが指定されています。</span><span class="sxs-lookup"><span data-stu-id="4bbe8-127">In the preceding JSON, `Information` and `Warning` log levels are specified.</span></span> <span data-ttu-id="4bbe8-128">`LogLevel` はログの重大度を 0 - 6 の範囲で示します。</span><span class="sxs-lookup"><span data-stu-id="4bbe8-128">`LogLevel` indicates the severity of the log and ranges from 0 to 6:</span></span>

<span data-ttu-id="4bbe8-129">`Trace` = 0、`Debug` = 1、`Information` = 2、`Warning` = 3、`Error` = 4、`Critical` = 5、`None` = 6。</span><span class="sxs-lookup"><span data-stu-id="4bbe8-129">`Trace` = 0, `Debug` = 1, `Information` = 2, `Warning` = 3, `Error` = 4, `Critical` = 5, and `None` = 6.</span></span>

<span data-ttu-id="4bbe8-130">`LogLevel` を指定すると、指定したレベル以上のメッセージに対してログが有効になります。</span><span class="sxs-lookup"><span data-stu-id="4bbe8-130">When a `LogLevel` is specified, logging is enabled for messages at the specified level and higher.</span></span> <span data-ttu-id="4bbe8-131">上記の JSON では、`Default` カテゴリは `Information` 以上に対してのみログに記録されます。</span><span class="sxs-lookup"><span data-stu-id="4bbe8-131">In the preceding JSON, the `Default` category is logged for `Information` and higher.</span></span> <span data-ttu-id="4bbe8-132">たとえば、`Information`、`Warning`、`Error`、`Critical` のメッセージがログに記録されます。</span><span class="sxs-lookup"><span data-stu-id="4bbe8-132">For example, `Information`, `Warning`, `Error`, and `Critical` messages are logged.</span></span> <span data-ttu-id="4bbe8-133">`LogLevel` が指定されていない場合、ログは既定で `Information` レベルになります。</span><span class="sxs-lookup"><span data-stu-id="4bbe8-133">If no `LogLevel` is specified, logging defaults to the `Information` level.</span></span> <span data-ttu-id="4bbe8-134">詳細については、「[ログ レベル](#log-level)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="4bbe8-134">For more information, see [Log levels](#log-level).</span></span>

<span data-ttu-id="4bbe8-135">プロバイダー プロパティで `LogLevel` プロパティを指定できます。</span><span class="sxs-lookup"><span data-stu-id="4bbe8-135">A provider property can specify a `LogLevel` property.</span></span> <span data-ttu-id="4bbe8-136">プロバイダーの下の `LogLevel` によって、そのプロバイダーのログに記録するレベルが指定され、プロバイダー以外のログ設定がオーバーライドされます。</span><span class="sxs-lookup"><span data-stu-id="4bbe8-136">`LogLevel` under a provider specifies levels to log for that provider, and overrides the non-provider log settings.</span></span> <span data-ttu-id="4bbe8-137">以下の *appsettings.json* ファイルについて考えます:</span><span class="sxs-lookup"><span data-stu-id="4bbe8-137">Consider the following *appsettings.json* file:</span></span>

:::code language="json" source="snippets/configuration/worker-service/appsettings.Staging.json":::

<span data-ttu-id="4bbe8-138">`Logging.{ProviderName}.LogLevel` の設定により `Logging.LogLevel` の設定がオーバーライドされます。</span><span class="sxs-lookup"><span data-stu-id="4bbe8-138">Settings in `Logging.{ProviderName}.LogLevel` override settings in `Logging.LogLevel`.</span></span> <span data-ttu-id="4bbe8-139">上記の JSON では、`Debug` プロバイダーの既定のログ レベルは `Information` に設定されています。</span><span class="sxs-lookup"><span data-stu-id="4bbe8-139">In the preceding JSON, the `Debug` provider's default log level is set to `Information`:</span></span>

`Logging:Debug:LogLevel:Default:Information`

<span data-ttu-id="4bbe8-140">上記の設定により、`Microsoft.Hosting` 以外のすべての `Logging:Debug:` カテゴリに `Information` ログ レベルが指定されます。</span><span class="sxs-lookup"><span data-stu-id="4bbe8-140">The preceding setting specifies the `Information` log level for every `Logging:Debug:` category except `Microsoft.Hosting`.</span></span> <span data-ttu-id="4bbe8-141">特定のカテゴリが一覧表示されると、特定のカテゴリによって既定のカテゴリがオーバーライドされます。</span><span class="sxs-lookup"><span data-stu-id="4bbe8-141">When a specific category is listed, the specific category overrides the default category.</span></span> <span data-ttu-id="4bbe8-142">上記の JSON では、`Logging:Debug:LogLevel` カテゴリ `"Microsoft.Hosting"` と `"Default"` によって、`Logging:LogLevel` の設定がオーバーライドされます。</span><span class="sxs-lookup"><span data-stu-id="4bbe8-142">In the preceding JSON, the `Logging:Debug:LogLevel` categories `"Microsoft.Hosting"` and `"Default"` override the settings in `Logging:LogLevel`</span></span>

<span data-ttu-id="4bbe8-143">最小ログ レベルは、次のいずれかに指定できます。</span><span class="sxs-lookup"><span data-stu-id="4bbe8-143">The minimum log level can be specified for any of:</span></span>

- <span data-ttu-id="4bbe8-144">特定のプロバイダー: たとえば、`Logging:EventSource:LogLevel:Default:Information`</span><span class="sxs-lookup"><span data-stu-id="4bbe8-144">Specific providers:  For example, `Logging:EventSource:LogLevel:Default:Information`</span></span>
- <span data-ttu-id="4bbe8-145">特定のカテゴリ: たとえば、`Logging:LogLevel:Microsoft:Warning`</span><span class="sxs-lookup"><span data-stu-id="4bbe8-145">Specific categories: For example, `Logging:LogLevel:Microsoft:Warning`</span></span>
- <span data-ttu-id="4bbe8-146">すべてのプロバイダーとすべてのカテゴリ: `Logging:LogLevel:Default:Warning`</span><span class="sxs-lookup"><span data-stu-id="4bbe8-146">All providers and all categories: `Logging:LogLevel:Default:Warning`</span></span>

<span data-ttu-id="4bbe8-147">最小レベルを下回るログは、次のことが "***行われません***"。</span><span class="sxs-lookup"><span data-stu-id="4bbe8-147">Any logs below the minimum level are ***not***:</span></span>

- <span data-ttu-id="4bbe8-148">プロバイダーに渡される。</span><span class="sxs-lookup"><span data-stu-id="4bbe8-148">Passed to the provider.</span></span>
- <span data-ttu-id="4bbe8-149">ログに記録または表示される。</span><span class="sxs-lookup"><span data-stu-id="4bbe8-149">Logged or displayed.</span></span>

<span data-ttu-id="4bbe8-150">すべてのログを抑制するには、[LogLevel.None](xref:Microsoft.Extensions.Logging.LogLevel) を指定します。</span><span class="sxs-lookup"><span data-stu-id="4bbe8-150">To suppress all logs, specify [LogLevel.None](xref:Microsoft.Extensions.Logging.LogLevel).</span></span> <span data-ttu-id="4bbe8-151">`LogLevel.None` の値は、`LogLevel.Critical` (5) より大きい 6 です。</span><span class="sxs-lookup"><span data-stu-id="4bbe8-151">`LogLevel.None` has a value of 6, which is higher than `LogLevel.Critical` (5).</span></span>

<span data-ttu-id="4bbe8-152">プロバイダーで[ログのスコープ](#log-scopes)がサポートされている場合、`IncludeScopes` によってそれを有効にするかどうかが指定されます。</span><span class="sxs-lookup"><span data-stu-id="4bbe8-152">If a provider supports [log scopes](#log-scopes), `IncludeScopes` indicates whether they're enabled.</span></span> <span data-ttu-id="4bbe8-153">詳細については、「[ログ スコープ](#log-scopes)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="4bbe8-153">For more information, see [log scopes](#log-scopes)</span></span>

<span data-ttu-id="4bbe8-154">次の *appsettings.json* ファイルには、すべての組み込みプロバイダー用の設定が含まれています。</span><span class="sxs-lookup"><span data-stu-id="4bbe8-154">The following *appsettings.json* file contains settings for all of the built-in providers:</span></span>

:::code language="json" source="snippets/configuration/worker-service/appsettings.Production.json":::

<span data-ttu-id="4bbe8-155">上記のサンプルについて:</span><span class="sxs-lookup"><span data-stu-id="4bbe8-155">In the preceding sample:</span></span>

- <span data-ttu-id="4bbe8-156">カテゴリとレベルは推奨値ではありません。</span><span class="sxs-lookup"><span data-stu-id="4bbe8-156">The categories and levels are not suggested values.</span></span> <span data-ttu-id="4bbe8-157">このサンプルは、すべての既定のプロバイダーを表示するために提供されています。</span><span class="sxs-lookup"><span data-stu-id="4bbe8-157">The sample is provided to show all the default providers.</span></span>
- <span data-ttu-id="4bbe8-158">`Logging.{ProviderName}.LogLevel` の設定により `Logging.LogLevel` の設定がオーバーライドされます。</span><span class="sxs-lookup"><span data-stu-id="4bbe8-158">Settings in `Logging.{ProviderName}.LogLevel` override settings in `Logging.LogLevel`.</span></span> <span data-ttu-id="4bbe8-159">たとえば、`Debug.LogLevel.Default` のレベルにより `LogLevel.Default` のレベルがオーバーライドされます。</span><span class="sxs-lookup"><span data-stu-id="4bbe8-159">For example, the level in `Debug.LogLevel.Default` overrides the level in `LogLevel.Default`.</span></span>
- <span data-ttu-id="4bbe8-160">各プロバイダーの "*エイリアス*" が使用されています。</span><span class="sxs-lookup"><span data-stu-id="4bbe8-160">Each provider's *alias* is used.</span></span> <span data-ttu-id="4bbe8-161">各プロバイダーでは "*エイリアス*" が定義されます。これは構成で完全修飾型名の代わりに使用できます。</span><span class="sxs-lookup"><span data-stu-id="4bbe8-161">Each provider defines an *alias* that can be used in configuration in place of the fully qualified type name.</span></span> <span data-ttu-id="4bbe8-162">組み込みプロバイダーのエイリアスは次のとおりです。</span><span class="sxs-lookup"><span data-stu-id="4bbe8-162">The built-in providers' aliases are:</span></span>
  - <span data-ttu-id="4bbe8-163">コンソール</span><span class="sxs-lookup"><span data-stu-id="4bbe8-163">Console</span></span>
  - <span data-ttu-id="4bbe8-164">デバッグ</span><span class="sxs-lookup"><span data-stu-id="4bbe8-164">Debug</span></span>
  - <span data-ttu-id="4bbe8-165">EventSource</span><span class="sxs-lookup"><span data-stu-id="4bbe8-165">EventSource</span></span>
  - <span data-ttu-id="4bbe8-166">EventLog</span><span class="sxs-lookup"><span data-stu-id="4bbe8-166">EventLog</span></span>
  - <span data-ttu-id="4bbe8-167">AzureAppServicesFile</span><span class="sxs-lookup"><span data-stu-id="4bbe8-167">AzureAppServicesFile</span></span>
  - <span data-ttu-id="4bbe8-168">AzureAppServicesBlob</span><span class="sxs-lookup"><span data-stu-id="4bbe8-168">AzureAppServicesBlob</span></span>
  - <span data-ttu-id="4bbe8-169">ApplicationInsights</span><span class="sxs-lookup"><span data-stu-id="4bbe8-169">ApplicationInsights</span></span>

### <a name="set-log-level-by-command-line-environment-variables-and-other-configuration"></a><span data-ttu-id="4bbe8-170">コマンド ライン、環境変数、およびその他の構成でログ レベルを設定する</span><span class="sxs-lookup"><span data-stu-id="4bbe8-170">Set log level by command line, environment variables, and other configuration</span></span>

<span data-ttu-id="4bbe8-171">ログ レベルは、いずれかの[構成プロバイダー](configuration-providers.md)で設定できます。</span><span class="sxs-lookup"><span data-stu-id="4bbe8-171">Log level can be set by any of the [configuration providers](configuration-providers.md).</span></span> <span data-ttu-id="4bbe8-172">たとえば、名前が `Logging:LogLevel:Microsoft` で値が `Information` の永続化された環境変数を作成できます。</span><span class="sxs-lookup"><span data-stu-id="4bbe8-172">For example, you can create a persisted environment variable named `Logging:LogLevel:Microsoft` with a value of `Information`.</span></span>

## <a name="command-line"></a>[<span data-ttu-id="4bbe8-173">コマンド ライン</span><span class="sxs-lookup"><span data-stu-id="4bbe8-173">Command Line</span></span>](#tab/command-line)

<span data-ttu-id="4bbe8-174">ログ レベルの値が代入された、永続化された環境変数を作成します。</span><span class="sxs-lookup"><span data-stu-id="4bbe8-174">Create and assign persisted environment variable, given the log level value.</span></span>

```CMD
:: Assigns the env var to the value
setx "Logging__LogLevel__Microsoft" "Information" /M
```

<span data-ttu-id="4bbe8-175">**コマンド プロンプト** の "*新しい*" インスタンスで、環境変数を読み取ります。</span><span class="sxs-lookup"><span data-stu-id="4bbe8-175">In a *new* instance of the **Command Prompt**, read the environment variable.</span></span>

```CMD
:: Prints the env var value
echo %Logging__LogLevel__Microsoft%
```

## <a name="powershell"></a>[<span data-ttu-id="4bbe8-176">PowerShell</span><span class="sxs-lookup"><span data-stu-id="4bbe8-176">PowerShell</span></span>](#tab/powershell)

<span data-ttu-id="4bbe8-177">ログ レベルの値が代入された、永続化された環境変数を作成します。</span><span class="sxs-lookup"><span data-stu-id="4bbe8-177">Create and assign persisted environment variable, given the log level value.</span></span>

```powershell
# Assigns the env var to the value
[System.Environment]::SetEnvironmentVariable(
    "Logging__LogLevel__Microsoft", "Information", "Machine")
```

<span data-ttu-id="4bbe8-178">**PowerShell** の "*新しい*" インスタンスで、環境変数を読み取ります。</span><span class="sxs-lookup"><span data-stu-id="4bbe8-178">In a *new* instance of the **PowerShell**, read the environment variable.</span></span>

```powershell
# Prints the env var value
[System.Environment]::GetEnvironmentVariable(
    "Logging__LogLevel__Microsoft", "Machine")
```

## <a name="bash"></a>[<span data-ttu-id="4bbe8-179">Bash</span><span class="sxs-lookup"><span data-stu-id="4bbe8-179">Bash</span></span>](#tab/bash)

<span data-ttu-id="4bbe8-180">ログ レベルの値が代入された、永続化された環境変数を作成します。</span><span class="sxs-lookup"><span data-stu-id="4bbe8-180">Create and assign persisted environment variable, given the log level value.</span></span>

```Bash
# Assigns the env var to the value, persists it across sessions
echo export Logging__LogLevel__Microsoft="Information" >> ~/.bashrc && source ~/.bashrc
```

<span data-ttu-id="4bbe8-181">環境変数を読み取ります。</span><span class="sxs-lookup"><span data-stu-id="4bbe8-181">To read the environment variable.</span></span>

```Bash
# Prints the env var value
echo $Logging__LogLevel__Microsoft

# Or use printenv:
# printenv Logging__LogLevel__Microsoft
```

> [!NOTE]
> <span data-ttu-id="4bbe8-182">`.` (ピリオド) を含む名前で環境変数を構成する場合は、**Stack Exchange** の「ドット (.) が含まれる変数のエクスポート」という質問と、それに対して[受け入れられた回答](https://unix.stackexchange.com/a/93533)を考慮してください。</span><span class="sxs-lookup"><span data-stu-id="4bbe8-182">When configuring environment variables with names that contain `.` (periods), consider the "Exporting a variable with a dot (.) in it" question on **Stack Exchange** and its corresponding [accepted answer](https://unix.stackexchange.com/a/93533).</span></span>

---

<span data-ttu-id="4bbe8-183">上記の環境設定は、環境内に保持されます。</span><span class="sxs-lookup"><span data-stu-id="4bbe8-183">The preceding environment setting is persisted in the environment.</span></span> <span data-ttu-id="4bbe8-184">.NET Worker サービス テンプレートで作成されたアプリを使用して設定をテストするには、環境変数に代入した後、プロジェクト ディレクトリ内で `dotnet run` コマンドを使用します。</span><span class="sxs-lookup"><span data-stu-id="4bbe8-184">To test the settings when using an app created with the .NET Worker service templates, use the `dotnet run` command in the project directory after the environment variable is assigned.</span></span>

```dotnetcli
dotnet run
```

> [!TIP]
> <span data-ttu-id="4bbe8-185">環境変数を設定した後、統合開発環境 (IDE) を再起動して、新しく追加した環境変数を使用できることを確認します。</span><span class="sxs-lookup"><span data-stu-id="4bbe8-185">After setting an environment variable, restart your integrated development environment (IDE) to ensure that newly added environment variables are available.</span></span>

<span data-ttu-id="4bbe8-186">[Azure App Service](https://azure.microsoft.com/services/app-service/) で、 **設定 > 構成** ページの **新しいアプリケーション設定** を選択します。</span><span class="sxs-lookup"><span data-stu-id="4bbe8-186">On [Azure App Service](https://azure.microsoft.com/services/app-service/), select **New application setting** on the **Settings > Configuration** page.</span></span> <span data-ttu-id="4bbe8-187">Azure App Service アプリケーションの設定は：</span><span class="sxs-lookup"><span data-stu-id="4bbe8-187">Azure App Service application settings are:</span></span>

- <span data-ttu-id="4bbe8-188">保存時に暗号化され、暗号化されたチャネルで送信されます。</span><span class="sxs-lookup"><span data-stu-id="4bbe8-188">Encrypted at rest and transmitted over an encrypted channel.</span></span>
- <span data-ttu-id="4bbe8-189">環境変数として公開されます。</span><span class="sxs-lookup"><span data-stu-id="4bbe8-189">Exposed as environment variables.</span></span>

<span data-ttu-id="4bbe8-190">環境変数を使用して .NET 構成値を設定する方法の詳細については、[環境変数](configuration-providers.md#environment-variable-configuration-provider)に関する記事を参照してください。</span><span class="sxs-lookup"><span data-stu-id="4bbe8-190">For more information on setting .NET configuration values using environment variables, see [environment variables](configuration-providers.md#environment-variable-configuration-provider).</span></span>

## <a name="how-filtering-rules-are-applied"></a><span data-ttu-id="4bbe8-191">フィルター規則を適用する方法</span><span class="sxs-lookup"><span data-stu-id="4bbe8-191">How filtering rules are applied</span></span>

<span data-ttu-id="4bbe8-192"><xref:Microsoft.Extensions.Logging.ILogger%601> オブジェクトを作成すると、<xref:Microsoft.Extensions.Logging.ILoggerFactory> オブジェクトによって、そのロガーに適用するプロバイダーごとに 1 つの規則が選択されます。</span><span class="sxs-lookup"><span data-stu-id="4bbe8-192">When an <xref:Microsoft.Extensions.Logging.ILogger%601> object is created, the <xref:Microsoft.Extensions.Logging.ILoggerFactory> object selects a single rule per provider to apply to that logger.</span></span> <span data-ttu-id="4bbe8-193">`ILogger` インスタンスによって書き込まれるすべてのメッセージは、選択した規則に基づいてフィルター処理されます。</span><span class="sxs-lookup"><span data-stu-id="4bbe8-193">All messages written by an `ILogger` instance are filtered based on the selected rules.</span></span> <span data-ttu-id="4bbe8-194">使用できる規則から、各プロバイダーとカテゴリのペアごとに最も明確な規則が選択されます。</span><span class="sxs-lookup"><span data-stu-id="4bbe8-194">The most specific rule for each provider and category pair is selected from the available rules.</span></span>

<span data-ttu-id="4bbe8-195">特定のカテゴリに `ILogger` が作成されるときに、各プロバイダーに次のアルゴリズムが使用されます。</span><span class="sxs-lookup"><span data-stu-id="4bbe8-195">The following algorithm is used for each provider when an `ILogger` is created for a given category:</span></span>

- <span data-ttu-id="4bbe8-196">プロバイダーとそのエイリアスと一致するすべての規則が選択されます。</span><span class="sxs-lookup"><span data-stu-id="4bbe8-196">Select all rules that match the provider or its alias.</span></span> <span data-ttu-id="4bbe8-197">一致が見つからない場合は、空のプロバイダーですべての規則が選択されます。</span><span class="sxs-lookup"><span data-stu-id="4bbe8-197">If no match is found, select all rules with an empty provider.</span></span>
- <span data-ttu-id="4bbe8-198">前の手順の結果、最も長いカテゴリのプレフィックスが一致する規則が選択されます。</span><span class="sxs-lookup"><span data-stu-id="4bbe8-198">From the result of the preceding step, select rules with longest matching category prefix.</span></span> <span data-ttu-id="4bbe8-199">一致が見つからない場合は、カテゴリを指定しないすべての規則が選択されます。</span><span class="sxs-lookup"><span data-stu-id="4bbe8-199">If no match is found, select all rules that don't specify a category.</span></span>
- <span data-ttu-id="4bbe8-200">複数の規則が選択されている場合は、**最後** の 1 つが使用されます。</span><span class="sxs-lookup"><span data-stu-id="4bbe8-200">If multiple rules are selected, take the **last** one.</span></span>
- <span data-ttu-id="4bbe8-201">規則が選択されていない場合は、<xref:Microsoft.Extensions.Logging.LoggingBuilderExtensions.SetMinimumLevel(Microsoft.Extensions.Logging.ILoggingBuilder,Microsoft.Extensions.Logging.LogLevel)?displayProperty=nameWithType> を使用して最小ログ記録レベルを指定します。</span><span class="sxs-lookup"><span data-stu-id="4bbe8-201">If no rules are selected, use <xref:Microsoft.Extensions.Logging.LoggingBuilderExtensions.SetMinimumLevel(Microsoft.Extensions.Logging.ILoggingBuilder,Microsoft.Extensions.Logging.LogLevel)?displayProperty=nameWithType> to specify the minimum logging level.</span></span>

## <a name="log-category"></a><span data-ttu-id="4bbe8-202">ログのカテゴリ</span><span class="sxs-lookup"><span data-stu-id="4bbe8-202">Log category</span></span>

<span data-ttu-id="4bbe8-203">`ILogger` オブジェクトが作成されるときに、"*カテゴリ*" が指定されます。</span><span class="sxs-lookup"><span data-stu-id="4bbe8-203">When an `ILogger` object is created, a *category* is specified.</span></span> <span data-ttu-id="4bbe8-204">このカテゴリは、`ILogger` のインスタンスによって作成される各ログ メッセージと共に含められます。</span><span class="sxs-lookup"><span data-stu-id="4bbe8-204">That category is included with each log message created by that instance of `ILogger`.</span></span> <span data-ttu-id="4bbe8-205">カテゴリ文字列は任意ですが、規則ではクラス名を使用します。</span><span class="sxs-lookup"><span data-stu-id="4bbe8-205">The category string is arbitrary, but the convention is to use the class name.</span></span> <span data-ttu-id="4bbe8-206">たとえば、サービスが次のオブジェクトように定義されているアプリケーションでは、カテゴリは `"Example.DefaultService"` のようになります。</span><span class="sxs-lookup"><span data-stu-id="4bbe8-206">For example, in an application with a service define like the following object, the category might be `"Example.DefaultService"`:</span></span>

```csharp
namespace Example
{
    public class DefaultService : IService
    {
        private readonly ILogger<DefaultService> _logger;

        public DefaultService(ILogger<DefaultService> logger) =>
            _logger = logger;

        // ...
    }
}
```

<span data-ttu-id="4bbe8-207">カテゴリを明示的に指定するには、<xref:Microsoft.Extensions.Logging.LoggerFactory.CreateLogger%2A?displayProperty=nameWithType> を呼び出します。</span><span class="sxs-lookup"><span data-stu-id="4bbe8-207">To explicitly specify the category, call <xref:Microsoft.Extensions.Logging.LoggerFactory.CreateLogger%2A?displayProperty=nameWithType>:</span></span>

```csharp
namespace Example
{
    public class DefaultService : IService
    {
        private readonly ILogger _logger;

        public DefaultService(ILoggerFactory loggerFactory) =>
            _logger = loggerFactory.CreateLogger("CustomCategory");

        // ...
    }
}
```

<span data-ttu-id="4bbe8-208">複数のクラスや型で使用する場合、固定名を使用して `CreateLogger` を呼び出すと、イベントをカテゴリ別に分類できるので便利です。</span><span class="sxs-lookup"><span data-stu-id="4bbe8-208">Calling `CreateLogger` with a fixed name can be useful when used in multiple classes/types so the events can be organized by category.</span></span>

<span data-ttu-id="4bbe8-209">`ILogger<T>` は、`T` の完全修飾型名を使用した `CreateLogger` の呼び出しと同じです。</span><span class="sxs-lookup"><span data-stu-id="4bbe8-209">`ILogger<T>` is equivalent to calling `CreateLogger` with the fully qualified type name of `T`.</span></span>

## <a name="log-level"></a><span data-ttu-id="4bbe8-210">ログ レベル</span><span class="sxs-lookup"><span data-stu-id="4bbe8-210">Log level</span></span>

<span data-ttu-id="4bbe8-211">次の表に、<xref:Microsoft.Extensions.Logging.LogLevel> 値、便利な `Log{LogLevel}` 拡張メソッド、推奨される使用法を示します。</span><span class="sxs-lookup"><span data-stu-id="4bbe8-211">The following table lists the <xref:Microsoft.Extensions.Logging.LogLevel> values, the convenience `Log{LogLevel}` extension method, and the suggested usage:</span></span>

| <span data-ttu-id="4bbe8-212">LogLevel</span><span class="sxs-lookup"><span data-stu-id="4bbe8-212">LogLevel</span></span> | <span data-ttu-id="4bbe8-213">[値]</span><span class="sxs-lookup"><span data-stu-id="4bbe8-213">Value</span></span> | <span data-ttu-id="4bbe8-214">Method</span><span class="sxs-lookup"><span data-stu-id="4bbe8-214">Method</span></span> | <span data-ttu-id="4bbe8-215">説明</span><span class="sxs-lookup"><span data-stu-id="4bbe8-215">Description</span></span> |
|--|--|--|--|
| [<span data-ttu-id="4bbe8-216">トレース</span><span class="sxs-lookup"><span data-stu-id="4bbe8-216">Trace</span></span>](xref:Microsoft.Extensions.Logging.LogLevel) | <span data-ttu-id="4bbe8-217">0</span><span class="sxs-lookup"><span data-stu-id="4bbe8-217">0</span></span> | <xref:Microsoft.Extensions.Logging.LoggerExtensions.LogTrace%2A> | <span data-ttu-id="4bbe8-218">最も詳細なメッセージが含まれます。</span><span class="sxs-lookup"><span data-stu-id="4bbe8-218">Contain the most detailed messages.</span></span> <span data-ttu-id="4bbe8-219">これらのメッセージには、機密性の高いアプリ データが含まれる場合があります。</span><span class="sxs-lookup"><span data-stu-id="4bbe8-219">These messages may contain sensitive app data.</span></span> <span data-ttu-id="4bbe8-220">これらのメッセージは既定で無効になっているため、運用環境では有効に "***しないでください***"。</span><span class="sxs-lookup"><span data-stu-id="4bbe8-220">These messages are disabled by default and should ***not*** be enabled in production.</span></span> |
| [<span data-ttu-id="4bbe8-221">デバッグ</span><span class="sxs-lookup"><span data-stu-id="4bbe8-221">Debug</span></span>](xref:Microsoft.Extensions.Logging.LogLevel) | <span data-ttu-id="4bbe8-222">1</span><span class="sxs-lookup"><span data-stu-id="4bbe8-222">1</span></span> | <xref:Microsoft.Extensions.Logging.LoggerExtensions.LogDebug%2A> | <span data-ttu-id="4bbe8-223">デバッグと開発用。</span><span class="sxs-lookup"><span data-stu-id="4bbe8-223">For debugging and development.</span></span> <span data-ttu-id="4bbe8-224">量が多いため、運用環境では慎重に使用してください。</span><span class="sxs-lookup"><span data-stu-id="4bbe8-224">Use with caution in production due to the high volume.</span></span> |
| [<span data-ttu-id="4bbe8-225">情報</span><span class="sxs-lookup"><span data-stu-id="4bbe8-225">Information</span></span>](xref:Microsoft.Extensions.Logging.LogLevel) | <span data-ttu-id="4bbe8-226">2</span><span class="sxs-lookup"><span data-stu-id="4bbe8-226">2</span></span> | <xref:Microsoft.Extensions.Logging.LoggerExtensions.LogInformation%2A> | <span data-ttu-id="4bbe8-227">アプリの一般的なフローを追跡します。</span><span class="sxs-lookup"><span data-stu-id="4bbe8-227">Tracks the general flow of the app.</span></span> <span data-ttu-id="4bbe8-228">長期的な値が含まれている可能性があります。</span><span class="sxs-lookup"><span data-stu-id="4bbe8-228">May have long-term value.</span></span> |
| [<span data-ttu-id="4bbe8-229">警告</span><span class="sxs-lookup"><span data-stu-id="4bbe8-229">Warning</span></span>](xref:Microsoft.Extensions.Logging.LogLevel) | <span data-ttu-id="4bbe8-230">3</span><span class="sxs-lookup"><span data-stu-id="4bbe8-230">3</span></span> | <xref:Microsoft.Extensions.Logging.LoggerExtensions.LogWarning%2A> | <span data-ttu-id="4bbe8-231">異常なイベントや予期しないイベント用。</span><span class="sxs-lookup"><span data-stu-id="4bbe8-231">For abnormal or unexpected events.</span></span> <span data-ttu-id="4bbe8-232">通常、アプリが失敗する原因にならないエラーや条件が含まれます。</span><span class="sxs-lookup"><span data-stu-id="4bbe8-232">Typically includes errors or conditions that don't cause the app to fail.</span></span> |
| [<span data-ttu-id="4bbe8-233">エラー</span><span class="sxs-lookup"><span data-stu-id="4bbe8-233">Error</span></span>](xref:Microsoft.Extensions.Logging.LogLevel) | <span data-ttu-id="4bbe8-234">4</span><span class="sxs-lookup"><span data-stu-id="4bbe8-234">4</span></span> | <xref:Microsoft.Extensions.Logging.LoggerExtensions.LogError%2A> | <span data-ttu-id="4bbe8-235">処理できないエラーと例外の場合。</span><span class="sxs-lookup"><span data-stu-id="4bbe8-235">For errors and exceptions that cannot be handled.</span></span> <span data-ttu-id="4bbe8-236">これらのメッセージは、アプリ全体のエラーではなく、現在の操作や要求における失敗を示します。</span><span class="sxs-lookup"><span data-stu-id="4bbe8-236">These messages indicate a failure in the current operation or request, not an app-wide failure.</span></span> |
| [<span data-ttu-id="4bbe8-237">重大</span><span class="sxs-lookup"><span data-stu-id="4bbe8-237">Critical</span></span>](xref:Microsoft.Extensions.Logging.LogLevel) | <span data-ttu-id="4bbe8-238">5</span><span class="sxs-lookup"><span data-stu-id="4bbe8-238">5</span></span> | <xref:Microsoft.Extensions.Logging.LoggerExtensions.LogCritical%2A> | <span data-ttu-id="4bbe8-239">即時の注意が必要なエラーの場合。</span><span class="sxs-lookup"><span data-stu-id="4bbe8-239">For failures that require immediate attention.</span></span> <span data-ttu-id="4bbe8-240">例: データ損失のシナリオ、ディスク領域不足。</span><span class="sxs-lookup"><span data-stu-id="4bbe8-240">Examples: data loss scenarios, out of disk space.</span></span> |
| [<span data-ttu-id="4bbe8-241">None</span><span class="sxs-lookup"><span data-stu-id="4bbe8-241">None</span></span>](xref:Microsoft.Extensions.Logging.LogLevel) | <span data-ttu-id="4bbe8-242">6</span><span class="sxs-lookup"><span data-stu-id="4bbe8-242">6</span></span> |  | <span data-ttu-id="4bbe8-243">メッセージを書き込む必要がないことを指定します。</span><span class="sxs-lookup"><span data-stu-id="4bbe8-243">Specifies that no messages should be written.</span></span> |

<span data-ttu-id="4bbe8-244">前の表では、重大度が最も低い方から高い方に `LogLevel` が一覧表示されています。</span><span class="sxs-lookup"><span data-stu-id="4bbe8-244">In the previous table, the `LogLevel` is listed from lowest to highest severity.</span></span>

<span data-ttu-id="4bbe8-245">[Log](xref:Microsoft.Extensions.Logging.LoggerExtensions) メソッドの最初のパラメーター <xref:Microsoft.Extensions.Logging.LogLevel> は、ログの重大度を示します。</span><span class="sxs-lookup"><span data-stu-id="4bbe8-245">The [Log](xref:Microsoft.Extensions.Logging.LoggerExtensions) method's first parameter, <xref:Microsoft.Extensions.Logging.LogLevel>, indicates the severity of the log.</span></span> <span data-ttu-id="4bbe8-246">ほとんどの開発者は、`Log(LogLevel, ...)` を呼び出すのではなく、[Log{LogLevel}](xref:Microsoft.Extensions.Logging.LoggerExtensions) 拡張メソッドを呼び出します。</span><span class="sxs-lookup"><span data-stu-id="4bbe8-246">Rather than calling `Log(LogLevel, ...)`, most developers call the [Log{LogLevel}](xref:Microsoft.Extensions.Logging.LoggerExtensions) extension methods.</span></span> <span data-ttu-id="4bbe8-247">`Log{LogLevel}` 拡張メソッドによって、[Log メソッドが呼び出され、LogLevel が指定されます](https://github.com/dotnet/extensions/blob/release/3.1/src/Logging/Logging.Abstractions/src/LoggerExtensions.cs)。</span><span class="sxs-lookup"><span data-stu-id="4bbe8-247">The `Log{LogLevel}` extension methods [call the Log method and specify the LogLevel](https://github.com/dotnet/extensions/blob/release/3.1/src/Logging/Logging.Abstractions/src/LoggerExtensions.cs).</span></span> <span data-ttu-id="4bbe8-248">たとえば、次の 2 つのログ呼び出しは、機能的に同等で、同じログが生成されます。</span><span class="sxs-lookup"><span data-stu-id="4bbe8-248">For example, the following two logging calls are functionally equivalent and produce the same log:</span></span>

```csharp
public void LogDetails()
{
    var logMessage = "Details for log.";

    _logger.Log(LogLevel.Information, AppLogEvents.Details, logMessage);
    _logger.LogInformation(AppLogEvents.Details, logMessage);
}
```

<span data-ttu-id="4bbe8-249">`AppLogEvents.Details` はイベント ID であり、暗黙的に <xref:System.Int32> 定数値によって表されます。</span><span class="sxs-lookup"><span data-stu-id="4bbe8-249">`AppLogEvents.Details` is the event ID, and is implicitly represented by a constant <xref:System.Int32> value.</span></span> <span data-ttu-id="4bbe8-250">`AppLogEvents` はさまざまな名前付き識別子定数を公開するクラスであり、[ログ イベント ID](#log-event-id) セクションに表示されます。</span><span class="sxs-lookup"><span data-stu-id="4bbe8-250">`AppLogEvents` is a class that exposes various named identifier constants and is displayed in the [Log event ID](#log-event-id) section.</span></span>

<span data-ttu-id="4bbe8-251">`Information` および `Warning` ログを作成するコードを次に示します。</span><span class="sxs-lookup"><span data-stu-id="4bbe8-251">The following code creates `Information` and `Warning` logs:</span></span>

```csharp
public async Task<T> GetAsync<T>(string id)
{
    _logger.LogInformation(AppLogEvents.Read, "Reading value for {Id}", id);

    var result = await _repository.GetAsync(id);
    if (result is null)
    {
        _logger.LogWarning(AppLogEvents.ReadNotFound, "GetAsync({Id}) not found", id);
    }

    return result;
}
```

<span data-ttu-id="4bbe8-252">上記のコードでは、最初の `Log{LogLevel}` パラメーター `AppLogEvents.Read` は、[ログ イベント ID](#log-event-id) です。</span><span class="sxs-lookup"><span data-stu-id="4bbe8-252">In the preceding code, the first `Log{LogLevel}` parameter,`AppLogEvents.Read`, is the [Log event ID](#log-event-id).</span></span> <span data-ttu-id="4bbe8-253">2 つ目のパラメーターは、他のメソッド パラメーターによって提供される引数値のプレースホルダーを含むメッセージ テンプレートです。</span><span class="sxs-lookup"><span data-stu-id="4bbe8-253">The second parameter is a message template with placeholders for argument values provided by the remaining method parameters.</span></span> <span data-ttu-id="4bbe8-254">メソッド パラメーターについては、この記事の後半の[メッセージ テンプレート](#log-message-template)に関するセクションで説明します。</span><span class="sxs-lookup"><span data-stu-id="4bbe8-254">The method parameters are explained in the [message template](#log-message-template) section later in this article.</span></span>

<span data-ttu-id="4bbe8-255">適切なログ レベルを構成し、適切な `Log{LogLevel}` メソッドを呼び出して、特定のストレージ メディアに書き込むログ出力の量を制御します。</span><span class="sxs-lookup"><span data-stu-id="4bbe8-255">Configure the appropriate log level and call the correct `Log{LogLevel}` methods to control how much log output is written to a particular storage medium.</span></span> <span data-ttu-id="4bbe8-256">次に例を示します。</span><span class="sxs-lookup"><span data-stu-id="4bbe8-256">For example:</span></span>

- <span data-ttu-id="4bbe8-257">運用環境:</span><span class="sxs-lookup"><span data-stu-id="4bbe8-257">In production:</span></span>
  - <span data-ttu-id="4bbe8-258">`Trace` または `Information` のレベルでログを記録すると、詳細なログ メッセージが大量に生成されます。</span><span class="sxs-lookup"><span data-stu-id="4bbe8-258">Logging at the `Trace` or `Information` levels produces a high-volume of detailed log messages.</span></span> <span data-ttu-id="4bbe8-259">コストを制御し、データ ストレージの上限を超えないようにするには、`Trace` および `Information` のレベルのメッセージを、大容量の低コストのデータ ストアに記録します。</span><span class="sxs-lookup"><span data-stu-id="4bbe8-259">To control costs and not exceed data storage limits, log `Trace` and `Information` level messages to a high-volume, low-cost data store.</span></span> <span data-ttu-id="4bbe8-260">`Trace` と `Information` を特定のカテゴリに制限することを検討してください。</span><span class="sxs-lookup"><span data-stu-id="4bbe8-260">Consider limiting `Trace` and `Information` to specific categories.</span></span>
  - <span data-ttu-id="4bbe8-261">`Warning` から `Critical` のレベルでログを記録しても、ログ メッセージはほとんど生成されません。</span><span class="sxs-lookup"><span data-stu-id="4bbe8-261">Logging at `Warning` through `Critical` levels should produce few log messages.</span></span>
    - <span data-ttu-id="4bbe8-262">通常、コストとストレージの制限は考慮されません。</span><span class="sxs-lookup"><span data-stu-id="4bbe8-262">Costs and storage limits usually aren't a concern.</span></span>
    - <span data-ttu-id="4bbe8-263">ログの数が少ないほど、データ ストアをより柔軟に選択できるようになります。</span><span class="sxs-lookup"><span data-stu-id="4bbe8-263">Few logs allow more flexibility in data store choices.</span></span>
- <span data-ttu-id="4bbe8-264">開発中:</span><span class="sxs-lookup"><span data-stu-id="4bbe8-264">In development:</span></span>
  - <span data-ttu-id="4bbe8-265">`Warning` を設定します。</span><span class="sxs-lookup"><span data-stu-id="4bbe8-265">Set to `Warning`.</span></span>
  - <span data-ttu-id="4bbe8-266">トラブルシューティングの際に `Trace` または `Information` のメッセージを追加します。</span><span class="sxs-lookup"><span data-stu-id="4bbe8-266">Add `Trace` or `Information` messages when troubleshooting.</span></span> <span data-ttu-id="4bbe8-267">出力を制限するには、調査中のカテゴリに対してのみ `Trace` または `Information` を設定します。</span><span class="sxs-lookup"><span data-stu-id="4bbe8-267">To limit output, set `Trace` or `Information` only for the categories under investigation.</span></span>

<span data-ttu-id="4bbe8-268">次の JSON は `Logging:Console:LogLevel:Microsoft:Information` を設定します。</span><span class="sxs-lookup"><span data-stu-id="4bbe8-268">The following JSON sets `Logging:Console:LogLevel:Microsoft:Information`:</span></span>

:::code language="json" source="snippets/configuration/worker-service/appsettings.MSFT.json":::

## <a name="log-event-id"></a><span data-ttu-id="4bbe8-269">ログ イベント ID</span><span class="sxs-lookup"><span data-stu-id="4bbe8-269">Log event ID</span></span>

<span data-ttu-id="4bbe8-270">各ログでは、"*イベント識別子*" を指定できます。<xref:Microsoft.Extensions.Logging.EventId> は、`Id` および省略可能な `Name` 読み取り専用プロパティを持つ構造体です。</span><span class="sxs-lookup"><span data-stu-id="4bbe8-270">Each log can specify an *event identifer*, the <xref:Microsoft.Extensions.Logging.EventId> is a structure with an `Id` and optional `Name` readonly properties.</span></span> <span data-ttu-id="4bbe8-271">サンプル ソース コードでは、`AppLogEvents` クラスを使用してイベント ID を定義しています。</span><span class="sxs-lookup"><span data-stu-id="4bbe8-271">The sample source code uses the `AppLogEvents` class to define event IDs:</span></span>

```csharp
internal static class AppLogEvents
{
    internal const int Create = 1000;
    internal const int Read = 1001;
    internal const int Update = 1002;
    internal const int Delete = 1003;

    internal const int Details = 3000;
    internal const int Error = 3001;

    internal const int ReadNotFound = 4000;
    internal const int UpdateNotFound = 4001;

    // ...
}
```

<span data-ttu-id="4bbe8-272">イベント ID によって一連のイベントが関連付けられます。</span><span class="sxs-lookup"><span data-stu-id="4bbe8-272">An event ID associates a set of events.</span></span> <span data-ttu-id="4bbe8-273">たとえば、リポジトリからの値の読み取りに関連するすべてのログを `1001` にすることができます。</span><span class="sxs-lookup"><span data-stu-id="4bbe8-273">For example, all logs related to reading values from a repository might be `1001`.</span></span>

<span data-ttu-id="4bbe8-274">ログ プロバイダーでは、ID フィールドやログ メッセージにイベント ID が記録されたり、またはまったく記録されなかったりする場合があります。</span><span class="sxs-lookup"><span data-stu-id="4bbe8-274">The logging provider may log the event ID in an ID field, in the logging message, or not at all.</span></span> <span data-ttu-id="4bbe8-275">Debug プロバイダーでイベント ID が表示されることはありません。</span><span class="sxs-lookup"><span data-stu-id="4bbe8-275">The Debug provider doesn't show event IDs.</span></span> <span data-ttu-id="4bbe8-276">Console プロバイダーでは、カテゴリの後のブラケット内にイベント ID が表示されます。</span><span class="sxs-lookup"><span data-stu-id="4bbe8-276">The console provider shows event IDs in brackets after the category:</span></span>

```console
info: Example.DefaultService.GetAsync[1001]
      Reading value for a1b2c3
warn: Example.DefaultService.GetAsync[4000]
      GetAsync(a1b2c3) not found
```

<span data-ttu-id="4bbe8-277">一部のログ プロバイダーでは、イベント ID がフィールドに格納されます。これにより、ID に対するフィルター処理が可能になります。</span><span class="sxs-lookup"><span data-stu-id="4bbe8-277">Some logging providers store the event ID in a field, which allows for filtering on the ID.</span></span>

## <a name="log-message-template"></a><span data-ttu-id="4bbe8-278">ログ メッセージ テンプレート</span><span class="sxs-lookup"><span data-stu-id="4bbe8-278">Log message template</span></span>

<span data-ttu-id="4bbe8-279">各ログ API では、メッセージ テンプレートが使用されます。</span><span class="sxs-lookup"><span data-stu-id="4bbe8-279">Each log API uses a message template.</span></span> <span data-ttu-id="4bbe8-280">メッセージ テンプレートには、指定される引数のためのプレースホルダーを含めることができます。</span><span class="sxs-lookup"><span data-stu-id="4bbe8-280">The message template can contain placeholders for which arguments are provided.</span></span> <span data-ttu-id="4bbe8-281">プレースホルダーには、数値ではなく名前を使用します。</span><span class="sxs-lookup"><span data-stu-id="4bbe8-281">Use names for the placeholders, not numbers.</span></span> <span data-ttu-id="4bbe8-282">プレースホルダーの名前ではなく、プレースホルダーの順序によって、値の指定に使用されるパラメーターが決まります。</span><span class="sxs-lookup"><span data-stu-id="4bbe8-282">The order of placeholders, not their names, determines which parameters are used to provide their values.</span></span> <span data-ttu-id="4bbe8-283">次のコードでは、パラメーター名がメッセージ テンプレート内のシーケンスの外にあります。</span><span class="sxs-lookup"><span data-stu-id="4bbe8-283">In the following code, the parameter names are out of sequence in the message template:</span></span>

```csharp
string p1 = "param1";
string p2 = "param2";
_logger.LogInformation("Parameter values: {p2}, {p1}", p1, p2);
```

<span data-ttu-id="4bbe8-284">上記のコードでは、シーケンス内のパラメーター値を含むログ メッセージが作成されます。</span><span class="sxs-lookup"><span data-stu-id="4bbe8-284">The preceding code creates a log message with the parameter values in sequence:</span></span>

```text
Parameter values: param1, param2
```

<span data-ttu-id="4bbe8-285">この方法により、ログ プロバイダーが [セマンティック ログまたは構造化ログ](https://github.com/NLog/NLog/wiki/How-to-use-structured-logging)を実装できるようになります。</span><span class="sxs-lookup"><span data-stu-id="4bbe8-285">This approach allows logging providers to implement [semantic or structured logging](https://github.com/NLog/NLog/wiki/How-to-use-structured-logging).</span></span> <span data-ttu-id="4bbe8-286">書式設定されたメッセージ テンプレートだけでなく、引数自体がログ システムに渡されます。</span><span class="sxs-lookup"><span data-stu-id="4bbe8-286">The arguments themselves are passed to the logging system, not just the formatted message template.</span></span> <span data-ttu-id="4bbe8-287">これにより、ログ プロバイダーはフィールドとしてパラメーター値を格納することができます。</span><span class="sxs-lookup"><span data-stu-id="4bbe8-287">This enables logging providers to store the parameter values as fields.</span></span> <span data-ttu-id="4bbe8-288">次のロガー メソッドについて考えてみます。</span><span class="sxs-lookup"><span data-stu-id="4bbe8-288">Consider the following logger method:</span></span>

```csharp
_logger.LogInformation("Getting item {Id} at {RunTime}", id, DateTime.Now);
```

<span data-ttu-id="4bbe8-289">たとえば、Azure Table Storage にログを記録する場合:</span><span class="sxs-lookup"><span data-stu-id="4bbe8-289">For example, when logging to Azure Table Storage:</span></span>

- <span data-ttu-id="4bbe8-290">各 Azure Table エンティティには、`ID` プロパティと `RunTime` プロパティを含めることができます。</span><span class="sxs-lookup"><span data-stu-id="4bbe8-290">Each Azure Table entity can have `ID` and `RunTime` properties.</span></span>
- <span data-ttu-id="4bbe8-291">プロパティを持つテーブルによって、ログに記録されたデータに対するクエリが簡略化されます。</span><span class="sxs-lookup"><span data-stu-id="4bbe8-291">Tables with properties simplify queries on logged data.</span></span> <span data-ttu-id="4bbe8-292">たとえば、クエリによって、特定の `RunTime` の範囲内のすべてのログを検索できます。テキスト メッセージから時間を解析する必要はありません。</span><span class="sxs-lookup"><span data-stu-id="4bbe8-292">For example, a query can find all logs within a particular `RunTime` range without having to parse the time out of the text message.</span></span>

## <a name="log-exceptions"></a><span data-ttu-id="4bbe8-293">例外をログに記録する</span><span class="sxs-lookup"><span data-stu-id="4bbe8-293">Log exceptions</span></span>

<span data-ttu-id="4bbe8-294">ロガー メソッドには、例外パラメーターを受け取るオーバーロードがあります。</span><span class="sxs-lookup"><span data-stu-id="4bbe8-294">The logger methods have overloads that take an exception parameter:</span></span>

```csharp
public void Test(string id)
{
    try
    {
        if (id == "none")
        {
            throw new Exception("Default Id detected.");
        }
    }
    catch (Exception ex)
    {
        _logger.LogWarning(
            AppLogEvents.Error, ex,
            "Failed to process iteration: {Id}", id)
    }
}
```

<span data-ttu-id="4bbe8-295">例外ログはプロバイダー固有です。</span><span class="sxs-lookup"><span data-stu-id="4bbe8-295">Exception logging is provider-specific.</span></span>

### <a name="default-log-level"></a><span data-ttu-id="4bbe8-296">既定のログ レベル</span><span class="sxs-lookup"><span data-stu-id="4bbe8-296">Default log level</span></span>

<span data-ttu-id="4bbe8-297">既定のログ レベルが設定されていない場合、既定のログ レベル値は `Information` になります。</span><span class="sxs-lookup"><span data-stu-id="4bbe8-297">If the default log level is not set, the default log level value is `Information`.</span></span>

<span data-ttu-id="4bbe8-298">たとえば、次のようなワーカー サービス アプリについて考えてみます。</span><span class="sxs-lookup"><span data-stu-id="4bbe8-298">For example, consider the following worker service app:</span></span>

- <span data-ttu-id="4bbe8-299">.NET Worker テンプレートを使用して作成された。</span><span class="sxs-lookup"><span data-stu-id="4bbe8-299">Created with the .NET Worker templates.</span></span>
- <span data-ttu-id="4bbe8-300">*appsettings.json* と *appsettings.Development.json* が削除または名前が変更された。</span><span class="sxs-lookup"><span data-stu-id="4bbe8-300">*appsettings.json* and *appsettings.Development.json* deleted or renamed.</span></span>

<span data-ttu-id="4bbe8-301">上記の設定で、プライバシー ページまたはホーム ページに移動すると、カテゴリ名に `Microsoft` が含まれる多くの`Trace`、`Debug`、`Information` のメッセージが生成されます。</span><span class="sxs-lookup"><span data-stu-id="4bbe8-301">With the preceding setup, navigating to the privacy or home page produces many `Trace`, `Debug`, and `Information`  messages with `Microsoft` in the category name.</span></span>

<span data-ttu-id="4bbe8-302">次のコードは、既定のログ レベルが構成で設定されていない場合に、既定のログ レベルを設定します。</span><span class="sxs-lookup"><span data-stu-id="4bbe8-302">The following code sets the default log level when the default log level is not set in configuration:</span></span>

```csharp
class Program
{
    static Task Main(string[] args) =>
        CreateHostBuilder(args).Build().RunAsync();

    static IHostBuilder CreateHostBuilder(string[] args) =>
        Host.CreateDefaultBuilder(args)
            .ConfigureLogging(logging => logging.SetMinimumLevel(LogLevel.Warning));
}
```

### <a name="filter-function"></a><span data-ttu-id="4bbe8-303">フィルター関数</span><span class="sxs-lookup"><span data-stu-id="4bbe8-303">Filter function</span></span>

<span data-ttu-id="4bbe8-304">フィルター関数は、構成またはコードによって規則が割り当てられていないすべてのプロバイダーとカテゴリに対して呼び出されます。</span><span class="sxs-lookup"><span data-stu-id="4bbe8-304">A filter function is invoked for all providers and categories that don't have rules assigned to them by configuration or code:</span></span>

```csharp
class Program
{
    static Task Main(string[] args) =>
        CreateHostBuilder(args).Build().RunAsync();

    static IHostBuilder CreateHostBuilder(string[] args) =>
        Host.CreateDefaultBuilder(args)
            .ConfigureLogging(logging =>
                logging.AddFilter((provider, category, logLevel) =>
                {
                    return provider.Contains("ConsoleLoggerProvider")
                        && (category.Contains("Example") || category.Contains("Microsoft"))
                        && logLevel >= LogLevel.Information;
                }));
}
```

<span data-ttu-id="4bbe8-305">上記のコードでは、カテゴリに `Example` または `Microsoft` が含まれ、ログ レベルが `Information` 以上の場合にコンソール ログが表示されます。</span><span class="sxs-lookup"><span data-stu-id="4bbe8-305">The preceding code displays console logs when the category contains `Example` or `Microsoft` and the log level is `Information` or higher.</span></span>

## <a name="log-scopes"></a><span data-ttu-id="4bbe8-306">ログのスコープ</span><span class="sxs-lookup"><span data-stu-id="4bbe8-306">Log scopes</span></span>

 <span data-ttu-id="4bbe8-307">"*スコープ*" では、論理操作のセットをグループ化できます。</span><span class="sxs-lookup"><span data-stu-id="4bbe8-307">A *scope* can group a set of logical operations.</span></span> <span data-ttu-id="4bbe8-308">このグループ化を使用して、セットの一部として作成される各ログに同じデータをアタッチすることができます。</span><span class="sxs-lookup"><span data-stu-id="4bbe8-308">This grouping can be used to attach the same data to each log that's created as part of a set.</span></span> <span data-ttu-id="4bbe8-309">たとえば、トランザクション処理の一部として作成されるすべてのログに、トランザクション ID を含めることができます。</span><span class="sxs-lookup"><span data-stu-id="4bbe8-309">For example, every log created as part of processing a transaction can include the transaction ID.</span></span>

<span data-ttu-id="4bbe8-310">スコープは:</span><span class="sxs-lookup"><span data-stu-id="4bbe8-310">A scope:</span></span>

- <span data-ttu-id="4bbe8-311"><xref:Microsoft.Extensions.Logging.ILogger.BeginScope%2A> メソッドによって返される <xref:System.IDisposable> 型です。</span><span class="sxs-lookup"><span data-stu-id="4bbe8-311">Is an <xref:System.IDisposable> type that's returned by the <xref:Microsoft.Extensions.Logging.ILogger.BeginScope%2A> method.</span></span>
- <span data-ttu-id="4bbe8-312">破棄されるまで継続します。</span><span class="sxs-lookup"><span data-stu-id="4bbe8-312">Lasts until it's disposed.</span></span>

<span data-ttu-id="4bbe8-313">次のプロバイダーではスコープがサポートされています。</span><span class="sxs-lookup"><span data-stu-id="4bbe8-313">The following providers support scopes:</span></span>

- `Console`
- [<span data-ttu-id="4bbe8-314">AzureAppServicesFile と AzureAppServicesBlob</span><span class="sxs-lookup"><span data-stu-id="4bbe8-314">AzureAppServicesFile and AzureAppServicesBlob</span></span>](xref:Microsoft.Extensions.Logging.AzureAppServices.BatchingLoggerOptions.IncludeScopes)

<span data-ttu-id="4bbe8-315">ロガーの呼び出しを `using` ブロックでラップすることによって、スコープを使用します。</span><span class="sxs-lookup"><span data-stu-id="4bbe8-315">Use a scope by wrapping logger calls in a `using` block:</span></span>

```csharp
public async Task<T> GetAsync<T>(string id)
{
    T result;

    using (_logger.BeginScope("using block message"))
    {
        _logger.LogInformation(
            AppLogEvents.Read, "Reading value for {Id}", id);

        var result = await _repository.GetAsync(id);
        if (result is null)
        {
            _logger.LogWarning(
                AppLogEvents.ReadNotFound, "GetAsync({Id}) not found", id);
        }
    }

    return result;
}
```

<span data-ttu-id="4bbe8-316">次の JSON では、Console プロバイダーのスコープを有効にしています。</span><span class="sxs-lookup"><span data-stu-id="4bbe8-316">The following JSON enables scopes for the console provider:</span></span>

:::code language="json" source="snippets/configuration/worker-service/appsettings.IncludeScopes.json" highlight="9":::

<span data-ttu-id="4bbe8-317">次のコードでは、Console プロバイダーのスコープを有効にしています。</span><span class="sxs-lookup"><span data-stu-id="4bbe8-317">The following code enables scopes for the console provider:</span></span>

```csharp
class Program
{
    static Task Main(string[] args) =>
        CreateHostBuilder(args).Build().RunAsync();

    static IHostBuilder CreateHostBuilder(string[] args) =>
        Host.CreateDefaultBuilder(args)
            .ConfigureLogging((_, logging) =>
                logging.ClearProviders()
                    .AddConsole(options => options.IncludeScopes = true));
}
```

## <a name="non-host-console-app"></a><span data-ttu-id="4bbe8-318">ホスト コンソール以外のアプリ</span><span class="sxs-lookup"><span data-stu-id="4bbe8-318">Non-host console app</span></span>

<span data-ttu-id="4bbe8-319">[汎用ホスト](generic-host.md)を使用しないアプリのログ記録コードは、[プロバイダーの追加方法](logging-providers.md#built-in-logging-providers)と[ロガーの作成方法](#create-logs)が異なります。</span><span class="sxs-lookup"><span data-stu-id="4bbe8-319">Logging code for apps without a [Generic Host](generic-host.md) differs in the way [providers are added](logging-providers.md#built-in-logging-providers) and [loggers are created](#create-logs).</span></span> <span data-ttu-id="4bbe8-320">ホスト コンソール以外のアプリでは、`LoggerFactory` を作成するときにプロバイダーの `Add{provider name}` 拡張メソッドを呼び出します。</span><span class="sxs-lookup"><span data-stu-id="4bbe8-320">In a non-host console app, call the provider's `Add{provider name}` extension method while creating a `LoggerFactory`:</span></span>

```csharp
class Program
{
    static void Main(string[] args)
    {
        using var loggerFactory = LoggerFactory.Create(builder =>
        {
            builder
                .AddFilter("Microsoft", LogLevel.Warning)
                .AddFilter("System", LogLevel.Warning)
                .AddFilter("LoggingConsoleApp.Program", LogLevel.Debug)
                .AddConsole();
        });

        ILogger logger = loggerFactory.CreateLogger<Program>();
        logger.LogInformation("Example log message");
    }
}
```

<span data-ttu-id="4bbe8-321">`loggerFactory` オブジェクトは、<xref:Microsoft.Extensions.Logging.ILogger> インスタンスを作成するために使用されます。</span><span class="sxs-lookup"><span data-stu-id="4bbe8-321">The `loggerFactory` object is used to create an <xref:Microsoft.Extensions.Logging.ILogger> instance.</span></span>

## <a name="create-logs-in-main"></a><span data-ttu-id="4bbe8-322">Main でログを作成する</span><span class="sxs-lookup"><span data-stu-id="4bbe8-322">Create logs in Main</span></span>

<span data-ttu-id="4bbe8-323">次のコードでは、ホストを構築した後に DI から `ILogger` インスタンスを取得することによって `Main` でログを記録します。</span><span class="sxs-lookup"><span data-stu-id="4bbe8-323">The following code logs in `Main` by getting an `ILogger` instance from DI after building the host:</span></span>

```csharp
using System;
using System.Threading.Tasks;
using Microsoft.Extensions.DependencyInjection;
using Microsoft.Extensions.Hosting;
using Microsoft.Extensions.Logging;

class Program
{
    static Task Main(string[] args)
    {
        IHost host = Host.CreateDefaultBuilder(args).Build();

        var logger = host.Services.GetRequiredService<ILogger<Program>>();
        logger.LogInformation("Host created.");

        return host.RunAsync();
    }
}
```

### <a name="no-asynchronous-logger-methods"></a><span data-ttu-id="4bbe8-324">非同期でないロガー メソッド</span><span class="sxs-lookup"><span data-stu-id="4bbe8-324">No asynchronous logger methods</span></span>

<span data-ttu-id="4bbe8-325">ログ記録は高速に実行され、非同期コードのパフォーマンス コストを下回る必要があります。</span><span class="sxs-lookup"><span data-stu-id="4bbe8-325">Logging should be so fast that it isn't worth the performance cost of asynchronous code.</span></span> <span data-ttu-id="4bbe8-326">ログ データ ストアが低速の場合は、そこへ直接書き込まないでください。</span><span class="sxs-lookup"><span data-stu-id="4bbe8-326">If a logging data store is slow, don't write to it directly.</span></span> <span data-ttu-id="4bbe8-327">まずログ メッセージを高速なストアに書き込んでから、後で低速なストアに移動することを検討してください。</span><span class="sxs-lookup"><span data-stu-id="4bbe8-327">Consider writing the log messages to a fast store initially, then moving them to the slow store later.</span></span> <span data-ttu-id="4bbe8-328">たとえば、SQL Server にログを記録する場合、`Log` メソッドは同期しているため、`Log` メソッドで直接それを行わないでください。</span><span class="sxs-lookup"><span data-stu-id="4bbe8-328">For example, when logging to SQL Server, don't do so directly in a `Log` method, since the `Log` methods are synchronous.</span></span> <span data-ttu-id="4bbe8-329">代わりに、ログ メッセージをインメモリ キューに同期的に追加し、バックグラウンド ワーカーにキューからメッセージをプルさせて、SQL Server にデータをプッシュする非同期処理を実行させます。</span><span class="sxs-lookup"><span data-stu-id="4bbe8-329">Instead, synchronously add log messages to an in-memory queue and have a background worker pull the messages out of the queue to do the asynchronous work of pushing data to SQL Server.</span></span>

## <a name="change-log-levels-in-a-running-app"></a><span data-ttu-id="4bbe8-330">実行中のアプリのログ レベルを変更する</span><span class="sxs-lookup"><span data-stu-id="4bbe8-330">Change log levels in a running app</span></span>

<span data-ttu-id="4bbe8-331">ログ API には、アプリの実行中にログ レベルを変更するシナリオは含まれていません。</span><span class="sxs-lookup"><span data-stu-id="4bbe8-331">The Logging API doesn't include a scenario to change log levels while an app is running.</span></span> <span data-ttu-id="4bbe8-332">ただし、一部の構成プロバイダーは構成を再読み込みすることができ、ログ構成に直ちに影響します。</span><span class="sxs-lookup"><span data-stu-id="4bbe8-332">However, some configuration providers are capable of reloading configuration, which takes immediate effect on logging configuration.</span></span> <span data-ttu-id="4bbe8-333">たとえば、[ファイル構成プロバイダー](configuration-providers.md#file-configuration-provider)では、既定でログ構成が再度読み込まれます。</span><span class="sxs-lookup"><span data-stu-id="4bbe8-333">For example, the [File Configuration Provider](configuration-providers.md#file-configuration-provider) reloads logging configuration by default.</span></span> <span data-ttu-id="4bbe8-334">アプリの実行中にコードの構成が変更された場合、アプリは [IConfigurationRoot.Reload](xref:Microsoft.Extensions.Configuration.IConfigurationRoot.Reload%2A) を呼び出して、アプリのログ構成を更新できます。</span><span class="sxs-lookup"><span data-stu-id="4bbe8-334">If configuration is changed in code while an app is running, the app can call [IConfigurationRoot.Reload](xref:Microsoft.Extensions.Configuration.IConfigurationRoot.Reload%2A) to update the app's logging configuration.</span></span>

## <a name="nuget-packages"></a><span data-ttu-id="4bbe8-335">NuGet パッケージ</span><span class="sxs-lookup"><span data-stu-id="4bbe8-335">NuGet packages</span></span>

<span data-ttu-id="4bbe8-336"><xref:Microsoft.Extensions.Logging.ILogger%601> と <xref:Microsoft.Extensions.Logging.ILoggerFactory> のインターフェイスと実装は .NET Core SDK に含まれています。</span><span class="sxs-lookup"><span data-stu-id="4bbe8-336">The <xref:Microsoft.Extensions.Logging.ILogger%601> and <xref:Microsoft.Extensions.Logging.ILoggerFactory> interfaces and implementations are included in the .NET Core SDK.</span></span> <span data-ttu-id="4bbe8-337">これらは、次の NuGet パッケージでも入手できます。</span><span class="sxs-lookup"><span data-stu-id="4bbe8-337">They are also available in the following NuGet packages:</span></span>

- <span data-ttu-id="4bbe8-338">インターフェイスは、[Microsoft.Extensions.Logging.Abstractions](https://www.nuget.org/packages/Microsoft.Extensions.Logging.Abstractions) にあります。</span><span class="sxs-lookup"><span data-stu-id="4bbe8-338">The interfaces are in [Microsoft.Extensions.Logging.Abstractions](https://www.nuget.org/packages/Microsoft.Extensions.Logging.Abstractions).</span></span>
- <span data-ttu-id="4bbe8-339">既定の実装は、[Microsoft.Extensions.Logging](https://www.nuget.org/packages/microsoft.extensions.logging) にあります。</span><span class="sxs-lookup"><span data-stu-id="4bbe8-339">The default implementations are in [Microsoft.Extensions.Logging](https://www.nuget.org/packages/microsoft.extensions.logging).</span></span>

## <a name="apply-log-filter-rules-in-code"></a><span data-ttu-id="4bbe8-340">コードでログ フィルター規則を適用する</span><span class="sxs-lookup"><span data-stu-id="4bbe8-340">Apply log filter rules in code</span></span>

<span data-ttu-id="4bbe8-341">ログ フィルター規則を設定するには、[構成](configuration.md)を使用することをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="4bbe8-341">The preferred approach for setting log filter rules is by using [Configuration](configuration.md).</span></span>

<span data-ttu-id="4bbe8-342">コードにフィルター規則を登録する方法を次の例に示します。</span><span class="sxs-lookup"><span data-stu-id="4bbe8-342">The following example shows how to register filter rules in code:</span></span>

```csharp
class Program
{
    static Task Main(string[] args) =>
        CreateHostBuilder(args).Build().RunAsync();

    static IHostBuilder CreateHostBuilder(string[] args) =>
        Host.CreateDefaultBuilder(args)
            .ConfigureLogging(logging =>
               logging.AddFilter("System", LogLevel.Debug)
                  .AddFilter<DebugLoggerProvider>("Microsoft", LogLevel.Information)
                  .AddFilter<ConsoleLoggerProvider>("Microsoft", LogLevel.Trace));
}
```

<span data-ttu-id="4bbe8-343">`logging.AddFilter("System", LogLevel.Debug)` は `System` カテゴリとログ レベル `Debug` を指定します。</span><span class="sxs-lookup"><span data-stu-id="4bbe8-343">`logging.AddFilter("System", LogLevel.Debug)` specifies the `System` category and log level `Debug`.</span></span> <span data-ttu-id="4bbe8-344">特定のプロバイダーが構成されていないため、フィルターはすべてのプロバイダーに適用されます。</span><span class="sxs-lookup"><span data-stu-id="4bbe8-344">The filter is applied to all providers because a specific provider was not configured.</span></span>

<span data-ttu-id="4bbe8-345">`AddFilter<DebugLoggerProvider>("Microsoft", LogLevel.Information)` は以下を指定します。</span><span class="sxs-lookup"><span data-stu-id="4bbe8-345">`AddFilter<DebugLoggerProvider>("Microsoft", LogLevel.Information)` specifies:</span></span>

- <span data-ttu-id="4bbe8-346">`Debug` ログ プロバイダー。</span><span class="sxs-lookup"><span data-stu-id="4bbe8-346">The `Debug` logging provider.</span></span>
- <span data-ttu-id="4bbe8-347">ログ レベル `Information` 以上。</span><span class="sxs-lookup"><span data-stu-id="4bbe8-347">Log level `Information` and higher.</span></span>
- <span data-ttu-id="4bbe8-348">`"Microsoft"` で始まるすべてのカテゴリ。</span><span class="sxs-lookup"><span data-stu-id="4bbe8-348">All categories starting with `"Microsoft"`.</span></span>

## <a name="see-also"></a><span data-ttu-id="4bbe8-349">関連項目</span><span class="sxs-lookup"><span data-stu-id="4bbe8-349">See also</span></span>

- [<span data-ttu-id="4bbe8-350">.NET でのログ プロバイダー</span><span class="sxs-lookup"><span data-stu-id="4bbe8-350">Logging providers in .NET</span></span>](logging-providers.md)
- [<span data-ttu-id="4bbe8-351">.NET にカスタム ログ プロバイダーを実装する</span><span class="sxs-lookup"><span data-stu-id="4bbe8-351">Implement a custom logging provider in .NET</span></span>](custom-logging-provider.md)
- [<span data-ttu-id="4bbe8-352">コンソール ログの書式設定</span><span class="sxs-lookup"><span data-stu-id="4bbe8-352">Console log formatting</span></span>](console-log-formatter.md)
- [<span data-ttu-id="4bbe8-353">.NET での高パフォーマンスのログ</span><span class="sxs-lookup"><span data-stu-id="4bbe8-353">High-performance logging in .NET</span></span>](high-performance-logging.md)
- <span data-ttu-id="4bbe8-354">ログに関するバグは [github.com/dotnet/extensions](https://github.com/dotnet/extensions/issues) リポジトリに作成する必要があります</span><span class="sxs-lookup"><span data-stu-id="4bbe8-354">Logging bugs should be created in the [github.com/dotnet/extensions](https://github.com/dotnet/extensions/issues) repo</span></span>
