---
title: Windows Workflow の基本概念
description: この記事では、一部の開発者にとってはなじみのない .NET Framework 4.6.1 のワークフロー開発における概念の一部について説明します。
ms.date: 03/30/2017
ms.assetid: 0e930e80-5060-45d2-8a7a-95c0690105d4
ms.openlocfilehash: a7683791c7aed54beed9256ab08010dfeebe9936
ms.sourcegitcommit: bc293b14af795e0e999e3304dd40c0222cf2ffe4
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 11/26/2020
ms.locfileid: "96265298"
---
# <a name="fundamental-windows-workflow-concepts"></a><span data-ttu-id="07cf5-103">Windows Workflow の基本概念</span><span class="sxs-lookup"><span data-stu-id="07cf5-103">Fundamental Windows Workflow Concepts</span></span>

<span data-ttu-id="07cf5-104">[!INCLUDE[netfx_current_long](../../../includes/netfx-current-long-md.md)] のワークフロー開発で使用される概念は、一部の開発者には不慣れなことも考えられます。</span><span class="sxs-lookup"><span data-stu-id="07cf5-104">Workflow development in the [!INCLUDE[netfx_current_long](../../../includes/netfx-current-long-md.md)] uses concepts that may be new to some developers.</span></span> <span data-ttu-id="07cf5-105">ここでは、そのいくつかの概念について、内容と実装方法を説明します。</span><span class="sxs-lookup"><span data-stu-id="07cf5-105">This topic describes some of the concepts and how they are implemented.</span></span>  
  
## <a name="workflows-and-activities"></a><span data-ttu-id="07cf5-106">ワークフローとアクティビティ</span><span class="sxs-lookup"><span data-stu-id="07cf5-106">Workflows and Activities</span></span>  

 <span data-ttu-id="07cf5-107">ワークフローは、プロセスをモデル化するアクションの構造化されたコレクションです。</span><span class="sxs-lookup"><span data-stu-id="07cf5-107">A workflow is a structured collection of actions that models a process.</span></span> <span data-ttu-id="07cf5-108">ワークフローの各アクションは、アクティビティとしてモデル化されます。</span><span class="sxs-lookup"><span data-stu-id="07cf5-108">Each action in the workflow is modeled as an activity.</span></span> <span data-ttu-id="07cf5-109">ホストがワークフローとのやり取りを行う場合、メソッドと同じようにワークフローを呼び出すときは <xref:System.Activities.WorkflowInvoker> が、1 つのワークフロー インスタンスの実行を明示的に制御するときは <xref:System.Activities.WorkflowApplication> が、インスタンスが複数のシナリオでメッセージ ベースのやり取りを行うときは <xref:System.ServiceModel.WorkflowServiceHost> が使用されます。</span><span class="sxs-lookup"><span data-stu-id="07cf5-109">A host interacts with a workflow by using <xref:System.Activities.WorkflowInvoker> for invoking a workflow as if it were a method,  <xref:System.Activities.WorkflowApplication> for explicit control over the execution of a single workflow instance, and <xref:System.ServiceModel.WorkflowServiceHost> for message-based interactions in multi-instance scenarios.</span></span> <span data-ttu-id="07cf5-110">ワークフローの手順はアクティビティの階層として定義されるため、階層の最上位のアクティビティはワークフローそのものを定義すると言えます。</span><span class="sxs-lookup"><span data-stu-id="07cf5-110">Because steps of the workflow are defined as a hierarchy of activities, the topmost activity in the hierarchy can be said to define the workflow itself.</span></span> <span data-ttu-id="07cf5-111">この階層モデルは、前のバージョンの明示的な `SequentialWorkflow` クラスおよび `StateMachineWorkflow` クラスの代わりになります。</span><span class="sxs-lookup"><span data-stu-id="07cf5-111">This hierarchy model takes the place of the explicit `SequentialWorkflow` and `StateMachineWorkflow` classes from previous versions.</span></span> <span data-ttu-id="07cf5-112">アクティビティ自体は、他のアクティビティの集まりとして (ベースとして <xref:System.Activities.Activity> クラスを使用。通常は XAML を使用して定義されます)、データ アクセスにランタイムを使用できる <xref:System.Activities.CodeActivity> クラスを使用して作成されるカスタムとして、またはワークフロー ランタイムの範囲をアクティビティの作成者に提示する <xref:System.Activities.NativeActivity> クラスを使用して開発されます。</span><span class="sxs-lookup"><span data-stu-id="07cf5-112">Activities themselves are developed as collections of other activities (using the <xref:System.Activities.Activity> class as a base, usually defined by using XAML) or are custom created by using the <xref:System.Activities.CodeActivity> class, which can use the runtime for data access, or by using the <xref:System.Activities.NativeActivity> class, which exposes the breadth of the workflow runtime to the activity author.</span></span> <span data-ttu-id="07cf5-113"><xref:System.Activities.CodeActivity> クラスおよび <xref:System.Activities.NativeActivity> クラスを使用して開発されるアクティビティは、C# などの CLR 準拠の言語を使用して作成されます。</span><span class="sxs-lookup"><span data-stu-id="07cf5-113">Activities developed by using <xref:System.Activities.CodeActivity> and <xref:System.Activities.NativeActivity> are created by using CLR-compliant languages such as C#.</span></span>  
  
## <a name="activity-data-model"></a><span data-ttu-id="07cf5-114">アクティビティ データ モデル</span><span class="sxs-lookup"><span data-stu-id="07cf5-114">Activity Data Model</span></span>  

 <span data-ttu-id="07cf5-115">アクティビティは、次の表に示すタイプを使用してデータを格納および共有します。</span><span class="sxs-lookup"><span data-stu-id="07cf5-115">Activities store and share data by using the types shown in the following table.</span></span>  
  
|||  
|-|-|  
|<span data-ttu-id="07cf5-116">変数</span><span class="sxs-lookup"><span data-stu-id="07cf5-116">Variable</span></span>|<span data-ttu-id="07cf5-117">データをアクティビティに格納します。</span><span class="sxs-lookup"><span data-stu-id="07cf5-117">Stores data in an activity.</span></span>|  
|<span data-ttu-id="07cf5-118">引数</span><span class="sxs-lookup"><span data-stu-id="07cf5-118">Argument</span></span>|<span data-ttu-id="07cf5-119">データをアクティビティに移動したり、アクティビティから移動したりします。</span><span class="sxs-lookup"><span data-stu-id="07cf5-119">Moves data into and out of an activity.</span></span>|  
|<span data-ttu-id="07cf5-120">式</span><span class="sxs-lookup"><span data-stu-id="07cf5-120">Expression</span></span>|<span data-ttu-id="07cf5-121">引数のバインディングで使用される、昇格された戻り値を持つアクティビティです。</span><span class="sxs-lookup"><span data-stu-id="07cf5-121">An activity with an elevated return value used in argument bindings.</span></span>|  
  
## <a name="workflow-runtime"></a><span data-ttu-id="07cf5-122">ワークフロー ランタイム</span><span class="sxs-lookup"><span data-stu-id="07cf5-122">Workflow Runtime</span></span>  

 <span data-ttu-id="07cf5-123">ワークフロー ランタイムはワークフローが実行される環境です。</span><span class="sxs-lookup"><span data-stu-id="07cf5-123">The workflow runtime is the environment in which workflows execute.</span></span> <span data-ttu-id="07cf5-124"><xref:System.Activities.WorkflowInvoker> はワークフローを実行する最も単純な方法です。</span><span class="sxs-lookup"><span data-stu-id="07cf5-124"><xref:System.Activities.WorkflowInvoker> is the simplest way to execute a workflow.</span></span> <span data-ttu-id="07cf5-125">ホストは、次の処理に <xref:System.Activities.WorkflowInvoker> を使用します。</span><span class="sxs-lookup"><span data-stu-id="07cf5-125">The host uses <xref:System.Activities.WorkflowInvoker> for the following:</span></span>  
  
- <span data-ttu-id="07cf5-126">ワークフローの同期呼び出しを実行する。</span><span class="sxs-lookup"><span data-stu-id="07cf5-126">To synchronously invoke a workflow.</span></span>  
  
- <span data-ttu-id="07cf5-127">ワークフローに入力を行ったり、ワークフローから出力を取り出したりする。</span><span class="sxs-lookup"><span data-stu-id="07cf5-127">To provide input to, or retrieve output from a workflow.</span></span>  
  
- <span data-ttu-id="07cf5-128">アクティビティによって使用される拡張機能を追加する。</span><span class="sxs-lookup"><span data-stu-id="07cf5-128">To add extensions to be used by activities.</span></span>  
  
 <span data-ttu-id="07cf5-129"><xref:System.Activities.ActivityInstance> は、ホストがランタイムとのやり取りに使用できるスレッドセーフなプロキシです。</span><span class="sxs-lookup"><span data-stu-id="07cf5-129"><xref:System.Activities.ActivityInstance> is the thread-safe proxy that hosts can use to interact with the runtime.</span></span> <span data-ttu-id="07cf5-130">ホストは、次の処理に <xref:System.Activities.ActivityInstance> を使用します。</span><span class="sxs-lookup"><span data-stu-id="07cf5-130">The host uses <xref:System.Activities.ActivityInstance> for the following:</span></span>  
  
- <span data-ttu-id="07cf5-131">インスタンスを作成するか、インスタンス ストアから読み込んで、インスタンスを取得する。</span><span class="sxs-lookup"><span data-stu-id="07cf5-131">To acquire an instance by creating it or loading it from an instance store.</span></span>  
  
- <span data-ttu-id="07cf5-132">インスタンスのライフサイクル イベントが通知されるようにする。</span><span class="sxs-lookup"><span data-stu-id="07cf5-132">To be notified of instance life-cycle events.</span></span>  
  
- <span data-ttu-id="07cf5-133">ワークフローの実行を制御する。</span><span class="sxs-lookup"><span data-stu-id="07cf5-133">To control workflow execution.</span></span>  
  
- <span data-ttu-id="07cf5-134">ワークフローに入力を行ったり、ワークフローから出力を取り出したりする。</span><span class="sxs-lookup"><span data-stu-id="07cf5-134">To provide input to, or retrieve output from a workflow.</span></span>  
  
- <span data-ttu-id="07cf5-135">ワークフローの継続を通知し、値をワークフローに渡す。</span><span class="sxs-lookup"><span data-stu-id="07cf5-135">To signal a workflow continuation and pass values into the workflow.</span></span>  
  
- <span data-ttu-id="07cf5-136">ワークフローのデータを永続化する。</span><span class="sxs-lookup"><span data-stu-id="07cf5-136">To persist workflow data.</span></span>  
  
- <span data-ttu-id="07cf5-137">アクティビティによって使用される拡張機能を追加する。</span><span class="sxs-lookup"><span data-stu-id="07cf5-137">To add extensions to be used by activities.</span></span>  
  
 <span data-ttu-id="07cf5-138">アクティビティは、<xref:System.Activities.ActivityContext> または <xref:System.Activities.NativeActivityContext> などの、適切な <xref:System.Activities.CodeActivityContext> 派生クラスを使用してワーク フローのランタイム環境にアクセスできます。</span><span class="sxs-lookup"><span data-stu-id="07cf5-138">Activities gain access to the workflow runtime environment by using the appropriate <xref:System.Activities.ActivityContext> derived class, such as <xref:System.Activities.NativeActivityContext> or <xref:System.Activities.CodeActivityContext>.</span></span> <span data-ttu-id="07cf5-139">これらの要素がこのクラスを使用する目的は、引数や変数の解決や子アクティビティのスケジュール設定など、多岐にわたります。</span><span class="sxs-lookup"><span data-stu-id="07cf5-139">They use this for resolving arguments and variables, for scheduling child activities, and for many other purposes.</span></span>  
  
## <a name="services"></a><span data-ttu-id="07cf5-140">サービス</span><span class="sxs-lookup"><span data-stu-id="07cf5-140">Services</span></span>  

 <span data-ttu-id="07cf5-141">ワークフローは、メッセージング アクティビティを使用して疎結合サービスの実装およびアクセスを行う、無理のない方法です。</span><span class="sxs-lookup"><span data-stu-id="07cf5-141">Workflows provide a natural way to implement and access loosely-coupled services, using messaging activities.</span></span> <span data-ttu-id="07cf5-142">メッセージング アクティビティは WCF 上にビルドされる、ワーク フローとのデータの受け渡しに使用される主要な方法です。</span><span class="sxs-lookup"><span data-stu-id="07cf5-142">Messaging activities are built on WCF and are the primary mechanism used to get data into and out of a workflow.</span></span> <span data-ttu-id="07cf5-143">任意の種類のメッセージ交換パターンをモデル化するため、複数のメッセージング アクティビティを共に作成できます。</span><span class="sxs-lookup"><span data-stu-id="07cf5-143">You can compose messaging activities together to model any kind of message exchange pattern you wish.</span></span> <span data-ttu-id="07cf5-144">詳細については、「[メッセージング アクティビティ](../wcf/feature-details/messaging-activities.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="07cf5-144">For more information, see [Messaging Activities](../wcf/feature-details/messaging-activities.md).</span></span> <span data-ttu-id="07cf5-145">ワークフロー サービスは <xref:System.ServiceModel.Activities.WorkflowServiceHost> クラスを使用してホストされます。</span><span class="sxs-lookup"><span data-stu-id="07cf5-145">Workflow services are hosted using the <xref:System.ServiceModel.Activities.WorkflowServiceHost> class.</span></span> <span data-ttu-id="07cf5-146">詳細については、「[ワークフロー サービスのホストの概要](../wcf/feature-details/hosting-workflow-services-overview.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="07cf5-146">For more information, see [Hosting Workflow Services Overview](../wcf/feature-details/hosting-workflow-services-overview.md).</span></span> <span data-ttu-id="07cf5-147">ワークフロー サービスの詳細については、「[ワークフロー サービス](../wcf/feature-details/workflow-services.md)」を参照してください</span><span class="sxs-lookup"><span data-stu-id="07cf5-147">For more information about workflow services see [Workflow Services](../wcf/feature-details/workflow-services.md)</span></span>  
  
## <a name="persistence-unloading-and-long-running-workflows"></a><span data-ttu-id="07cf5-148">永続性、アンロード、実行時間の長いワークフロー</span><span class="sxs-lookup"><span data-stu-id="07cf5-148">Persistence, Unloading, and Long-Running Workflows</span></span>  

 <span data-ttu-id="07cf5-149">Windows Workflow は次の機能により、実行時間の長いリアクティブなプログラムの作成を簡素化しています。</span><span class="sxs-lookup"><span data-stu-id="07cf5-149">Windows Workflow simplifies the authoring of long-running reactive programs by providing:</span></span>  
  
- <span data-ttu-id="07cf5-150">外部入力にアクセスするアクティビティ</span><span class="sxs-lookup"><span data-stu-id="07cf5-150">Activities that access external input.</span></span>  
  
- <span data-ttu-id="07cf5-151">ホストのリスナーが再開できる <xref:System.Activities.Bookmark> オブジェクトを作成する機能</span><span class="sxs-lookup"><span data-stu-id="07cf5-151">The ability to create <xref:System.Activities.Bookmark> objects that can be resumed by a host listener.</span></span>  
  
- <span data-ttu-id="07cf5-152">ワークフローのデータを永続化してワークフローをアンロードした後、特定のワークフローでの <xref:System.Activities.Bookmark> オブジェクトの再開に反応してワークフローを再読み込みおよび再アクティブ化する機能</span><span class="sxs-lookup"><span data-stu-id="07cf5-152">The ability to persist a workflow’s data and unload the workflow, and then reload and reactivate the workflow in response to the resumption of <xref:System.Activities.Bookmark> objects in a particular workflow.</span></span>  
  
 <span data-ttu-id="07cf5-153">ワークフローは、実行するアクティビティがなくなるか、現在の実行中のすべてのアクティビティが入力を待機するまで、アクティビティを継続して実行します。</span><span class="sxs-lookup"><span data-stu-id="07cf5-153">A workflow continuously executes activities until there are no more activities to execute or until all currently executing activities are waiting for input.</span></span> <span data-ttu-id="07cf5-154">後者の場合、ワークフローはアイドル状態になります。</span><span class="sxs-lookup"><span data-stu-id="07cf5-154">In this latter state, the workflow is idle.</span></span> <span data-ttu-id="07cf5-155">ホストでは、アイドル状態になったワークフローをアンロードし、メッセージが到着したときに実行を継続するためのワークフローを再読み込みすることは一般的です。</span><span class="sxs-lookup"><span data-stu-id="07cf5-155">It is common for a host to unload workflows that have gone idle and to reload them to continue execution when a message arrives.</span></span> <span data-ttu-id="07cf5-156"><xref:System.ServiceModel.Activities.WorkflowServiceHost> によって、この機能が実現されるほか、拡張可能なアンロード ポリシーを使用できます。</span><span class="sxs-lookup"><span data-stu-id="07cf5-156"><xref:System.ServiceModel.Activities.WorkflowServiceHost> provides functionality for this feature and provides an extensible unload policy.</span></span> <span data-ttu-id="07cf5-157">揮発性状態のデータまたは永続化できない他のデータを使用する実行ブロックの場合、アクティビティは <xref:System.Activities.NoPersistHandle> を使用して永続化すべきではないホストを指定できます。</span><span class="sxs-lookup"><span data-stu-id="07cf5-157">For blocks of execution that use volatile state data or other data that cannot be persisted, an activity can indicate to a host that it should not be persisted by using the <xref:System.Activities.NoPersistHandle>.</span></span> <span data-ttu-id="07cf5-158">また、ワークフローは <xref:System.Activities.Statements.Persist> アクティビティを使用して、そのデータを永続ストレージ メディアに永続化することもできます。</span><span class="sxs-lookup"><span data-stu-id="07cf5-158">A workflow can also explicitly persist its data to a durable storage medium by using the <xref:System.Activities.Statements.Persist> activity.</span></span>
