---
title: Mpgo.exe (マネージド プロファイル ガイド付き最適化ツール)
description: Mpgo.exe (マネージド プロファイル ガイド付き最適化ツール) を使用します。 このツールを使用して、ネイティブ イメージ ジェネレーター (Ngen.exe) によって作成されたネイティブ イメージ アセンブリを最適化できます。
ms.date: 03/30/2017
helpviewer_keywords:
- Mpgo.exe
- training scenarios, generating profiles with
- Managed Profile Guided Optimization Tool
- Ngen.exe
- Ngen.exe, profilers and native images
ms.assetid: f6976502-a000-4fbe-aaf5-a7aab9ce4ec2
ms.openlocfilehash: 050822d12ef4e0a7dfa752e4789f9861c4894cfa
ms.sourcegitcommit: 9c589b25b005b9a7f87327646020eb85c3b6306f
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/06/2021
ms.locfileid: "102259383"
---
# <a name="mpgoexe-managed-profile-guided-optimization-tool"></a><span data-ttu-id="080db-104">Mpgo.exe (マネージド プロファイル ガイド付き最適化ツール)</span><span class="sxs-lookup"><span data-stu-id="080db-104">Mpgo.exe (Managed Profile Guided Optimization Tool)</span></span>

<span data-ttu-id="080db-105">マネージド プロファイル ガイド付き最適化ツール (Mpgo.exe) は、[ネイティブ イメージ ジェネレーター (Ngen.exe)](ngen-exe-native-image-generator.md) によって作成されたネイティブ イメージ アセンブリを最適化するために一般的なエンド ユーザー シナリオを使用するコマンド ライン ツールです。</span><span class="sxs-lookup"><span data-stu-id="080db-105">The Managed Profile Guided Optimization Tool (Mpgo.exe) is a command-line tool that uses common end-user scenarios to optimize the native image assemblies that are created by the [Native Image Generator (Ngen.exe)](ngen-exe-native-image-generator.md).</span></span> <span data-ttu-id="080db-106">このツールによって、プロファイル データを生成するトレーニング シナリオを実行できます。</span><span class="sxs-lookup"><span data-stu-id="080db-106">This tool enables you to run training scenarios that generate profile data.</span></span> <span data-ttu-id="080db-107">[ネイティブ イメージ ジェネレーター (Ngen.exe)](ngen-exe-native-image-generator.md) は、このデータを使用して、生成されたネイティブ イメージ アプリケーション アセンブリを最適化します。</span><span class="sxs-lookup"><span data-stu-id="080db-107">The [Native Image Generator (Ngen.exe)](ngen-exe-native-image-generator.md) uses this data to optimize its generated native image application assemblies.</span></span> <span data-ttu-id="080db-108">トレーニングのシナリオでは、アプリケーションで予期される使用について試行します。</span><span class="sxs-lookup"><span data-stu-id="080db-108">A training scenario is a trial run of an expected use of your application.</span></span> <span data-ttu-id="080db-109">Mpgo.exe は、Visual Studio Ultimate 2012 以降のバージョンで使用できます。</span><span class="sxs-lookup"><span data-stu-id="080db-109">Mpgo.exe is available in Visual Studio Ultimate 2012 and later versions.</span></span> <span data-ttu-id="080db-110">Visual Studio 2013 以降では、Windows 8.x Store アプリを最適化するために Mpgo.exe も使用できます。</span><span class="sxs-lookup"><span data-stu-id="080db-110">Starting with Visual Studio 2013, you can also use Mpgo.exe to optimize Windows 8.x Store apps.</span></span>

<span data-ttu-id="080db-111">ガイド付き最適化のプロファイルは、トレーニング シナリオからデータを収集し、ネイティブ イメージのレイアウトを最適化するためにそのデータを使用することによって、アプリケーションの起動時間、メモリ使用率 (ワーキング セット サイズ)、およびスループットを向上させます。</span><span class="sxs-lookup"><span data-stu-id="080db-111">Profile-guided optimization improves application startup time, memory utilization (working set size), and throughput by gathering data from training scenarios and using it to optimize the layout of native images.</span></span>

<span data-ttu-id="080db-112">中間言語 (IL) アセンブリの起動時間および作業セット サイズでパフォーマンスの問題が見つかった場合、Just-In-Time (JIT) コンパイルのコストを回避し、コード共有を容易にするために、最初に Ngen.exe を使用することをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="080db-112">When you encounter performance issues with startup time and working set size for Intermediate Language (IL) assemblies, we recommend that you first use Ngen.exe to eliminate just-in-time (JIT) compilation costs and to facilitate code sharing.</span></span> <span data-ttu-id="080db-113">さらなる向上が必要な場合は、アプリケーションを最適化するために Mpgo.exe を使用できます。</span><span class="sxs-lookup"><span data-stu-id="080db-113">If you need additional improvements, you can then use Mpgo.exe to further optimize your application.</span></span> <span data-ttu-id="080db-114">パフォーマンスの向上を評価するためのベースラインとして、最適化されていないネイティブ イメージ アセンブリからのパフォーマンス データを使用できます。</span><span class="sxs-lookup"><span data-stu-id="080db-114">You can use the performance data from the un-optimized native image assemblies as a baseline to evaluate the performance gains.</span></span> <span data-ttu-id="080db-115">Mpgo.exe を使用することにより、コールド スタートの時間を短縮し、作業セットのサイズを縮小できます。</span><span class="sxs-lookup"><span data-stu-id="080db-115">Using Mpgo.exe may result in faster cold startup times and a smaller working set size.</span></span> <span data-ttu-id="080db-116">Mpgo.exe は、最適化されたネイティブ イメージ アセンブリを作成するために Ngen.exe で使用される IL アセンブリに情報を追加します。</span><span class="sxs-lookup"><span data-stu-id="080db-116">Mpgo.exe adds information to IL assemblies that Ngen.exe uses to create optimized native image assemblies.</span></span> <span data-ttu-id="080db-117">詳しくは、.NET ブログ エントリの「[Improving Launch Performance for your Desktop Applications](https://devblogs.microsoft.com/dotnet/improving-launch-performance-for-your-desktop-applications/)」 (デスクトップ アプリケーションの起動時のパフォーマンスの向上) をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="080db-117">For more information, see the entry [Improving Launch Performance for your Desktop Applications](https://devblogs.microsoft.com/dotnet/improving-launch-performance-for-your-desktop-applications/) in the .NET blog.</span></span>

<span data-ttu-id="080db-118">このツールは、Visual Studio と共に自動的にインストールされます。</span><span class="sxs-lookup"><span data-stu-id="080db-118">This tool is automatically installed with Visual Studio.</span></span> <span data-ttu-id="080db-119">ツールを実行するには、管理者の資格情報を使用して[開発者コマンドライン シェル](/visualstudio/ide/reference/command-prompt-powershell)を使用します。</span><span class="sxs-lookup"><span data-stu-id="080db-119">To run the tool, use a [developer command-line shell](/visualstudio/ide/reference/command-prompt-powershell) with administrator credentials.</span></span>

<span data-ttu-id="080db-120">コマンド プロンプトに次のコマンドを入力します。</span><span class="sxs-lookup"><span data-stu-id="080db-120">Enter the following command at the command prompt:</span></span>

<span data-ttu-id="080db-121">デスクトップ アプリの場合:</span><span class="sxs-lookup"><span data-stu-id="080db-121">For desktop apps:</span></span>

```console
mpgo –Scenario <command> [-Import <directory>] –AssemblyList <assembly1>  <assembly2> ... -OutDir <directory> [options]
```

<span data-ttu-id="080db-122">Windows 8.x Store アプリの場合:</span><span class="sxs-lookup"><span data-stu-id="080db-122">For Windows 8.x Store apps:</span></span>

```console
mpgo –Scenario <packageName> -AppID <appId> -Timeout <seconds>
```

## <a name="parameters"></a><span data-ttu-id="080db-123">パラメーター</span><span class="sxs-lookup"><span data-stu-id="080db-123">Parameters</span></span>

 <span data-ttu-id="080db-124">Mpgo.exe では、どの引数も大文字と小文字が区別されません。</span><span class="sxs-lookup"><span data-stu-id="080db-124">All arguments to Mpgo.exe are case-insensitive.</span></span> <span data-ttu-id="080db-125">コマンドには、ダッシュがプレフィックスとして付けられます。</span><span class="sxs-lookup"><span data-stu-id="080db-125">Commands are prefixed with a dash.</span></span>

> [!NOTE]
> <span data-ttu-id="080db-126">必要なコマンドとして `–Scenario` または `–Import` のいずれかを使用できますが、両方は使用できません。</span><span class="sxs-lookup"><span data-stu-id="080db-126">You can use either `–Scenario` or `–Import` as a required command, but not both.</span></span> <span data-ttu-id="080db-127">`–Reset` オプションを指定する場合、必須パラメーターのいずれも使用されません。</span><span class="sxs-lookup"><span data-stu-id="080db-127">None of the required parameters are used if you specify the `–Reset` option.</span></span>

|<span data-ttu-id="080db-128">必須パラメーター</span><span class="sxs-lookup"><span data-stu-id="080db-128">Required parameter</span></span>|<span data-ttu-id="080db-129">説明</span><span class="sxs-lookup"><span data-stu-id="080db-129">Description</span></span>|
|------------------------|-----------------|
|<span data-ttu-id="080db-130">`-Scenario` \<*command*></span><span class="sxs-lookup"><span data-stu-id="080db-130">`-Scenario` \<*command*></span></span><br /><br /> <span data-ttu-id="080db-131">または</span><span class="sxs-lookup"><span data-stu-id="080db-131">—or—</span></span><br /><br /> <span data-ttu-id="080db-132">`-Scenario` \<*packageName*></span><span class="sxs-lookup"><span data-stu-id="080db-132">`-Scenario` \<*packageName*></span></span><br /><br /> <span data-ttu-id="080db-133">\- または -</span><span class="sxs-lookup"><span data-stu-id="080db-133">-or-</span></span><br /><br /> <span data-ttu-id="080db-134">`-Import` \<*directory*></span><span class="sxs-lookup"><span data-stu-id="080db-134">`-Import` \<*directory*></span></span>|<span data-ttu-id="080db-135">デスクトップ アプリでは、コマンド ライン引数も含めて、最適化するアプリケーションを実行するためのコマンド指定のために `–Scenario` を使用します。</span><span class="sxs-lookup"><span data-stu-id="080db-135">For desktop apps, use `–Scenario` to specify the command to run the application you want to optimize, including any command-line arguments.</span></span> <span data-ttu-id="080db-136">スペースを含むパスを指定する場合は、*command* を 3 組の二重引用符で囲みます (例: `mpgo.exe -scenario """C:\My App\myapp.exe""" -assemblylist """C:\My App\myapp.exe""" -outdir "C:\optimized files"`)。</span><span class="sxs-lookup"><span data-stu-id="080db-136">Use three sets of double quotation marks around *command* if it specifies a path that includes spaces; for example: `mpgo.exe -scenario """C:\My App\myapp.exe""" -assemblylist """C:\My App\myapp.exe""" -outdir "C:\optimized files"`.</span></span> <span data-ttu-id="080db-137">二重引用符は使用しません。*command* にスペースが含まれる場合に、正しく機能しません。</span><span class="sxs-lookup"><span data-stu-id="080db-137">Do not use double quotation marks; they will not work correctly if *command* includes spaces.</span></span><br /><br /> <span data-ttu-id="080db-138">\- または -</span><span class="sxs-lookup"><span data-stu-id="080db-138">-or-</span></span><br /><br /> <span data-ttu-id="080db-139">Windows 8.x Store アプリでは、プロファイル情報を生成するパッケージを指定するために `–Scenario` を使用します。</span><span class="sxs-lookup"><span data-stu-id="080db-139">For Windows 8.x Store apps, use `–Scenario` to specify the package that you want to generate profile information for.</span></span> <span data-ttu-id="080db-140">完全なパッケージ名ではなく、パッケージの表示名またはファミリ名を指定した場合、Mpgo.exe では単一の一致のみが存在するときに指定の名前に一致するパッケージが選択されます。</span><span class="sxs-lookup"><span data-stu-id="080db-140">If you specify the package display name or the package family name instead of the full package name, Mpgo.exe will select the package that matches the name you provided if there is only one match.</span></span> <span data-ttu-id="080db-141">指定の名前に複数のパッケージが一致する場合、Mpgo.exe ではパッケージを選択するように求めるプロンプトが表示されます。</span><span class="sxs-lookup"><span data-stu-id="080db-141">If multiple packages match the specified name, Mpgo.exe will prompt you to choose a package.</span></span><br /><br /> <span data-ttu-id="080db-142">または</span><span class="sxs-lookup"><span data-stu-id="080db-142">—or—</span></span><br /><br /> <span data-ttu-id="080db-143">`-Import` でアセンブリを最適化するために、以前に最適化されたアセンブリからの最適化データを使用する旨を指定するには `-AssemblyList` を使用します。</span><span class="sxs-lookup"><span data-stu-id="080db-143">Use `-Import` to specify that optimization data from previously optimized assemblies should be used to optimize the assemblies in `-AssemblyList`.</span></span> <span data-ttu-id="080db-144">*directory* では、以前に最適化されたファイルを含めるディレクトリを指定します。</span><span class="sxs-lookup"><span data-stu-id="080db-144">*directory* specifies the directory that contains the previously optimized files.</span></span> <span data-ttu-id="080db-145">`–AssemblyList` または `–AssemblyListFile` で指定するアセンブリは、インポートされたファイルのデータを使用して最適化されるアセンブリの新しいバージョンです。</span><span class="sxs-lookup"><span data-stu-id="080db-145">The assemblies specified in `–AssemblyList` or `–AssemblyListFile` are the new versions of the assemblies to be optimized using the data from the imported files.</span></span> <span data-ttu-id="080db-146">古いバージョンのアセンブリからの最適化データを使用することによって、シナリオを再実行しなくてもアセンブリの新しいバージョンを最適化できます。</span><span class="sxs-lookup"><span data-stu-id="080db-146">Using optimization data from older version of assemblies enables you to optimize newer versions of assemblies without re-running the scenario.</span></span>  <span data-ttu-id="080db-147">ただし、インポートしたターゲット アセンブリのコードが大きく異なる場合は、最適化データは非効率的になります。</span><span class="sxs-lookup"><span data-stu-id="080db-147">However, if the imported and target assemblies include significantly different code, the optimization data will be ineffective.</span></span> <span data-ttu-id="080db-148">`–AssemblyList` または `–AssemblyListFile` で指定するアセンブリ名は、`–Import`*directory* によって指定するディレクトリに存在する必要があります。</span><span class="sxs-lookup"><span data-stu-id="080db-148">The assembly names specified in `–AssemblyList` or `–AssemblyListFile` must be present in the directory specified by `–Import`*directory*.</span></span> <span data-ttu-id="080db-149">スペースを含むパスを指定する場合は、*directory* を 3 組の二重引用符で囲みます。</span><span class="sxs-lookup"><span data-stu-id="080db-149">Use three sets of double quotation marks around *directory* if it specifies a path that includes spaces.</span></span><br /><br /> <span data-ttu-id="080db-150">`–Scenario` または `–Import` のいずれかを指定する必要がありますが、両方のパラメーターを指定する必要はありません。</span><span class="sxs-lookup"><span data-stu-id="080db-150">You must specify either `–Scenario` or `–Import`, but not both parameters.</span></span>|
|<span data-ttu-id="080db-151">`-OutDir` \<*directory*></span><span class="sxs-lookup"><span data-stu-id="080db-151">`-OutDir` \<*directory*></span></span>|<span data-ttu-id="080db-152">最適化されたアセンブリを配置するディレクトリ。</span><span class="sxs-lookup"><span data-stu-id="080db-152">The directory in which to place the optimized assemblies.</span></span> <span data-ttu-id="080db-153">出力ディレクトリ フォルダーにアセンブリが既に存在する場合、新しいコピーが作成され、その名前にインデックス番号が付加されます (例: *assemblyname*-1.exe)。</span><span class="sxs-lookup"><span data-stu-id="080db-153">If an assembly already exists in the output directory folder, a new copy is created and an index number is appended to its name; for example: *assemblyname*-1.exe.</span></span> <span data-ttu-id="080db-154">スペースを含むパスを指定する場合は、*directory* を二重引用符で囲みます。</span><span class="sxs-lookup"><span data-stu-id="080db-154">Use double quotation marks around *directory* if it specifies a path that contains spaces.</span></span>|
|<span data-ttu-id="080db-155">`-AssemblyList` \<*assembly1 assembly2 ...*></span><span class="sxs-lookup"><span data-stu-id="080db-155">`-AssemblyList` \<*assembly1 assembly2 ...*></span></span><br /><br /> <span data-ttu-id="080db-156">または</span><span class="sxs-lookup"><span data-stu-id="080db-156">—or—</span></span><br /><br /> <span data-ttu-id="080db-157">`-AssemblyListFile` \<*file*></span><span class="sxs-lookup"><span data-stu-id="080db-157">`-AssemblyListFile` \<*file*></span></span>|<span data-ttu-id="080db-158">プロファイル情報を収集するスペースで区切った (.exe ファイルおよび .dll ファイルを含む) アセンブリのリスト。</span><span class="sxs-lookup"><span data-stu-id="080db-158">A list of assemblies (including .exe and .dll files), separated by spaces, that you want collect profile information about.</span></span> <span data-ttu-id="080db-159">`C:\Dir\*.dll` または `*.dll` を指定して、指定した作業ディレクトリまたは現在の作業ディレクトリのアセンブリをすべて選択できます。</span><span class="sxs-lookup"><span data-stu-id="080db-159">You can specify `C:\Dir\*.dll` or `*.dll` to select all the assemblies in the designated or current working directory.</span></span> <span data-ttu-id="080db-160">詳細については、次の「解説」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="080db-160">See the Remarks section for more information.</span></span><br /><br /> <span data-ttu-id="080db-161">または</span><span class="sxs-lookup"><span data-stu-id="080db-161">—or—</span></span><br /><br /> <span data-ttu-id="080db-162">行ごとに 1 つのアセンブリを記述した、プロファイル情報を収集するアセンブリのリストを含むテキスト ファイル。</span><span class="sxs-lookup"><span data-stu-id="080db-162">A text file that contains the list of assemblies you want to collect profile information about, listed one assembly per line.</span></span> <span data-ttu-id="080db-163">アセンブリ名の先頭がハイフン (-) である場合は、アセンブリ ファイル リストを使用するか、またはアセンブリ名を変更します。</span><span class="sxs-lookup"><span data-stu-id="080db-163">If an assembly name begins with a hyphen (-), use an assembly file list or rename the assembly.</span></span>|
|<span data-ttu-id="080db-164">`-AppID` \<*appId*></span><span class="sxs-lookup"><span data-stu-id="080db-164">`-AppID` \<*appId*></span></span>|<span data-ttu-id="080db-165">指定したパッケージのアプリケーション ID。</span><span class="sxs-lookup"><span data-stu-id="080db-165">The ID of the application in the specified package.</span></span> <span data-ttu-id="080db-166">ワイルドカード (\*) を使用する場合、Mpgo.exe によってパッケージ内の AppID の列挙が試行され、失敗した場合は \<*package_family_name*>!App にフォール バックされます。</span><span class="sxs-lookup"><span data-stu-id="080db-166">If you use the wildcard (\*), Mpgo.exe will try to enumerate the AppIDs in the package and will fall back to \<*package_family_name*>!App if it fails.</span></span> <span data-ttu-id="080db-167">感嘆符 (!) のプレフィックスを付けた文字列を指定した場合、Mpgo.exe ではパッケージ ファミリ名と指定した引数が連結されます。</span><span class="sxs-lookup"><span data-stu-id="080db-167">If you specify a string that is prefixed by an exclamation point (!), Mpgo.exe will concatenate the package family name with the argument provided.</span></span>|
|<span data-ttu-id="080db-168">`-Timeout` \<*seconds*></span><span class="sxs-lookup"><span data-stu-id="080db-168">`-Timeout` \<*seconds*></span></span>|<span data-ttu-id="080db-169">Windows 8.x Store アプリが終了するまでに実行を許可される時間。</span><span class="sxs-lookup"><span data-stu-id="080db-169">The amount of time to allow the Windows 8.x Store app to run before the app exits.</span></span>|

|<span data-ttu-id="080db-170">省略可能なパラメーター</span><span class="sxs-lookup"><span data-stu-id="080db-170">Optional parameter</span></span>|<span data-ttu-id="080db-171">説明</span><span class="sxs-lookup"><span data-stu-id="080db-171">Description</span></span>|
|------------------------|-----------------|
|`-64bit`|<span data-ttu-id="080db-172">64 ビット システムのアセンブリをインストルメント化します。</span><span class="sxs-lookup"><span data-stu-id="080db-172">Instruments the assemblies for 64-bit systems.</span></span>  <span data-ttu-id="080db-173">アセンブリ自体が 64 ビットとして宣言していても、このパラメーターを 64 ビット アセンブリ用に指定する必要があります。</span><span class="sxs-lookup"><span data-stu-id="080db-173">You must specify this parameter for 64-bit assemblies, even if your assembly declares itself as 64 bit.</span></span>|
|<span data-ttu-id="080db-174">`-ExeConfig` \<*filename*></span><span class="sxs-lookup"><span data-stu-id="080db-174">`-ExeConfig` \<*filename*></span></span>|<span data-ttu-id="080db-175">シナリオがバージョンおよびローダーの情報を指定するために使用する構成ファイルを指定します。</span><span class="sxs-lookup"><span data-stu-id="080db-175">Specifies the configuration file that your scenario uses to provide version and loader information.</span></span>|
|`-f`|<span data-ttu-id="080db-176">バイナリ アセンブリには、署名済みであってもプロファイル データを強制的に含めます。</span><span class="sxs-lookup"><span data-stu-id="080db-176">Forces the inclusion of the profile data in a binary assembly, even if it's signed.</span></span>  <span data-ttu-id="080db-177">アセンブリが署名されている場合、再署名が必要です。再署名しない場合は、アセンブリの読み込みおよび実行が失敗します。</span><span class="sxs-lookup"><span data-stu-id="080db-177">If the assembly is signed, it must be re-signed; otherwise, the assembly will fail to load and run.</span></span>|
|`-Reset`|<span data-ttu-id="080db-178">中止されたプロファイル セッションがアセンブリに影響しないことを確認するために環境をリセットして、終了します。</span><span class="sxs-lookup"><span data-stu-id="080db-178">Resets the environment to make certain that an aborted profiling session doesn't affect your assemblies, and then quits.</span></span> <span data-ttu-id="080db-179">環境は、プロファイル セッションの前後に既定でリセットされます。</span><span class="sxs-lookup"><span data-stu-id="080db-179">The environment is reset by default before and after a profiling session.</span></span>|
|<span data-ttu-id="080db-180">`-Timeout` \<*time in seconds*></span><span class="sxs-lookup"><span data-stu-id="080db-180">`-Timeout` \<*time in seconds*></span></span>|<span data-ttu-id="080db-181">プロファイルの継続期間を秒単位で指定します。</span><span class="sxs-lookup"><span data-stu-id="080db-181">Specifies the profiling duration in seconds.</span></span> <span data-ttu-id="080db-182">計測した GUI アプリケーションの起動時間よりも少し大きい値を使用します。</span><span class="sxs-lookup"><span data-stu-id="080db-182">Use a value that is slightly more than your observed startup times for GUI applications.</span></span> <span data-ttu-id="080db-183">タイムアウト期間の終了時に、アプリケーションは実行を続行しますが、プロファイル データが記録されます。</span><span class="sxs-lookup"><span data-stu-id="080db-183">At the end of the time-out period, the profile data is recorded although the application continues to run.</span></span> <span data-ttu-id="080db-184">このオプションを設定しない場合、プロファイリングはアプリケーションのシャットダウンまで続行され、その時点までデータが記録されます。</span><span class="sxs-lookup"><span data-stu-id="080db-184">If you don't set this option, profiling will continue until application shutdown, at which time the data will be recorded.</span></span>|
|`-LeaveNativeImages`|<span data-ttu-id="080db-185">インストルメント化されたネイティブ イメージはシナリオの実行後に削除されないことを指定します。</span><span class="sxs-lookup"><span data-stu-id="080db-185">Specifies that the instrumented native images shouldn't be removed after running the scenario.</span></span> <span data-ttu-id="080db-186">このオプションは、主に、実行中のシナリオ用に指定したアプリケーションを取得するときに使用されます。</span><span class="sxs-lookup"><span data-stu-id="080db-186">This option is primarily used when you're getting the application that you specified for the scenario running.</span></span> <span data-ttu-id="080db-187">これにより、Mpgo.exe のその後の実行に対してネイティブ イメージを再生成できなくなります。</span><span class="sxs-lookup"><span data-stu-id="080db-187">It will prevent the recreation of native images for subsequent runs of Mpgo.exe.</span></span> <span data-ttu-id="080db-188">このオプションを指定した場合、アプリケーションの実行の完了後に、キャッシュ内に孤立したネイティブ イメージが存在する可能性があります。</span><span class="sxs-lookup"><span data-stu-id="080db-188">When you have finished running your application, there may be orphaned native images in the cache if you specify this option.</span></span> <span data-ttu-id="080db-189">この場合、同じシナリオおよびアセンブリ リストと共に Mpgo.exe を実行し、`–RemoveNativeImages` パラメーターを使用することによって、こうしたネイティブ イメージを削除します。</span><span class="sxs-lookup"><span data-stu-id="080db-189">In this case, run Mpgo.exe with the same scenario and assembly list and use the `–RemoveNativeImages` parameter to remove these native images.</span></span>|
|`-RemoveNativeImages`|<span data-ttu-id="080db-190">`–LeaveNativeImages` が指定された実行からクリーンアップします。</span><span class="sxs-lookup"><span data-stu-id="080db-190">Cleans up from a run where `–LeaveNativeImages` was specified.</span></span> <span data-ttu-id="080db-191">`-RemoveNativeImages` を指定すると、Mpgo.exe は `-64bit` と `–AssemblyList` を除く引数を無視して、すべてのインストルメントされたネイティブ イメージを削除すると終了します。</span><span class="sxs-lookup"><span data-stu-id="080db-191">If you specify `-RemoveNativeImages`, Mpgo.exe ignores any arguments except `-64bit` and `–AssemblyList`, and exits after removing all instrumented native images.</span></span>|

## <a name="remarks"></a><span data-ttu-id="080db-192">Remarks</span><span class="sxs-lookup"><span data-stu-id="080db-192">Remarks</span></span>

 <span data-ttu-id="080db-193">`–AssemblyList` と `- AssemblyListFile` の両方をコマンド行で複数回、使用できます。</span><span class="sxs-lookup"><span data-stu-id="080db-193">You can use both `–AssemblyList` and `- AssemblyListFile` multiple times on the command line.</span></span>

 <span data-ttu-id="080db-194">アセンブリを指定する際に完全パス名を指定しないと、Mpgo.exe は現在のディレクトリ内を調べます。</span><span class="sxs-lookup"><span data-stu-id="080db-194">If you do not specify full path names when specifying assemblies, Mpgo.exe looks in the current directory.</span></span> <span data-ttu-id="080db-195">正しくないパスを指定した場合、Mpgo.exe がエラー メッセージを表示しますが、他のアセンブリに対するデータの生成は続行されます。</span><span class="sxs-lookup"><span data-stu-id="080db-195">If you specify an incorrect path, Mpgo.exe displays an error message but continues to generate data for other assemblies.</span></span> <span data-ttu-id="080db-196">トレーニング シナリオの実行中に読み込まれていないアセンブリを指定すると、トレーニングのデータがそのアセンブリに対して生成されません。</span><span class="sxs-lookup"><span data-stu-id="080db-196">If you specify an assembly that is not loaded during the training scenario, no training data is generated for that assembly.</span></span>

 <span data-ttu-id="080db-197">リストのアセンブリがグローバル アセンブリ キャッシュ内にある場合、そのアセンブリはプロファイル情報を含めるように更新されません。</span><span class="sxs-lookup"><span data-stu-id="080db-197">If an assembly in the list is in the global assembly cache, it will not be updated to contain the profile information.</span></span>  <span data-ttu-id="080db-198">プロファイル情報を収集するには、グローバル アセンブリ キャッシュから削除します。</span><span class="sxs-lookup"><span data-stu-id="080db-198">Remove it from the global assembly cache to collect profile information.</span></span>

 <span data-ttu-id="080db-199">プリコンパイルされたネイティブ イメージの利点は一般的に、実行時の JIT コンパイルが大幅に除外される場合に限り得られるので、大規模なマネージド アプリケーションでのみ、Ngen.exe および Mpgo.exe を使用することをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="080db-199">The use of Ngen.exe and Mpgo.exe is recommended only for large managed applications, because the benefit of precompiled native images is typically seen only when it eliminates significant JIT compilation at run time.</span></span> <span data-ttu-id="080db-200">作業セットを集中的に使用しない "Hello World" スタイルのアプリケーションに対して Mpgo.exe を実行すると、利点は得られず、Mpgo.exe でプロファイル データの収集に失敗することすらあります。</span><span class="sxs-lookup"><span data-stu-id="080db-200">Running Mpgo.exe on "Hello World" style applications that aren’t working-set intensive will not provide any benefits, and Mpgo.exe may even fail to gather profile data.</span></span>

> [!NOTE]
> <span data-ttu-id="080db-201">Ngen.exe および Mpgo.exe は、ASP.NET アプリケーションおよび Windows Communication Foundation (WCF) サービスでは推奨されません。</span><span class="sxs-lookup"><span data-stu-id="080db-201">Ngen.exe and Mpgo.exe are not recommended for ASP.NET applications and Windows Communication Foundation (WCF) services.</span></span>

## <a name="to-use-mpgoexe"></a><span data-ttu-id="080db-202">Mpgo.exe を使用するには</span><span class="sxs-lookup"><span data-stu-id="080db-202">To Use Mpgo.exe</span></span>

1. <span data-ttu-id="080db-203">Visual Studio Ultimate 2012 およびアプリケーションがインストールされたコンピューターを使用します。</span><span class="sxs-lookup"><span data-stu-id="080db-203">Use a computer that has the Visual Studio Ultimate 2012 and your application installed.</span></span>

2. <span data-ttu-id="080db-204">管理者として必要なパラメーターと共に Mpgo.exe を実行します。</span><span class="sxs-lookup"><span data-stu-id="080db-204">Run Mpgo.exe as an administrator with the necessary parameters.</span></span>  <span data-ttu-id="080db-205">サンプル コマンドについては、次のセクションを参照してください。</span><span class="sxs-lookup"><span data-stu-id="080db-205">See the next section for sample commands.</span></span>

     <span data-ttu-id="080db-206">最適化された中間言語 (IL) アセンブリが `–OutDir` パラメーターによって指定したフォルダー内に作成されます (この例では、`C:\Optimized` フォルダー)。</span><span class="sxs-lookup"><span data-stu-id="080db-206">The optimized intermediate language (IL) assemblies are created in the folder specified by the `–OutDir` parameter (in the examples, this is the `C:\Optimized` folder).</span></span>

3. <span data-ttu-id="080db-207">`–OutDir` によって指定したディレクトリからのプロファイル情報を含む新しい IL アセンブリにより、Ngen.exe で使用する IL アセンブリを置き換えます。</span><span class="sxs-lookup"><span data-stu-id="080db-207">Replace the IL assemblies you used for Ngen.exe  with the new IL assemblies that contain the profile information from the directory specified by `–OutDir`.</span></span>

4. <span data-ttu-id="080db-208">(Mpgo.exe によって提供されるイメージを使用した) アプリケーション セットアップでは、最適化されたネイティブなイメージがインストールされます。</span><span class="sxs-lookup"><span data-stu-id="080db-208">The application setup (using the images provided by Mpgo.exe) will install optimized native images.</span></span>

## <a name="suggested-workflow"></a><span data-ttu-id="080db-209">推奨されるワークフロー</span><span class="sxs-lookup"><span data-stu-id="080db-209">Suggested Workflow</span></span>

1. <span data-ttu-id="080db-210">`–Scenario` パラメーターと共に Mpgo.exe を使用することにより、一連の最適化された IL アセンブリを作成します。</span><span class="sxs-lookup"><span data-stu-id="080db-210">Create a set of optimized IL assemblies by using Mpgo.exe with the `–Scenario` parameter.</span></span>

2. <span data-ttu-id="080db-211">ソース管理に最適化された IL アセンブリをチェックインします。</span><span class="sxs-lookup"><span data-stu-id="080db-211">Check the optimized IL assemblies into source control.</span></span>

3. <span data-ttu-id="080db-212">ビルド プロセスで、Ngen.exe に渡す最適化された IL イメージを生成するために、ビルド後のステップとして `–Import` パラメーターと共に Mpgo.exe を呼び出します。</span><span class="sxs-lookup"><span data-stu-id="080db-212">In the build process, call Mpgo.exe with the `–Import` parameter as a post-build step to generate optimized IL images to pass to Ngen.exe.</span></span>

 <span data-ttu-id="080db-213">このプロセスでは、すべてのアセンブリが最適化データを持つことが保証されます。</span><span class="sxs-lookup"><span data-stu-id="080db-213">This process ensures that all assemblies have optimization data.</span></span> <span data-ttu-id="080db-214">更新および最適化されたアセンブリのチェックインをより頻繁に行う場合 (ステップ 1 および 2)、製品開発全体でパフォーマンス値はより一貫したものになります。</span><span class="sxs-lookup"><span data-stu-id="080db-214">If you check in updated optimized assemblies (steps 1 and 2) more frequently, the performance numbers will be more consistent throughout product development.</span></span>

## <a name="using-mpgoexe-from-visual-studio"></a><span data-ttu-id="080db-215">Visual Studio の Mpgo.exe の使用</span><span class="sxs-lookup"><span data-stu-id="080db-215">Using Mpgo.exe from Visual Studio</span></span>

 <span data-ttu-id="080db-216">Visual Studio から次の制限で Mpgo.exe を実行できます ([方法: ビルド イベントを指定する (C#)](/visualstudio/ide/how-to-specify-build-events-csharp) という記事を参照してください)。</span><span class="sxs-lookup"><span data-stu-id="080db-216">You can run Mpgo.exe from Visual Studio (see the article [How to: Specify Build Events (C#)](/visualstudio/ide/how-to-specify-build-events-csharp)) with the following restrictions:</span></span>

- <span data-ttu-id="080db-217">既定では Visual Studio マクロも末尾でスラッシュを使用するので、末尾にスラッシュを含む引用符付きのパスを使用することはできません。</span><span class="sxs-lookup"><span data-stu-id="080db-217">You cannot use quoted paths with trailing slash marks, because Visual Studio macros also use trailing slash marks by default.</span></span> <span data-ttu-id="080db-218">(たとえば、`–OutDir "C:\Output Folder\"` は無効です。)この制限を回避するために、末尾のスラッシュをエスケープできます。</span><span class="sxs-lookup"><span data-stu-id="080db-218">(For example, `–OutDir "C:\Output Folder\"` is invalid.) To work around this restriction, you can escape the trailing slash.</span></span> <span data-ttu-id="080db-219">(たとえば、代わりに `-OutDir "$(OutDir)\"` を使用します。)</span><span class="sxs-lookup"><span data-stu-id="080db-219">(For example, use `-OutDir "$(OutDir)\"` instead.)</span></span>

- <span data-ttu-id="080db-220">既定では、Mpgo.exe は Visual Studio のビルド パス上にありません。</span><span class="sxs-lookup"><span data-stu-id="080db-220">By default, Mpgo.exe is not on the Visual Studio build path.</span></span> <span data-ttu-id="080db-221">Visual Studio にこのパスを追加するか、Mpgo のコマンド ラインで完全パスを指定する必要があります。</span><span class="sxs-lookup"><span data-stu-id="080db-221">You must either add the path to Visual Studio or specify the full path on the Mpgo command line.</span></span> <span data-ttu-id="080db-222">Visual Studio でビルド後イベントに `–Scenario` または `–Import` パラメーターのいずれかを使用できます。</span><span class="sxs-lookup"><span data-stu-id="080db-222">You can use either the `–Scenario` or the `–Import` parameter in the post-build event in Visual Studio.</span></span> <span data-ttu-id="080db-223">ただし、通常のプロセスでは、Visual Studio 用開発者コマンド プロンプトから `–Scenario` を一度使用し、その後 `–Import` を使用し、各ビルド後に最適化されたアセンブリを更新します (たとえば、`"C:\Program Files\Microsoft Visual Studio 11.0\Team Tools\Performance Tools\mpgo.exe" -import "$(OutDir)tmp" -assemblylist "$(TargetPath)" -outdir "$(OutDir)\"`)。</span><span class="sxs-lookup"><span data-stu-id="080db-223">However, the typical process is to use `–Scenario` one time from a Developer Command Prompt for Visual Studio, and then use `–Import` to update the optimized assemblies after each build; for example:  `"C:\Program Files\Microsoft Visual Studio 11.0\Team Tools\Performance Tools\mpgo.exe" -import "$(OutDir)tmp" -assemblylist "$(TargetPath)" -outdir "$(OutDir)\"`.</span></span>

<a name="samples"></a>

## <a name="examples"></a><span data-ttu-id="080db-224">使用例</span><span class="sxs-lookup"><span data-stu-id="080db-224">Examples</span></span>

 <span data-ttu-id="080db-225">Visual Studio 用開発者コマンド プロンプトから次の Mpgo.exe コマンドにより税処理アプリケーションを最適化します。</span><span class="sxs-lookup"><span data-stu-id="080db-225">The following Mpgo.exe command from a Developer Command Prompt for Visual Studio optimizes a tax application:</span></span>

```console
mpgo –scenario "C:\MyApp\MyTax.exe /params par" –AssemblyList Mytax.dll MyTaxUtil2011.dll –OutDir C:\Optimized –TimeOut 15
```

 <span data-ttu-id="080db-226">次の Mpgo.exe コマンドはサウンド アプリケーションを最適化します。</span><span class="sxs-lookup"><span data-stu-id="080db-226">The following Mpgo.exe command optimizes a sound application:</span></span>

```console
mpgo –scenario "C:\MyApp\wav2wma.exe –input song1.wav –output song1.wma" –AssemblyList transcode.dll –OutDir C:\Optimized –TimeOut 15
```

 <span data-ttu-id="080db-227">次の Mpgo.exe コマンドは、新しいバージョンのアセンブリを最適化するために、以前に最適化されたアセンブリからのデータを使用します。</span><span class="sxs-lookup"><span data-stu-id="080db-227">The following Mpgo.exe command uses data from previously optimized assemblies to optimize newer versions of the assemblies:</span></span>

```console
mpgo.exe -import "C:\Optimized" -assemblylist "C:\MyApp\MyTax.dll" "C:\MyApp\MyTaxUtil2011.dll" -outdir C:\ReOptimized
```

## <a name="see-also"></a><span data-ttu-id="080db-228">関連項目</span><span class="sxs-lookup"><span data-stu-id="080db-228">See also</span></span>

- [<span data-ttu-id="080db-229">Ngen.exe (ネイティブ イメージ ジェネレーター)</span><span class="sxs-lookup"><span data-stu-id="080db-229">Ngen.exe (Native Image Generator)</span></span>](ngen-exe-native-image-generator.md)
- [<span data-ttu-id="080db-230">開発者コマンドライン シェル</span><span class="sxs-lookup"><span data-stu-id="080db-230">Developer command-line shells</span></span>](/visualstudio/ide/reference/command-prompt-powershell)
- [<span data-ttu-id="080db-231">デスクトップ アプリケーションの起動時のパフォーマンスの向上</span><span class="sxs-lookup"><span data-stu-id="080db-231">Improving Launch Performance for your Desktop Applications</span></span>](https://devblogs.microsoft.com/dotnet/improving-launch-performance-for-your-desktop-applications/)
- [<span data-ttu-id="080db-232">.NET Framework 4.5 のパフォーマンスの向上の概要</span><span class="sxs-lookup"><span data-stu-id="080db-232">An Overview of Performance Improvements in .NET Framework 4.5</span></span>](/archive/msdn-magazine/2012/april/clr-an-overview-of-performance-improvements-in-net-4-5)
