---
title: コード アクセス セキュリティ
description: 悪意のあるモバイル コードからコンピューター システムを保護するのに役立つ .NET のコード アクセス セキュリティ メカニズムについて説明します。
ms.date: 03/30/2017
helpviewer_keywords:
- named permission sets, code access security
- call stacks
- malicious code
- stack walk
- security [.NET Framework], code access security
- permissions [.NET Framework], code access security
- trusted code
- mobile code security
- unmanaged code, code access security
- granting permissions, code access security
- user authentication, code access security
- code access security
ms.assetid: 859af632-c80d-4736-8d6f-1e01b09ce127
ms.openlocfilehash: 1119965f971e00b1b795378d9af3977074a696f3
ms.sourcegitcommit: bc293b14af795e0e999e3304dd40c0222cf2ffe4
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 11/26/2020
ms.locfileid: "96288321"
---
# <a name="code-access-security"></a><span data-ttu-id="e7c27-103">コード アクセス セキュリティ</span><span class="sxs-lookup"><span data-stu-id="e7c27-103">Code Access Security</span></span>

[!INCLUDE[net_security_note](../../../includes/net-security-note-md.md)]  

> [!NOTE]
> <span data-ttu-id="e7c27-104">コード アクセス セキュリティは非推奨なので、.NET エコシステム内の最新のコードのほとんどは、部分信頼環境内で動作するようには設計されていません。</span><span class="sxs-lookup"><span data-stu-id="e7c27-104">Because Code Access Security is deprecated, most modern code within the .NET ecosystem is not designed to operate within a partial trust environment.</span></span> <span data-ttu-id="e7c27-105">CAS サンドボックス内で互換性を確保するための明示的なステップをライブラリ開発者が実行していない限り、CAS に依存するアプリケーションでは、最新のライブラリがこれらの環境内で正しく動作することを期待してはなりません。</span><span class="sxs-lookup"><span data-stu-id="e7c27-105">Applications that rely on CAS should not expect modern libraries to behave correctly within these environments, unless the library developer has taken explicit steps to ensure compatibility within the CAS sandbox.</span></span>  

 <span data-ttu-id="e7c27-106">複雑にリンクされた現在のコンピューター システムには、多種多様な、多くの場合は不明なソースからコードが送信されてきます。</span><span class="sxs-lookup"><span data-stu-id="e7c27-106">Today's highly connected computer systems are frequently exposed to code originating from various, possibly unknown sources.</span></span> <span data-ttu-id="e7c27-107">コードは、電子メールに添付されていたり、文書に含まれていたり、インターネットからダウンロードされたりします。</span><span class="sxs-lookup"><span data-stu-id="e7c27-107">Code can be attached to email, contained in documents, or downloaded over the Internet.</span></span> <span data-ttu-id="e7c27-108">ウイルスやワームのような悪意のあるコードによってコンピューター上のデータを破損または破壊され、時間的にも金銭的にも直接の被害を受けた経験のあるユーザーは少なくありません。</span><span class="sxs-lookup"><span data-stu-id="e7c27-108">Unfortunately, many computer users have experienced firsthand the effects of malicious mobile code, including viruses and worms, which can damage or destroy data and cost time and money.</span></span>  
  
 <span data-ttu-id="e7c27-109">ほとんどのセキュリティ機構では、資格情報 (通常はパスワード) に基づいてユーザーに権限を与え、そのユーザーがアクセスできるリソース (多くの場合はディレクトリとファイル) を制限しています。</span><span class="sxs-lookup"><span data-stu-id="e7c27-109">Most common security mechanisms give rights to users based on their credentials (usually a password) and restrict resources (often directories and files) that the user is allowed to access.</span></span> <span data-ttu-id="e7c27-110">しかし、この方法では対処できないさまざまな問題が存在します。たとえば、ユーザーはさまざまなソースからコードを入手しますが、中には信頼できない入手先もあります。コードに、悪意のあるコードからねらわれやすいバグがあったり、脆弱性が潜んでいる可能性もあります。また、コードがユーザーの予期しない動作をする場合もあります。</span><span class="sxs-lookup"><span data-stu-id="e7c27-110">However, this approach fails to address several issues: users obtain code from many sources, some of which might be unreliable; code can contain bugs or vulnerabilities that enable it to be exploited by malicious code; and code sometimes does things that the user does not know it will do.</span></span> <span data-ttu-id="e7c27-111">これらの結果、ユーザーが慎重で信頼できるとしても、実行したソフトウェアが悪意のあるソフトウェアやエラーを含むソフトウェアであった場合は、コンピューター システムが損害を受けたり、機密データが漏洩したりする可能性があります。</span><span class="sxs-lookup"><span data-stu-id="e7c27-111">As a result, computer systems can be damaged and private data can be leaked when cautious and trustworthy users run malicious or error-filled software.</span></span> <span data-ttu-id="e7c27-112">多くのオペレーティング システムのセキュリティ機構では、Web ページ上のスクリプトなどの場合を除き、コードを実行するためには、その細部にわたるまで信頼されていることが要求されます。</span><span class="sxs-lookup"><span data-stu-id="e7c27-112">Most operating system security mechanisms require that every piece of code must be trusted in order to run, except perhaps for scripts on a Web page.</span></span> <span data-ttu-id="e7c27-113">そのため、信頼関係のないコンピューター システム間でも、一方のシステムから送信されたコードをもう一方のシステムで安全に実行できるようにするための、幅広く適用できるセキュリティ機構が必要になります。</span><span class="sxs-lookup"><span data-stu-id="e7c27-113">Therefore, there is still a need for a widely applicable security mechanism that allows code originating from one computer system to execute with protection on another system, even when there is no trust relationship between the systems.</span></span>  
  
 <span data-ttu-id="e7c27-114">コンピューター システムを悪意のあるコードから簡単に保護できるようにしたり、発生元の不明なコードを安全に実行できるようにしたり、信頼されているコードを故意または過失によって露呈したセキュリティの脆弱性から保護できるようにしたりするために、.NET Framework はコード アクセス セキュリティというセキュリティ機構を提供しています。</span><span class="sxs-lookup"><span data-stu-id="e7c27-114">The .NET Framework provides a security mechanism called code access security to help protect computer systems from malicious mobile code, to allow code from unknown origins to run with protection, and to help prevent trusted code from intentionally or accidentally compromising security.</span></span> <span data-ttu-id="e7c27-115">コード アクセス セキュリティにより、コードの発生元や、そのコードの身元を示すその他の基準に基づいて、コードをさまざまなレベルで信頼できます。</span><span class="sxs-lookup"><span data-stu-id="e7c27-115">Code access security enables code to be trusted to varying degrees depending on where the code originates and on other aspects of the code's identity.</span></span> <span data-ttu-id="e7c27-116">また、コードに対してさまざまな信頼レベルを強制的に適用することにより、実行するために完全に信頼されていなければならないコードの数は少なくなります。</span><span class="sxs-lookup"><span data-stu-id="e7c27-116">Code access security also enforces the varying levels of trust on code, which minimizes the amount of code that must be fully trusted in order to run.</span></span> <span data-ttu-id="e7c27-117">コード アクセス セキュリティを使用することで、作成したコードが悪意のあるコードやバグのあるコードによって誤用される可能性も低くなります。</span><span class="sxs-lookup"><span data-stu-id="e7c27-117">Using code access security can reduce the likelihood that your code will be misused by malicious or error-filled code.</span></span> <span data-ttu-id="e7c27-118">コードによって実行できる一連の操作を指定できるため、開発者の責任を軽減できます。</span><span class="sxs-lookup"><span data-stu-id="e7c27-118">It can reduce your liability, because you can specify the set of operations your code should be allowed to perform.</span></span> <span data-ttu-id="e7c27-119">コード アクセス セキュリティは、コードにセキュリティの脆弱性があった場合に、それによって被る可能性のある損害を最小限に抑えるためにも役立ちます。</span><span class="sxs-lookup"><span data-stu-id="e7c27-119">Code access security can also help minimize the damage that can result from security vulnerabilities in your code.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="e7c27-120">.NET Framework 4 で、コード アクセス セキュリティ システムに大幅な変更が加えられています。</span><span class="sxs-lookup"><span data-stu-id="e7c27-120">Major changes have been made to code access security in the .NET Framework 4.</span></span> <span data-ttu-id="e7c27-121">最も重要な変更点は、[透過的セキュリティ](security-transparent-code.md)の導入ですが、コード アクセス セキュリティに影響を及ぼす重要な変更は、このほかにもあります。</span><span class="sxs-lookup"><span data-stu-id="e7c27-121">The most notable change has been [security transparency](security-transparent-code.md), but there are also other significant changes that affect code access security.</span></span> <span data-ttu-id="e7c27-122">これらの変更については、[セキュリティの変更点](/previous-versions/dotnet/framework/security/security-changes)に関する記事を参照してください。</span><span class="sxs-lookup"><span data-stu-id="e7c27-122">For information about these changes, see [Security Changes](/previous-versions/dotnet/framework/security/security-changes).</span></span>  
  
 <span data-ttu-id="e7c27-123">コード アクセス セキュリティは、主にライブラリ コードと部分的に信頼されたアプリケーションに影響します。</span><span class="sxs-lookup"><span data-stu-id="e7c27-123">Code access security primarily affects library code and partially trusted applications.</span></span> <span data-ttu-id="e7c27-124">ライブラリ開発者は、部分的に信頼されたアプリケーションによる認証されていないアクセスからコードを保護する必要があります。</span><span class="sxs-lookup"><span data-stu-id="e7c27-124">Library developers must protect their code from unauthorized access from partially trusted applications.</span></span> <span data-ttu-id="e7c27-125">部分的に信頼されたアプリケーションは、インターネットなどの外部リソースから読み込まれるアプリケーションです。</span><span class="sxs-lookup"><span data-stu-id="e7c27-125">Partially trusted applications are applications that are loaded from external sources such as the Internet.</span></span> <span data-ttu-id="e7c27-126">デスクトップまたはローカル イントラネットにインストールされているアプリケーションは、完全に信頼されたアプリケーションとして実行されます。</span><span class="sxs-lookup"><span data-stu-id="e7c27-126">Applications that are installed on your desktop or on the local intranet run in full trust.</span></span> <span data-ttu-id="e7c27-127">完全に信頼されたアプリケーションは、完全に信頼されているため、[セキュリティ透過的](security-transparent-code.md)とマークされている場合を除き、コード アクセス セキュリティの影響を受けません。</span><span class="sxs-lookup"><span data-stu-id="e7c27-127">Full-trust applications are not affected by code access security unless they are marked as [security-transparent](security-transparent-code.md), because they are fully trusted.</span></span> <span data-ttu-id="e7c27-128">完全に信頼されたアプリケーションの唯一の制限事項は、<xref:System.Security.SecurityTransparentAttribute> 属性でマークされているアプリケーションは <xref:System.Security.SecurityCriticalAttribute> 属性でマークされているコードを呼び出すことができない点です。</span><span class="sxs-lookup"><span data-stu-id="e7c27-128">The only limitation for full-trust applications is that applications that are marked with the <xref:System.Security.SecurityTransparentAttribute> attribute cannot call code that is marked with the <xref:System.Security.SecurityCriticalAttribute> attribute.</span></span> <span data-ttu-id="e7c27-129">部分的に信頼されたアプリケーションは、コード アクセス セキュリティを適用できるように、サンドボックス (Internet Explorer など) で実行する必要があります。</span><span class="sxs-lookup"><span data-stu-id="e7c27-129">Partially trusted applications must be run in a sandbox (for example, in Internet Explorer) so that code access security can be applied.</span></span> <span data-ttu-id="e7c27-130">インターネットからアプリケーションをダウンロードし、デスクトップから実行しようとすると、<xref:System.NotSupportedException> が返されます。このとき、"ネットワーク上の場所からアセンブリの読み込みを試みました。以前のバージョンの .NET Framework では、これによりアセンブリがサンドボックス化されました。</span><span class="sxs-lookup"><span data-stu-id="e7c27-130">If you download an application from the Internet and try to run it from your desktop, you will get a <xref:System.NotSupportedException> with the message: "An attempt was made to load an assembly from a network location, which would have caused the assembly to be sandboxed in previous versions of the .NET Framework.</span></span> <span data-ttu-id="e7c27-131">このリリースの .NET Framework では CAS ポリシーが既定で有効ではないため、この読み込みは危険な場合があります。" というメッセージが表示されます。</span><span class="sxs-lookup"><span data-stu-id="e7c27-131">This release of the .NET Framework does not enable CAS policy by default, so this load may be dangerous."</span></span> <span data-ttu-id="e7c27-132">アプリケーションを確実に信頼できる場合は、[\<loadFromRemoteSources> 要素](../configure-apps/file-schema/runtime/loadfromremotesources-element.md)を使用して、それを完全な信頼として実行できます。</span><span class="sxs-lookup"><span data-stu-id="e7c27-132">If you are sure that the application can be trusted, you can enable it to be run as full trust by using the [\<loadFromRemoteSources> element](../configure-apps/file-schema/runtime/loadfromremotesources-element.md).</span></span> <span data-ttu-id="e7c27-133">アプリケーションをサンドボックス内で実行する方法の詳細については、「[方法: サンドボックスで部分信頼コードを実行する](how-to-run-partially-trusted-code-in-a-sandbox.md)」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="e7c27-133">For information about running an application in a sandbox, see [How to: Run Partially Trusted Code in a Sandbox](how-to-run-partially-trusted-code-in-a-sandbox.md).</span></span>  
  
 <span data-ttu-id="e7c27-134">共通言語ランタイムに対応したマネージド コードすべては、単一コード アクセス セキュリティ呼び出しを行わない場合でも、コード アクセス セキュリティの利点を享受することになります。</span><span class="sxs-lookup"><span data-stu-id="e7c27-134">All managed code that targets the common language runtime receives the benefits of code access security, even if that code does not make a single code access security call.</span></span> <span data-ttu-id="e7c27-135">詳しくは、「[コード アクセス セキュリティの基礎](code-access-security-basics.md)」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="e7c27-135">For more information, see [Code Access Security Basics](code-access-security-basics.md).</span></span>  
  
<a name="key_functions"></a>

## <a name="key-functions-of-code-access-security"></a><span data-ttu-id="e7c27-136">コード アクセス セキュリティの主な機能</span><span class="sxs-lookup"><span data-stu-id="e7c27-136">Key Functions of Code Access Security</span></span>  

 <span data-ttu-id="e7c27-137">コード アクセス セキュリティにより、コードがアクセスする対象を保護されたリソースと保護された操作に制限できます。</span><span class="sxs-lookup"><span data-stu-id="e7c27-137">Code access security helps limit the access that code has to protected resources and operations.</span></span> <span data-ttu-id="e7c27-138">.NET Framework では、コード アクセス セキュリティは次の機能を果たします。</span><span class="sxs-lookup"><span data-stu-id="e7c27-138">In the .NET Framework, code access security performs the following functions:</span></span>  
  
- <span data-ttu-id="e7c27-139">各種システム リソースにアクセスするための権限や権限セットを定義する。</span><span class="sxs-lookup"><span data-stu-id="e7c27-139">Defines permissions and permission sets that represent the right to access various system resources.</span></span>  
  
- <span data-ttu-id="e7c27-140">呼び出し元が特定の権限を所有していることをコードから要求できるようにする。</span><span class="sxs-lookup"><span data-stu-id="e7c27-140">Enables code to demand that its callers have specific permissions.</span></span>  
  
- <span data-ttu-id="e7c27-141">呼び出し元にデジタル署名があることをコード自身が要求できるようにします。これにより、特定の組織またはサイトからの呼び出し元だけが、保護されたコードを呼び出すことができます。</span><span class="sxs-lookup"><span data-stu-id="e7c27-141">Enables code to demand that its callers possess a digital signature, thus allowing only callers from a particular organization or site to call the protected code.</span></span>  
  
- <span data-ttu-id="e7c27-142">呼び出し履歴上で、各呼び出し元に付与された権限を、その呼び出し元に求められる権限と比較することにより、コードに対する制限を実行時に強制する。</span><span class="sxs-lookup"><span data-stu-id="e7c27-142">Enforces restrictions on code at run time by comparing the granted permissions of every caller on the call stack to the permissions that callers must have.</span></span>  
  
<a name="walking_the_call_stack"></a>

## <a name="walking-the-call-stack"></a><span data-ttu-id="e7c27-143">コール スタック ウォークの実行</span><span class="sxs-lookup"><span data-stu-id="e7c27-143">Walking the Call Stack</span></span>  

 <span data-ttu-id="e7c27-144">コードがリソースにアクセスしたり、操作を実行したりすることを許可されているかどうかを判断するために、ランタイムのセキュリティ システムはコール スタック ウォークを行い、コール スタック内の各呼び出し元に与えられているアクセス許可と、確認要求されているアクセス許可とを比較します。</span><span class="sxs-lookup"><span data-stu-id="e7c27-144">To determine whether code is authorized to access a resource or perform an operation, the runtime's security system walks the call stack, comparing the granted permissions of each caller to the permission being demanded.</span></span> <span data-ttu-id="e7c27-145">コール スタックに、確認要求されたアクセス許可を持っていない呼び出し元があった場合は、セキュリティ例外がスローされ、アクセスは拒否されます。</span><span class="sxs-lookup"><span data-stu-id="e7c27-145">If any caller in the call stack does not have the demanded permission, a security exception is thrown and access is refused.</span></span> <span data-ttu-id="e7c27-146">スタック ウォークは、信頼レベルの低いコードが信頼レベルの高いコードを呼び出して利用し、承認されていないアクションを実行しようとする攻撃を防止できるようにするために実行します。</span><span class="sxs-lookup"><span data-stu-id="e7c27-146">The stack walk is designed to help prevent luring attacks, in which less-trusted code calls highly trusted code and uses it to perform unauthorized actions.</span></span> <span data-ttu-id="e7c27-147">コードの呼び出し元すべてに対して実行時にアクセス許可を確認要求することは、確かにパフォーマンスに影響しますが、信頼レベルの低いコードによる攻撃からコードを保護できるようにするためには必要です。</span><span class="sxs-lookup"><span data-stu-id="e7c27-147">Demanding permissions of all callers at run time affects performance, but it is essential to help protect code from luring attacks by less-trusted code.</span></span> <span data-ttu-id="e7c27-148">パフォーマンスを最適化するために、コードで実行されるスタック ウォークを減らすことができます。</span><span class="sxs-lookup"><span data-stu-id="e7c27-148">To optimize performance, you can have your code perform fewer stack walks.</span></span> <span data-ttu-id="e7c27-149">ただし、これを行う場合は必ずセキュリティの脆弱性を露呈しないようにしてください。</span><span class="sxs-lookup"><span data-stu-id="e7c27-149">However, be sure that you don't expose a security weakness whenever you do this.</span></span>  
  
 <span data-ttu-id="e7c27-150">アセンブリ A4 のメソッドが、その呼び出し元にアクセス許可 P が与えられていることを確認要求する場合に、結果として行われるスタック ウォークを次の図に示します。</span><span class="sxs-lookup"><span data-stu-id="e7c27-150">The following illustration shows the stack walk that results when a method in Assembly A4 demands that its callers have permission P.</span></span>  
  
 <span data-ttu-id="e7c27-151">![コード アクセス セキュリティのスタック ウォーク](media/slide-10a.gif "slide_10a")</span><span class="sxs-lookup"><span data-stu-id="e7c27-151">![Code access security stack walk](media/slide-10a.gif "slide_10a")</span></span>
  
<a name="related_topics"></a>

## <a name="related-articles"></a><span data-ttu-id="e7c27-152">関連記事</span><span class="sxs-lookup"><span data-stu-id="e7c27-152">Related articles</span></span>
  
|<span data-ttu-id="e7c27-153">Title</span><span class="sxs-lookup"><span data-stu-id="e7c27-153">Title</span></span>|<span data-ttu-id="e7c27-154">説明</span><span class="sxs-lookup"><span data-stu-id="e7c27-154">Description</span></span>|  
|-----------|-----------------|  
|[<span data-ttu-id="e7c27-155">コード アクセス セキュリティの基礎</span><span class="sxs-lookup"><span data-stu-id="e7c27-155">Code Access Security Basics</span></span>](code-access-security-basics.md)|<span data-ttu-id="e7c27-156">コード アクセス セキュリティとその最も一般的な使用方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="e7c27-156">Describes code access security and its most common uses.</span></span>|  
|[<span data-ttu-id="e7c27-157">透過的セキュリティ コード、レベル 2</span><span class="sxs-lookup"><span data-stu-id="e7c27-157">Security-Transparent Code, Level 2</span></span>](security-transparent-code-level-2.md)|<span data-ttu-id="e7c27-158">.NET Framework 4 のセキュリティ透過モデルについて説明します。</span><span class="sxs-lookup"><span data-stu-id="e7c27-158">Describes the security transparency model in the .NET Framework 4.</span></span>|  
|[<span data-ttu-id="e7c27-159">部分信頼コードからのライブラリの使用</span><span class="sxs-lookup"><span data-stu-id="e7c27-159">Using Libraries from Partially Trusted Code</span></span>](using-libraries-from-partially-trusted-code.md)|<span data-ttu-id="e7c27-160">ライブラリを有効にしてアンマネージ コードと共に使用できるようにする方法と、アンマネージ コードからライブラリを使用する方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="e7c27-160">Describes how to enable libraries for use with unmanaged code and how to use libraries from unmanaged code.</span></span>|  
|[<span data-ttu-id="e7c27-161">セキュリティの基本概念</span><span class="sxs-lookup"><span data-stu-id="e7c27-161">Key Security Concepts</span></span>](../../standard/security/key-security-concepts.md)|<span data-ttu-id="e7c27-162">.NET Framework セキュリティ システムで使用されるさまざまな重要用語と概念について、概要を示します。</span><span class="sxs-lookup"><span data-stu-id="e7c27-162">Provides an overview of many of the key terms and concepts used in the .NET Framework security system.</span></span>|  
|[<span data-ttu-id="e7c27-163">ロール ベースのセキュリティ</span><span class="sxs-lookup"><span data-stu-id="e7c27-163">Role-Based Security</span></span>](../../standard/security/role-based-security.md)|<span data-ttu-id="e7c27-164">ロールに基づいて、セキュリティを組み込む方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="e7c27-164">Describes how to incorporate security based on roles.</span></span>|  
|[<span data-ttu-id="e7c27-165">Cryptographic Services</span><span class="sxs-lookup"><span data-stu-id="e7c27-165">Cryptographic Services</span></span>](../../standard/security/cryptographic-services.md)|<span data-ttu-id="e7c27-166">アプリケーションに暗号を組み込む方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="e7c27-166">Describes how to incorporate cryptography into your applications.</span></span>|
